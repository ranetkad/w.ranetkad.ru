{"config":{"lang":["ru"],"separator":"[\\s\\-\\.]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"index.html","title":"Home","text":"<p>?????</p>"},{"location":"databases/postgresql/admin.html","title":"\u0410\u0434\u043c\u0438\u043d\u0438\u0441\u0442\u0440\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435","text":""},{"location":"databases/postgresql/admin.html#_1","title":"\u0410\u0434\u043c\u0438\u043d\u0438\u0441\u0442\u0440\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435","text":""},{"location":"databases/postgresql/admin.html#_2","title":"\u041a\u043e\u0440\u043e\u0442\u043a\u043e","text":"<p>\u0411\u0430\u0437\u043e\u0432\u044b\u0435 \u043e\u043f\u0435\u0440\u0430\u0446\u0438\u0438: \u0441\u043e\u0437\u0434\u0430\u043d\u0438\u0435 \u0411\u0414/\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u0435\u0439, \u043f\u0440\u0430\u0432\u0430, \u0431\u044d\u043a\u0430\u043f\u044b. \u041a\u043e\u043c\u0430\u043d\u0434\u044b \u0432\u044b\u043f\u043e\u043b\u043d\u044f\u044e\u0442\u0441\u044f \u0432 psql \u0438\u043b\u0438 \u0447\u0435\u0440\u0435\u0437 \u0443\u0442\u0438\u043b\u0438\u0442\u044b pg_dump/pg_restore.</p>"},{"location":"databases/postgresql/admin.html#_3","title":"\u041a\u043e\u043c\u0430\u043d\u0434\u044b","text":"<p>\u0421\u043e\u0437\u0434\u0430\u043d\u0438\u0435 \u0431\u0430\u0437\u044b \u0434\u0430\u043d\u043d\u044b\u0445:</p> SQL<pre><code>CREATE DATABASE mydb;\n</code></pre> <p>\u0423\u0434\u0430\u043b\u0435\u043d\u0438\u0435 \u0431\u0430\u0437\u044b \u0434\u0430\u043d\u043d\u044b\u0445:</p> SQL<pre><code>DROP DATABASE mydb;\n</code></pre> <p>\u0421\u043e\u0437\u0434\u0430\u043d\u0438\u0435 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f:</p> SQL<pre><code>CREATE USER myuser WITH PASSWORD 'secret';\n</code></pre> <p>\u0412\u044b\u0434\u0430\u0442\u044c \u0432\u0441\u0435 \u043f\u0440\u0430\u0432\u0430 \u043d\u0430 \u0411\u0414:</p> SQL<pre><code>GRANT ALL PRIVILEGES ON DATABASE mydb TO myuser;\n</code></pre> <p>\u0418\u0437\u043c\u0435\u043d\u0438\u0442\u044c \u043f\u0430\u0440\u043e\u043b\u044c:</p> SQL<pre><code>ALTER USER myuser WITH PASSWORD 'newpass';\n</code></pre> <p>\u0423\u0434\u0430\u043b\u0438\u0442\u044c \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f:</p> SQL<pre><code>DROP USER myuser;\n</code></pre>"},{"location":"databases/postgresql/admin.html#_4","title":"\u041f\u0440\u0438\u043c\u0435\u0440\u044b","text":"<p>\u0411\u044d\u043a\u0430\u043f \u0431\u0430\u0437\u044b \u0432 SQL-\u0444\u0430\u0439\u043b:</p> Bash<pre><code>pg_dump -d mydb -f backup.sql\n</code></pre> <p>\u0411\u044d\u043a\u0430\u043f \u0432 \u0441\u0436\u0430\u0442\u044b\u0439 \u0444\u043e\u0440\u043c\u0430\u0442 (\u0440\u0435\u043a\u043e\u043c\u0435\u043d\u0434\u0443\u0435\u0442\u0441\u044f \u0434\u043b\u044f \u0431\u043e\u043b\u044c\u0448\u0438\u0445 \u0411\u0414):</p> Bash<pre><code>pg_dump -d mydb -Fc -f backup.dump\n</code></pre> <p>\u0411\u044d\u043a\u0430\u043f \u043e\u0434\u043d\u043e\u0439 \u0442\u0430\u0431\u043b\u0438\u0446\u044b:</p> Bash<pre><code>pg_dump -d mydb -t users -f users.sql\n</code></pre> <p>\u0412\u043e\u0441\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u0435 \u0438\u0437 SQL-\u0444\u0430\u0439\u043b\u0430:</p> Bash<pre><code>psql -d mydb -f backup.sql\n</code></pre> <p>\u0412\u043e\u0441\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u0435 \u0438\u0437 \u0441\u0436\u0430\u0442\u043e\u0433\u043e \u0444\u043e\u0440\u043c\u0430\u0442\u0430:</p> Bash<pre><code>pg_restore -d mydb backup.dump\n</code></pre> <p>\u0412\u043e\u0441\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u0435 \u0441 \u043f\u0435\u0440\u0435\u0441\u043e\u0437\u0434\u0430\u043d\u0438\u0435\u043c \u0411\u0414:</p> Bash<pre><code>pg_restore -C -d postgres backup.dump\n</code></pre> <p>\u0424\u043b\u0430\u0433 <code>-C</code> \u0441\u043e\u0437\u0434\u0430\u0441\u0442 \u0411\u0414 \u043f\u0435\u0440\u0435\u0434 \u0432\u043e\u0441\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u0435\u043c.</p> <p>\u041f\u0430\u0440\u0430\u043b\u043b\u0435\u043b\u044c\u043d\u043e\u0435 \u0432\u043e\u0441\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u0435 (\u0431\u044b\u0441\u0442\u0440\u0435\u0435):</p> Bash<pre><code>pg_restore -d mydb -j 4 backup.dump\n</code></pre>"},{"location":"databases/postgresql/psql.html","title":"psql","text":""},{"location":"databases/postgresql/psql.html#psql","title":"psql","text":""},{"location":"databases/postgresql/psql.html#_1","title":"\u041a\u043e\u0440\u043e\u0442\u043a\u043e","text":"<p>\u041a\u043e\u043d\u0441\u043e\u043b\u044c\u043d\u044b\u0439 \u043a\u043b\u0438\u0435\u043d\u0442 \u0434\u043b\u044f PostgreSQL. \u041f\u043e\u0434\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u0435 \u043a \u0411\u0414, \u0432\u044b\u043f\u043e\u043b\u043d\u0435\u043d\u0438\u0435 SQL, \u043f\u0440\u043e\u0441\u043c\u043e\u0442\u0440 \u0441\u0442\u0440\u0443\u043a\u0442\u0443\u0440\u044b. \u041c\u0435\u0442\u0430-\u043a\u043e\u043c\u0430\u043d\u0434\u044b \u043d\u0430\u0447\u0438\u043d\u0430\u044e\u0442\u0441\u044f \u0441 <code>\\</code>. SQL-\u0437\u0430\u043f\u0440\u043e\u0441\u044b \u0437\u0430\u0432\u0435\u0440\u0448\u0430\u044e\u0442\u0441\u044f <code>;</code>.</p>"},{"location":"databases/postgresql/psql.html#_2","title":"\u041a\u043e\u043c\u0430\u043d\u0434\u044b","text":"<p>\u041f\u043e\u0434\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u0435:</p> Bash<pre><code>psql -U postgres -d mydb -h localhost -p 5432\n</code></pre> <p>\u041f\u043e\u0434\u043a\u043b\u044e\u0447\u0438\u0442\u044c\u0441\u044f \u043a \u0411\u0414 \u043f\u043e\u0434 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u0435\u043c postgres.</p> Bash<pre><code>psql \"postgresql://user:pass@host:5432/dbname\"\n</code></pre> <p>\u041f\u043e\u0434\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u0435 \u0447\u0435\u0440\u0435\u0437 URI.</p> <p>\u041c\u0435\u0442\u0430-\u043a\u043e\u043c\u0430\u043d\u0434\u044b \u0432\u043d\u0443\u0442\u0440\u0438 psql:</p> SQL<pre><code>\\l\n</code></pre> <p>\u0421\u043f\u0438\u0441\u043e\u043a \u0432\u0441\u0435\u0445 \u0431\u0430\u0437 \u0434\u0430\u043d\u043d\u044b\u0445.</p> SQL<pre><code>\\c dbname\n</code></pre> <p>\u041f\u0435\u0440\u0435\u043a\u043b\u044e\u0447\u0438\u0442\u044c\u0441\u044f \u043d\u0430 \u0434\u0440\u0443\u0433\u0443\u044e \u0411\u0414.</p> SQL<pre><code>\\dt\n</code></pre> <p>\u0421\u043f\u0438\u0441\u043e\u043a \u0442\u0430\u0431\u043b\u0438\u0446 \u0432 \u0442\u0435\u043a\u0443\u0449\u0435\u0439 \u0441\u0445\u0435\u043c\u0435.</p> SQL<pre><code>\\d tablename\n</code></pre> <p>\u0421\u0442\u0440\u0443\u043a\u0442\u0443\u0440\u0430 \u0442\u0430\u0431\u043b\u0438\u0446\u044b (\u043a\u043e\u043b\u043e\u043d\u043a\u0438, \u0442\u0438\u043f\u044b, \u0438\u043d\u0434\u0435\u043a\u0441\u044b).</p> SQL<pre><code>\\du\n</code></pre> <p>\u0421\u043f\u0438\u0441\u043e\u043a \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u0435\u0439/\u0440\u043e\u043b\u0435\u0439.</p> SQL<pre><code>\\q\n</code></pre> <p>\u0412\u044b\u0445\u043e\u0434 \u0438\u0437 psql.</p> SQL<pre><code>\\?\n</code></pre> <p>\u0421\u043f\u0440\u0430\u0432\u043a\u0430 \u043f\u043e \u043c\u0435\u0442\u0430-\u043a\u043e\u043c\u0430\u043d\u0434\u0430\u043c.</p>"},{"location":"databases/postgresql/psql.html#_3","title":"\u041f\u0440\u0438\u043c\u0435\u0440\u044b","text":"<p>\u0412\u044b\u043f\u043e\u043b\u043d\u0438\u0442\u044c SQL \u0431\u0435\u0437 \u0432\u0445\u043e\u0434\u0430 \u0432 \u0438\u043d\u0442\u0435\u0440\u0430\u043a\u0442\u0438\u0432\u043d\u044b\u0439 \u0440\u0435\u0436\u0438\u043c:</p> Bash<pre><code>psql -d mydb -c \"SELECT * FROM users LIMIT 10;\"\n</code></pre> <p>\u0412\u044b\u043f\u043e\u043b\u043d\u0438\u0442\u044c SQL-\u0444\u0430\u0439\u043b:</p> Bash<pre><code>psql -d mydb -f script.sql\n</code></pre> <p>\u0421\u043f\u0438\u0441\u043e\u043a \u0442\u0430\u0431\u043b\u0438\u0446 \u0441 \u0440\u0430\u0437\u043c\u0435\u0440\u0430\u043c\u0438:</p> SQL<pre><code>\\dt+\n</code></pre>"},{"location":"infrastructure/kubernetes/architecture.html","title":"\u0410\u0440\u0445\u0438\u0442\u0435\u043a\u0442\u0443\u0440\u0430","text":""},{"location":"infrastructure/kubernetes/architecture.html#_1","title":"\u0410\u0440\u0445\u0438\u0442\u0435\u043a\u0442\u0443\u0440\u0430","text":""},{"location":"infrastructure/kubernetes/architecture.html#_2","title":"\u041a\u043e\u0440\u043e\u0442\u043a\u043e","text":"<p>\u041a\u043b\u0430\u0441\u0442\u0435\u0440 = Control Plane (\u0443\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u0438\u0435) + Worker Nodes (\u0437\u0430\u043f\u0443\u0441\u043a \u043f\u043e\u0434\u043e\u0432). \u0421\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u0435 \u0445\u0440\u0430\u043d\u0438\u0442\u0441\u044f \u0432 etcd. \u0412\u0441\u0435 \u0432\u0437\u0430\u0438\u043c\u043e\u0434\u0435\u0439\u0441\u0442\u0432\u0438\u0435 \u0447\u0435\u0440\u0435\u0437 API Server.</p>"},{"location":"infrastructure/kubernetes/architecture.html#control-plane","title":"Control Plane","text":"<p>kube-apiserver - REST API \u043a\u043b\u0430\u0441\u0442\u0435\u0440\u0430, \u0435\u0434\u0438\u043d\u0430\u044f \u0442\u043e\u0447\u043a\u0430 \u0432\u0445\u043e\u0434\u0430 \u0434\u043b\u044f \u0432\u0441\u0435\u0445 \u043e\u043f\u0435\u0440\u0430\u0446\u0438\u0439.</p> <p>etcd - \u0440\u0430\u0441\u043f\u0440\u0435\u0434\u0435\u043b\u0435\u043d\u043d\u043e\u0435 key-value \u0445\u0440\u0430\u043d\u0438\u043b\u0438\u0449\u0435 \u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u044f \u043a\u043b\u0430\u0441\u0442\u0435\u0440\u0430.</p> <p>kube-scheduler - \u0440\u0430\u0441\u043f\u0440\u0435\u0434\u0435\u043b\u044f\u0435\u0442 \u043f\u043e\u0434\u044b \u043f\u043e \u0443\u0437\u043b\u0430\u043c \u043d\u0430 \u043e\u0441\u043d\u043e\u0432\u0435 \u0440\u0435\u0441\u0443\u0440\u0441\u043e\u0432 \u0438 \u043f\u043e\u043b\u0438\u0442\u0438\u043a.</p> <p>kube-controller-manager - \u0437\u0430\u043f\u0443\u0441\u043a\u0430\u0435\u0442 \u043a\u043e\u043d\u0442\u0440\u043e\u043b\u043b\u0435\u0440\u044b (Node, Deployment, ReplicaSet \u0438 \u0434\u0440.).</p> <p>cloud-controller-manager - \u0438\u043d\u0442\u0435\u0433\u0440\u0430\u0446\u0438\u044f \u0441 \u043e\u0431\u043b\u0430\u0447\u043d\u044b\u043c\u0438 \u043f\u0440\u043e\u0432\u0430\u0439\u0434\u0435\u0440\u0430\u043c\u0438 (\u043e\u043f\u0446\u0438\u043e\u043d\u0430\u043b\u044c\u043d\u043e).</p>"},{"location":"infrastructure/kubernetes/architecture.html#worker-node","title":"Worker Node","text":"<p>kubelet - \u0430\u0433\u0435\u043d\u0442 \u043d\u0430 \u0443\u0437\u043b\u0435, \u0437\u0430\u043f\u0443\u0441\u043a\u0430\u0435\u0442 \u043f\u043e\u0434\u044b, \u043e\u0442\u0447\u0438\u0442\u044b\u0432\u0430\u0435\u0442\u0441\u044f \u0432 API Server.</p> <p>kube-proxy - \u0441\u0435\u0442\u0435\u0432\u043e\u0439 \u043f\u0440\u043e\u043a\u0441\u0438, \u043c\u0430\u0440\u0448\u0440\u0443\u0442\u0438\u0437\u0430\u0446\u0438\u044f \u0442\u0440\u0430\u0444\u0438\u043a\u0430 \u043a \u0441\u0435\u0440\u0432\u0438\u0441\u0430\u043c.</p> <p>Container Runtime - \u0437\u0430\u043f\u0443\u0441\u043a \u043a\u043e\u043d\u0442\u0435\u0439\u043d\u0435\u0440\u043e\u0432 (containerd, CRI-O).</p>"},{"location":"infrastructure/kubernetes/architecture.html#_3","title":"\u0414\u043e\u043f\u043e\u043b\u043d\u0438\u0442\u0435\u043b\u044c\u043d\u044b\u0435 \u043a\u043e\u043c\u043f\u043e\u043d\u0435\u043d\u0442\u044b","text":"<p>CoreDNS - DNS \u0434\u043b\u044f \u0440\u0430\u0437\u0440\u0435\u0448\u0435\u043d\u0438\u044f \u0438\u043c\u0435\u043d \u0441\u0435\u0440\u0432\u0438\u0441\u043e\u0432 \u0432\u043d\u0443\u0442\u0440\u0438 \u043a\u043b\u0430\u0441\u0442\u0435\u0440\u0430.</p> <p>CNI-\u043f\u043b\u0430\u0433\u0438\u043d - \u0441\u0435\u0442\u0435\u0432\u0430\u044f \u043f\u043e\u0434\u0441\u0438\u0441\u0442\u0435\u043c\u0430 (Calico, Flannel, Cilium).</p>"},{"location":"infrastructure/kubernetes/architecture.html#etcd","title":"etcd","text":"<p>\u0411\u044d\u043a\u0430\u043f:</p> Bash<pre><code>etcdctl snapshot save backup.db\n</code></pre> <p>\u0412\u043e\u0441\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u0435:</p> Bash<pre><code>etcdctl snapshot restore backup.db\n</code></pre>"},{"location":"infrastructure/kubernetes/glossary.html","title":"\u0413\u043b\u043e\u0441\u0441\u0430\u0440\u0438\u0439","text":""},{"location":"infrastructure/kubernetes/glossary.html#_1","title":"\u0413\u043b\u043e\u0441\u0441\u0430\u0440\u0438\u0439","text":""},{"location":"infrastructure/kubernetes/glossary.html#_2","title":"\u041a\u043e\u0440\u043e\u0442\u043a\u043e","text":"<p>\u041e\u0441\u043d\u043e\u0432\u043d\u044b\u0435 \u0442\u0435\u0440\u043c\u0438\u043d\u044b Kubernetes. \u0427\u0442\u043e \u0435\u0441\u0442\u044c \u0447\u0442\u043e.</p>"},{"location":"infrastructure/kubernetes/glossary.html#workloads","title":"Workloads","text":"<p>Pod - \u043c\u0438\u043d\u0438\u043c\u0430\u043b\u044c\u043d\u0430\u044f \u0435\u0434\u0438\u043d\u0438\u0446\u0430, \u043e\u0434\u0438\u043d \u0438\u043b\u0438 \u043d\u0435\u0441\u043a\u043e\u043b\u044c\u043a\u043e \u043a\u043e\u043d\u0442\u0435\u0439\u043d\u0435\u0440\u043e\u0432.</p> <p>ReplicaSet - \u043f\u043e\u0434\u0434\u0435\u0440\u0436\u0438\u0432\u0430\u0435\u0442 \u0437\u0430\u0434\u0430\u043d\u043d\u043e\u0435 \u0447\u0438\u0441\u043b\u043e \u0440\u0435\u043f\u043b\u0438\u043a \u043f\u043e\u0434\u043e\u0432.</p> <p>Deployment - \u0443\u043f\u0440\u0430\u0432\u043b\u044f\u0435\u0442 ReplicaSet, \u043f\u043e\u0434\u0434\u0435\u0440\u0436\u0438\u0432\u0430\u0435\u0442 \u0432\u0435\u0440\u0441\u0438\u043e\u043d\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435 \u0438 \u043e\u0442\u043a\u0430\u0442\u044b.</p> <p>StatefulSet - \u0434\u043b\u044f stateful-\u043f\u0440\u0438\u043b\u043e\u0436\u0435\u043d\u0438\u0439 \u0441 \u043f\u043e\u0441\u0442\u043e\u044f\u043d\u043d\u044b\u043c \u0445\u0440\u0430\u043d\u0438\u043b\u0438\u0449\u0435\u043c \u0438 \u0441\u0442\u0430\u0431\u0438\u043b\u044c\u043d\u044b\u043c\u0438 \u0438\u043c\u0435\u043d\u0430\u043c\u0438.</p> <p>DaemonSet - \u0437\u0430\u043f\u0443\u0441\u043a\u0430\u0435\u0442 \u043f\u043e\u0434 \u043d\u0430 \u043a\u0430\u0436\u0434\u043e\u043c \u0443\u0437\u043b\u0435.</p> <p>Job - \u043e\u0434\u043d\u043e\u0440\u0430\u0437\u043e\u0432\u0430\u044f \u0437\u0430\u0434\u0430\u0447\u0430, \u0437\u0430\u0432\u0435\u0440\u0448\u0430\u0435\u0442\u0441\u044f \u043f\u043e\u0441\u043b\u0435 \u0432\u044b\u043f\u043e\u043b\u043d\u0435\u043d\u0438\u044f.</p> <p>CronJob - \u0437\u0430\u043f\u0443\u0441\u043a Job \u043f\u043e \u0440\u0430\u0441\u043f\u0438\u0441\u0430\u043d\u0438\u044e.</p>"},{"location":"infrastructure/kubernetes/glossary.html#_3","title":"\u0421\u0435\u0442\u044c \u0438 \u0434\u043e\u0441\u0442\u0443\u043f","text":"<p>Service - \u0442\u043e\u0447\u043a\u0430 \u0434\u043e\u0441\u0442\u0443\u043f\u0430 \u043a \u0433\u0440\u0443\u043f\u043f\u0435 \u043f\u043e\u0434\u043e\u0432 (ClusterIP, NodePort, LoadBalancer).</p> <p>Ingress - \u043c\u0430\u0440\u0448\u0440\u0443\u0442\u0438\u0437\u0430\u0446\u0438\u044f HTTP/HTTPS \u0442\u0440\u0430\u0444\u0438\u043a\u0430 \u043a \u0441\u0435\u0440\u0432\u0438\u0441\u0430\u043c.</p> <p>Ingress Controller - \u043a\u043e\u043c\u043f\u043e\u043d\u0435\u043d\u0442, \u043e\u0431\u0440\u0430\u0431\u0430\u0442\u044b\u0432\u0430\u044e\u0449\u0438\u0439 Ingress-\u0440\u0435\u0441\u0443\u0440\u0441\u044b.</p> <p>NetworkPolicy - \u043f\u0440\u0430\u0432\u0438\u043b\u0430 \u0441\u0435\u0442\u0435\u0432\u043e\u0439 \u0438\u0437\u043e\u043b\u044f\u0446\u0438\u0438 \u043c\u0435\u0436\u0434\u0443 \u043f\u043e\u0434\u0430\u043c\u0438.</p>"},{"location":"infrastructure/kubernetes/glossary.html#_4","title":"\u041a\u043e\u043d\u0444\u0438\u0433\u0443\u0440\u0430\u0446\u0438\u044f","text":"<p>ConfigMap - \u0445\u0440\u0430\u043d\u0435\u043d\u0438\u0435 \u043a\u043e\u043d\u0444\u0438\u0433\u043e\u0432 \u0432 \u0432\u0438\u0434\u0435 key-value.</p> <p>Secret - \u0445\u0440\u0430\u043d\u0435\u043d\u0438\u0435 \u0447\u0443\u0432\u0441\u0442\u0432\u0438\u0442\u0435\u043b\u044c\u043d\u044b\u0445 \u0434\u0430\u043d\u043d\u044b\u0445 (\u043f\u0430\u0440\u043e\u043b\u0438, \u0442\u043e\u043a\u0435\u043d\u044b).</p>"},{"location":"infrastructure/kubernetes/glossary.html#_5","title":"\u0425\u0440\u0430\u043d\u0438\u043b\u0438\u0449\u0435","text":"<p>PersistentVolume (PV) - \u0440\u0435\u0441\u0443\u0440\u0441 \u0445\u0440\u0430\u043d\u0438\u043b\u0438\u0449\u0430 \u0432 \u043a\u043b\u0430\u0441\u0442\u0435\u0440\u0435.</p> <p>PersistentVolumeClaim (PVC) - \u0437\u0430\u043f\u0440\u043e\u0441 \u043d\u0430 PV \u043e\u0442 \u043f\u043e\u0434\u0430.</p> <p>StorageClass - \u0448\u0430\u0431\u043b\u043e\u043d \u0434\u043b\u044f \u0434\u0438\u043d\u0430\u043c\u0438\u0447\u0435\u0441\u043a\u043e\u0433\u043e \u0441\u043e\u0437\u0434\u0430\u043d\u0438\u044f PV.</p>"},{"location":"infrastructure/kubernetes/glossary.html#_6","title":"\u041e\u0440\u0433\u0430\u043d\u0438\u0437\u0430\u0446\u0438\u044f","text":"<p>Namespace - \u043b\u043e\u0433\u0438\u0447\u0435\u0441\u043a\u043e\u0435 \u0440\u0430\u0437\u0434\u0435\u043b\u0435\u043d\u0438\u0435 \u0440\u0435\u0441\u0443\u0440\u0441\u043e\u0432 \u0432 \u043a\u043b\u0430\u0441\u0442\u0435\u0440\u0435.</p> <p>Label - \u043f\u0430\u0440\u0430 key-value \u0434\u043b\u044f \u043c\u0430\u0440\u043a\u0438\u0440\u043e\u0432\u043a\u0438 \u043e\u0431\u044a\u0435\u043a\u0442\u043e\u0432.</p> <p>Annotation - \u043f\u0440\u043e\u0438\u0437\u0432\u043e\u043b\u044c\u043d\u044b\u0435 \u043c\u0435\u0442\u0430\u0434\u0430\u043d\u043d\u044b\u0435 \u043e\u0431\u044a\u0435\u043a\u0442\u0430.</p>"},{"location":"infrastructure/kubernetes/glossary.html#_7","title":"\u0420\u0430\u0437\u043c\u0435\u0449\u0435\u043d\u0438\u0435 \u043f\u043e\u0434\u043e\u0432","text":"<p>Node Selector - \u0440\u0430\u0437\u043c\u0435\u0449\u0435\u043d\u0438\u0435 \u043f\u043e\u0434\u043e\u0432 \u043f\u043e \u043c\u0435\u0442\u043a\u0430\u043c \u0443\u0437\u043b\u043e\u0432.</p> <p>Affinity - \u0433\u0438\u0431\u043a\u0438\u0435 \u043f\u0440\u0430\u0432\u0438\u043b\u0430 \u0440\u0430\u0437\u043c\u0435\u0449\u0435\u043d\u0438\u044f (\u043f\u0440\u0435\u0434\u043f\u043e\u0447\u0442\u0435\u043d\u0438\u044f/\u0442\u0440\u0435\u0431\u043e\u0432\u0430\u043d\u0438\u044f).</p> <p>Taints/Tolerations - \u0437\u0430\u043f\u0440\u0435\u0442 \u0440\u0430\u0437\u043c\u0435\u0449\u0435\u043d\u0438\u044f \u043d\u0430 \u0443\u0437\u043b\u0430\u0445, \u0435\u0441\u043b\u0438 \u043f\u043e\u0434 \u043d\u0435 \u0438\u043c\u0435\u0435\u0442 toleration.</p>"},{"location":"infrastructure/kubernetes/glossary.html#_8","title":"\u0420\u0435\u0441\u0443\u0440\u0441\u044b","text":"<p>Requests - \u043c\u0438\u043d\u0438\u043c\u0443\u043c \u0440\u0435\u0441\u0443\u0440\u0441\u043e\u0432 \u0434\u043b\u044f \u043f\u043e\u0434\u0430 (\u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442\u0441\u044f scheduler).</p> <p>Limits - \u043c\u0430\u043a\u0441\u0438\u043c\u0443\u043c \u0440\u0435\u0441\u0443\u0440\u0441\u043e\u0432, \u043f\u0440\u0438 \u043f\u0440\u0435\u0432\u044b\u0448\u0435\u043d\u0438\u0438 \u043f\u043e\u0434 \u0443\u0431\u0438\u0432\u0430\u0435\u0442\u0441\u044f (OOM).</p>"},{"location":"infrastructure/kubernetes/glossary.html#probes","title":"Probes","text":"<p>Liveness - \u0436\u0438\u0432 \u043b\u0438 \u043a\u043e\u043d\u0442\u0435\u0439\u043d\u0435\u0440, \u043f\u0440\u0438 \u0441\u0431\u043e\u0435 - \u043f\u0435\u0440\u0435\u0437\u0430\u043f\u0443\u0441\u043a.</p> <p>Readiness - \u0433\u043e\u0442\u043e\u0432 \u043b\u0438 \u043f\u0440\u0438\u043d\u0438\u043c\u0430\u0442\u044c \u0442\u0440\u0430\u0444\u0438\u043a, \u043f\u0440\u0438 \u0441\u0431\u043e\u0435 - \u0438\u0441\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u0435 \u0438\u0437 Service.</p> <p>Startup - \u043f\u0440\u043e\u0432\u0435\u0440\u043a\u0430 \u043f\u0440\u0438 \u0441\u0442\u0430\u0440\u0442\u0435, \u0434\u043e \u0437\u0430\u043f\u0443\u0441\u043a\u0430 liveness/readiness.</p> <p>\u0422\u0438\u043f\u044b \u043f\u0440\u043e\u0431: HTTP GET, TCP Socket, Exec, gRPC.</p>"},{"location":"infrastructure/kubernetes/kubectl.html","title":"kubectl","text":""},{"location":"infrastructure/kubernetes/kubectl.html#kubectl","title":"kubectl","text":""},{"location":"infrastructure/kubernetes/kubectl.html#_1","title":"\u041a\u043e\u0440\u043e\u0442\u043a\u043e","text":"<p>CLI \u0434\u043b\u044f \u0443\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u0438\u044f \u043a\u043b\u0430\u0441\u0442\u0435\u0440\u043e\u043c. \u0412\u0441\u0435 \u043e\u043f\u0435\u0440\u0430\u0446\u0438\u0438: \u043f\u0440\u043e\u0441\u043c\u043e\u0442\u0440, \u0441\u043e\u0437\u0434\u0430\u043d\u0438\u0435, \u0443\u0434\u0430\u043b\u0435\u043d\u0438\u0435, \u043e\u0442\u043b\u0430\u0434\u043a\u0430.</p>"},{"location":"infrastructure/kubernetes/kubectl.html#_2","title":"\u041a\u043e\u043c\u0430\u043d\u0434\u044b","text":"<p>\u041f\u0440\u043e\u0441\u043c\u043e\u0442\u0440 \u0440\u0435\u0441\u0443\u0440\u0441\u043e\u0432:</p> Bash<pre><code>kubectl get pods\n</code></pre> <p>\u041f\u043e\u0434\u044b \u0432 \u0442\u0435\u043a\u0443\u0449\u0435\u043c namespace.</p> Bash<pre><code>kubectl get pods -A\n</code></pre> <p>\u041f\u043e\u0434\u044b \u0432\u043e \u0432\u0441\u0435\u0445 namespace.</p> Bash<pre><code>kubectl get pods -o wide\n</code></pre> <p>\u0420\u0430\u0441\u0448\u0438\u0440\u0435\u043d\u043d\u044b\u0439 \u0432\u044b\u0432\u043e\u0434 (IP, \u0443\u0437\u0435\u043b).</p> Bash<pre><code>kubectl get deploy,svc,pods\n</code></pre> <p>\u041d\u0435\u0441\u043a\u043e\u043b\u044c\u043a\u043e \u0442\u0438\u043f\u043e\u0432 \u0440\u0435\u0441\u0443\u0440\u0441\u043e\u0432 \u0441\u0440\u0430\u0437\u0443.</p> <p>\u0414\u0435\u0442\u0430\u043b\u0438 \u043e\u0431\u044a\u0435\u043a\u0442\u0430:</p> Bash<pre><code>kubectl describe pod my-pod\n</code></pre> <p>\u041f\u043e\u0434\u0440\u043e\u0431\u043d\u0430\u044f \u0438\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u044f: \u0441\u043e\u0431\u044b\u0442\u0438\u044f, \u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u0435, volumes.</p> <p>\u041b\u043e\u0433\u0438:</p> Bash<pre><code>kubectl logs my-pod\n</code></pre> <p>\u041b\u043e\u0433\u0438 \u043f\u043e\u0434\u0430.</p> Bash<pre><code>kubectl logs my-pod -f\n</code></pre> <p>\u0421\u043b\u0435\u0434\u0438\u0442\u044c \u0437\u0430 \u043b\u043e\u0433\u0430\u043c\u0438 (tail -f).</p> Bash<pre><code>kubectl logs my-pod -c my-container\n</code></pre> <p>\u041b\u043e\u0433\u0438 \u043a\u043e\u043d\u043a\u0440\u0435\u0442\u043d\u043e\u0433\u043e \u043a\u043e\u043d\u0442\u0435\u0439\u043d\u0435\u0440\u0430 (\u0435\u0441\u043b\u0438 \u043d\u0435\u0441\u043a\u043e\u043b\u044c\u043a\u043e).</p> Bash<pre><code>kubectl logs my-pod --previous\n</code></pre> <p>\u041b\u043e\u0433\u0438 \u043f\u0440\u0435\u0434\u044b\u0434\u0443\u0449\u0435\u0433\u043e \u043a\u043e\u043d\u0442\u0435\u0439\u043d\u0435\u0440\u0430 (\u043f\u043e\u0441\u043b\u0435 \u0440\u0435\u0441\u0442\u0430\u0440\u0442\u0430).</p> <p>\u0412\u044b\u043f\u043e\u043b\u043d\u0435\u043d\u0438\u0435 \u043a\u043e\u043c\u0430\u043d\u0434:</p> Bash<pre><code>kubectl exec my-pod -- ls /app\n</code></pre> <p>\u0412\u044b\u043f\u043e\u043b\u043d\u0438\u0442\u044c \u043a\u043e\u043c\u0430\u043d\u0434\u0443 \u0432 \u043f\u043e\u0434\u0435.</p> Bash<pre><code>kubectl exec -it my-pod -- /bin/sh\n</code></pre> <p>\u0418\u043d\u0442\u0435\u0440\u0430\u043a\u0442\u0438\u0432\u043d\u044b\u0439 shell.</p> <p>\u041f\u0440\u0438\u043c\u0435\u043d\u0435\u043d\u0438\u0435 \u043c\u0430\u043d\u0438\u0444\u0435\u0441\u0442\u043e\u0432:</p> Bash<pre><code>kubectl apply -f manifest.yaml\n</code></pre> <p>\u0421\u043e\u0437\u0434\u0430\u0442\u044c/\u043e\u0431\u043d\u043e\u0432\u0438\u0442\u044c \u0440\u0435\u0441\u0443\u0440\u0441\u044b \u0438\u0437 \u0444\u0430\u0439\u043b\u0430.</p> Bash<pre><code>kubectl apply -f ./manifests/\n</code></pre> <p>\u041f\u0440\u0438\u043c\u0435\u043d\u0438\u0442\u044c \u0432\u0441\u0435 \u0444\u0430\u0439\u043b\u044b \u0438\u0437 \u0434\u0438\u0440\u0435\u043a\u0442\u043e\u0440\u0438\u0438.</p> <p>\u0423\u0434\u0430\u043b\u0435\u043d\u0438\u0435:</p> Bash<pre><code>kubectl delete pod my-pod\n</code></pre> <p>\u0423\u0434\u0430\u043b\u0438\u0442\u044c \u043f\u043e\u0434.</p> Bash<pre><code>kubectl delete -f manifest.yaml\n</code></pre> <p>\u0423\u0434\u0430\u043b\u0438\u0442\u044c \u0440\u0435\u0441\u0443\u0440\u0441\u044b \u0438\u0437 \u0444\u0430\u0439\u043b\u0430.</p> <p>\u041c\u0430\u0441\u0448\u0442\u0430\u0431\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435:</p> Bash<pre><code>kubectl scale deployment my-deploy --replicas=3\n</code></pre> <p>\u0418\u0437\u043c\u0435\u043d\u0438\u0442\u044c \u0447\u0438\u0441\u043b\u043e \u0440\u0435\u043f\u043b\u0438\u043a.</p> <p>Rollout (\u0434\u0435\u043f\u043b\u043e\u0439):</p> Bash<pre><code>kubectl rollout status deployment/my-deploy\n</code></pre> <p>\u0421\u0442\u0430\u0442\u0443\u0441 \u0432\u044b\u043a\u0430\u0442\u043a\u0438.</p> Bash<pre><code>kubectl rollout history deployment/my-deploy\n</code></pre> <p>\u0418\u0441\u0442\u043e\u0440\u0438\u044f \u0440\u0435\u0432\u0438\u0437\u0438\u0439.</p> Bash<pre><code>kubectl rollout undo deployment/my-deploy\n</code></pre> <p>\u041e\u0442\u043a\u0430\u0442 \u043d\u0430 \u043f\u0440\u0435\u0434\u044b\u0434\u0443\u0449\u0443\u044e \u0432\u0435\u0440\u0441\u0438\u044e.</p> Bash<pre><code>kubectl rollout restart deployment/my-deploy\n</code></pre> <p>\u041f\u0435\u0440\u0435\u0437\u0430\u043f\u0443\u0441\u043a \u043f\u043e\u0434\u043e\u0432 \u0434\u0435\u043f\u043b\u043e\u0439\u043c\u0435\u043d\u0442\u0430.</p>"},{"location":"infrastructure/kubernetes/kubectl.html#_3","title":"\u041f\u0440\u0438\u043c\u0435\u0440\u044b","text":"<p>\u041d\u0430\u0439\u0442\u0438 \u043f\u043e\u0434\u044b \u043f\u043e \u043b\u0435\u0439\u0431\u043b\u0443:</p> Bash<pre><code>kubectl get pods -l app=nginx\n</code></pre> <p>\u0421\u043c\u043e\u0442\u0440\u0435\u0442\u044c \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u044f \u0432 \u0440\u0435\u0430\u043b\u044c\u043d\u043e\u043c \u0432\u0440\u0435\u043c\u0435\u043d\u0438:</p> Bash<pre><code>kubectl get pods -w\n</code></pre> <p>\u0412\u044b\u0432\u043e\u0434 \u0432 YAML:</p> Bash<pre><code>kubectl get pod my-pod -o yaml\n</code></pre> <p>\u0421\u043e\u0437\u0434\u0430\u0442\u044c deployment:</p> Bash<pre><code>kubectl create deployment nginx --image=nginx\n</code></pre> <p>\u041f\u0440\u043e\u0431\u0440\u043e\u0441 \u043f\u043e\u0440\u0442\u0430 \u0434\u043b\u044f \u043e\u0442\u043b\u0430\u0434\u043a\u0438:</p> Bash<pre><code>kubectl port-forward pod/my-pod 8080:80\n</code></pre>"},{"location":"infrastructure/openstack/cli.html","title":"CLI","text":""},{"location":"infrastructure/openstack/cli.html#cli","title":"CLI","text":""},{"location":"infrastructure/openstack/cli.html#_1","title":"\u041a\u043e\u0440\u043e\u0442\u043a\u043e","text":"<p>Unified CLI \u0434\u043b\u044f OpenStack. \u041f\u0435\u0440\u0435\u0434 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u043d\u0438\u0435\u043c \u043d\u0443\u0436\u043d\u043e source keystonerc \u0444\u0430\u0439\u043b\u0430 \u043f\u0440\u043e\u0435\u043a\u0442\u0430.</p>"},{"location":"infrastructure/openstack/cli.html#_2","title":"\u041a\u043e\u043c\u0430\u043d\u0434\u044b","text":"<p>\u0410\u0443\u0442\u0435\u043d\u0442\u0438\u0444\u0438\u043a\u0430\u0446\u0438\u044f:</p> Bash<pre><code>source keystonerc_admin\n</code></pre> <p>\u0417\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044c credentials \u043f\u0440\u043e\u0435\u043a\u0442\u0430 \u0432 \u043f\u0435\u0440\u0435\u043c\u0435\u043d\u043d\u044b\u0435 \u043e\u043a\u0440\u0443\u0436\u0435\u043d\u0438\u044f.</p> <p>\u0421\u0435\u0440\u0432\u0435\u0440\u044b (\u0412\u041c):</p> Bash<pre><code>openstack server list\n</code></pre> <p>\u0421\u043f\u0438\u0441\u043e\u043a \u0412\u041c.</p> Bash<pre><code>openstack server show my-server\n</code></pre> <p>\u0414\u0435\u0442\u0430\u043b\u0438 \u0412\u041c.</p> Bash<pre><code>openstack server create --image ubuntu --flavor m1.small --network private my-server\n</code></pre> <p>\u0421\u043e\u0437\u0434\u0430\u0442\u044c \u0412\u041c.</p> Bash<pre><code>openstack server delete my-server\n</code></pre> <p>\u0423\u0434\u0430\u043b\u0438\u0442\u044c \u0412\u041c.</p> Bash<pre><code>openstack server stop my-server\nopenstack server start my-server\n</code></pre> <p>\u041e\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c/\u0437\u0430\u043f\u0443\u0441\u0442\u0438\u0442\u044c \u0412\u041c.</p> <p>\u041e\u0431\u0440\u0430\u0437\u044b:</p> Bash<pre><code>openstack image list\n</code></pre> <p>\u0421\u043f\u0438\u0441\u043e\u043a \u043e\u0431\u0440\u0430\u0437\u043e\u0432.</p> <p>Flavors:</p> Bash<pre><code>openstack flavor list\n</code></pre> <p>\u0421\u043f\u0438\u0441\u043e\u043a flavor (\u0442\u0438\u043f\u043e\u0440\u0430\u0437\u043c\u0435\u0440\u044b \u0412\u041c).</p> Bash<pre><code>openstack flavor create --ram 512 --disk 10 --vcpus 1 m1.tiny\n</code></pre> <p>\u0421\u043e\u0437\u0434\u0430\u0442\u044c flavor.</p> <p>\u0421\u0435\u0442\u044c:</p> Bash<pre><code>openstack network list\n</code></pre> <p>\u0421\u043f\u0438\u0441\u043e\u043a \u0441\u0435\u0442\u0435\u0439.</p> Bash<pre><code>openstack network create my-network\n</code></pre> <p>\u0421\u043e\u0437\u0434\u0430\u0442\u044c \u0441\u0435\u0442\u044c.</p> Bash<pre><code>openstack subnet create --network my-network --subnet-range 192.168.1.0/24 my-subnet\n</code></pre> <p>\u0421\u043e\u0437\u0434\u0430\u0442\u044c \u043f\u043e\u0434\u0441\u0435\u0442\u044c.</p> <p>\u0422\u043e\u043c\u0430:</p> Bash<pre><code>openstack volume list\n</code></pre> <p>\u0421\u043f\u0438\u0441\u043e\u043a \u0442\u043e\u043c\u043e\u0432.</p> Bash<pre><code>openstack volume create --size 10 my-volume\n</code></pre> <p>\u0421\u043e\u0437\u0434\u0430\u0442\u044c \u0442\u043e\u043c 10 GB.</p> Bash<pre><code>openstack server add volume my-server my-volume\n</code></pre> <p>\u041f\u043e\u0434\u043a\u043b\u044e\u0447\u0438\u0442\u044c \u0442\u043e\u043c \u043a \u0412\u041c.</p> <p>Security Groups:</p> Bash<pre><code>openstack security group list\n</code></pre> <p>\u0421\u043f\u0438\u0441\u043e\u043a \u0433\u0440\u0443\u043f\u043f.</p> Bash<pre><code>openstack security group rule create default --protocol tcp --dst-port 22\n</code></pre> <p>\u0420\u0430\u0437\u0440\u0435\u0448\u0438\u0442\u044c SSH.</p> Bash<pre><code>openstack security group rule create default --protocol icmp\n</code></pre> <p>\u0420\u0430\u0437\u0440\u0435\u0448\u0438\u0442\u044c ping.</p>"},{"location":"infrastructure/openstack/cli.html#_3","title":"\u041f\u0440\u0438\u043c\u0435\u0440\u044b","text":"<p>\u0412\u044b\u0432\u043e\u0434 \u0432 JSON:</p> Bash<pre><code>openstack server list -f json\n</code></pre> <p>\u0424\u0438\u043b\u044c\u0442\u0440\u0430\u0446\u0438\u044f:</p> Bash<pre><code>openstack server list | grep running\n</code></pre>"},{"location":"infrastructure/openstack/services.html","title":"\u0421\u0435\u0440\u0432\u0438\u0441\u044b","text":""},{"location":"infrastructure/openstack/services.html#_1","title":"\u0421\u0435\u0440\u0432\u0438\u0441\u044b","text":""},{"location":"infrastructure/openstack/services.html#_2","title":"\u041a\u043e\u0440\u043e\u0442\u043a\u043e","text":"<p>\u041e\u0441\u043d\u043e\u0432\u043d\u044b\u0435 \u0441\u0435\u0440\u0432\u0438\u0441\u044b OpenStack: \u043f\u043e\u0440\u0442\u044b, \u043a\u043e\u043d\u0444\u0438\u0433\u0438, \u043b\u043e\u0433\u0438. \u0411\u044b\u0441\u0442\u0440\u0430\u044f \u0441\u043f\u0440\u0430\u0432\u043a\u0430.</p>"},{"location":"infrastructure/openstack/services.html#keystone-identity","title":"Keystone (Identity)","text":"<p>\u0410\u0443\u0442\u0435\u043d\u0442\u0438\u0444\u0438\u043a\u0430\u0446\u0438\u044f \u0438 \u0430\u0432\u0442\u043e\u0440\u0438\u0437\u0430\u0446\u0438\u044f.</p> <ul> <li>\u041f\u043e\u0440\u0442\u044b: 5000, 35357</li> <li>\u041a\u043e\u043d\u0444\u0438\u0433: <code>/etc/keystone/keystone.conf</code></li> <li>\u041b\u043e\u0433\u0438: <code>/var/log/keystone.log</code></li> <li>\u041f\u0430\u043a\u0435\u0442: <code>openstack-keystone</code></li> </ul>"},{"location":"infrastructure/openstack/services.html#nova-compute","title":"Nova (Compute)","text":"<p>\u0423\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u0438\u0435 \u0432\u0438\u0440\u0442\u0443\u0430\u043b\u044c\u043d\u044b\u043c\u0438 \u043c\u0430\u0448\u0438\u043d\u0430\u043c\u0438.</p> <ul> <li>\u041f\u043e\u0440\u0442\u044b: 8774 (API), 8775, 5900-5999 (VNC)</li> <li>\u041a\u043e\u043d\u0444\u0438\u0433: <code>/etc/nova/nova.conf</code></li> <li>\u041b\u043e\u0433\u0438: <code>/var/log/nova/</code></li> <li>\u041f\u0430\u043a\u0435\u0442: <code>openstack-nova</code></li> <li>\u0421\u0435\u0440\u0432\u0438\u0441\u044b: <code>openstack-nova-api</code>, <code>openstack-nova-scheduler</code>, <code>openstack-nova-conductor</code>, <code>openstack-nova-compute</code></li> </ul>"},{"location":"infrastructure/openstack/services.html#glance-image","title":"Glance (Image)","text":"<p>\u0425\u0440\u0430\u043d\u0435\u043d\u0438\u0435 \u043e\u0431\u0440\u0430\u0437\u043e\u0432 \u0412\u041c.</p> <ul> <li>\u041f\u043e\u0440\u0442: 9292</li> <li>\u041a\u043e\u043d\u0444\u0438\u0433\u0438: <code>/etc/glance/glance-api.conf</code>, <code>/etc/glance/glance-registry.conf</code></li> <li>\u041b\u043e\u0433\u0438: <code>/var/log/glance/</code></li> <li>\u041f\u0430\u043a\u0435\u0442: <code>openstack-glance</code></li> <li>\u0421\u0435\u0440\u0432\u0438\u0441\u044b: <code>openstack-glance-api</code>, <code>openstack-glance-registry</code></li> </ul>"},{"location":"infrastructure/openstack/services.html#neutron-networking","title":"Neutron (Networking)","text":"<p>\u0421\u0435\u0442\u044c \u0434\u043b\u044f \u0412\u041c.</p> <ul> <li>\u041f\u043e\u0440\u0442: 9696</li> <li>\u041a\u043e\u043d\u0444\u0438\u0433\u0438: <code>/etc/neutron/</code></li> <li>\u041b\u043e\u0433\u0438: <code>/var/log/neutron/</code></li> <li>\u041f\u0430\u043a\u0435\u0442: <code>openstack-neutron</code></li> </ul>"},{"location":"infrastructure/openstack/services.html#cinder-block-storage","title":"Cinder (Block Storage)","text":"<p>\u0411\u043b\u043e\u0447\u043d\u044b\u0435 \u0442\u043e\u043c\u0430 \u0434\u043b\u044f \u0412\u041c.</p> <ul> <li>\u041f\u043e\u0440\u0442\u044b: 8776 (API), 3260 (iSCSI)</li> <li>\u041a\u043e\u043d\u0444\u0438\u0433: <code>/etc/cinder/cinder.conf</code></li> <li>\u041b\u043e\u0433\u0438: <code>/var/log/cinder/</code></li> <li>\u041f\u0430\u043a\u0435\u0442: <code>openstack-cinder</code></li> <li>\u0421\u0435\u0440\u0432\u0438\u0441\u044b: <code>openstack-cinder-api</code>, <code>openstack-cinder-scheduler</code>, <code>openstack-cinder-volume</code></li> </ul>"},{"location":"infrastructure/openstack/services.html#swift-object-storage","title":"Swift (Object Storage)","text":"<p>\u041e\u0431\u044a\u0435\u043a\u0442\u043d\u043e\u0435 \u0445\u0440\u0430\u043d\u0438\u043b\u0438\u0449\u0435.</p> <ul> <li>\u041f\u043e\u0440\u0442\u044b: 8080 (proxy), 6000-6002, 873 (rsync)</li> <li>\u041a\u043e\u043d\u0444\u0438\u0433\u0438: <code>/etc/swift/</code></li> <li>\u041b\u043e\u0433\u0438: <code>/var/log/messages</code></li> <li>\u041f\u0430\u043a\u0435\u0442\u044b: <code>openstack-swift-*</code></li> <li>\u0421\u0435\u0440\u0432\u0438\u0441\u044b: <code>openstack-swift-proxy</code>, <code>openstack-swift-object</code>, <code>openstack-swift-container</code>, <code>openstack-swift-account</code></li> </ul>"},{"location":"linux/dpdk/index.html","title":"DPDK","text":""},{"location":"linux/dpdk/index.html#dpdk","title":"DPDK","text":""},{"location":"linux/dpdk/index.html#_1","title":"\u041a\u043e\u0440\u043e\u0442\u043a\u043e","text":"<p>Data Plane Development Kit - \u043d\u0430\u0431\u043e\u0440 \u0431\u0438\u0431\u043b\u0438\u043e\u0442\u0435\u043a \u0434\u043b\u044f \u0432\u044b\u0441\u043e\u043a\u043e\u043f\u0440\u043e\u0438\u0437\u0432\u043e\u0434\u0438\u0442\u0435\u043b\u044c\u043d\u043e\u0439 \u043e\u0431\u0440\u0430\u0431\u043e\u0442\u043a\u0438 \u043f\u0430\u043a\u0435\u0442\u043e\u0432 \u0432 userspace. \u0420\u0430\u0437\u0440\u0430\u0431\u043e\u0442\u0430\u043d Intel, \u0441\u0435\u0439\u0447\u0430\u0441 \u043f\u043e\u0434 Linux Foundation.</p> <p>\u0413\u043b\u0430\u0432\u043d\u0430\u044f \u0438\u0434\u0435\u044f: kernel bypass. \u041f\u0430\u043a\u0435\u0442\u044b \u0438\u0434\u0443\u0442 \u043d\u0430\u043f\u0440\u044f\u043c\u0443\u044e \u0438\u0437 NIC \u0432 \u043f\u0440\u0438\u043b\u043e\u0436\u0435\u043d\u0438\u0435, \u043c\u0438\u043d\u0443\u044f \u044f\u0434\u0440\u043e Linux.</p>"},{"location":"linux/dpdk/index.html#_2","title":"\u041f\u0440\u043e\u0431\u043b\u0435\u043c\u0430","text":"<p>\u041a\u043b\u0430\u0441\u0441\u0438\u0447\u0435\u0441\u043a\u0438\u0439 \u043f\u0443\u0442\u044c \u043f\u0430\u043a\u0435\u0442\u0430: NIC -&gt; \u0434\u0440\u0430\u0439\u0432\u0435\u0440 \u044f\u0434\u0440\u0430 -&gt; \u0441\u0435\u0442\u0435\u0432\u043e\u0439 \u0441\u0442\u0435\u043a \u044f\u0434\u0440\u0430 -&gt; socket API -&gt; \u043f\u0440\u0438\u043b\u043e\u0436\u0435\u043d\u0438\u0435.</p> <p>\u041f\u0440\u043e\u0431\u043b\u0435\u043c\u044b \u044d\u0442\u043e\u0433\u043e \u043f\u0443\u0442\u0438: - \u041f\u0440\u0435\u0440\u044b\u0432\u0430\u043d\u0438\u0435 \u043d\u0430 \u043a\u0430\u0436\u0434\u044b\u0439 \u043f\u0430\u043a\u0435\u0442 (\u0438\u043b\u0438 \u0433\u0440\u0443\u043f\u043f\u0443) - Context switch \u043c\u0435\u0436\u0434\u0443 kernel space \u0438 user space - \u041a\u043e\u043f\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435 \u0434\u0430\u043d\u043d\u044b\u0445 \u043c\u0435\u0436\u0434\u0443 \u0431\u0443\u0444\u0435\u0440\u0430\u043c\u0438 - \u0412\u044b\u0434\u0435\u043b\u0435\u043d\u0438\u0435/\u043e\u0441\u0432\u043e\u0431\u043e\u0436\u0434\u0435\u043d\u0438\u0435 sk_buff \u043d\u0430 \u043a\u0430\u0436\u0434\u044b\u0439 \u043f\u0430\u043a\u0435\u0442 - \u041e\u0431\u0440\u0430\u0431\u043e\u0442\u043a\u0430 netfilter/iptables</p> <p>\u041f\u0440\u0438 10 Gbit/s \u0438 \u043f\u0430\u043a\u0435\u0442\u0430\u0445 64 \u0431\u0430\u0439\u0442\u0430: ~14.88 \u043c\u0438\u043b\u043b\u0438\u043e\u043d\u043e\u0432 \u043f\u0430\u043a\u0435\u0442\u043e\u0432 \u0432 \u0441\u0435\u043a\u0443\u043d\u0434\u0443. \u042f\u0434\u0440\u043e \u043d\u0435 \u0441\u043f\u0440\u0430\u0432\u043b\u044f\u0435\u0442\u0441\u044f.</p>"},{"location":"linux/dpdk/index.html#dpdk_1","title":"\u0420\u0435\u0448\u0435\u043d\u0438\u0435 DPDK","text":"<p>\u041f\u0435\u0440\u0435\u043d\u043e\u0441 fast path \u0432 userspace: - \u0414\u0440\u0430\u0439\u0432\u0435\u0440 NIC \u0440\u0430\u0431\u043e\u0442\u0430\u0435\u0442 \u0432 userspace (PMD) - Polling \u0432\u043c\u0435\u0441\u0442\u043e \u043f\u0440\u0435\u0440\u044b\u0432\u0430\u043d\u0438\u0439 - Hugepages \u0434\u043b\u044f \u043f\u0430\u043c\u044f\u0442\u0438 (\u043c\u0435\u043d\u044c\u0448\u0435 TLB misses) - Lockless \u0441\u0442\u0440\u0443\u043a\u0442\u0443\u0440\u044b \u0434\u0430\u043d\u043d\u044b\u0445 - Batch \u043e\u0431\u0440\u0430\u0431\u043e\u0442\u043a\u0430 \u043f\u0430\u043a\u0435\u0442\u043e\u0432 - CPU pinning (lcore \u043f\u0440\u0438\u0432\u044f\u0437\u0430\u043d \u043a \u044f\u0434\u0440\u0443)</p> <p>\u0420\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442: \u043c\u0438\u043b\u043b\u0438\u043e\u043d\u044b pps \u043d\u0430 \u043e\u0431\u044b\u0447\u043d\u043e\u043c CPU.</p>"},{"location":"linux/dpdk/index.html#_3","title":"\u0410\u0440\u0445\u0438\u0442\u0435\u043a\u0442\u0443\u0440\u0430","text":""},{"location":"linux/dpdk/index.html#eal-environment-abstraction-layer","title":"EAL (Environment Abstraction Layer)","text":"<p>\u0418\u043d\u0438\u0446\u0438\u0430\u043b\u0438\u0437\u0430\u0446\u0438\u044f DPDK: - \u0412\u044b\u0434\u0435\u043b\u0435\u043d\u0438\u0435 hugepages - \u041c\u0430\u043f\u043f\u0438\u043d\u0433 \u0443\u0441\u0442\u0440\u043e\u0439\u0441\u0442\u0432 \u0432 userspace - \u041f\u0440\u0438\u0432\u044f\u0437\u043a\u0430 \u043f\u043e\u0442\u043e\u043a\u043e\u0432 \u043a \u044f\u0434\u0440\u0430\u043c CPU - NUMA awareness - \u041b\u043e\u0433\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435, \u0442\u0430\u0439\u043c\u0435\u0440\u044b</p> <p>\u0421\u043a\u0440\u044b\u0432\u0430\u0435\u0442 \u0441\u043f\u0435\u0446\u0438\u0444\u0438\u043a\u0443 \u041e\u0421 \u043e\u0442 \u043f\u0440\u0438\u043b\u043e\u0436\u0435\u043d\u0438\u044f.</p>"},{"location":"linux/dpdk/index.html#pmd-poll-mode-driver","title":"PMD (Poll Mode Driver)","text":"<p>Userspace \u0434\u0440\u0430\u0439\u0432\u0435\u0440 \u0434\u043b\u044f NIC. \u0420\u0430\u0431\u043e\u0442\u0430\u0435\u0442 \u0431\u0435\u0437 \u043f\u0440\u0435\u0440\u044b\u0432\u0430\u043d\u0438\u0439 - \u043f\u043e\u0441\u0442\u043e\u044f\u043d\u043d\u043e \u043e\u043f\u0440\u0430\u0448\u0438\u0432\u0430\u0435\u0442 (poll) RX/TX \u0434\u0435\u0441\u043a\u0440\u0438\u043f\u0442\u043e\u0440\u044b.</p> <p>\u041e\u0434\u0438\u043d lcore (logical core) \u043a\u0440\u0443\u0442\u0438\u0442\u0441\u044f \u0432 busy loop: </p>Text Only<pre><code>while (true) {\n    nb_rx = rte_eth_rx_burst(port, queue, pkts, BURST_SIZE);\n    process(pkts, nb_rx);\n    rte_eth_tx_burst(port, queue, pkts, nb_tx);\n}\n</code></pre><p></p> <p>CPU \u0437\u0430\u043d\u044f\u0442 \u043d\u0430 100%, \u043d\u043e \u043b\u0430\u0442\u0435\u043d\u0442\u043d\u043e\u0441\u0442\u044c \u043c\u0438\u043d\u0438\u043c\u0430\u043b\u044c\u043d\u0430.</p>"},{"location":"linux/dpdk/index.html#mempool","title":"Mempool","text":"<p>\u041f\u0443\u043b \u0437\u0430\u0440\u0430\u043d\u0435\u0435 \u0432\u044b\u0434\u0435\u043b\u0435\u043d\u043d\u044b\u0445 \u0431\u0443\u0444\u0435\u0440\u043e\u0432. \u0411\u0443\u0444\u0435\u0440\u044b \u0441\u043e\u0437\u0434\u0430\u044e\u0442\u0441\u044f \u043f\u0440\u0438 \u0441\u0442\u0430\u0440\u0442\u0435, \u043d\u0435 \u0432\u044b\u0434\u0435\u043b\u044f\u044e\u0442\u0441\u044f \u0434\u0438\u043d\u0430\u043c\u0438\u0447\u0435\u0441\u043a\u0438.</p> <p>\u0418\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442 hugepages (2MB \u0438\u043b\u0438 1GB \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u044b). \u041c\u0435\u043d\u044c\u0448\u0435 \u0437\u0430\u043f\u0438\u0441\u0435\u0439 \u0432 TLB, \u043c\u0435\u043d\u044c\u0448\u0435 cache misses.</p>"},{"location":"linux/dpdk/index.html#mbuf","title":"mbuf","text":"<p>\u0421\u0442\u0440\u0443\u043a\u0442\u0443\u0440\u0430 \u0434\u043b\u044f \u0445\u0440\u0430\u043d\u0435\u043d\u0438\u044f \u043f\u0430\u043a\u0435\u0442\u0430. \u0410\u043d\u0430\u043b\u043e\u0433 sk_buff \u0432 \u044f\u0434\u0440\u0435, \u043d\u043e \u043f\u0440\u043e\u0449\u0435 \u0438 \u0431\u044b\u0441\u0442\u0440\u0435\u0435. \u0412\u044b\u0434\u0435\u043b\u044f\u0435\u0442\u0441\u044f \u0438\u0437 mempool.</p>"},{"location":"linux/dpdk/index.html#ring","title":"Ring","text":"<p>Lockless FIFO \u043e\u0447\u0435\u0440\u0435\u0434\u044c. Multi-producer/multi-consumer. \u0418\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442\u0441\u044f \u0434\u043b\u044f \u043f\u0435\u0440\u0435\u0434\u0430\u0447\u0438 \u043f\u0430\u043a\u0435\u0442\u043e\u0432 \u043c\u0435\u0436\u0434\u0443 \u044f\u0434\u0440\u0430\u043c\u0438 \u0432 pipeline \u043c\u043e\u0434\u0435\u043b\u0438.</p>"},{"location":"linux/dpdk/index.html#_4","title":"\u041c\u043e\u0434\u0435\u043b\u0438 \u043e\u0431\u0440\u0430\u0431\u043e\u0442\u043a\u0438","text":""},{"location":"linux/dpdk/index.html#run-to-completion","title":"Run-to-completion","text":"<p>\u041e\u0434\u0438\u043d lcore \u0434\u0435\u043b\u0430\u0435\u0442 \u0432\u0441\u0435: RX -&gt; \u043e\u0431\u0440\u0430\u0431\u043e\u0442\u043a\u0430 -&gt; TX. \u041f\u0430\u043a\u0435\u0442 \u043d\u0435 \u043f\u043e\u043a\u0438\u0434\u0430\u0435\u0442 \u044f\u0434\u0440\u043e.</p> Text Only<pre><code>lcore 1: NIC RX -&gt; parse -&gt; forward -&gt; NIC TX\nlcore 2: NIC RX -&gt; parse -&gt; forward -&gt; NIC TX\n</code></pre> <p>\u041f\u0440\u043e\u0441\u0442\u0430\u044f \u043c\u043e\u0434\u0435\u043b\u044c, \u0445\u043e\u0440\u043e\u0448\u0430\u044f \u043b\u043e\u043a\u0430\u043b\u044c\u043d\u043e\u0441\u0442\u044c \u043a\u044d\u0448\u0430.</p>"},{"location":"linux/dpdk/index.html#pipeline","title":"Pipeline","text":"<p>\u041f\u0430\u043a\u0435\u0442 \u043f\u0440\u043e\u0445\u043e\u0434\u0438\u0442 \u0447\u0435\u0440\u0435\u0437 \u043d\u0435\u0441\u043a\u043e\u043b\u044c\u043a\u043e \u044f\u0434\u0435\u0440. \u041c\u0435\u0436\u0434\u0443 \u044f\u0434\u0440\u0430\u043c\u0438 - ring \u043e\u0447\u0435\u0440\u0435\u0434\u0438.</p> Text Only<pre><code>lcore 1: NIC RX -&gt; ring\nlcore 2: ring -&gt; parse -&gt; ring\nlcore 3: ring -&gt; forward -&gt; NIC TX\n</code></pre> <p>\u0421\u043b\u043e\u0436\u043d\u0435\u0435, \u043d\u043e \u043f\u043e\u0437\u0432\u043e\u043b\u044f\u0435\u0442 \u0440\u0430\u0437\u0434\u0435\u043b\u0438\u0442\u044c \u0442\u044f\u0436\u0435\u043b\u0443\u044e \u043e\u0431\u0440\u0430\u0431\u043e\u0442\u043a\u0443.</p>"},{"location":"linux/dpdk/index.html#binding","title":"Binding \u0443\u0441\u0442\u0440\u043e\u0439\u0441\u0442\u0432","text":"<p>NIC \u043d\u0430\u0434\u043e \u043e\u0442\u0432\u044f\u0437\u0430\u0442\u044c \u043e\u0442 kernel \u0434\u0440\u0430\u0439\u0432\u0435\u0440\u0430 \u0438 \u043f\u0440\u0438\u0432\u044f\u0437\u0430\u0442\u044c \u043a DPDK.</p> <p>Userspace \u0434\u0440\u0430\u0439\u0432\u0435\u0440\u044b \u0434\u043b\u044f \u0434\u043e\u0441\u0442\u0443\u043f\u0430 \u043a PCI: - vfio-pci - \u0441\u043e\u0432\u0440\u0435\u043c\u0435\u043d\u043d\u044b\u0439, \u0431\u0435\u0437\u043e\u043f\u0430\u0441\u043d\u044b\u0439 (IOMMU) - uio_pci_generic - \u0441\u0442\u0430\u0440\u044b\u0439, \u0442\u0440\u0435\u0431\u0443\u0435\u0442 root - igb_uio - DPDK-\u0441\u043f\u0435\u0446\u0438\u0444\u0438\u0447\u043d\u044b\u0439 (deprecated)</p> <p>\u041f\u043e\u0441\u043b\u0435 binding: NIC \u043d\u0435 \u0432\u0438\u0434\u0435\u043d \u0432 <code>ip link</code>, \u0442\u043e\u043b\u044c\u043a\u043e \u0447\u0435\u0440\u0435\u0437 DPDK API.</p>"},{"location":"linux/dpdk/index.html#hugepages","title":"Hugepages","text":"<p>DPDK \u0442\u0440\u0435\u0431\u0443\u0435\u0442 hugepages \u0434\u043b\u044f mempool. \u0421\u0442\u0430\u043d\u0434\u0430\u0440\u0442\u043d\u044b\u0435 4KB \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u044b \u0441\u043e\u0437\u0434\u0430\u044e\u0442 overhead \u043d\u0430 TLB.</p> <p>\u0422\u0438\u043f\u0438\u0447\u043d\u044b\u0435 \u0440\u0430\u0437\u043c\u0435\u0440\u044b: - 2MB hugepages (\u043f\u043e \u0443\u043c\u043e\u043b\u0447\u0430\u043d\u0438\u044e \u043d\u0430 x86) - 1GB hugepages (\u0434\u043b\u044f \u0431\u043e\u043b\u044c\u0448\u0438\u0445 mempool)</p> <p>\u041f\u0430\u043c\u044f\u0442\u044c \u0432\u044b\u0434\u0435\u043b\u044f\u0435\u0442\u0441\u044f \u043f\u0440\u0438 \u0441\u0442\u0430\u0440\u0442\u0435, \u043d\u0435 \u0434\u0438\u043d\u0430\u043c\u0438\u0447\u0435\u0441\u043a\u0438.</p>"},{"location":"linux/dpdk/index.html#numa","title":"NUMA","text":"<p>DPDK \u0443\u0447\u0438\u0442\u044b\u0432\u0430\u0435\u0442 NUMA \u0442\u043e\u043f\u043e\u043b\u043e\u0433\u0438\u044e: - Mempool \u0432\u044b\u0434\u0435\u043b\u044f\u0435\u0442\u0441\u044f \u043d\u0430 \u043d\u0443\u0436\u043d\u043e\u0439 NUMA node - lcore \u0437\u0430\u043f\u0443\u0441\u043a\u0430\u0435\u0442\u0441\u044f \u043d\u0430 \u044f\u0434\u0440\u0435 \u0442\u043e\u0439 \u0436\u0435 NUMA node \u0447\u0442\u043e \u0438 NIC - \u041c\u0438\u043d\u0438\u043c\u0438\u0437\u0430\u0446\u0438\u044f cross-NUMA \u0434\u043e\u0441\u0442\u0443\u043f\u043e\u0432</p>"},{"location":"linux/dpdk/index.html#use-cases","title":"Use cases","text":"<p>\u0421\u0435\u0442\u0435\u0432\u044b\u0435 \u0444\u0443\u043d\u043a\u0446\u0438\u0438 (NFV): - vSwitch (OVS-DPDK) - vRouter (VPP/FD.io) - Firewall, NAT, Load Balancer</p> <p>\u0422\u0435\u043b\u0435\u043a\u043e\u043c: - 5G UPF (User Plane Function) - EPC (Evolved Packet Core) - BNG (Broadband Network Gateway)</p> <p>\u0411\u0435\u0437\u043e\u043f\u0430\u0441\u043d\u043e\u0441\u0442\u044c: - DDoS mitigation - IDS/IPS (Suricata \u0441 DPDK) - Deep Packet Inspection</p> <p>\u0418\u043d\u0444\u0440\u0430\u0441\u0442\u0440\u0443\u043a\u0442\u0443\u0440\u0430: - Traffic generator (TRex) - Packet capture - Network monitoring</p>"},{"location":"linux/dpdk/index.html#_5","title":"\u041e\u0433\u0440\u0430\u043d\u0438\u0447\u0435\u043d\u0438\u044f","text":"<ul> <li>NIC \u043d\u0435 \u0432\u0438\u0434\u0435\u043d \u0432 Linux (\u043d\u0435\u0442 ip link, tcpdump)</li> <li>\u0422\u0440\u0435\u0431\u0443\u0435\u0442 \u0432\u044b\u0434\u0435\u043b\u0435\u043d\u043d\u044b\u0445 CPU \u044f\u0434\u0435\u0440 (100% load)</li> <li>\u0421\u043b\u043e\u0436\u043d\u0435\u0435 \u043e\u0442\u043b\u0430\u0434\u043a\u0430</li> <li>\u041d\u0435 \u0432\u0441\u0435 NIC \u043f\u043e\u0434\u0434\u0435\u0440\u0436\u0438\u0432\u0430\u044e\u0442\u0441\u044f</li> <li>\u0422\u0440\u0435\u0431\u0443\u0435\u0442 hugepages, \u0438\u043d\u043e\u0433\u0434\u0430 IOMMU</li> </ul>"},{"location":"linux/dpdk/index.html#_6","title":"\u0410\u043b\u044c\u0442\u0435\u0440\u043d\u0430\u0442\u0438\u0432\u044b","text":"<p>XDP/eBPF - \u043e\u0431\u0440\u0430\u0431\u043e\u0442\u043a\u0430 \u0432 \u044f\u0434\u0440\u0435, \u043d\u043e \u043e\u0447\u0435\u043d\u044c \u0440\u0430\u043d\u043e (\u0434\u043e \u0441\u0435\u0442\u0435\u0432\u043e\u0433\u043e \u0441\u0442\u0435\u043a\u0430). \u041f\u0440\u043e\u0449\u0435 \u0438\u043d\u0442\u0435\u0433\u0440\u0430\u0446\u0438\u044f \u0441 Linux.</p> <p>AF_XDP - \u0441\u043e\u043a\u0435\u0442\u044b \u0441 zero-copy \u0438\u0437 XDP \u0432 userspace. \u041a\u043e\u043c\u043f\u0440\u043e\u043c\u0438\u0441\u0441 \u043c\u0435\u0436\u0434\u0443 DPDK \u0438 \u044f\u0434\u0440\u043e\u043c.</p> <p>Netmap - \u043f\u043e\u0445\u043e\u0436\u0438\u0439 \u043d\u0430 DPDK \u043f\u043e\u0434\u0445\u043e\u0434, \u043d\u043e \u043c\u0435\u043d\u0435\u0435 \u0440\u0430\u0441\u043f\u0440\u043e\u0441\u0442\u0440\u0430\u043d\u0435\u043d.</p>"},{"location":"linux/ipvs/index.html","title":"IPVS","text":""},{"location":"linux/ipvs/index.html#ipvs","title":"IPVS","text":""},{"location":"linux/ipvs/index.html#_1","title":"\u041a\u043e\u0440\u043e\u0442\u043a\u043e","text":"<p>IP Virtual Server - \u0431\u0430\u043b\u0430\u043d\u0441\u0438\u0440\u043e\u0432\u0449\u0438\u043a \u043d\u0430\u0433\u0440\u0443\u0437\u043a\u0438 L4 \u0432 \u044f\u0434\u0440\u0435 Linux. \u0427\u0430\u0441\u0442\u044c \u043f\u0440\u043e\u0435\u043a\u0442\u0430 LVS (Linux Virtual Server).</p> <p>\u041a\u043b\u0438\u0435\u043d\u0442 \u043e\u0431\u0440\u0430\u0449\u0430\u0435\u0442\u0441\u044f \u043d\u0430 VIP, IPVS \u0440\u0430\u0441\u043f\u0440\u0435\u0434\u0435\u043b\u044f\u0435\u0442 \u0441\u043e\u0435\u0434\u0438\u043d\u0435\u043d\u0438\u044f \u043d\u0430 real servers. \u0420\u0430\u0431\u043e\u0442\u0430\u0435\u0442 \u0441 TCP \u0438 UDP.</p> <p>\u0422\u0440\u0438 \u043c\u0435\u0442\u043e\u0434\u0430 \u0434\u043e\u0441\u0442\u0430\u0432\u043a\u0438: - NAT - \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u0435 dst IP, \u043e\u0442\u0432\u0435\u0442 \u0447\u0435\u0440\u0435\u0437 \u0431\u0430\u043b\u0430\u043d\u0441\u0438\u0440\u043e\u0432\u0449\u0438\u043a - DR (Direct Routing) - \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u0435 MAC, \u043e\u0442\u0432\u0435\u0442 \u043d\u0430\u043f\u0440\u044f\u043c\u0443\u044e \u043a\u043b\u0438\u0435\u043d\u0442\u0443 - TUN (Tunneling) - IPIP \u0438\u043d\u043a\u0430\u043f\u0441\u0443\u043b\u044f\u0446\u0438\u044f</p> <p>\u0418\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442\u0441\u044f \u0432 keepalived, kube-proxy (Kubernetes).</p>"},{"location":"linux/ipvs/index.html#forwarding","title":"\u041c\u0435\u0442\u043e\u0434\u044b forwarding","text":""},{"location":"linux/ipvs/index.html#nat-m","title":"NAT (-m)","text":"<p>\u0411\u0430\u043b\u0430\u043d\u0441\u0438\u0440\u043e\u0432\u0449\u0438\u043a \u043f\u0435\u0440\u0435\u043f\u0438\u0441\u044b\u0432\u0430\u0435\u0442 dst IP \u0441 VIP \u043d\u0430 IP real server. \u041e\u0442\u0432\u0435\u0442 \u0438\u0434\u0435\u0442 \u043e\u0431\u0440\u0430\u0442\u043d\u043e \u0447\u0435\u0440\u0435\u0437 \u0431\u0430\u043b\u0430\u043d\u0441\u0438\u0440\u043e\u0432\u0449\u0438\u043a.</p> Text Only<pre><code>Client -&gt; [VIP] -&gt; LVS (DNAT) -&gt; Real Server\nClient &lt;- [VIP] &lt;- LVS (SNAT) &lt;- Real Server\n</code></pre> <ul> <li>Real servers \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u044e\u0442 LVS \u043a\u0430\u043a default gateway</li> <li>\u041f\u043e\u0434\u0434\u0435\u0440\u0436\u0438\u0432\u0430\u0435\u0442 port mapping (VIP:80 -&gt; RIP:8080)</li> <li>\u0411\u0430\u043b\u0430\u043d\u0441\u0438\u0440\u043e\u0432\u0449\u0438\u043a \u043e\u0431\u0440\u0430\u0431\u0430\u0442\u044b\u0432\u0430\u0435\u0442 \u0432\u0435\u0441\u044c \u0442\u0440\u0430\u0444\u0438\u043a</li> <li>Real servers \u043c\u043e\u0433\u0443\u0442 \u0431\u044b\u0442\u044c \u0432 \u043f\u0440\u0438\u0432\u0430\u0442\u043d\u043e\u0439 \u0441\u0435\u0442\u0438</li> </ul>"},{"location":"linux/ipvs/index.html#dr-g","title":"DR (-g)","text":"<p>\u0411\u0430\u043b\u0430\u043d\u0441\u0438\u0440\u043e\u0432\u0449\u0438\u043a \u043c\u0435\u043d\u044f\u0435\u0442 \u0442\u043e\u043b\u044c\u043a\u043e MAC-\u0430\u0434\u0440\u0435\u0441. IP \u043e\u0441\u0442\u0430\u0435\u0442\u0441\u044f VIP. Real server \u043e\u0442\u0432\u0435\u0447\u0430\u0435\u0442 \u043d\u0430\u043f\u0440\u044f\u043c\u0443\u044e \u043a\u043b\u0438\u0435\u043d\u0442\u0443.</p> Text Only<pre><code>Client -&gt; [VIP] -&gt; LVS (MAC rewrite) -&gt; Real Server\nClient &lt;------------------------------ Real Server\n</code></pre> <ul> <li>Real servers \u0434\u043e\u043b\u0436\u043d\u044b \u0438\u043c\u0435\u0442\u044c VIP \u043d\u0430 loopback (\u0431\u0435\u0437 ARP)</li> <li>\u041d\u0435 \u043f\u043e\u0434\u0434\u0435\u0440\u0436\u0438\u0432\u0430\u0435\u0442 port mapping</li> <li>\u0412\u044b\u0441\u043e\u043a\u0430\u044f \u043f\u0440\u043e\u0438\u0437\u0432\u043e\u0434\u0438\u0442\u0435\u043b\u044c\u043d\u043e\u0441\u0442\u044c</li> <li>Real servers \u0432 \u043e\u0434\u043d\u043e\u043c L2 \u0441\u0435\u0433\u043c\u0435\u043d\u0442\u0435 \u0441 LVS</li> </ul>"},{"location":"linux/ipvs/index.html#tun-i","title":"TUN (-i)","text":"<p>\u0411\u0430\u043b\u0430\u043d\u0441\u0438\u0440\u043e\u0432\u0449\u0438\u043a \u0438\u043d\u043a\u0430\u043f\u0441\u0443\u043b\u0438\u0440\u0443\u0435\u0442 \u043f\u0430\u043a\u0435\u0442 \u0432 IPIP \u0442\u0443\u043d\u043d\u0435\u043b\u044c. Real server \u0434\u0435\u043a\u0430\u043f\u0441\u0443\u043b\u0438\u0440\u0443\u0435\u0442 \u0438 \u043e\u0442\u0432\u0435\u0447\u0430\u0435\u0442 \u043d\u0430\u043f\u0440\u044f\u043c\u0443\u044e.</p> <ul> <li>Real servers \u043c\u043e\u0433\u0443\u0442 \u0431\u044b\u0442\u044c \u0432 \u0440\u0430\u0437\u043d\u044b\u0445 \u0441\u0435\u0442\u044f\u0445</li> <li>\u041d\u0435 \u043f\u043e\u0434\u0434\u0435\u0440\u0436\u0438\u0432\u0430\u0435\u0442 port mapping</li> <li>\u0422\u0440\u0435\u0431\u0443\u0435\u0442 IPIP \u043d\u0430 real servers</li> </ul>"},{"location":"linux/ipvs/index.html#schedulers","title":"Schedulers","text":"<p>rr - round robin. \u041f\u043e \u043e\u0447\u0435\u0440\u0435\u0434\u0438.</p> <p>wrr - weighted round robin. \u0423\u0447\u0438\u0442\u044b\u0432\u0430\u0435\u0442 weight \u0441\u0435\u0440\u0432\u0435\u0440\u043e\u0432.</p> <p>lc - least connections. \u041d\u0430 \u0441\u0435\u0440\u0432\u0435\u0440 \u0441 \u043d\u0430\u0438\u043c\u0435\u043d\u044c\u0448\u0438\u043c \u0447\u0438\u0441\u043b\u043e\u043c \u0441\u043e\u0435\u0434\u0438\u043d\u0435\u043d\u0438\u0439.</p> <p>wlc - weighted least connections. lc \u0441 \u0443\u0447\u0435\u0442\u043e\u043c weight. \u041f\u043e \u0443\u043c\u043e\u043b\u0447\u0430\u043d\u0438\u044e.</p> <p>sh - source hash. \u041e\u0434\u0438\u043d \u043a\u043b\u0438\u0435\u043d\u0442 \u0432\u0441\u0435\u0433\u0434\u0430 \u043d\u0430 \u043e\u0434\u0438\u043d \u0441\u0435\u0440\u0432\u0435\u0440.</p> <p>dh - destination hash. \u0414\u043b\u044f \u043f\u0440\u043e\u043a\u0441\u0438/\u043a\u0435\u0448\u0435\u0439.</p> <p>sed - shortest expected delay.</p> <p>nq - never queue. \u0421\u043d\u0430\u0447\u0430\u043b\u0430 \u043d\u0430 idle \u0441\u0435\u0440\u0432\u0435\u0440\u044b.</p>"},{"location":"linux/ipvs/index.html#_2","title":"\u041a\u043e\u043c\u0430\u043d\u0434\u044b","text":"Bash<pre><code>apt install ipvsadm\n</code></pre> \u0423\u0441\u0442\u0430\u043d\u043e\u0432\u043a\u0430. Bash<pre><code>modprobe ip_vs\n</code></pre> \u0417\u0430\u0433\u0440\u0443\u0437\u043a\u0430 \u043c\u043e\u0434\u0443\u043b\u044f \u044f\u0434\u0440\u0430. Bash<pre><code>ipvsadm -A -t 192.168.1.100:80 -s rr\n</code></pre> \u0421\u043e\u0437\u0434\u0430\u0442\u044c \u0441\u0435\u0440\u0432\u0438\u0441 (TCP, round robin). Bash<pre><code>ipvsadm -A -u 192.168.1.100:53 -s wlc\n</code></pre> \u0421\u043e\u0437\u0434\u0430\u0442\u044c \u0441\u0435\u0440\u0432\u0438\u0441 (UDP). Bash<pre><code>ipvsadm -a -t 192.168.1.100:80 -r 10.0.0.1:80 -m -w 1\n</code></pre> \u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c real server (NAT, weight 1). Bash<pre><code>ipvsadm -a -t 192.168.1.100:80 -r 10.0.0.2:80 -g -w 2\n</code></pre> \u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c real server (DR, weight 2). Bash<pre><code>ipvsadm -e -t 192.168.1.100:80 -r 10.0.0.1:80 -w 0\n</code></pre> Weight 0 - graceful drain. Bash<pre><code>ipvsadm -d -t 192.168.1.100:80 -r 10.0.0.1:80\n</code></pre> \u0423\u0434\u0430\u043b\u0438\u0442\u044c real server. Bash<pre><code>ipvsadm -D -t 192.168.1.100:80\n</code></pre> \u0423\u0434\u0430\u043b\u0438\u0442\u044c \u0441\u0435\u0440\u0432\u0438\u0441. Bash<pre><code>ipvsadm -ln\n</code></pre> \u041f\u043e\u043a\u0430\u0437\u0430\u0442\u044c \u043a\u043e\u043d\u0444\u0438\u0433\u0443\u0440\u0430\u0446\u0438\u044e. Bash<pre><code>ipvsadm -ln --stats\n</code></pre> \u0421\u0442\u0430\u0442\u0438\u0441\u0442\u0438\u043a\u0430. Bash<pre><code>ipvsadm -lnc\n</code></pre> \u0422\u0435\u043a\u0443\u0449\u0438\u0435 \u0441\u043e\u0435\u0434\u0438\u043d\u0435\u043d\u0438\u044f. Bash<pre><code>ipvsadm -C\n</code></pre> \u041e\u0447\u0438\u0441\u0442\u0438\u0442\u044c \u0432\u0441\u0435 \u043f\u0440\u0430\u0432\u0438\u043b\u0430. Bash<pre><code>ipvsadm-save &gt; /etc/ipvsadm.rules\nipvsadm-restore &lt; /etc/ipvsadm.rules\n</code></pre> \u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c/\u0432\u043e\u0441\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c."},{"location":"linux/ipvs/index.html#_3","title":"\u041f\u0440\u0438\u043c\u0435\u0440\u044b","text":""},{"location":"linux/ipvs/index.html#http-nat","title":"HTTP \u0431\u0430\u043b\u0430\u043d\u0441\u0438\u0440\u043e\u0432\u0449\u0438\u043a (NAT)","text":"Bash<pre><code>echo 1 &gt; /proc/sys/net/ipv4/ip_forward\n\nipvsadm -A -t 192.168.1.100:80 -s wlc\nipvsadm -a -t 192.168.1.100:80 -r 10.0.0.10:80 -m -w 1\nipvsadm -a -t 192.168.1.100:80 -r 10.0.0.11:80 -m -w 1\n</code></pre> <p>Real servers: default gateway \u043d\u0430 IP \u0431\u0430\u043b\u0430\u043d\u0441\u0438\u0440\u043e\u0432\u0449\u0438\u043a\u0430.</p>"},{"location":"linux/ipvs/index.html#http-dr","title":"HTTP \u0431\u0430\u043b\u0430\u043d\u0441\u0438\u0440\u043e\u0432\u0449\u0438\u043a (DR)","text":"<p>\u041d\u0430 \u0431\u0430\u043b\u0430\u043d\u0441\u0438\u0440\u043e\u0432\u0449\u0438\u043a\u0435:</p> Bash<pre><code>ip addr add 192.168.1.100/32 dev eth0\n\nipvsadm -A -t 192.168.1.100:80 -s wlc\nipvsadm -a -t 192.168.1.100:80 -r 192.168.1.10:80 -g -w 1\nipvsadm -a -t 192.168.1.100:80 -r 192.168.1.11:80 -g -w 1\n</code></pre> <p>\u041d\u0430 \u043a\u0430\u0436\u0434\u043e\u043c real server:</p> Bash<pre><code>ip addr add 192.168.1.100/32 dev lo\n\necho 1 &gt; /proc/sys/net/ipv4/conf/all/arp_ignore\necho 2 &gt; /proc/sys/net/ipv4/conf/all/arp_announce\n</code></pre>"},{"location":"linux/ipvs/index.html#persistence","title":"Persistence","text":"Bash<pre><code>ipvsadm -A -t 192.168.1.100:80 -s rr -p 300\n</code></pre> <p>\u041a\u043b\u0438\u0435\u043d\u0442 \u043f\u0440\u0438\u0432\u044f\u0437\u0430\u043d \u043a \u0441\u0435\u0440\u0432\u0435\u0440\u0443 \u043d\u0430 300 \u0441\u0435\u043a\u0443\u043d\u0434.</p>"},{"location":"linux/ipvs/index.html#_4","title":"\u041f\u0440\u043e\u0432\u0435\u0440\u043a\u0430","text":"Bash<pre><code>lsmod | grep ip_vs\n</code></pre> \u041c\u043e\u0434\u0443\u043b\u044c \u0437\u0430\u0433\u0440\u0443\u0436\u0435\u043d. Bash<pre><code>ipvsadm -ln\n</code></pre> \u0422\u0435\u043a\u0443\u0449\u0438\u0435 \u043f\u0440\u0430\u0432\u0438\u043b\u0430. Bash<pre><code>ipvsadm -lnc\n</code></pre> \u0410\u043a\u0442\u0438\u0432\u043d\u044b\u0435 \u0441\u043e\u0435\u0434\u0438\u043d\u0435\u043d\u0438\u044f."},{"location":"linux/keepalived/index.html","title":"Keepalived","text":""},{"location":"linux/keepalived/index.html#keepalived","title":"Keepalived","text":""},{"location":"linux/keepalived/index.html#_1","title":"\u041a\u043e\u0440\u043e\u0442\u043a\u043e","text":"<p>\u0414\u0435\u043c\u043e\u043d \u0434\u043b\u044f \u043e\u0442\u043a\u0430\u0437\u043e\u0443\u0441\u0442\u043e\u0439\u0447\u0438\u0432\u043e\u0441\u0442\u0438 \u043d\u0430 Linux. \u0420\u0435\u0430\u043b\u0438\u0437\u0443\u0435\u0442 VRRP (Virtual Router Redundancy Protocol) - \u0430\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0438\u0439 failover \u0432\u0438\u0440\u0442\u0443\u0430\u043b\u044c\u043d\u043e\u0433\u043e IP \u043c\u0435\u0436\u0434\u0443 \u0441\u0435\u0440\u0432\u0435\u0440\u0430\u043c\u0438. \u0422\u0430\u043a\u0436\u0435 \u043c\u043e\u0436\u0435\u0442 \u0432\u044b\u043f\u043e\u043b\u043d\u044f\u0442\u044c \u0431\u0430\u043b\u0430\u043d\u0441\u0438\u0440\u043e\u0432\u043a\u0443 \u043d\u0430\u0433\u0440\u0443\u0437\u043a\u0438 \u0447\u0435\u0440\u0435\u0437 IPVS (LVS).</p> <p>\u041e\u0441\u043d\u043e\u0432\u043d\u044b\u0435 \u0441\u0446\u0435\u043d\u0430\u0440\u0438\u0438: - HA \u0434\u043b\u044f nginx, haproxy, database VIP - \u0410\u043a\u0442\u0438\u0432\u043d\u044b\u0439/\u0440\u0435\u0437\u0435\u0440\u0432\u043d\u044b\u0439 \u043a\u043b\u0430\u0441\u0442\u0435\u0440 \u0438\u0437 \u0434\u0432\u0443\u0445 \u043d\u043e\u0434 - \u0411\u0430\u043b\u0430\u043d\u0441\u0438\u0440\u043e\u0432\u043a\u0430 \u0441 health checks \u0440\u0435\u0430\u043b\u044c\u043d\u044b\u0445 \u0441\u0435\u0440\u0432\u0435\u0440\u043e\u0432</p>"},{"location":"linux/keepalived/index.html#vrrp","title":"\u041a\u0430\u043a \u0440\u0430\u0431\u043e\u0442\u0430\u0435\u0442 VRRP","text":"<p>VRRP \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442 IP protocol 112 (\u043d\u0435 TCP/UDP).</p> <p>Master \u043e\u0442\u043f\u0440\u0430\u0432\u043b\u044f\u0435\u0442 advertisements \u043a\u0430\u0436\u0434\u044b\u0435 <code>advert_int</code> \u0441\u0435\u043a\u0443\u043d\u0434 (\u043f\u043e \u0443\u043c\u043e\u043b\u0447\u0430\u043d\u0438\u044e 1 \u0441\u0435\u043a) \u043d\u0430 multicast 224.0.0.18 (IPv4) \u0438\u043b\u0438 ff02::12 (IPv6).</p> <p>Backup \u0441\u043b\u0443\u0448\u0430\u0435\u0442 \u044d\u0442\u0438 \u043f\u0430\u043a\u0435\u0442\u044b. \u0415\u0441\u043b\u0438 advertisements \u043f\u0435\u0440\u0435\u0441\u0442\u0430\u044e\u0442 \u043f\u0440\u0438\u0445\u043e\u0434\u0438\u0442\u044c - backup \u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u0441\u044f master \u0438 \u0437\u0430\u0431\u0438\u0440\u0430\u0435\u0442 VIP.</p> <p>\u0412\u044b\u0431\u043e\u0440\u044b master: - \u041f\u043e\u0431\u0435\u0436\u0434\u0430\u0435\u0442 \u043d\u043e\u0434\u0430 \u0441 \u0431\u043e\u043b\u044c\u0448\u0438\u043c <code>priority</code> (1-255) - \u041f\u0440\u0438 \u0440\u0430\u0432\u043d\u043e\u043c priority - \u043d\u043e\u0434\u0430 \u0441 \u0431\u043e\u043b\u044c\u0448\u0438\u043c IP</p> <p>Preemption: \u0435\u0441\u043b\u0438 \u0443\u043f\u0430\u0432\u0448\u0438\u0439 master \u0432\u043e\u0441\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u043b\u0441\u044f \u0438 \u0435\u0433\u043e priority \u0432\u044b\u0448\u0435 - \u043e\u043d \u0437\u0430\u0431\u0435\u0440\u0435\u0442 VIP \u043e\u0431\u0440\u0430\u0442\u043d\u043e. \u041e\u0442\u043a\u043b\u044e\u0447\u0430\u0435\u0442\u0441\u044f \u0447\u0435\u0440\u0435\u0437 <code>nopreempt</code>.</p>"},{"location":"linux/keepalived/index.html#_2","title":"\u041a\u043e\u043d\u0444\u0438\u0433\u0443\u0440\u0430\u0446\u0438\u044f","text":"<p>\u0424\u0430\u0439\u043b: <code>/etc/keepalived/keepalived.conf</code></p>"},{"location":"linux/keepalived/index.html#masterbackup","title":"\u041c\u0438\u043d\u0438\u043c\u0430\u043b\u044c\u043d\u044b\u0439 MASTER/BACKUP","text":"<p>\u041d\u043e\u0434\u0430 1 (master):</p> Text Only<pre><code>vrrp_instance VI_1 {\n    state MASTER\n    interface eth0\n    virtual_router_id 101\n    priority 255\n    advert_int 1\n\n    authentication {\n        auth_type PASS\n        auth_pass secret12\n    }\n\n    virtual_ipaddress {\n        192.168.1.100/24\n    }\n}\n</code></pre> <p>\u041d\u043e\u0434\u0430 2 (backup):</p> Text Only<pre><code>vrrp_instance VI_1 {\n    state BACKUP\n    interface eth0\n    virtual_router_id 101\n    priority 150\n    advert_int 1\n\n    authentication {\n        auth_type PASS\n        auth_pass secret12\n    }\n\n    virtual_ipaddress {\n        192.168.1.100/24\n    }\n}\n</code></pre> <p>\u041a\u0440\u0438\u0442\u0438\u0447\u043d\u044b\u0435 \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u044b: - <code>virtual_router_id</code> - \u0434\u043e\u043b\u0436\u0435\u043d \u0441\u043e\u0432\u043f\u0430\u0434\u0430\u0442\u044c \u043d\u0430 \u043e\u0431\u0435\u0438\u0445 \u043d\u043e\u0434\u0430\u0445, \u0443\u043d\u0438\u043a\u0430\u043b\u0435\u043d \u0432 \u0441\u0435\u0433\u043c\u0435\u043d\u0442\u0435 (1-255) - <code>auth_pass</code> - \u043c\u0430\u043a\u0441\u0438\u043c\u0443\u043c 8 \u0441\u0438\u043c\u0432\u043e\u043b\u043e\u0432 - <code>priority</code> - \u0443 master \u0432\u044b\u0448\u0435 \u0447\u0435\u043c \u0443 backup</p>"},{"location":"linux/keepalived/index.html#failover-preemption","title":"Failover \u0431\u0435\u0437 preemption","text":"<p>\u041e\u0431\u0430 \u0441\u0435\u0440\u0432\u0435\u0440\u0430 \u0441\u0442\u0430\u0440\u0442\u0443\u044e\u0442 \u043a\u0430\u043a BACKUP. \u041a\u0442\u043e \u043f\u0435\u0440\u0432\u044b\u0439 \u043f\u043e\u0434\u043d\u044f\u043b\u0441\u044f - \u0442\u043e\u0442 master. \u041f\u0440\u0438 \u0432\u043e\u0441\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u0438 \u0443\u043f\u0430\u0432\u0448\u0435\u0433\u043e - \u043e\u043d \u043e\u0441\u0442\u0430\u0435\u0442\u0441\u044f backup.</p> Text Only<pre><code>vrrp_instance VI_1 {\n    state BACKUP\n    nopreempt\n    interface eth0\n    virtual_router_id 101\n    priority 200\n    advert_int 1\n\n    virtual_ipaddress {\n        192.168.1.100/24\n    }\n}\n</code></pre>"},{"location":"linux/keepalived/index.html#health-check-track_script","title":"Health check \u0447\u0435\u0440\u0435\u0437 track_script","text":"<p>\u041e\u0442\u0441\u043b\u0435\u0436\u0438\u0432\u0430\u043d\u0438\u0435 \u0441\u0435\u0440\u0432\u0438\u0441\u0430. \u041f\u0440\u0438 \u043f\u0430\u0434\u0435\u043d\u0438\u0438 \u0441\u0435\u0440\u0432\u0438\u0441\u0430 - \u0441\u043d\u0438\u0436\u0430\u0435\u0442\u0441\u044f priority \u0438 VIP \u0443\u0445\u043e\u0434\u0438\u0442 \u043d\u0430 backup.</p> Text Only<pre><code>vrrp_script chk_nginx {\n    script \"/usr/bin/pgrep nginx\"\n    interval 2\n    weight -50\n    fall 3\n    rise 2\n}\n\nvrrp_instance VI_1 {\n    state MASTER\n    interface eth0\n    virtual_router_id 101\n    priority 100\n\n    track_script {\n        chk_nginx\n    }\n\n    virtual_ipaddress {\n        192.168.1.100/24\n    }\n}\n</code></pre> <p>\u041f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u044b vrrp_script: - <code>interval</code> - \u0447\u0430\u0441\u0442\u043e\u0442\u0430 \u043f\u0440\u043e\u0432\u0435\u0440\u043a\u0438 \u0432 \u0441\u0435\u043a\u0443\u043d\u0434\u0430\u0445 (\u043f\u043e \u0443\u043c\u043e\u043b\u0447\u0430\u043d\u0438\u044e 1) - <code>weight</code> - \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u0435 priority \u043f\u0440\u0438 fail (\u043e\u0442\u0440\u0438\u0446\u0430\u0442\u0435\u043b\u044c\u043d\u043e\u0435 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435) - <code>fall</code> - \u0441\u043a\u043e\u043b\u044c\u043a\u043e \u0440\u0430\u0437 \u0434\u043e\u043b\u0436\u0435\u043d \u0443\u043f\u0430\u0441\u0442\u044c \u0434\u043b\u044f \u043f\u0435\u0440\u0435\u0445\u043e\u0434\u0430 \u0432 FAULT - <code>rise</code> - \u0441\u043a\u043e\u043b\u044c\u043a\u043e \u0440\u0430\u0437 \u0434\u043e\u043b\u0436\u0435\u043d \u043e\u0442\u0440\u0430\u0431\u043e\u0442\u0430\u0442\u044c \u0434\u043b\u044f \u0432\u044b\u0445\u043e\u0434\u0430 \u0438\u0437 FAULT</p>"},{"location":"linux/keepalived/index.html#track-interface","title":"Track interface","text":"<p>\u041f\u0430\u0434\u0435\u043d\u0438\u0435 \u0438\u043d\u0442\u0435\u0440\u0444\u0435\u0439\u0441\u0430 -&gt; \u043f\u0435\u0440\u0435\u0445\u043e\u0434 \u0432 FAULT -&gt; VIP \u0443\u0445\u043e\u0434\u0438\u0442 \u043d\u0430 backup.</p> Text Only<pre><code>vrrp_instance VI_1 {\n    state MASTER\n    interface eth0\n    virtual_router_id 101\n    priority 100\n\n    track_interface {\n        eth1\n        eth2 weight -50\n    }\n\n    virtual_ipaddress {\n        192.168.1.100/24\n    }\n}\n</code></pre>"},{"location":"linux/keepalived/index.html#track-process","title":"Track process","text":"Text Only<pre><code>vrrp_track_process track_haproxy {\n    process haproxy\n    delay 1\n}\n\nvrrp_instance VI_1 {\n    state BACKUP\n    nopreempt\n    interface eth0\n    virtual_router_id 101\n    priority 200\n\n    track_process {\n        track_haproxy\n    }\n\n    virtual_ipaddress {\n        192.168.1.100/24\n    }\n}\n</code></pre>"},{"location":"linux/keepalived/index.html#_3","title":"\u041a\u043e\u043c\u0430\u043d\u0434\u044b","text":"Bash<pre><code>apt install keepalived\n</code></pre> \u0423\u0441\u0442\u0430\u043d\u043e\u0432\u043a\u0430 (Debian/Ubuntu). Bash<pre><code>systemctl enable keepalived\nsystemctl start keepalived\n</code></pre> \u0417\u0430\u043f\u0443\u0441\u043a \u0441\u0435\u0440\u0432\u0438\u0441\u0430. Bash<pre><code>systemctl status keepalived\njournalctl -u keepalived -f\n</code></pre> \u0421\u0442\u0430\u0442\u0443\u0441 \u0438 \u043b\u043e\u0433\u0438. Bash<pre><code>ip addr show eth0\n</code></pre> \u041f\u0440\u043e\u0432\u0435\u0440\u0438\u0442\u044c \u043d\u0430\u043b\u0438\u0447\u0438\u0435 VIP \u043d\u0430 \u0438\u043d\u0442\u0435\u0440\u0444\u0435\u0439\u0441\u0435. Bash<pre><code>tcpdump -i eth0 -n proto 112\n</code></pre> \u0417\u0430\u0445\u0432\u0430\u0442 VRRP advertisements."},{"location":"linux/keepalived/index.html#firewall","title":"Firewall","text":"<p>VRRP \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442 IP protocol 112. \u0411\u0435\u0437 \u043f\u0440\u0430\u0432\u0438\u043b firewall advertisements \u043d\u0435 \u043f\u0440\u043e\u0439\u0434\u0443\u0442.</p> Bash<pre><code># iptables\niptables -A INPUT -p 112 -j ACCEPT\n\n# firewalld\nfirewall-cmd --add-protocol=vrrp --permanent\nfirewall-cmd --reload\n\n# nftables\nnft add rule inet filter input ip protocol 112 accept\n</code></pre>"},{"location":"linux/keepalived/index.html#_4","title":"\u041f\u0440\u0438\u043c\u0435\u0440\u044b","text":""},{"location":"linux/keepalived/index.html#ha-nginx","title":"HA \u0434\u043b\u044f nginx","text":"<p>\u0414\u0432\u0435 \u043d\u043e\u0434\u044b. VIP 10.0.0.100. \u041f\u0440\u0438 \u043f\u0430\u0434\u0435\u043d\u0438\u0438 nginx \u043d\u0430 master - VIP \u043f\u0435\u0440\u0435\u0435\u0437\u0436\u0430\u0435\u0442 \u043d\u0430 backup.</p> <p>\u041e\u0431\u0435 \u043d\u043e\u0434\u044b:</p> Text Only<pre><code>global_defs {\n    router_id nginx_ha\n}\n\nvrrp_script chk_nginx {\n    script \"/usr/bin/pgrep nginx\"\n    interval 2\n    weight -50\n    fall 2\n    rise 2\n}\n\nvrrp_instance VI_NGINX {\n    state BACKUP\n    nopreempt\n    interface eth0\n    virtual_router_id 51\n    priority 100\n    advert_int 1\n\n    track_script {\n        chk_nginx\n    }\n\n    virtual_ipaddress {\n        10.0.0.100/24\n    }\n}\n</code></pre> <p>\u0420\u0430\u0437\u043d\u0438\u0446\u0430 \u043c\u0435\u0436\u0434\u0443 \u043d\u043e\u0434\u0430\u043c\u0438 - \u043c\u043e\u0436\u043d\u043e \u0437\u0430\u0434\u0430\u0442\u044c \u0440\u0430\u0437\u043d\u044b\u0439 <code>priority</code> (100 vs 90).</p>"},{"location":"linux/keepalived/index.html#lvs","title":"LVS \u0431\u0430\u043b\u0430\u043d\u0441\u0438\u0440\u043e\u0432\u043a\u0430","text":"<p>Keepalived \u043a\u0430\u043a \u0431\u0430\u043b\u0430\u043d\u0441\u0438\u0440\u043e\u0432\u0449\u0438\u043a \u043d\u0430 \u043e\u0441\u043d\u043e\u0432\u0435 IPVS.</p> Text Only<pre><code>virtual_server 192.168.1.100 80 {\n    delay_loop 6\n    lvs_sched rr\n    lvs_method NAT\n    protocol TCP\n\n    real_server 192.168.1.10 80 {\n        weight 1\n        TCP_CHECK {\n            connect_timeout 10\n        }\n    }\n\n    real_server 192.168.1.11 80 {\n        weight 1\n        TCP_CHECK {\n            connect_timeout 10\n        }\n    }\n}\n</code></pre> <p>Schedulers (<code>lvs_sched</code>): - <code>rr</code> - round robin - <code>wrr</code> - weighted round robin - <code>lc</code> - least connections - <code>wlc</code> - weighted least connections - <code>sh</code> - source hash</p> <p>Methods (<code>lvs_method</code>): - <code>NAT</code> - destination NAT - <code>DR</code> - direct routing (real servers \u043e\u0442\u0432\u0435\u0447\u0430\u044e\u0442 \u043d\u0430\u043f\u0440\u044f\u043c\u0443\u044e) - <code>TUN</code> - IP tunneling</p>"},{"location":"linux/keepalived/index.html#_5","title":"\u041f\u0440\u043e\u0432\u0435\u0440\u043a\u0430","text":"<ol> <li>\u0417\u0430\u043f\u0443\u0441\u0442\u0438\u0442\u044c keepalived \u043d\u0430 \u043e\u0431\u0435\u0438\u0445 \u043d\u043e\u0434\u0430\u0445</li> <li><code>ip addr show</code> - VIP \u0434\u043e\u043b\u0436\u0435\u043d \u0431\u044b\u0442\u044c \u043d\u0430 master</li> <li>\u041e\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c keepalived \u043d\u0430 master: <code>systemctl stop keepalived</code></li> <li><code>ip addr show</code> \u043d\u0430 backup - VIP \u0434\u043e\u043b\u0436\u0435\u043d \u043f\u043e\u044f\u0432\u0438\u0442\u044c\u0441\u044f</li> <li><code>tcpdump -i eth0 proto 112</code> - \u0434\u043e\u043b\u0436\u043d\u044b \u0438\u0434\u0442\u0438 VRRP \u043f\u0430\u043a\u0435\u0442\u044b</li> </ol>"},{"location":"linux/namespaces/index.html","title":"\u0418\u0437\u043e\u043b\u044f\u0446\u0438\u044f \u043f\u0440\u043e\u0446\u0435\u0441\u0441\u043e\u0432 \u0432 Linux","text":""},{"location":"linux/namespaces/index.html#linux","title":"\u0418\u0437\u043e\u043b\u044f\u0446\u0438\u044f \u043f\u0440\u043e\u0446\u0435\u0441\u0441\u043e\u0432 \u0432 Linux","text":""},{"location":"linux/namespaces/index.html#_1","title":"\u041a\u043e\u0440\u043e\u0442\u043a\u043e","text":"<p>\u041c\u0435\u0445\u0430\u043d\u0438\u0437\u043c\u044b \u044f\u0434\u0440\u0430 Linux \u0434\u043b\u044f \u0438\u0437\u043e\u043b\u044f\u0446\u0438\u0438 \u0438 \u043e\u0433\u0440\u0430\u043d\u0438\u0447\u0435\u043d\u0438\u044f \u043f\u0440\u043e\u0446\u0435\u0441\u0441\u043e\u0432. \u041d\u0430 \u043d\u0438\u0445 \u043f\u043e\u0441\u0442\u0440\u043e\u0435\u043d\u044b \u043a\u043e\u043d\u0442\u0435\u0439\u043d\u0435\u0440\u044b (Docker, LXC, Podman).</p> \u041c\u0435\u0445\u0430\u043d\u0438\u0437\u043c \u0427\u0442\u043e \u0434\u0435\u043b\u0430\u0435\u0442 Namespaces \u0418\u0437\u043e\u043b\u044f\u0446\u0438\u044f \u0440\u0435\u0441\u0443\u0440\u0441\u043e\u0432 (\u0441\u0435\u0442\u044c, PID, FS, users) Cgroups \u041b\u0438\u043c\u0438\u0442\u044b CPU, \u043f\u0430\u043c\u044f\u0442\u0438, I/O Capabilities \u0413\u0440\u0430\u043d\u0443\u043b\u044f\u0440\u043d\u044b\u0435 \u043f\u0440\u0438\u0432\u0438\u043b\u0435\u0433\u0438\u0438 \u0432\u043c\u0435\u0441\u0442\u043e \u043f\u043e\u043b\u043d\u043e\u0433\u043e root Seccomp \u0424\u0438\u043b\u044c\u0442\u0440\u0430\u0446\u0438\u044f \u0441\u0438\u0441\u0442\u0435\u043c\u043d\u044b\u0445 \u0432\u044b\u0437\u043e\u0432\u043e\u0432 AppArmor/SELinux Mandatory Access Control - \u0434\u043e\u0441\u0442\u0443\u043f \u043a \u0444\u0430\u0439\u043b\u0430\u043c/\u0441\u0435\u0442\u0438 pivot_root \u0421\u043c\u0435\u043d\u0430 \u043a\u043e\u0440\u043d\u0435\u0432\u043e\u0439 \u0444\u0430\u0439\u043b\u043e\u0432\u043e\u0439 \u0441\u0438\u0441\u0442\u0435\u043c\u044b <p>\u041a\u043e\u043d\u0442\u0435\u0439\u043d\u0435\u0440 = namespaces + cgroups + capabilities + seccomp + MAC + pivot_root.</p>"},{"location":"linux/namespaces/index.html#namespaces","title":"Namespaces","text":"<p>8 \u0442\u0438\u043f\u043e\u0432 namespaces (Linux 6.1+):</p> Namespace Clone Flag \u0427\u0442\u043e \u0438\u0437\u043e\u043b\u0438\u0440\u0443\u0435\u0442 pid CLONE_NEWPID Process IDs - \u043f\u0440\u043e\u0446\u0435\u0441\u0441\u044b \u043d\u0435 \u0432\u0438\u0434\u044f\u0442 PID \u0438\u0437 \u0434\u0440\u0443\u0433\u0438\u0445 ns net CLONE_NEWNET \u0421\u0435\u0442\u0435\u0432\u043e\u0439 \u0441\u0442\u0435\u043a: \u0438\u043d\u0442\u0435\u0440\u0444\u0435\u0439\u0441\u044b, IP, routes, iptables, \u0441\u043e\u043a\u0435\u0442\u044b mnt CLONE_NEWNS Mount points - \u0441\u0432\u043e\u044f \u0444\u0430\u0439\u043b\u043e\u0432\u0430\u044f \u0441\u0438\u0441\u0442\u0435\u043c\u0430 user CLONE_NEWUSER UID/GID mapping - root \u0432\u043d\u0443\u0442\u0440\u0438 != root \u0441\u043d\u0430\u0440\u0443\u0436\u0438 uts CLONE_NEWUTS Hostname \u0438 domain name ipc CLONE_NEWIPC System V IPC, POSIX message queues, shared memory cgroup CLONE_NEWCGROUP \u0418\u0437\u043e\u043b\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u044b\u0439 view cgroup hierarchy time CLONE_NEWTIME Boot \u0438 monotonic clocks (\u0441 kernel 5.6)"},{"location":"linux/namespaces/index.html#_2","title":"\u041a\u043e\u043c\u0430\u043d\u0434\u044b","text":"<p>\u041f\u043e\u0441\u043c\u043e\u0442\u0440\u0435\u0442\u044c namespaces \u043f\u0440\u043e\u0446\u0435\u0441\u0441\u0430:</p> Bash<pre><code>ls -la /proc/$$/ns/\n</code></pre> Text Only<pre><code>lrwxrwxrwx 1 root root 0 Dec 25 12:00 cgroup -&gt; 'cgroup:[4026531835]'\nlrwxrwxrwx 1 root root 0 Dec 25 12:00 ipc -&gt; 'ipc:[4026531839]'\nlrwxrwxrwx 1 root root 0 Dec 25 12:00 mnt -&gt; 'mnt:[4026531841]'\nlrwxrwxrwx 1 root root 0 Dec 25 12:00 net -&gt; 'net:[4026531840]'\nlrwxrwxrwx 1 root root 0 Dec 25 12:00 pid -&gt; 'pid:[4026531836]'\nlrwxrwxrwx 1 root root 0 Dec 25 12:00 user -&gt; 'user:[4026531837]'\nlrwxrwxrwx 1 root root 0 Dec 25 12:00 uts -&gt; 'uts:[4026531838]'\n</code></pre> <p>\u0421\u043f\u0438\u0441\u043e\u043a \u0432\u0441\u0435\u0445 namespaces \u0432 \u0441\u0438\u0441\u0442\u0435\u043c\u0435:</p> Bash<pre><code>lsns\n</code></pre> <p>\u0421\u043e\u0437\u0434\u0430\u0442\u044c \u043f\u0440\u043e\u0446\u0435\u0441\u0441 \u0432 \u043d\u043e\u0432\u043e\u043c namespace:</p> Bash<pre><code># \u043d\u043e\u0432\u044b\u0439 network + uts namespace\nunshare --net --uts /bin/bash\n\n# \u043f\u0440\u043e\u0432\u0435\u0440\u0438\u0442\u044c - \u043f\u0443\u0441\u0442\u043e\u0439 \u0441\u0435\u0442\u0435\u0432\u043e\u0439 \u0441\u0442\u0435\u043a\nip link\n# \u0442\u043e\u043b\u044c\u043a\u043e lo\n</code></pre> <p>\u0412\u043e\u0439\u0442\u0438 \u0432 namespace \u0434\u0440\u0443\u0433\u043e\u0433\u043e \u043f\u0440\u043e\u0446\u0435\u0441\u0441\u0430:</p> Bash<pre><code># \u0432\u043e\u0439\u0442\u0438 \u0432 net namespace \u043f\u0440\u043e\u0446\u0435\u0441\u0441\u0430 1234\nnsenter -t 1234 -n ip addr\n\n# \u0432\u043e\u0439\u0442\u0438 \u0432\u043e \u0432\u0441\u0435 namespaces \u043a\u043e\u043d\u0442\u0435\u0439\u043d\u0435\u0440\u0430\nnsenter -t $(docker inspect -f '{{.State.Pid}}' container_name) -a\n</code></pre>"},{"location":"linux/namespaces/index.html#network-namespace-","title":"Network Namespace - \u043f\u0440\u0438\u043c\u0435\u0440","text":"<p>\u0421\u043e\u0437\u0434\u0430\u043d\u0438\u0435 \u0438\u0437\u043e\u043b\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u043e\u0439 \u0441\u0435\u0442\u0438 \u043c\u0435\u0436\u0434\u0443 \u0434\u0432\u0443\u043c\u044f netns:</p> Bash<pre><code># \u0441\u043e\u0437\u0434\u0430\u0442\u044c \u0434\u0432\u0430 netns\nip netns add ns1\nip netns add ns2\n\n# \u0441\u043e\u0437\u0434\u0430\u0442\u044c veth pair\nip link add veth1 type veth peer name veth2\n\n# \u043f\u0435\u0440\u0435\u043c\u0435\u0441\u0442\u0438\u0442\u044c \u0438\u043d\u0442\u0435\u0440\u0444\u0435\u0439\u0441\u044b \u0432 namespaces\nip link set veth1 netns ns1\nip link set veth2 netns ns2\n\n# \u043d\u0430\u0441\u0442\u0440\u043e\u0438\u0442\u044c IP\nip netns exec ns1 ip addr add 10.0.0.1/24 dev veth1\nip netns exec ns1 ip link set veth1 up\nip netns exec ns1 ip link set lo up\n\nip netns exec ns2 ip addr add 10.0.0.2/24 dev veth2\nip netns exec ns2 ip link set veth2 up\nip netns exec ns2 ip link set lo up\n\n# \u043f\u0440\u043e\u0432\u0435\u0440\u0438\u0442\u044c \u0441\u0432\u044f\u0437\u043d\u043e\u0441\u0442\u044c\nip netns exec ns1 ping 10.0.0.2\n</code></pre> <p>\u0423\u0434\u0430\u043b\u0435\u043d\u0438\u0435:</p> Bash<pre><code>ip netns del ns1\nip netns del ns2\n</code></pre>"},{"location":"linux/namespaces/index.html#cgroups","title":"Cgroups","text":"<p>Cgroups (control groups) - \u043b\u0438\u043c\u0438\u0442\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435 \u0438 \u0443\u0447\u0435\u0442 \u0440\u0435\u0441\u0443\u0440\u0441\u043e\u0432 \u0434\u043b\u044f \u0433\u0440\u0443\u043f\u043f\u044b \u043f\u0440\u043e\u0446\u0435\u0441\u0441\u043e\u0432.</p> <p>cgroups v1 - \u043e\u0442\u0434\u0435\u043b\u044c\u043d\u0430\u044f \u0438\u0435\u0440\u0430\u0440\u0445\u0438\u044f \u043d\u0430 \u043a\u0430\u0436\u0434\u044b\u0439 \u043a\u043e\u043d\u0442\u0440\u043e\u043b\u043b\u0435\u0440 (\u0443\u0441\u0442\u0430\u0440\u0435\u0432\u0448\u0438\u0439) cgroups v2 - \u0435\u0434\u0438\u043d\u0430\u044f \u0438\u0435\u0440\u0430\u0440\u0445\u0438\u044f, \u0434\u0435\u043b\u0435\u0433\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435 non-root \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f\u043c (\u0441\u043e\u0432\u0440\u0435\u043c\u0435\u043d\u043d\u044b\u0439)</p> <p>\u041e\u0441\u043d\u043e\u0432\u043d\u044b\u0435 \u043a\u043e\u043d\u0442\u0440\u043e\u043b\u043b\u0435\u0440\u044b:</p> \u041a\u043e\u043d\u0442\u0440\u043e\u043b\u043b\u0435\u0440 \u0427\u0442\u043e \u043b\u0438\u043c\u0438\u0442\u0438\u0440\u0443\u0435\u0442 cpu CPU time, \u0432\u0435\u0441\u0430, \u043a\u0432\u043e\u0442\u044b memory RAM, swap, OOM killer io Disk I/O bandwidth, IOPS pids \u041c\u0430\u043a\u0441\u0438\u043c\u0430\u043b\u044c\u043d\u043e\u0435 \u0447\u0438\u0441\u043b\u043e \u043f\u0440\u043e\u0446\u0435\u0441\u0441\u043e\u0432 cpuset \u041f\u0440\u0438\u0432\u044f\u0437\u043a\u0430 \u043a \u043a\u043e\u043d\u043a\u0440\u0435\u0442\u043d\u044b\u043c CPU/NUMA"},{"location":"linux/namespaces/index.html#cgroups-v2","title":"\u041a\u043e\u043c\u0430\u043d\u0434\u044b cgroups v2","text":"<p>\u041f\u0440\u043e\u0432\u0435\u0440\u0438\u0442\u044c \u0447\u0442\u043e \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442\u0441\u044f v2:</p> Bash<pre><code>mount | grep cgroup\n# cgroup2 on /sys/fs/cgroup type cgroup2 ...\n</code></pre> <p>\u041f\u043e\u0441\u043c\u043e\u0442\u0440\u0435\u0442\u044c \u0434\u043e\u0441\u0442\u0443\u043f\u043d\u044b\u0435 \u043a\u043e\u043d\u0442\u0440\u043e\u043b\u043b\u0435\u0440\u044b:</p> Bash<pre><code>cat /sys/fs/cgroup/cgroup.controllers\n# cpuset cpu io memory pids\n</code></pre> <p>\u0421\u043e\u0437\u0434\u0430\u0442\u044c cgroup \u0438 \u0434\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u043f\u0440\u043e\u0446\u0435\u0441\u0441:</p> Bash<pre><code># \u0441\u043e\u0437\u0434\u0430\u0442\u044c \u0433\u0440\u0443\u043f\u043f\u0443\nmkdir /sys/fs/cgroup/mygroup\n\n# \u0432\u043a\u043b\u044e\u0447\u0438\u0442\u044c \u043a\u043e\u043d\u0442\u0440\u043e\u043b\u043b\u0435\u0440\u044b \u0434\u043b\u044f \u0434\u043e\u0447\u0435\u0440\u043d\u0438\u0445 \u0433\u0440\u0443\u043f\u043f\necho \"+cpu +memory +io\" &gt; /sys/fs/cgroup/cgroup.subtree_control\n\n# \u043b\u0438\u043c\u0438\u0442 \u043f\u0430\u043c\u044f\u0442\u0438 100MB\necho 100M &gt; /sys/fs/cgroup/mygroup/memory.max\n\n# \u043b\u0438\u043c\u0438\u0442 CPU 50%\necho \"50000 100000\" &gt; /sys/fs/cgroup/mygroup/cpu.max\n\n# \u0434\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u043f\u0440\u043e\u0446\u0435\u0441\u0441\necho $$ &gt; /sys/fs/cgroup/mygroup/cgroup.procs\n</code></pre> <p>\u041f\u043e\u0441\u043c\u043e\u0442\u0440\u0435\u0442\u044c \u0442\u0435\u043a\u0443\u0449\u0435\u0435 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u043d\u0438\u0435:</p> Bash<pre><code>cat /sys/fs/cgroup/mygroup/memory.current\ncat /sys/fs/cgroup/mygroup/cpu.stat\n</code></pre>"},{"location":"linux/namespaces/index.html#systemd-cgroups","title":"systemd \u0438 cgroups","text":"<p>systemd \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442 cgroups \u0434\u043b\u044f \u0443\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u0438\u044f \u0441\u0435\u0440\u0432\u0438\u0441\u0430\u043c\u0438.</p> <p>\u041f\u043e\u0441\u043c\u043e\u0442\u0440\u0435\u0442\u044c \u0434\u0435\u0440\u0435\u0432\u043e cgroups:</p> Bash<pre><code>systemd-cgls\n</code></pre> <p>\u041b\u0438\u043c\u0438\u0442\u044b \u0434\u043b\u044f \u0441\u0435\u0440\u0432\u0438\u0441\u0430:</p> INI<pre><code># /etc/systemd/system/myservice.service.d/limits.conf\n[Service]\nMemoryMax=512M\nCPUQuota=50%\nIOWeight=100\n</code></pre> <p>\u041f\u0440\u0438\u043c\u0435\u043d\u0438\u0442\u044c:</p> Bash<pre><code>systemctl daemon-reload\nsystemctl restart myservice\n</code></pre>"},{"location":"linux/namespaces/index.html#capabilities","title":"Capabilities","text":"<p>Linux capabilities - \u0440\u0430\u0437\u0431\u0438\u0435\u043d\u0438\u0435 \u043f\u0440\u0438\u0432\u0438\u043b\u0435\u0433\u0438\u0439 root \u043d\u0430 \u043e\u0442\u0434\u0435\u043b\u044c\u043d\u044b\u0435 \u0435\u0434\u0438\u043d\u0438\u0446\u044b. \u0412\u043c\u0435\u0441\u0442\u043e \"\u0432\u0441\u0451 \u0438\u043b\u0438 \u043d\u0438\u0447\u0435\u0433\u043e\" \u043f\u0440\u043e\u0446\u0435\u0441\u0441 \u043f\u043e\u043b\u0443\u0447\u0430\u0435\u0442 \u0442\u043e\u043b\u044c\u043a\u043e \u043d\u0443\u0436\u043d\u044b\u0435 \u043f\u0440\u0438\u0432\u0438\u043b\u0435\u0433\u0438\u0438.</p> <p>\u041e\u0441\u043d\u043e\u0432\u043d\u044b\u0435 capabilities:</p> Capability \u0427\u0442\u043e \u0440\u0430\u0437\u0440\u0435\u0448\u0430\u0435\u0442 CAP_NET_ADMIN \u041d\u0430\u0441\u0442\u0440\u043e\u0439\u043a\u0430 \u0441\u0435\u0442\u0438: IP, routes, iptables CAP_NET_BIND_SERVICE Bind \u043d\u0430 \u043f\u043e\u0440\u0442\u044b &lt; 1024 CAP_NET_RAW RAW/PACKET \u0441\u043e\u043a\u0435\u0442\u044b CAP_SYS_ADMIN \"\u041d\u043e\u0432\u044b\u0439 root\" - mount, namespaces, \u043c\u043d\u043e\u0433\u043e \u0432\u0441\u0435\u0433\u043e CAP_SYS_PTRACE ptrace \u043b\u044e\u0431\u043e\u0433\u043e \u043f\u0440\u043e\u0446\u0435\u0441\u0441\u0430 CAP_CHOWN \u0421\u043c\u0435\u043d\u0430 \u0432\u043b\u0430\u0434\u0435\u043b\u044c\u0446\u0430 \u0444\u0430\u0439\u043b\u043e\u0432 CAP_DAC_OVERRIDE \u0418\u0433\u043d\u043e\u0440\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u043f\u0440\u0430\u0432\u0430 \u0434\u043e\u0441\u0442\u0443\u043f\u0430 \u043a \u0444\u0430\u0439\u043b\u0430\u043c CAP_SETUID/SETGID \u0421\u043c\u0435\u043d\u0430 UID/GID <p>Docker \u043f\u043e \u0443\u043c\u043e\u043b\u0447\u0430\u043d\u0438\u044e \u0434\u0430\u0451\u0442 \u043a\u043e\u043d\u0442\u0435\u0439\u043d\u0435\u0440\u0443 ~14 capabilities \u0438 \u0434\u0440\u043e\u043f\u0430\u0435\u0442 \u043e\u043f\u0430\u0441\u043d\u044b\u0435 (SYS_ADMIN, NET_ADMIN).</p> <p>\u041f\u043e\u0441\u043c\u043e\u0442\u0440\u0435\u0442\u044c capabilities \u043f\u0440\u043e\u0446\u0435\u0441\u0441\u0430:</p> Bash<pre><code># \u0442\u0435\u043a\u0443\u0449\u0438\u0439 \u043f\u0440\u043e\u0446\u0435\u0441\u0441\ncapsh --print\n\n# \u043a\u043e\u043d\u043a\u0440\u0435\u0442\u043d\u044b\u0439 \u043f\u0440\u043e\u0446\u0435\u0441\u0441\ngetpcaps $$\n\n# \u0444\u0430\u0439\u043b\u0430\ngetcap /usr/bin/ping\n</code></pre> <p>\u0423\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u0438\u0435 \u0432 Docker:</p> Bash<pre><code># \u0443\u0431\u0440\u0430\u0442\u044c \u0432\u0441\u0435 \u0438 \u0434\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0442\u043e\u043b\u044c\u043a\u043e \u043d\u0443\u0436\u043d\u044b\u0435\ndocker run --cap-drop=ALL --cap-add=NET_BIND_SERVICE nginx\n\n# \u0434\u043e\u0431\u0430\u0432\u0438\u0442\u044c capability\ndocker run --cap-add=NET_ADMIN alpine ip link\n</code></pre>"},{"location":"linux/namespaces/index.html#seccomp","title":"Seccomp","text":"<p>Seccomp (Secure Computing) - \u0444\u0438\u043b\u044c\u0442\u0440\u0430\u0446\u0438\u044f \u0441\u0438\u0441\u0442\u0435\u043c\u043d\u044b\u0445 \u0432\u044b\u0437\u043e\u0432\u043e\u0432 \u043d\u0430 \u0443\u0440\u043e\u0432\u043d\u0435 \u044f\u0434\u0440\u0430. \u041f\u0440\u043e\u0446\u0435\u0441\u0441 \u043c\u043e\u0436\u0435\u0442 \u0432\u044b\u0437\u044b\u0432\u0430\u0442\u044c \u0442\u043e\u043b\u044c\u043a\u043e \u0440\u0430\u0437\u0440\u0435\u0448\u0451\u043d\u043d\u044b\u0435 syscalls.</p> <p>\u0420\u0435\u0436\u0438\u043c\u044b: - strict - \u0442\u043e\u043b\u044c\u043a\u043e read/write/exit/sigreturn (\u043f\u043e\u0447\u0442\u0438 \u0431\u0435\u0441\u043f\u043e\u043b\u0435\u0437\u0435\u043d) - filter (BPF) - \u0433\u0438\u0431\u043a\u0438\u0435 \u043f\u0440\u0430\u0432\u0438\u043b\u0430 \u0447\u0435\u0440\u0435\u0437 BPF \u043f\u0440\u043e\u0433\u0440\u0430\u043c\u043c\u0443</p> <p>Docker \u043f\u043e \u0443\u043c\u043e\u043b\u0447\u0430\u043d\u0438\u044e \u0431\u043b\u043e\u043a\u0438\u0440\u0443\u0435\u0442 ~44 syscalls: mount, reboot, setns, swapon \u0438 \u0434\u0440.</p> <p>\u041f\u043e\u0441\u043c\u043e\u0442\u0440\u0435\u0442\u044c seccomp \u0441\u0442\u0430\u0442\u0443\u0441 \u043f\u0440\u043e\u0446\u0435\u0441\u0441\u0430:</p> Bash<pre><code>grep Seccomp /proc/$$/status\n# Seccomp:        0  - \u043e\u0442\u043a\u043b\u044e\u0447\u0435\u043d\n# Seccomp:        2  - filter mode\n</code></pre> <p>Docker \u0441 \u043a\u0430\u0441\u0442\u043e\u043c\u043d\u044b\u043c \u043f\u0440\u043e\u0444\u0438\u043b\u0435\u043c:</p> Bash<pre><code># \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c \u0441\u0432\u043e\u0439 \u043f\u0440\u043e\u0444\u0438\u043b\u044c\ndocker run --security-opt seccomp=/path/to/profile.json alpine\n\n# \u043e\u0442\u043a\u043b\u044e\u0447\u0438\u0442\u044c seccomp (\u043d\u0435\u0431\u0435\u0437\u043e\u043f\u0430\u0441\u043d\u043e)\ndocker run --security-opt seccomp=unconfined alpine\n</code></pre> <p>\u041f\u0440\u0438\u043c\u0435\u0440 \u043f\u0440\u043e\u0444\u0438\u043b\u044f (\u0440\u0430\u0437\u0440\u0435\u0448\u0438\u0442\u044c \u0432\u0441\u0451 \u043a\u0440\u043e\u043c\u0435 mount):</p> JSON<pre><code>{\n  \"defaultAction\": \"SCMP_ACT_ALLOW\",\n  \"syscalls\": [\n    {\n      \"names\": [\"mount\", \"umount2\"],\n      \"action\": \"SCMP_ACT_ERRNO\"\n    }\n  ]\n}\n</code></pre>"},{"location":"linux/namespaces/index.html#apparmor","title":"AppArmor","text":"<p>AppArmor - Mandatory Access Control (MAC) \u0434\u043b\u044f Debian/Ubuntu. \u041f\u0440\u043e\u0444\u0438\u043b\u0438 \u043e\u0433\u0440\u0430\u043d\u0438\u0447\u0438\u0432\u0430\u044e\u0442 \u0434\u043e\u0441\u0442\u0443\u043f \u043f\u0440\u043e\u0446\u0435\u0441\u0441\u0430 \u043a \u0444\u0430\u0439\u043b\u0430\u043c, \u0441\u0435\u0442\u0438, capabilities.</p> <p>\u0420\u0435\u0436\u0438\u043c\u044b \u043f\u0440\u043e\u0444\u0438\u043b\u0435\u0439: - enforce - \u0431\u043b\u043e\u043a\u0438\u0440\u0443\u0435\u0442 \u043d\u0430\u0440\u0443\u0448\u0435\u043d\u0438\u044f - complain - \u0442\u043e\u043b\u044c\u043a\u043e \u043b\u043e\u0433\u0438\u0440\u0443\u0435\u0442</p> <p>\u0421\u0442\u0430\u0442\u0443\u0441:</p> Bash<pre><code>aa-status\n</code></pre> <p>Docker \u0430\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0438 \u043f\u0440\u0438\u043c\u0435\u043d\u044f\u0435\u0442 \u043f\u0440\u043e\u0444\u0438\u043b\u044c <code>docker-default</code> \u043a \u043a\u043e\u043d\u0442\u0435\u0439\u043d\u0435\u0440\u0430\u043c.</p> Bash<pre><code># \u0441\u0432\u043e\u0439 \u043f\u0440\u043e\u0444\u0438\u043b\u044c\ndocker run --security-opt apparmor=my-profile alpine\n\n# \u043e\u0442\u043a\u043b\u044e\u0447\u0438\u0442\u044c (\u043d\u0435\u0431\u0435\u0437\u043e\u043f\u0430\u0441\u043d\u043e)\ndocker run --security-opt apparmor=unconfined alpine\n</code></pre> <p>\u041f\u0440\u0438\u043c\u0435\u0440 \u043f\u0440\u043e\u0444\u0438\u043b\u044f <code>/etc/apparmor.d/my-container</code>:</p> Text Only<pre><code>#include &lt;tunables/global&gt;\n\nprofile my-container flags=(attach_disconnected) {\n  #include &lt;abstractions/base&gt;\n\n  # \u0440\u0430\u0437\u0440\u0435\u0448\u0438\u0442\u044c \u0447\u0442\u0435\u043d\u0438\u0435\n  /etc/passwd r,\n  /app/** r,\n\n  # \u0437\u0430\u043f\u0440\u0435\u0442\u0438\u0442\u044c \u0437\u0430\u043f\u0438\u0441\u044c \u0432 /etc\n  deny /etc/** w,\n\n  # \u0440\u0430\u0437\u0440\u0435\u0448\u0438\u0442\u044c \u0441\u0435\u0442\u044c\n  network inet tcp,\n}\n</code></pre> <p>\u0417\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044c \u043f\u0440\u043e\u0444\u0438\u043b\u044c:</p> Bash<pre><code>apparmor_parser -r /etc/apparmor.d/my-container\n</code></pre>"},{"location":"linux/namespaces/index.html#selinux","title":"SELinux","text":"<p>SELinux - MAC \u0434\u043b\u044f RHEL/CentOS/Fedora. \u0418\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442 \u043c\u0435\u0442\u043a\u0438 (labels) \u043d\u0430 \u043f\u0440\u043e\u0446\u0435\u0441\u0441\u0430\u0445 \u0438 \u0440\u0435\u0441\u0443\u0440\u0441\u0430\u0445.</p> <p>\u0420\u0435\u0436\u0438\u043c\u044b: - enforcing - \u0431\u043b\u043e\u043a\u0438\u0440\u0443\u0435\u0442 \u043d\u0430\u0440\u0443\u0448\u0435\u043d\u0438\u044f - permissive - \u0442\u043e\u043b\u044c\u043a\u043e \u043b\u043e\u0433\u0438\u0440\u0443\u0435\u0442 - disabled - \u043e\u0442\u043a\u043b\u044e\u0447\u0435\u043d</p> Bash<pre><code># \u0442\u0435\u043a\u0443\u0449\u0438\u0439 \u0440\u0435\u0436\u0438\u043c\ngetenforce\n\n# \u0432\u0440\u0435\u043c\u0435\u043d\u043d\u043e \u043f\u0435\u0440\u0435\u043a\u043b\u044e\u0447\u0438\u0442\u044c\nsetenforce 0  # permissive\nsetenforce 1  # enforcing\n</code></pre> <p>\u041a\u043e\u043d\u0442\u0435\u043a\u0441\u0442 \u0431\u0435\u0437\u043e\u043f\u0430\u0441\u043d\u043e\u0441\u0442\u0438 (\u043c\u0435\u0442\u043a\u0430):</p> Bash<pre><code># \u0444\u0430\u0439\u043b\u0430\nls -Z /etc/passwd\n# system_u:object_r:passwd_file_t:s0\n\n# \u043f\u0440\u043e\u0446\u0435\u0441\u0441\u0430\nps -Z\n</code></pre> <p>Docker \u0438 SELinux:</p> Bash<pre><code># \u0432\u043a\u043b\u044e\u0447\u0438\u0442\u044c \u0440\u0430\u0437\u0434\u0435\u043b\u0435\u043d\u0438\u0435 \u043a\u043e\u043d\u0442\u0435\u0439\u043d\u0435\u0440\u043e\u0432\ndocker run --security-opt label=type:container_t alpine\n\n# \u043e\u0442\u043a\u043b\u044e\u0447\u0438\u0442\u044c SELinux \u0434\u043b\u044f \u043a\u043e\u043d\u0442\u0435\u0439\u043d\u0435\u0440\u0430\ndocker run --security-opt label=disable alpine\n\n# \u0440\u0430\u0437\u0440\u0435\u0448\u0438\u0442\u044c \u0434\u043e\u0441\u0442\u0443\u043f \u043a volume\ndocker run -v /data:/data:Z alpine  # :Z \u043f\u0435\u0440\u0435\u043c\u0430\u0440\u043a\u0438\u0440\u0443\u0435\u0442 \u0444\u0430\u0439\u043b\u044b\n</code></pre>"},{"location":"linux/namespaces/index.html#pivot_root","title":"pivot_root","text":"<p>pivot_root - \u0441\u043c\u0435\u043d\u0430 \u043a\u043e\u0440\u043d\u0435\u0432\u043e\u0439 \u0444\u0430\u0439\u043b\u043e\u0432\u043e\u0439 \u0441\u0438\u0441\u0442\u0435\u043c\u044b. \u041a\u043e\u043d\u0442\u0435\u0439\u043d\u0435\u0440\u044b \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u044e\u0442 \u0432\u043c\u0435\u0441\u0442\u043e chroot (\u0431\u043e\u043b\u0435\u0435 \u0431\u0435\u0437\u043e\u043f\u0430\u0441\u0435\u043d).</p> <p>\u041e\u0442\u043b\u0438\u0447\u0438\u0435 \u043e\u0442 chroot: - chroot \u043c\u0435\u043d\u044f\u0435\u0442 \u0442\u043e\u043b\u044c\u043a\u043e <code>/</code> \u0434\u043b\u044f \u043f\u0440\u043e\u0446\u0435\u0441\u0441\u0430, \u0441\u0442\u0430\u0440\u044b\u0439 root \u0434\u043e\u0441\u0442\u0443\u043f\u0435\u043d - pivot_root \u043c\u0435\u043d\u044f\u0435\u0442 root \u0434\u043b\u044f \u0432\u0441\u0435\u0433\u043e mount namespace, \u0441\u0442\u0430\u0440\u044b\u0439 root \u043c\u043e\u0436\u043d\u043e \u043e\u0442\u043c\u043e\u043d\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c</p> Bash<pre><code># \u043f\u043e\u0434\u0433\u043e\u0442\u043e\u0432\u043a\u0430 \u043d\u043e\u0432\u043e\u0433\u043e root\nmkdir /newroot\nmount --bind /path/to/rootfs /newroot\n\n# pivot\ncd /newroot\nmkdir old_root\npivot_root . old_root\n\n# \u043e\u0442\u043c\u043e\u043d\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0441\u0442\u0430\u0440\u044b\u0439 root\numount -l /old_root\nrmdir /old_root\n</code></pre> <p>\u0412 \u043a\u043e\u043d\u0442\u0435\u0439\u043d\u0435\u0440\u0430\u0445 \u044d\u0442\u043e \u0434\u0435\u043b\u0430\u0435\u0442 runtime (runc, crun) \u0430\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0438.</p>"},{"location":"linux/namespaces/index.html#_3","title":"\u041f\u0440\u043e\u0432\u0435\u0440\u043a\u0430","text":"<p>\u041f\u043e\u0441\u043c\u043e\u0442\u0440\u0435\u0442\u044c \u0432\u0441\u0435 \u043c\u0435\u0445\u0430\u043d\u0438\u0437\u043c\u044b \u0438\u0437\u043e\u043b\u044f\u0446\u0438\u0438 \u043f\u0440\u043e\u0446\u0435\u0441\u0441\u0430:</p> Bash<pre><code># namespaces\nls -la /proc/$$/ns/\n\n# cgroup\ncat /proc/$$/cgroup\n\n# capabilities\ngetpcaps $$\n\n# seccomp\ngrep Seccomp /proc/$$/status\n\n# SELinux \u043a\u043e\u043d\u0442\u0435\u043a\u0441\u0442 (\u0435\u0441\u043b\u0438 \u0432\u043a\u043b\u044e\u0447\u0435\u043d)\nps -Z -p $$\n\n# AppArmor \u043f\u0440\u043e\u0444\u0438\u043b\u044c (\u0435\u0441\u043b\u0438 \u0432\u043a\u043b\u044e\u0447\u0435\u043d)\ncat /proc/$$/attr/current\n</code></pre> <p>\u0414\u043b\u044f \u043a\u043e\u043d\u0442\u0435\u0439\u043d\u0435\u0440\u0430 Docker:</p> Bash<pre><code># PID \u043a\u043e\u043d\u0442\u0435\u0439\u043d\u0435\u0440\u0430 \u043d\u0430 \u0445\u043e\u0441\u0442\u0435\nPID=$(docker inspect -f '{{.State.Pid}}' container_name)\n\n# \u043f\u0440\u043e\u0432\u0435\u0440\u0438\u0442\u044c \u0432\u0441\u0451\nls -la /proc/$PID/ns/\ncat /proc/$PID/cgroup\ngetpcaps $PID\ngrep Seccomp /proc/$PID/status\n</code></pre>"},{"location":"linux/namespaces/index.html#_4","title":"\u0421\u0441\u044b\u043b\u043a\u0438","text":"<ul> <li>namespaces(7)</li> <li>cgroups v2 - kernel.org</li> <li>capabilities(7)</li> <li>seccomp(2)</li> </ul>"},{"location":"linux/network-stack/index.html","title":"\u041f\u0443\u0442\u044c \u043f\u0430\u043a\u0435\u0442\u0430 \u0432 Linux","text":""},{"location":"linux/network-stack/index.html#linux","title":"\u041f\u0443\u0442\u044c \u043f\u0430\u043a\u0435\u0442\u0430 \u0432 Linux","text":""},{"location":"linux/network-stack/index.html#_1","title":"\u041a\u043e\u0440\u043e\u0442\u043a\u043e","text":"<p>\u041f\u0430\u043a\u0435\u0442 \u043f\u0440\u043e\u0445\u043e\u0434\u0438\u0442: \u041f\u0440\u043e\u0432\u043e\u0434 -&gt; NIC -&gt; DMA -&gt; Ring Buffer -&gt; Hard IRQ -&gt; Soft IRQ (NAPI) -&gt; \u0421\u0435\u0442\u0435\u0432\u043e\u0439 \u0441\u0442\u0435\u043a \u044f\u0434\u0440\u0430 -&gt; Socket Buffer -&gt; Userspace.</p> <p>\u041a\u043b\u044e\u0447\u0435\u0432\u044b\u0435 \u043c\u0435\u0445\u0430\u043d\u0438\u0437\u043c\u044b: DMA (\u0431\u0435\u0437 \u0443\u0447\u0430\u0441\u0442\u0438\u044f CPU), \u043f\u0440\u0435\u0440\u044b\u0432\u0430\u043d\u0438\u044f (hard/soft), NAPI (polling \u0432\u043c\u0435\u0441\u0442\u043e interrupt storm), sk_buff (\u0441\u0442\u0440\u0443\u043a\u0442\u0443\u0440\u0430 \u043f\u0430\u043a\u0435\u0442\u0430 \u0432 \u044f\u0434\u0440\u0435).</p>"},{"location":"linux/network-stack/index.html#rx","title":"\u041f\u043e\u043b\u043d\u044b\u0439 \u043f\u0443\u0442\u044c \u043f\u0430\u043a\u0435\u0442\u0430 (RX)","text":"Text Only<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  \u0424\u0418\u0417\u0418\u0427\u0415\u0421\u041a\u0418\u0419 \u0423\u0420\u041e\u0412\u0415\u041d\u042c                                             \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502  \u041f\u0440\u043e\u0432\u043e\u0434/\u043e\u043f\u0442\u0438\u043a\u0430                                                  \u2502\n\u2502       \u2193                                                         \u2502\n\u2502  \u0422\u0440\u0430\u043d\u0441\u0438\u0432\u0435\u0440 (PHY) - \u043f\u0440\u0435\u043e\u0431\u0440\u0430\u0437\u043e\u0432\u0430\u043d\u0438\u0435 \u0441\u0438\u0433\u043d\u0430\u043b\u0430                       \u2502\n\u2502       \u2193                                                         \u2502\n\u2502  MAC (Media Access Control) - \u043f\u0440\u043e\u0432\u0435\u0440\u043a\u0430 FCS, \u0438\u0437\u0432\u043b\u0435\u0447\u0435\u043d\u0438\u0435 \u0444\u0440\u0435\u0439\u043c\u0430   \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n       \u2193\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  NIC (Network Interface Card)                                   \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502  1. \u041f\u0440\u0438\u043d\u0438\u043c\u0430\u0435\u0442 \u0444\u0440\u0435\u0439\u043c \u0432 hardware buffer                           \u2502\n\u2502  2. \u041f\u0440\u043e\u0432\u0435\u0440\u044f\u0435\u0442 checksum (\u0435\u0441\u043b\u0438 \u043f\u043e\u0434\u0434\u0435\u0440\u0436\u0438\u0432\u0430\u0435\u0442\u0441\u044f)                    \u2502\n\u2502  3. DMA: \u043a\u043e\u043f\u0438\u0440\u0443\u0435\u0442 \u0434\u0430\u043d\u043d\u044b\u0435 \u0432 Ring Buffer (RAM)                    \u2502\n\u2502  4. \u041e\u0431\u043d\u043e\u0432\u043b\u044f\u0435\u0442 RX descriptor                                     \u2502\n\u2502  5. \u0413\u0435\u043d\u0435\u0440\u0438\u0440\u0443\u0435\u0442 Hardware Interrupt                               \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n       \u2193\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  HARD IRQ (\u0430\u043f\u043f\u0430\u0440\u0430\u0442\u043d\u043e\u0435 \u043f\u0440\u0435\u0440\u044b\u0432\u0430\u043d\u0438\u0435)                               \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502  CPU \u043f\u0440\u0435\u0440\u044b\u0432\u0430\u0435\u0442\u0441\u044f, \u0432\u044b\u043f\u043e\u043b\u043d\u044f\u0435\u0442 interrupt handler \u0434\u0440\u0430\u0439\u0432\u0435\u0440\u0430:         \u2502\n\u2502  - \u041e\u0442\u043a\u043b\u044e\u0447\u0430\u0435\u0442 \u043f\u0440\u0435\u0440\u044b\u0432\u0430\u043d\u0438\u044f \u043e\u0442 NIC (\u0447\u0442\u043e\u0431\u044b \u043d\u0435 \u0431\u044b\u043b\u043e interrupt storm)  \u2502\n\u2502  - \u0412\u044b\u0437\u044b\u0432\u0430\u0435\u0442 napi_schedule() - \u043f\u043b\u0430\u043d\u0438\u0440\u0443\u0435\u0442 \u043e\u0431\u0440\u0430\u0431\u043e\u0442\u043a\u0443               \u2502\n\u2502  - \u0412\u043e\u0437\u0432\u0440\u0430\u0449\u0430\u0435\u0442 \u0443\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u0438\u0435 (\u043c\u0438\u043d\u0438\u043c\u0443\u043c \u0440\u0430\u0431\u043e\u0442\u044b)                       \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n       \u2193\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  SOFT IRQ / NAPI (\u043e\u0442\u043b\u043e\u0436\u0435\u043d\u043d\u0430\u044f \u043e\u0431\u0440\u0430\u0431\u043e\u0442\u043a\u0430)                         \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502  ksoftirqd \u043e\u0431\u0440\u0430\u0431\u0430\u0442\u044b\u0432\u0430\u0435\u0442 NET_RX_SOFTIRQ:                         \u2502\n\u2502  - net_rx_action() \u0432\u044b\u0437\u044b\u0432\u0430\u0435\u0442 poll-\u0444\u0443\u043d\u043a\u0446\u0438\u044e \u0434\u0440\u0430\u0439\u0432\u0435\u0440\u0430               \u2502\n\u2502  - \u0414\u0440\u0430\u0439\u0432\u0435\u0440 \u0447\u0438\u0442\u0430\u0435\u0442 \u043f\u0430\u043a\u0435\u0442\u044b \u0438\u0437 Ring Buffer (polling, \u043d\u0435 interrupt) \u2502\n\u2502  - \u0421\u043e\u0437\u0434\u0430\u0435\u0442 sk_buff \u0434\u043b\u044f \u043a\u0430\u0436\u0434\u043e\u0433\u043e \u043f\u0430\u043a\u0435\u0442\u0430                           \u2502\n\u2502  - \u041f\u0435\u0440\u0435\u0434\u0430\u0435\u0442 \u0432 napi_gro_receive() \u0438\u043b\u0438 netif_receive_skb()        \u2502\n\u2502  - \u041a\u043e\u0433\u0434\u0430 Ring Buffer \u043f\u0443\u0441\u0442 - \u0432\u043a\u043b\u044e\u0447\u0430\u0435\u0442 \u043f\u0440\u0435\u0440\u044b\u0432\u0430\u043d\u0438\u044f \u043e\u0431\u0440\u0430\u0442\u043d\u043e         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n       \u2193\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  \u0421\u0415\u0422\u0415\u0412\u041e\u0419 \u0421\u0422\u0415\u041a \u042f\u0414\u0420\u0410                                              \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502  netif_receive_skb()                                            \u2502\n\u2502       \u2193                                                         \u2502\n\u2502  \u041e\u043f\u0440\u0435\u0434\u0435\u043b\u044f\u0435\u0442 \u043f\u0440\u043e\u0442\u043e\u043a\u043e\u043b L3 (ETH_P_IP, ETH_P_IPV6...)               \u2502\n\u2502       \u2193                                                         \u2502\n\u2502  ip_rcv() - \u043e\u0431\u0440\u0430\u0431\u043e\u0442\u043a\u0430 IP                                        \u2502\n\u2502  - \u041f\u0440\u043e\u0432\u0435\u0440\u043a\u0430 \u0437\u0430\u0433\u043e\u043b\u043e\u0432\u043a\u0430, checksum                                 \u2502\n\u2502  - PREROUTING (netfilter/iptables)                              \u2502\n\u2502  - ip_route_input() - lookup \u043c\u0430\u0440\u0448\u0440\u0443\u0442\u0430                           \u2502\n\u2502  - INPUT \u0438\u043b\u0438 FORWARD                                            \u2502\n\u2502       \u2193                                                         \u2502\n\u2502  tcp_v4_rcv() - \u043e\u0431\u0440\u0430\u0431\u043e\u0442\u043a\u0430 TCP                                   \u2502\n\u2502  - \u041f\u043e\u0438\u0441\u043a \u0441\u043e\u043a\u0435\u0442\u0430 \u043f\u043e 4-tuple (src ip:port, dst ip:port)           \u2502\n\u2502  - TCP state machine (ACK, sequence numbers)                    \u2502\n\u2502  - \u0414\u043e\u0431\u0430\u0432\u043b\u0435\u043d\u0438\u0435 \u0432 sk_receive_queue \u0441\u043e\u043a\u0435\u0442\u0430                         \u2502\n\u2502       \u2193                                                         \u2502\n\u2502  sock_def_readable() - \u0431\u0443\u0434\u0438\u0442 \u043f\u0440\u043e\u0446\u0435\u0441\u0441                            \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n       \u2193\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  USERSPACE                                                      \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502  \u041f\u0440\u043e\u0446\u0435\u0441\u0441 \u0440\u0430\u0437\u0431\u043b\u043e\u043a\u0438\u0440\u0443\u0435\u0442\u0441\u044f (epoll_wait/select/read)                \u2502\n\u2502       \u2193                                                         \u2502\n\u2502  recv()/read() - \u0441\u0438\u0441\u0442\u0435\u043c\u043d\u044b\u0439 \u0432\u044b\u0437\u043e\u0432                                \u2502\n\u2502       \u2193                                                         \u2502\n\u2502  copy_to_user() - \u043a\u043e\u043f\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435 \u0438\u0437 sk_receive_queue \u0432 userspace   \u2502\n\u2502       \u2193                                                         \u2502\n\u2502  \u0414\u0430\u043d\u043d\u044b\u0435 \u0434\u043e\u0441\u0442\u0443\u043f\u043d\u044b \u043f\u0440\u0438\u043b\u043e\u0436\u0435\u043d\u0438\u044e                                     \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"linux/network-stack/index.html#ring-buffer","title":"Ring Buffer","text":"<p>\u041a\u043e\u043b\u044c\u0446\u0435\u0432\u043e\u0439 \u0431\u0443\u0444\u0435\u0440 \u0432 RAM. NIC \u043f\u0438\u0448\u0435\u0442 \u0442\u0443\u0434\u0430 \u0447\u0435\u0440\u0435\u0437 DMA. \u0414\u0440\u0430\u0439\u0432\u0435\u0440 \u0447\u0438\u0442\u0430\u0435\u0442 \u043e\u0442\u0442\u0443\u0434\u0430.</p> <p>\u0421\u0442\u0440\u0443\u043a\u0442\u0443\u0440\u0430: - RX descriptor ring - \u043c\u0430\u0441\u0441\u0438\u0432 \u0434\u0435\u0441\u043a\u0440\u0438\u043f\u0442\u043e\u0440\u043e\u0432 (\u0443\u043a\u0430\u0437\u0430\u0442\u0435\u043b\u0438 \u043d\u0430 \u0431\u0443\u0444\u0435\u0440\u044b + \u043c\u0435\u0442\u0430\u0434\u0430\u043d\u043d\u044b\u0435) - \u0411\u0443\u0444\u0435\u0440\u044b \u0434\u0430\u043d\u043d\u044b\u0445 - \u043f\u0430\u043c\u044f\u0442\u044c \u043f\u043e\u0434 \u0441\u0430\u043c\u0438 \u043f\u0430\u043a\u0435\u0442\u044b</p> Text Only<pre><code>  \u250c\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2510\n  \u2502 0 \u2502 1 \u2502 2 \u2502 3 \u2502 4 \u2502 5 \u2502 6 \u2502 7 \u2502  &lt;- \u0434\u0435\u0441\u043a\u0440\u0438\u043f\u0442\u043e\u0440\u044b\n  \u2514\u2500\u252c\u2500\u2534\u2500\u252c\u2500\u2534\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2534\u2500\u252c\u2500\u2534\u2500\u252c\u2500\u2534\u2500\u2500\u2500\u2518\n    \u2502   \u2502               \u2502   \u2502\n    \u2193   \u2193               \u2193   \u2193\n  [buf][buf]          [buf][buf]     &lt;- \u0431\u0443\u0444\u0435\u0440\u044b \u0441 \u0434\u0430\u043d\u043d\u044b\u043c\u0438\n    \u2191                       \u2191\n    \u2502                       \u2502\n  HEAD                    TAIL\n  (NIC \u043f\u0438\u0448\u0435\u0442)         (\u0434\u0440\u0430\u0439\u0432\u0435\u0440 \u0447\u0438\u0442\u0430\u0435\u0442)\n</code></pre> <p>\u041f\u0435\u0440\u0435\u043f\u043e\u043b\u043d\u0435\u043d\u0438\u0435 (overflow) - \u043f\u0430\u043a\u0435\u0442\u044b \u0442\u0435\u0440\u044f\u044e\u0442\u0441\u044f. \u0421\u0447\u0435\u0442\u0447\u0438\u043a: <code>ethtool -S eth0 | grep rx_missed</code>.</p>"},{"location":"linux/network-stack/index.html#sk_buff-skb","title":"sk_buff (skb)","text":"<p>\u0413\u043b\u0430\u0432\u043d\u0430\u044f \u0441\u0442\u0440\u0443\u043a\u0442\u0443\u0440\u0430 \u0434\u043b\u044f \u043f\u0430\u043a\u0435\u0442\u0430 \u0432 \u044f\u0434\u0440\u0435. \u041d\u0435 \u0441\u043e\u0434\u0435\u0440\u0436\u0438\u0442 \u0434\u0430\u043d\u043d\u044b\u0435 \u043d\u0430\u043f\u0440\u044f\u043c\u0443\u044e - \u0442\u043e\u043b\u044c\u043a\u043e \u043c\u0435\u0442\u0430\u0434\u0430\u043d\u043d\u044b\u0435 \u0438 \u0443\u043a\u0430\u0437\u0430\u0442\u0435\u043b\u0438.</p> Text Only<pre><code>struct sk_buff {\n    /* \u0423\u043a\u0430\u0437\u0430\u0442\u0435\u043b\u0438 \u043d\u0430 \u0437\u0430\u0433\u043e\u043b\u043e\u0432\u043a\u0438 */\n    transport_header  -&gt; TCP/UDP header\n    network_header    -&gt; IP header\n    mac_header        -&gt; Ethernet header\n\n    /* \u0420\u0430\u0437\u043c\u0435\u0440\u044b */\n    len               -&gt; \u043e\u0431\u0449\u0438\u0439 \u0440\u0430\u0437\u043c\u0435\u0440 \u0434\u0430\u043d\u043d\u044b\u0445\n    data_len          -&gt; \u0440\u0430\u0437\u043c\u0435\u0440 \u0432 page fragments\n\n    /* \u0423\u043a\u0430\u0437\u0430\u0442\u0435\u043b\u0438 \u043d\u0430 \u0434\u0430\u043d\u043d\u044b\u0435 */\n    head              -&gt; \u043d\u0430\u0447\u0430\u043b\u043e \u0431\u0443\u0444\u0435\u0440\u0430\n    data              -&gt; \u043d\u0430\u0447\u0430\u043b\u043e \u0434\u0430\u043d\u043d\u044b\u0445\n    tail              -&gt; \u043a\u043e\u043d\u0435\u0446 \u0434\u0430\u043d\u043d\u044b\u0445\n    end               -&gt; \u043a\u043e\u043d\u0435\u0446 \u0431\u0443\u0444\u0435\u0440\u0430\n\n    /* \u041e\u0447\u0435\u0440\u0435\u0434\u044c */\n    next, prev        -&gt; \u0434\u0432\u0443\u0441\u0432\u044f\u0437\u043d\u044b\u0439 \u0441\u043f\u0438\u0441\u043e\u043a\n}\n</code></pre>"},{"location":"linux/network-stack/index.html#hard-irq-vs-soft-irq","title":"Hard IRQ vs Soft IRQ","text":"<p>Hard IRQ (top half): - \u0412\u044b\u0437\u044b\u0432\u0430\u0435\u0442\u0441\u044f \u0436\u0435\u043b\u0435\u0437\u043e\u043c \u043d\u0435\u043c\u0435\u0434\u043b\u0435\u043d\u043d\u043e - \u041f\u0440\u0435\u0440\u044b\u0432\u0430\u0435\u0442 \u0442\u0435\u043a\u0443\u0449\u0443\u044e \u0440\u0430\u0431\u043e\u0442\u0443 CPU - \u041d\u0435\u043b\u044c\u0437\u044f \u0431\u043b\u043e\u043a\u0438\u0440\u043e\u0432\u0430\u0442\u044c\u0441\u044f - \u041c\u0438\u043d\u0438\u043c\u0443\u043c \u0440\u0430\u0431\u043e\u0442\u044b: acknowledge + schedule soft irq - \u0414\u0440\u0443\u0433\u0438\u0435 \u043f\u0440\u0435\u0440\u044b\u0432\u0430\u043d\u0438\u044f \u0437\u0430\u0431\u043b\u043e\u043a\u0438\u0440\u043e\u0432\u0430\u043d\u044b</p> <p>Soft IRQ (bottom half): - \u0412\u044b\u043f\u043e\u043b\u043d\u044f\u0435\u0442\u0441\u044f ksoftirqd \u0438\u043b\u0438 \u043f\u043e\u0441\u043b\u0435 hard irq - \u041c\u043e\u0436\u043d\u043e \u043f\u0440\u0435\u0440\u044b\u0432\u0430\u0442\u044c - \u041e\u0441\u043d\u043e\u0432\u043d\u0430\u044f \u043e\u0431\u0440\u0430\u0431\u043e\u0442\u043a\u0430 \u043f\u0430\u043a\u0435\u0442\u043e\u0432 - \u041e\u0433\u0440\u0430\u043d\u0438\u0447\u0435\u043d \u043f\u043e \u0432\u0440\u0435\u043c\u0435\u043d\u0438 \u0438 \u043a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u0443 \u043f\u0430\u043a\u0435\u0442\u043e\u0432</p>"},{"location":"linux/network-stack/index.html#napi-new-api","title":"NAPI (New API)","text":"<p>\u041f\u0440\u043e\u0431\u043b\u0435\u043c\u0430: \u043f\u0440\u0438 \u0432\u044b\u0441\u043e\u043a\u043e\u0439 \u043d\u0430\u0433\u0440\u0443\u0437\u043a\u0435 - interrupt storm (\u0442\u044b\u0441\u044f\u0447\u0438 \u043f\u0440\u0435\u0440\u044b\u0432\u0430\u043d\u0438\u0439 \u0432 \u0441\u0435\u043a\u0443\u043d\u0434\u0443).</p> <p>\u0420\u0435\u0448\u0435\u043d\u0438\u0435 NAPI: 1. \u041f\u0435\u0440\u0432\u043e\u0435 \u043f\u0440\u0435\u0440\u044b\u0432\u0430\u043d\u0438\u0435 \u0431\u0443\u0434\u0438\u0442 \u043e\u0431\u0440\u0430\u0431\u043e\u0442\u0447\u0438\u043a 2. \u041e\u0431\u0440\u0430\u0431\u043e\u0442\u0447\u0438\u043a \u043e\u0442\u043a\u043b\u044e\u0447\u0430\u0435\u0442 \u043f\u0440\u0435\u0440\u044b\u0432\u0430\u043d\u0438\u044f 3. Polling: \u0447\u0438\u0442\u0430\u0435\u0442 \u043f\u0430\u043a\u0435\u0442\u044b \u0438\u0437 ring buffer \u043f\u043e\u043a\u0430 \u0435\u0441\u0442\u044c 4. \u041a\u043e\u0433\u0434\u0430 ring buffer \u043f\u0443\u0441\u0442 - \u0432\u043a\u043b\u044e\u0447\u0430\u0435\u0442 \u043f\u0440\u0435\u0440\u044b\u0432\u0430\u043d\u0438\u044f</p> <p>\u041f\u0440\u0438 \u043d\u0438\u0437\u043a\u043e\u0439 \u043d\u0430\u0433\u0440\u0443\u0437\u043a\u0435: 1 \u043f\u0440\u0435\u0440\u044b\u0432\u0430\u043d\u0438\u0435 \u043d\u0430 \u043f\u0430\u043a\u0435\u0442. \u041f\u0440\u0438 \u0432\u044b\u0441\u043e\u043a\u043e\u0439: 1 \u043f\u0440\u0435\u0440\u044b\u0432\u0430\u043d\u0438\u0435 \u043d\u0430 \u043c\u043d\u043e\u0436\u0435\u0441\u0442\u0432\u043e \u043f\u0430\u043a\u0435\u0442\u043e\u0432.</p>"},{"location":"linux/network-stack/index.html#interrupt-coalescing","title":"Interrupt Coalescing","text":"<p>NIC \u043d\u0430\u043a\u0430\u043f\u043b\u0438\u0432\u0430\u0435\u0442 \u043d\u0435\u0441\u043a\u043e\u043b\u044c\u043a\u043e \u043f\u0430\u043a\u0435\u0442\u043e\u0432 \u043f\u0435\u0440\u0435\u0434 \u0433\u0435\u043d\u0435\u0440\u0430\u0446\u0438\u0435\u0439 \u043f\u0440\u0435\u0440\u044b\u0432\u0430\u043d\u0438\u044f.</p> <p>\u041f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u044b: - rx-usecs: \u0436\u0434\u0430\u0442\u044c N \u043c\u0438\u043a\u0440\u043e\u0441\u0435\u043a\u0443\u043d\u0434 - rx-frames: \u0436\u0434\u0430\u0442\u044c N \u043f\u0430\u043a\u0435\u0442\u043e\u0432</p> <p>\u041a\u043e\u043c\u043f\u0440\u043e\u043c\u0438\u0441\u0441: \u043c\u0435\u043d\u044c\u0448\u0435 \u043f\u0440\u0435\u0440\u044b\u0432\u0430\u043d\u0438\u0439 = \u0432\u044b\u0448\u0435 throughput, \u043d\u043e \u0432\u044b\u0448\u0435 latency.</p>"},{"location":"linux/network-stack/index.html#hardware-offloads","title":"Hardware Offloads","text":"<p>NIC \u0431\u0435\u0440\u0435\u0442 \u043d\u0430 \u0441\u0435\u0431\u044f \u0447\u0430\u0441\u0442\u044c \u0440\u0430\u0431\u043e\u0442\u044b CPU. \u0411\u0435\u0437 offloads 100G \u043d\u0435\u0432\u043e\u0437\u043c\u043e\u0436\u0435\u043d - CPU \u043d\u0435 \u0443\u0441\u043f\u0435\u0435\u0442.</p> <p>Checksum Offload - rx-checksumming: NIC \u043f\u0440\u043e\u0432\u0435\u0440\u044f\u0435\u0442 checksum, \u044f\u0434\u0440\u043e \u043d\u0435 \u043f\u0435\u0440\u0435\u0441\u0447\u0438\u0442\u044b\u0432\u0430\u0435\u0442 - tx-checksumming: NIC \u0441\u0447\u0438\u0442\u0430\u0435\u0442 checksum \u043f\u0440\u0438 \u043e\u0442\u043f\u0440\u0430\u0432\u043a\u0435</p> <p>Segmentation Offload - TSO (TCP Segmentation Offload): \u043f\u0440\u0438\u043b\u043e\u0436\u0435\u043d\u0438\u0435 \u043e\u0442\u0434\u0430\u0435\u0442 \u0431\u043e\u043b\u044c\u0448\u043e\u0439 chunk (64KB), NIC \u0441\u0430\u043c \u043d\u0430\u0440\u0435\u0437\u0430\u0435\u0442 \u043d\u0430 MSS-\u0441\u0435\u0433\u043c\u0435\u043d\u0442\u044b - GSO (Generic Segmentation Offload): \u0442\u043e \u0436\u0435, \u043d\u043e \u0432 \u0441\u043e\u0444\u0442\u0435 (fallback \u0435\u0441\u043b\u0438 \u043d\u0435\u0442 TSO) - UFO (UDP Fragmentation Offload): \u0430\u043d\u0430\u043b\u043e\u0433 \u0434\u043b\u044f UDP</p> <p>Receive Offload - GRO (Generic Receive Offload): \u0441\u043a\u043b\u0435\u0438\u0432\u0430\u0435\u0442 \u043c\u0435\u043b\u043a\u0438\u0435 \u043f\u0430\u043a\u0435\u0442\u044b \u043e\u0434\u043d\u043e\u0433\u043e \u043f\u043e\u0442\u043e\u043a\u0430 \u0432 \u0431\u043e\u043b\u044c\u0448\u0438\u0435 \u043f\u0435\u0440\u0435\u0434 \u043f\u0435\u0440\u0435\u0434\u0430\u0447\u0435\u0439 \u0432 \u0441\u0442\u0435\u043a - LRO (Large Receive Offload): \u0430\u043d\u0430\u043b\u043e\u0433 \u043d\u0430 \u0436\u0435\u043b\u0435\u0437\u0435 (\u0430\u0433\u0440\u0435\u0441\u0441\u0438\u0432\u043d\u0435\u0435, \u043c\u043e\u0436\u0435\u0442 \u043b\u043e\u043c\u0430\u0442\u044c routing/bridging)</p> <p>RSS (Receive Side Scaling) - NIC \u0445\u0435\u0448\u0438\u0440\u0443\u0435\u0442 5-tuple (src/dst IP, src/dst port, protocol) - \u0420\u0430\u0441\u043f\u0440\u0435\u0434\u0435\u043b\u044f\u0435\u0442 \u043f\u0430\u043a\u0435\u0442\u044b \u043f\u043e \u0440\u0430\u0437\u043d\u044b\u043c RX-\u043e\u0447\u0435\u0440\u0435\u0434\u044f\u043c - \u041a\u0430\u0436\u0434\u0430\u044f \u043e\u0447\u0435\u0440\u0435\u0434\u044c - \u0441\u0432\u043e\u0439 CPU - 100G \u043a\u0430\u0440\u0442\u0430: 32-128 \u043e\u0447\u0435\u0440\u0435\u0434\u0435\u0439 = \u043f\u0430\u0440\u0430\u043b\u043b\u0435\u043b\u044c\u043d\u0430\u044f \u043e\u0431\u0440\u0430\u0431\u043e\u0442\u043a\u0430</p> <p>Flow Director / ATR - NIC \u0437\u0430\u043f\u043e\u043c\u0438\u043d\u0430\u0435\u0442 flow \u0438 \u043e\u0442\u043f\u0440\u0430\u0432\u043b\u044f\u0435\u0442 \u043d\u0430 \u0442\u043e\u0442 \u0436\u0435 CPU \u0433\u0434\u0435 \u0441\u043e\u043a\u0435\u0442 - \u041b\u0443\u0447\u0448\u0435 cache locality</p> Bash<pre><code># \u041f\u043e\u0441\u043c\u043e\u0442\u0440\u0435\u0442\u044c \u0447\u0442\u043e \u0432\u043a\u043b\u044e\u0447\u0435\u043d\u043e\nethtool -k eth0\n\n# \u0412\u043a\u043b\u044e\u0447\u0438\u0442\u044c/\u0432\u044b\u043a\u043b\u044e\u0447\u0438\u0442\u044c\nethtool -K eth0 tso on\nethtool -K eth0 gro on\nethtool -K eth0 rx-checksumming on\n</code></pre> <p>\u0422\u0438\u043f\u0438\u0447\u043d\u044b\u0439 \u0432\u044b\u0432\u043e\u0434 <code>ethtool -k</code>: </p>Text Only<pre><code>rx-checksumming: on\ntx-checksumming: on\nscatter-gather: on\ntcp-segmentation-offload: on\ngeneric-receive-offload: on\nlarge-receive-offload: off    # \u043e\u0431\u044b\u0447\u043d\u043e off, \u043b\u043e\u043c\u0430\u0435\u0442 forwarding\nreceive-hashing: on           # RSS\n</code></pre><p></p> <p>\u0427\u0442\u043e \u0434\u0430\u0435\u0442 offload:</p> <p>\u0411\u0435\u0437 TSO (CPU \u043d\u0430\u0440\u0435\u0437\u0430\u0435\u0442): </p>Text Only<pre><code>App: 64KB \u0434\u0430\u043d\u043d\u044b\u0445\n    \u2193\nKernel: \u0441\u043e\u0437\u0434\u0430\u0435\u0442 ~44 sk_buff \u043f\u043e 1460 \u0431\u0430\u0439\u0442\n    \u2193\nNIC: \u043e\u0442\u043f\u0440\u0430\u0432\u043b\u044f\u0435\u0442 44 \u043f\u0430\u043a\u0435\u0442\u0430\n</code></pre><p></p> <p>\u0421 TSO (NIC \u043d\u0430\u0440\u0435\u0437\u0430\u0435\u0442): </p>Text Only<pre><code>App: 64KB \u0434\u0430\u043d\u043d\u044b\u0445\n    \u2193\nKernel: \u0441\u043e\u0437\u0434\u0430\u0435\u0442 1 \u0431\u043e\u043b\u044c\u0448\u043e\u0439 sk_buff\n    \u2193\nNIC: \u0441\u0430\u043c \u043d\u0430\u0440\u0435\u0437\u0430\u0435\u0442 \u0438 \u043e\u0442\u043f\u0440\u0430\u0432\u043b\u044f\u0435\u0442 44 \u043f\u0430\u043a\u0435\u0442\u0430\n</code></pre><p></p> <p>\u042d\u043a\u043e\u043d\u043e\u043c\u0438\u044f: \u043c\u0435\u043d\u044c\u0448\u0435 sk_buff allocations, \u043c\u0435\u043d\u044c\u0448\u0435 \u043f\u0440\u043e\u0445\u043e\u0434\u043e\u0432 \u043f\u043e \u0441\u0442\u0435\u043a\u0443.</p>"},{"location":"linux/network-stack/index.html#_2","title":"\u041a\u043e\u043c\u0430\u043d\u0434\u044b","text":"Bash<pre><code>ethtool -g eth0\n</code></pre> \u041f\u043e\u043a\u0430\u0437\u0430\u0442\u044c \u0440\u0430\u0437\u043c\u0435\u0440 ring buffer (\u0442\u0435\u043a\u0443\u0449\u0438\u0439 \u0438 \u043c\u0430\u043a\u0441\u0438\u043c\u0430\u043b\u044c\u043d\u044b\u0439). Bash<pre><code>ethtool -G eth0 rx 4096\n</code></pre> \u0423\u0432\u0435\u043b\u0438\u0447\u0438\u0442\u044c RX ring buffer \u0434\u043e 4096. Bash<pre><code>ethtool -c eth0\n</code></pre> \u041f\u043e\u043a\u0430\u0437\u0430\u0442\u044c \u043d\u0430\u0441\u0442\u0440\u043e\u0439\u043a\u0438 interrupt coalescing. Bash<pre><code>ethtool -C eth0 rx-usecs 100\n</code></pre> \u0423\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c \u0437\u0430\u0434\u0435\u0440\u0436\u043a\u0443 \u043f\u0440\u0435\u0440\u044b\u0432\u0430\u043d\u0438\u044f 100 \u043c\u043a\u0441. Bash<pre><code>ethtool -C eth0 adaptive-rx on\n</code></pre> \u0412\u043a\u043b\u044e\u0447\u0438\u0442\u044c \u0430\u0434\u0430\u043f\u0442\u0438\u0432\u043d\u044b\u0439 coalescing. Bash<pre><code>ethtool -S eth0 | grep -E \"rx_missed|rx_dropped|rx_errors\"\n</code></pre> \u041f\u0440\u043e\u0432\u0435\u0440\u0438\u0442\u044c \u043f\u043e\u0442\u0435\u0440\u0438 \u043f\u0430\u043a\u0435\u0442\u043e\u0432 \u043d\u0430 \u0443\u0440\u043e\u0432\u043d\u0435 NIC. Bash<pre><code>cat /proc/interrupts | grep eth0\n</code></pre> \u041f\u0440\u0435\u0440\u044b\u0432\u0430\u043d\u0438\u044f \u043f\u043e CPU \u0434\u043b\u044f \u0441\u0435\u0442\u0435\u0432\u043e\u0439 \u043a\u0430\u0440\u0442\u044b. Bash<pre><code>cat /proc/net/softnet_stat\n</code></pre> \u0421\u0442\u0430\u0442\u0438\u0441\u0442\u0438\u043a\u0430 softirq (\u0441\u0442\u043e\u043b\u0431\u0446\u044b: processed, dropped, time_squeeze). Bash<pre><code>cat /proc/softirqs | grep NET\n</code></pre> \u0421\u0447\u0435\u0442\u0447\u0438\u043a\u0438 NET_RX_SOFTIRQ \u0438 NET_TX_SOFTIRQ."},{"location":"linux/network-stack/index.html#_3","title":"\u041f\u0440\u0438\u043c\u0435\u0440\u044b","text":"<p>\u0414\u0438\u0430\u0433\u043d\u043e\u0441\u0442\u0438\u043a\u0430 \u043f\u043e\u0442\u0435\u0440\u044c \u043f\u0430\u043a\u0435\u0442\u043e\u0432:</p> Bash<pre><code># 1. \u041f\u043e\u0442\u0435\u0440\u0438 \u043d\u0430 NIC (ring buffer overflow)\nethtool -S eth0 | grep rx_missed\n\n# 2. \u041f\u043e\u0442\u0435\u0440\u0438 \u043d\u0430 softirq (\u043d\u0435 \u0443\u0441\u043f\u0435\u0432\u0430\u0435\u0442 \u043e\u0431\u0440\u0430\u0431\u043e\u0442\u0430\u0442\u044c)\ncat /proc/net/softnet_stat\n# \u0412\u0442\u043e\u0440\u043e\u0439 \u0441\u0442\u043e\u043b\u0431\u0435\u0446 - dropped, \u0442\u0440\u0435\u0442\u0438\u0439 - time_squeeze\n\n# 3. \u041f\u043e\u0442\u0435\u0440\u0438 \u043d\u0430 \u0441\u043e\u043a\u0435\u0442\u0435\nss -tmpn | grep -A1 ESTAB\n# \u0421\u043c\u043e\u0442\u0440\u0435\u0442\u044c Recv-Q\n</code></pre> <p>\u0422\u044e\u043d\u0438\u043d\u0433 \u0434\u043b\u044f \u0432\u044b\u0441\u043e\u043a\u043e\u0439 \u043d\u0430\u0433\u0440\u0443\u0437\u043a\u0438:</p> Bash<pre><code># \u0423\u0432\u0435\u043b\u0438\u0447\u0438\u0442\u044c ring buffer\nethtool -G eth0 rx 4096 tx 4096\n\n# \u0423\u0432\u0435\u043b\u0438\u0447\u0438\u0442\u044c coalescing (throughput \u0432\u0430\u0436\u043d\u0435\u0435 latency)\nethtool -C eth0 rx-usecs 100 rx-frames 64\n\n# \u0423\u0432\u0435\u043b\u0438\u0447\u0438\u0442\u044c backlog (\u0441\u043a\u043e\u043b\u044c\u043a\u043e \u043f\u0430\u043a\u0435\u0442\u043e\u0432 \u043c\u043e\u0436\u0435\u0442 \u043d\u0430\u043a\u043e\u043f\u0438\u0442\u044c\u0441\u044f \u0434\u043e \u043e\u0431\u0440\u0430\u0431\u043e\u0442\u043a\u0438)\nsysctl -w net.core.netdev_max_backlog=10000\n\n# \u0423\u0432\u0435\u043b\u0438\u0447\u0438\u0442\u044c budget softirq (\u0441\u043a\u043e\u043b\u044c\u043a\u043e \u043f\u0430\u043a\u0435\u0442\u043e\u0432 \u0437\u0430 \u043e\u0434\u0438\u043d \u0432\u044b\u0437\u043e\u0432)\nsysctl -w net.core.netdev_budget=600\n</code></pre> <p>\u0422\u044e\u043d\u0438\u043d\u0433 \u0434\u043b\u044f \u043d\u0438\u0437\u043a\u043e\u0439 latency:</p> Bash<pre><code># \u041c\u0438\u043d\u0438\u043c\u0430\u043b\u044c\u043d\u044b\u0439 coalescing\nethtool -C eth0 rx-usecs 0 rx-frames 1\n\n# \u0418\u043b\u0438 \u0430\u0434\u0430\u043f\u0442\u0438\u0432\u043d\u044b\u0439\nethtool -C eth0 adaptive-rx on\n</code></pre>"},{"location":"linux/network-stack/freebsd-vs-linux.html","title":"FreeBSD vs Linux","text":""},{"location":"linux/network-stack/freebsd-vs-linux.html#freebsd-vs-linux","title":"FreeBSD vs Linux","text":""},{"location":"linux/network-stack/freebsd-vs-linux.html#_1","title":"\u041a\u043e\u0440\u043e\u0442\u043a\u043e","text":"<p>Netflix \u0433\u043e\u043d\u0438\u0442 400Gb/s \u0441 \u043e\u0434\u043d\u043e\u0433\u043e \u0441\u0435\u0440\u0432\u0435\u0440\u0430 \u043d\u0430 FreeBSD. \u041f\u043e\u0447\u0435\u043c\u0443 \u043d\u0435 Linux? sendfile + KTLS \u0432 \u044f\u0434\u0440\u0435 \u0434\u0430\u044e\u0442 zero-copy \u0434\u043e \u0441\u0430\u043c\u043e\u0433\u043e NIC. \u0412 Linux \u0434\u0430\u043d\u043d\u044b\u0435 \u043a\u043e\u043f\u0438\u0440\u0443\u044e\u0442\u0441\u044f \u0434\u043b\u044f TLS \u0448\u0438\u0444\u0440\u043e\u0432\u0430\u043d\u0438\u044f \u0432 nginx.</p>"},{"location":"linux/network-stack/freebsd-vs-linux.html#mbuf-vs-sk_buff","title":"\u0411\u0443\u0444\u0435\u0440\u044b: mbuf vs sk_buff","text":"<p>Linux \u043f\u043e\u0448\u0435\u043b \u043f\u043e \u043f\u0443\u0442\u0438 \"\u043e\u0434\u0438\u043d \u043f\u0430\u043a\u0435\u0442 = \u043e\u0434\u0438\u043d \u043b\u0438\u043d\u0435\u0439\u043d\u044b\u0439 \u0431\u0443\u0444\u0435\u0440\". \u041f\u0440\u043e\u0449\u0435, \u043c\u0435\u043d\u044c\u0448\u0435 pointer chasing, \u043c\u043d\u043e\u0433\u0438\u0435 \u043e\u043f\u0435\u0440\u0430\u0446\u0438\u0438 \u0431\u044b\u0441\u0442\u0440\u0435\u0435. \u041c\u0438\u043d\u0443\u0441 - \u0438\u043d\u043e\u0433\u0434\u0430 \u0440\u0435\u0437\u0435\u0440\u0432\u0438\u0440\u0443\u0435\u0442\u0441\u044f \u043b\u0438\u0448\u043d\u044f\u044f \u043f\u0430\u043c\u044f\u0442\u044c.</p> <p>FreeBSD \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442 \u0446\u0435\u043f\u043e\u0447\u043a\u0438 mbuf (256 \u0431\u0430\u0439\u0442) + \u043a\u043b\u0430\u0441\u0442\u0435\u0440\u044b (2K/4K/9K). \u0413\u0438\u0431\u0447\u0435 \u043f\u043e\u0434 \u0440\u0430\u0437\u043d\u044b\u0435 \u0440\u0430\u0437\u043c\u0435\u0440\u044b, \u043d\u043e \u043d\u0443\u0436\u0435\u043d m_pullup() \u0447\u0442\u043e\u0431\u044b \u0441\u043e\u0431\u0440\u0430\u0442\u044c \u0437\u0430\u0433\u043e\u043b\u043e\u0432\u043a\u0438 \u0432 \u043d\u0435\u043f\u0440\u0435\u0440\u044b\u0432\u043d\u044b\u0439 \u0431\u043b\u043e\u043a.</p> <p>\u041d\u0430 \u043f\u0440\u0430\u043a\u0442\u0438\u043a\u0435 \u0440\u0430\u0437\u043d\u0438\u0446\u0430 \u043d\u0435 \u043a\u0440\u0438\u0442\u0438\u0447\u043d\u0430 \u0434\u043b\u044f \u0431\u043e\u043b\u044c\u0448\u0438\u043d\u0441\u0442\u0432\u0430 \u0437\u0430\u0434\u0430\u0447.</p>"},{"location":"linux/network-stack/freebsd-vs-linux.html#kqueue-vs-epoll","title":"kqueue vs epoll","text":"<p>epoll \u0440\u0430\u0437\u0434\u0440\u0430\u0436\u0430\u0435\u0442 \u0442\u0435\u043c, \u0447\u0442\u043e \u043d\u0430 \u043a\u0430\u0436\u0434\u043e\u0435 \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u0435 fd \u043d\u0443\u0436\u0435\u043d \u043e\u0442\u0434\u0435\u043b\u044c\u043d\u044b\u0439 epoll_ctl(). 100 \u0441\u043e\u043a\u0435\u0442\u043e\u0432 \u043f\u043e\u043c\u0435\u043d\u044f\u043b\u043e\u0441\u044c - 100 syscalls.</p> <p>kqueue \u0434\u0435\u043b\u0430\u0435\u0442 \u0432\u0441\u0451 \u0447\u0435\u0440\u0435\u0437 \u043e\u0434\u0438\u043d kevent() - \u0438 \u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u044f, \u0438 \u043f\u043e\u043b\u0443\u0447\u0435\u043d\u0438\u0435 \u0441\u043e\u0431\u044b\u0442\u0438\u0439. \u041c\u0435\u043d\u044c\u0448\u0435 syscalls = \u043c\u0435\u043d\u044c\u0448\u0435 overhead.</p> <p>\u0415\u0449\u0435 kqueue \u043d\u043e\u0440\u043c\u0430\u043b\u044c\u043d\u043e \u0440\u0430\u0431\u043e\u0442\u0430\u0435\u0442 \u0441 disk I/O \u0447\u0435\u0440\u0435\u0437 EVFILT_AIO. \u0412 Linux epoll \u043d\u0430 \u0444\u0430\u0439\u043b\u0430\u0445 \u0431\u0435\u0441\u043f\u043e\u043b\u0435\u0437\u0435\u043d - \u0444\u0430\u0439\u043b \"\u0432\u0441\u0435\u0433\u0434\u0430 ready\", \u0430 \u0440\u0435\u0430\u043b\u044c\u043d\u043e \u0431\u043b\u043e\u043a\u0438\u0440\u0443\u0435\u0442\u0441\u044f \u043d\u0430 \u0447\u0442\u0435\u043d\u0438\u0438 \u0441 \u0434\u0438\u0441\u043a\u0430.</p> <p>\u0418\u0441\u0442\u043e\u0447\u043d\u0438\u043a: kqueue vs epoll</p>"},{"location":"linux/network-stack/freebsd-vs-linux.html#sendfile-","title":"sendfile - \u0432\u043e\u0442 \u0433\u0434\u0435 \u0440\u0430\u0437\u043d\u0438\u0446\u0430","text":"<p>FreeBSD sendfile \u0434\u0435\u043b\u0430\u0435\u0442 share \u0441\u0442\u0440\u0430\u043d\u0438\u0446 \u043c\u0435\u0436\u0434\u0443 buffer cache \u0438 mbuf. \u0414\u0430\u043d\u043d\u044b\u0435 \u0441 \u0434\u0438\u0441\u043a\u0430 \u043f\u043e\u043f\u0430\u0434\u0430\u044e\u0442 \u0432 cache, \u043e\u0442\u0442\u0443\u0434\u0430 \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u044b \u0440\u0430\u0441\u0448\u0430\u0440\u0438\u0432\u0430\u044e\u0442\u0441\u044f \u0434\u043e \u0441\u0430\u043c\u043e\u0433\u043e NIC. \u041a\u043e\u043f\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u044f \u043d\u0435\u0442.</p> <p>\u041f\u043b\u044e\u0441 \u043e\u043d \u0430\u0441\u0438\u043d\u0445\u0440\u043e\u043d\u043d\u044b\u0439 - \u0432\u043e\u0437\u0432\u0440\u0430\u0449\u0430\u0435\u0442 success \u0434\u043e \u0437\u0430\u0432\u0435\u0440\u0448\u0435\u043d\u0438\u044f disk I/O. \u0414\u0430\u043d\u043d\u044b\u0435 \u0434\u043e\u043f\u0438\u0441\u044b\u0432\u0430\u044e\u0442\u0441\u044f \u0432 \u0441\u043e\u043a\u0435\u0442 \u043f\u043e\u0437\u0436\u0435, \u043f\u043e\u0440\u044f\u0434\u043e\u043a \u0441\u043e\u0445\u0440\u0430\u043d\u044f\u0435\u0442\u0441\u044f.</p> <p>Linux sendfile \u0442\u043e\u0436\u0435 zero-copy, \u043d\u043e \u043a\u043e\u0433\u0434\u0430 \u043d\u0443\u0436\u0435\u043d TLS - nginx \u0447\u0438\u0442\u0430\u0435\u0442 \u0434\u0430\u043d\u043d\u044b\u0435 \u0432 userspace, \u0448\u0438\u0444\u0440\u0443\u0435\u0442, \u043e\u0442\u0434\u0430\u0435\u0442 \u043e\u0431\u0440\u0430\u0442\u043d\u043e \u0432 \u044f\u0434\u0440\u043e. \u0412\u043e\u0442 \u0442\u0443\u0442 \u043a\u043e\u043f\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435.</p>"},{"location":"linux/network-stack/freebsd-vs-linux.html#netflix-freebsd","title":"\u041f\u043e\u0447\u0435\u043c\u0443 Netflix \u043d\u0430 FreeBSD","text":"<p>\u0418\u0437\u043d\u0430\u0447\u0430\u043b\u044c\u043d\u043e \u0432\u044b\u0431\u0440\u0430\u043b\u0438 \u043f\u043e\u0442\u043e\u043c\u0443 \u0447\u0442\u043e TCP/IP \u0441\u0442\u0435\u043a \u043f\u043e\u043a\u0430\u0437\u044b\u0432\u0430\u043b \u043c\u0435\u043d\u044c\u0448\u0435 latency. \u041f\u043e\u0442\u043e\u043c \u0432\u043b\u043e\u0436\u0438\u043b\u0438 \u043a\u0443\u0447\u0443 \u0440\u0430\u0431\u043e\u0442\u044b \u0432 \u043e\u043f\u0442\u0438\u043c\u0438\u0437\u0430\u0446\u0438\u0438 - \u0443\u0445\u043e\u0434\u0438\u0442\u044c \u0443\u0436\u0435 \u0433\u043b\u0443\u043f\u043e.</p> <p>\u0413\u043b\u0430\u0432\u043d\u0430\u044f \u0444\u0438\u0448\u043a\u0430 - KTLS. TLS \u0448\u0438\u0444\u0440\u043e\u0432\u0430\u043d\u0438\u0435 \u043f\u0435\u0440\u0435\u043d\u0435\u0441\u043b\u0438 \u0438\u0437 nginx \u0432 \u044f\u0434\u0440\u043e. sendfile pipeline \u0441\u043e\u0445\u0440\u0430\u043d\u044f\u0435\u0442\u0441\u044f:</p> Text Only<pre><code>\u0411\u0435\u0437 KTLS:  Disk -&gt; Cache -&gt; nginx (encrypt) -&gt; Kernel -&gt; NIC\n\u0421 KTLS:   Disk -&gt; Cache -&gt; Kernel (encrypt) -&gt; NIC\n</code></pre> <p>\u0412 2022 \u0434\u043e\u0431\u0430\u0432\u0438\u043b\u0438 NIC kTLS offload - \u0448\u0438\u0444\u0440\u043e\u0432\u0430\u043d\u0438\u0435 \u043d\u0430 \u0441\u0435\u0442\u0435\u0432\u0443\u0445\u0435. CPU \u0432\u043e\u043e\u0431\u0449\u0435 \u043d\u0435 \u0442\u0440\u043e\u0433\u0430\u0435\u0442 \u0434\u0430\u043d\u043d\u044b\u0435.</p> <p>\u0416\u0435\u043b\u0435\u0437\u043e \u0434\u043b\u044f 200Gb/s \u0441\u0435\u0440\u0432\u0435\u0440\u0430: AMD EPYC 7502P, 256GB RAM, 4x100GbE Mellanox, 18 NVMe \u0434\u0438\u0441\u043a\u043e\u0432. 200Gb/s \u044d\u0442\u043e 25GB/s, \u043d\u0443\u0436\u043d\u043e ~100GB/s memory bandwidth.</p> <p>NUMA siloing \u0442\u043e\u0436\u0435 \u0438\u0445 \u0440\u0430\u0431\u043e\u0442\u0430 - \u043f\u0440\u0438\u0432\u044f\u0437\u043a\u0430 \u0441\u0435\u0442\u0435\u0432\u044b\u0445 \u0441\u043e\u0435\u0434\u0438\u043d\u0435\u043d\u0438\u0439 \u043a NUMA node, \u043b\u043e\u043a\u0430\u043b\u044c\u043d\u0430\u044f \u0430\u043b\u043b\u043e\u043a\u0430\u0446\u0438\u044f \u043f\u0430\u043c\u044f\u0442\u0438 \u043f\u043e\u0434 \u0444\u0430\u0439\u043b\u044b \u0438 crypto \u0431\u0443\u0444\u0435\u0440\u044b. Intel Xeon \u043f\u043e\u0434\u043d\u044f\u043b\u0441\u044f \u0441 105Gb/s \u0434\u043e 191Gb/s.</p> <p>\u0418\u0441\u0442\u043e\u0447\u043d\u0438\u043a: Netflix Case Study</p>"},{"location":"linux/network-stack/freebsd-vs-linux.html#linux","title":"\u041a\u043e\u0433\u0434\u0430 Linux \u043b\u0443\u0447\u0448\u0435","text":"<p>Bulk transfer \u0431\u043e\u043b\u044c\u0448\u0438\u0445 \u043e\u0431\u044a\u0435\u043c\u043e\u0432 (Science DMZ \u0441\u0446\u0435\u043d\u0430\u0440\u0438\u0438). L3 forwarding \u043d\u0430 \u043c\u043d\u043e\u0433\u043e CPU - Linux \u043b\u0443\u0447\u0448\u0435 \u043f\u0430\u0440\u0430\u043b\u043b\u0435\u043b\u0438\u0442\u0441\u044f. Hardware support \u0448\u0438\u0440\u0435.</p> <p>io_uring \u0432 \u0441\u0432\u0435\u0436\u0438\u0445 \u044f\u0434\u0440\u0430\u0445 \u043c\u043e\u0436\u0435\u0442 \u0431\u044b\u0442\u044c \u0431\u044b\u0441\u0442\u0440\u0435\u0435 kqueue \u043d\u0430 \u043d\u0435\u043a\u043e\u0442\u043e\u0440\u044b\u0445 \u043f\u0430\u0442\u0442\u0435\u0440\u043d\u0430\u0445 - \u043f\u043e\u043b\u043d\u043e\u0441\u0442\u044c\u044e \u0430\u0441\u0438\u043d\u0445\u0440\u043e\u043d\u043d\u044b\u0439 I/O.</p>"},{"location":"linux/network-stack/freebsd-vs-linux.html#freebsd","title":"\u041a\u043e\u0433\u0434\u0430 FreeBSD \u043b\u0443\u0447\u0448\u0435","text":"<p>\u0421\u0442\u0440\u0438\u043c\u0438\u043d\u0433 \u0441\u0442\u0430\u0442\u0438\u043a\u0438 \u0441 TLS. Web-\u0441\u0435\u0440\u0432\u0435\u0440\u044b \u043f\u043e\u0434 \u0432\u044b\u0441\u043e\u043a\u043e\u0439 \u043d\u0430\u0433\u0440\u0443\u0437\u043a\u043e\u0439. Network appliances.</p> <p>\u0418\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u044e\u0442 Netflix, WhatsApp, Juniper.</p> <p>\u0418\u0441\u0442\u043e\u0447\u043d\u0438\u043a: Klara Systems</p>"},{"location":"linux/numa/index.html","title":"NUMA \u0438 \u0441\u0435\u0442\u044c","text":""},{"location":"linux/numa/index.html#numa","title":"NUMA \u0438 \u0441\u0435\u0442\u044c","text":""},{"location":"linux/numa/index.html#_1","title":"\u041a\u043e\u0440\u043e\u0442\u043a\u043e","text":"<p>NUMA (Non-Uniform Memory Access) - \u0430\u0440\u0445\u0438\u0442\u0435\u043a\u0442\u0443\u0440\u0430 \u043c\u043d\u043e\u0433\u043e\u043f\u0440\u043e\u0446\u0435\u0441\u0441\u043e\u0440\u043d\u044b\u0445 \u0441\u0438\u0441\u0442\u0435\u043c, \u0433\u0434\u0435 \u0434\u043e\u0441\u0442\u0443\u043f \u043a \"\u0441\u0432\u043e\u0435\u0439\" \u043f\u0430\u043c\u044f\u0442\u0438 \u0431\u044b\u0441\u0442\u0440\u0435\u0435, \u0447\u0435\u043c \u043a \"\u0447\u0443\u0436\u043e\u0439\".</p> <p>\u0414\u043b\u044f \u0441\u0435\u0442\u0438 \u043a\u0440\u0438\u0442\u0438\u0447\u043d\u043e: NIC \u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0435\u043d \u043a \u043a\u043e\u043d\u043a\u0440\u0435\u0442\u043d\u043e\u043c\u0443 CPU socket \u0447\u0435\u0440\u0435\u0437 PCIe. \u0415\u0441\u043b\u0438 \u043e\u0431\u0440\u0430\u0431\u0430\u0442\u044b\u0432\u0430\u0442\u044c \u043f\u0430\u043a\u0435\u0442\u044b \u043d\u0430 \"\u0447\u0443\u0436\u043e\u043c\" \u0441\u043e\u043a\u0435\u0442\u0435 - latency +50-100 ns, throughput -30-50%.</p>"},{"location":"linux/numa/index.html#numa_1","title":"\u0410\u0440\u0445\u0438\u0442\u0435\u043a\u0442\u0443\u0440\u0430 NUMA","text":"Text Only<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                          NUMA Node 0                                \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u2502\n\u2502  \u2502   CPU 0-15  \u2502    \u2502  L3 Cache   \u2502    \u2502      Local RAM          \u2502  \u2502\n\u2502  \u2502             \u2502\u25c4\u2500\u2500\u25ba\u2502   32 MB     \u2502\u25c4\u2500\u2500\u25ba\u2502       128 GB            \u2502  \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2502\n\u2502         \u2502                                         \u2502                 \u2502\n\u2502         \u2502              PCIe Root Complex          \u2502                 \u2502\n\u2502         \u2502                    \u2502                    \u2502                 \u2502\n\u2502         \u2502         \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510         \u2502                 \u2502\n\u2502         \u2502         \u2502     NIC 100G        \u2502         \u2502                 \u2502\n\u2502         \u2502         \u2502   (eth0, eth1)      \u2502         \u2502                 \u2502\n\u2502         \u2502         \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518         \u2502                 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2502\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2502\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n          \u2502                                         \u2502\n          \u2502            QPI / UPI / Infinity Fabric  \u2502\n          \u2502              (\u043c\u0435\u0436\u0441\u043e\u043a\u0435\u0442\u043d\u0430\u044f \u0441\u0432\u044f\u0437\u044c)        \u2502\n          \u2502                 ~100 ns                 \u2502\n          \u2502                                         \u2502\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2502\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2502\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502         \u25bc                                         \u25bc                 \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u2502\n\u2502  \u2502  CPU 16-31  \u2502    \u2502  L3 Cache   \u2502    \u2502      Remote RAM         \u2502  \u2502\n\u2502  \u2502             \u2502\u25c4\u2500\u2500\u25ba\u2502   32 MB     \u2502\u25c4\u2500\u2500\u25ba\u2502       128 GB            \u2502  \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2502\n\u2502                          NUMA Node 1                                \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"linux/numa/index.html#numa_2","title":"\u041f\u043e\u0447\u0435\u043c\u0443 NUMA \u0432\u043b\u0438\u044f\u0435\u0442 \u043d\u0430 \u0441\u0435\u0442\u044c","text":"<p>\u041f\u0440\u0430\u0432\u0438\u043b\u044c\u043d\u043e (\u043b\u043e\u043a\u0430\u043b\u044c\u043d\u044b\u0439 \u0434\u043e\u0441\u0442\u0443\u043f): </p>Text Only<pre><code>\u041f\u0430\u043a\u0435\u0442 \u2192 NIC \u2192 DMA \u0432 RAM (Node 0) \u2192 IRQ \u043d\u0430 CPU 0-15 \u2192 \u043e\u0431\u0440\u0430\u0431\u043e\u0442\u043a\u0430\n                                         \u2193\n                              \u0412\u0441\u0435 \u0432 \u043e\u0434\u043d\u043e\u043c NUMA node\n                              Latency: ~80 ns \u043a RAM\n</code></pre><p></p> <p>\u041d\u0435\u043f\u0440\u0430\u0432\u0438\u043b\u044c\u043d\u043e (\u0443\u0434\u0430\u043b\u0435\u043d\u043d\u044b\u0439 \u0434\u043e\u0441\u0442\u0443\u043f): </p>Text Only<pre><code>\u041f\u0430\u043a\u0435\u0442 \u2192 NIC \u2192 DMA \u0432 RAM (Node 0) \u2192 IRQ \u043d\u0430 CPU 16-31 (Node 1!)\n                                         \u2193\n                              CPU \u0438\u0434\u0435\u0442 \u0437\u0430 \u0434\u0430\u043d\u043d\u044b\u043c\u0438 \u043d\u0430 Node 0\n                              Latency: ~150 ns (QPI hop)\n                              + contention \u043d\u0430 interconnect\n</code></pre><p></p>"},{"location":"linux/numa/index.html#_2","title":"\u0412\u043b\u0438\u044f\u043d\u0438\u0435 \u043d\u0430 \u043f\u0440\u043e\u0438\u0437\u0432\u043e\u0434\u0438\u0442\u0435\u043b\u044c\u043d\u043e\u0441\u0442\u044c","text":"\u0421\u0446\u0435\u043d\u0430\u0440\u0438\u0439 Throughput Latency IRQ + App \u043d\u0430 \u043b\u043e\u043a\u0430\u043b\u044c\u043d\u043e\u043c node 100% baseline IRQ \u043b\u043e\u043a\u0430\u043b\u044c\u043d\u043e, App \u0443\u0434\u0430\u043b\u0435\u043d\u043d\u043e 70-85% +30-50 ns IRQ \u0443\u0434\u0430\u043b\u0435\u043d\u043d\u043e, App \u043b\u043e\u043a\u0430\u043b\u044c\u043d\u043e 60-80% +50-70 ns IRQ + App \u043d\u0430 \u0443\u0434\u0430\u043b\u0435\u043d\u043d\u043e\u043c node 50-70% +80-100 ns <p>\u041d\u0430 100G \u0440\u0430\u0437\u043d\u0438\u0446\u0430 \u043c\u0435\u0436\u0434\u0443 \u043f\u0440\u0430\u0432\u0438\u043b\u044c\u043d\u043e\u0439 \u0438 \u043d\u0435\u043f\u0440\u0430\u0432\u0438\u043b\u044c\u043d\u043e\u0439 \u043a\u043e\u043d\u0444\u0438\u0433\u0443\u0440\u0430\u0446\u0438\u0435\u0439: 40-100 Gbps vs 60-70 Gbps.</p>"},{"location":"linux/numa/index.html#_3","title":"\u0414\u0438\u0430\u0433\u043d\u043e\u0441\u0442\u0438\u043a\u0430","text":"<p>\u041f\u043e\u0441\u043c\u043e\u0442\u0440\u0435\u0442\u044c NUMA \u0442\u043e\u043f\u043e\u043b\u043e\u0433\u0438\u044e:</p> Bash<pre><code>numactl --hardware\n</code></pre> Text Only<pre><code>available: 2 nodes (0-1)\nnode 0 cpus: 0 1 2 3 4 5 6 7 16 17 18 19 20 21 22 23\nnode 0 size: 128000 MB\nnode 1 cpus: 8 9 10 11 12 13 14 15 24 25 26 27 28 29 30 31\nnode 1 size: 128000 MB\nnode distances:\nnode   0   1\n  0:  10  21\n  1:  21  10\n</code></pre> <p>Distance 10 = \u043b\u043e\u043a\u0430\u043b\u044c\u043d\u044b\u0439 \u0434\u043e\u0441\u0442\u0443\u043f, 21 = \u0443\u0434\u0430\u043b\u0435\u043d\u043d\u044b\u0439 (2.1x \u043c\u0435\u0434\u043b\u0435\u043d\u043d\u0435\u0435).</p> <p>\u041f\u043e\u0441\u043c\u043e\u0442\u0440\u0435\u0442\u044c CPU \u0438 NUMA:</p> Bash<pre><code>lscpu | grep -i numa\n</code></pre> Text Only<pre><code>NUMA node(s):          2\nNUMA node0 CPU(s):     0-7,16-23\nNUMA node1 CPU(s):     8-15,24-31\n</code></pre> <p>\u0423\u0437\u043d\u0430\u0442\u044c NUMA node \u0441\u0435\u0442\u0435\u0432\u043e\u0439 \u043a\u0430\u0440\u0442\u044b:</p> Bash<pre><code>cat /sys/class/net/eth0/device/numa_node\n</code></pre> Text Only<pre><code>0\n</code></pre> <p>\u0417\u043d\u0430\u0447\u0435\u043d\u0438\u0435 -1 = \u043d\u0435 \u043f\u0440\u0438\u0432\u044f\u0437\u0430\u043d\u043e (\u0432\u0438\u0440\u0442\u0443\u0430\u043b\u043a\u0430 \u0438\u043b\u0438 \u0441\u0442\u0430\u0440\u043e\u0435 \u0436\u0435\u043b\u0435\u0437\u043e).</p> <p>\u0412\u0438\u0437\u0443\u0430\u043b\u044c\u043d\u0430\u044f \u0442\u043e\u043f\u043e\u043b\u043e\u0433\u0438\u044f (\u0441 PCIe \u0443\u0441\u0442\u0440\u043e\u0439\u0441\u0442\u0432\u0430\u043c\u0438):</p> Bash<pre><code># \u0423\u0441\u0442\u0430\u043d\u043e\u0432\u043a\u0430\napt install hwloc\n\n# \u0422\u0435\u043a\u0441\u0442\u043e\u0432\u044b\u0439 \u0432\u044b\u0432\u043e\u0434\nlstopo --no-io\n\n# \u0421 \u0443\u0441\u0442\u0440\u043e\u0439\u0441\u0442\u0432\u0430\u043c\u0438\nlstopo\n\n# \u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c \u043a\u0430\u0440\u0442\u0438\u043d\u043a\u0443\nlstopo --output-format png &gt; topology.png\n</code></pre> <p>\u041f\u0440\u043e\u0432\u0435\u0440\u0438\u0442\u044c IRQ affinity:</p> Bash<pre><code># \u041d\u0430\u0439\u0442\u0438 IRQ \u0441\u0435\u0442\u0435\u0432\u043e\u0439 \u043a\u0430\u0440\u0442\u044b\ngrep eth0 /proc/interrupts\n\n# \u041f\u043e\u0441\u043c\u043e\u0442\u0440\u0435\u0442\u044c \u043d\u0430 \u043a\u0430\u043a\u0438\u0445 CPU \u043e\u0431\u0440\u0430\u0431\u0430\u0442\u044b\u0432\u0430\u0435\u0442\u0441\u044f\ncat /proc/irq/&lt;IRQ_NUM&gt;/smp_affinity_list\n</code></pre> <p>\u041f\u0440\u043e\u0432\u0435\u0440\u0438\u0442\u044c \u0433\u0434\u0435 \u0440\u0430\u0431\u043e\u0442\u0430\u0435\u0442 \u043f\u0440\u0438\u043b\u043e\u0436\u0435\u043d\u0438\u0435:</p> Bash<pre><code># PID \u043f\u0440\u043e\u0446\u0435\u0441\u0441\u0430\nps aux | grep nginx\n\n# \u041d\u0430 \u043a\u0430\u043a\u043e\u043c NUMA node\nnumactl --show --pid &lt;PID&gt;\n\n# \u0418\u043b\u0438 \u0447\u0435\u0440\u0435\u0437 taskset\ntaskset -cp &lt;PID&gt;\n</code></pre>"},{"location":"linux/numa/index.html#_4","title":"\u041d\u0430\u0441\u0442\u0440\u043e\u0439\u043a\u0430","text":"<p>1. \u041e\u0442\u043a\u043b\u044e\u0447\u0438\u0442\u044c irqbalance (\u0434\u043b\u044f \u0440\u0443\u0447\u043d\u043e\u0433\u043e \u043a\u043e\u043d\u0442\u0440\u043e\u043b\u044f):</p> Bash<pre><code>systemctl stop irqbalance\nsystemctl disable irqbalance\n</code></pre> <p>2. \u041f\u0440\u0438\u0432\u044f\u0437\u0430\u0442\u044c IRQ \u043a \u043b\u043e\u043a\u0430\u043b\u044c\u043d\u043e\u043c\u0443 NUMA node:</p> Bash<pre><code># \u0423\u0437\u043d\u0430\u0442\u044c NUMA node \u043a\u0430\u0440\u0442\u044b\nNODE=$(cat /sys/class/net/eth0/device/numa_node)\n\n# \u0423\u0437\u043d\u0430\u0442\u044c CPU \u044d\u0442\u043e\u0433\u043e node\nCPUS=$(numactl --hardware | grep \"node $NODE cpus\" | cut -d: -f2)\n\n# \u041d\u0430\u0439\u0442\u0438 IRQ\nIRQS=$(grep eth0 /proc/interrupts | awk '{print $1}' | tr -d ':')\n\n# \u041f\u0440\u0438\u0432\u044f\u0437\u0430\u0442\u044c \u043a\u0430\u0436\u0434\u044b\u0439 IRQ \u043a CPU \u0438\u0437 \u0441\u043f\u0438\u0441\u043a\u0430\nfor irq in $IRQS; do\n    echo &lt;CPU_MASK&gt; &gt; /proc/irq/$irq/smp_affinity\ndone\n</code></pre> <p>3. \u0417\u0430\u043f\u0443\u0441\u0442\u0438\u0442\u044c \u043f\u0440\u0438\u043b\u043e\u0436\u0435\u043d\u0438\u0435 \u043d\u0430 \u043f\u0440\u0430\u0432\u0438\u043b\u044c\u043d\u043e\u043c NUMA node:</p> Bash<pre><code># \u041f\u0440\u0438\u0432\u044f\u0437\u0430\u0442\u044c \u043a node 0 (\u043f\u0430\u043c\u044f\u0442\u044c \u0438 CPU)\nnumactl --cpunodebind=0 --membind=0 ./my_app\n\n# \u0418\u043b\u0438 \u0442\u043e\u043b\u044c\u043a\u043e CPU\ntaskset -c 0-7 ./my_app\n</code></pre> <p>4. \u0414\u043b\u044f nginx/haproxy - \u0432 systemd unit:</p> INI<pre><code>[Service]\nExecStart=/usr/sbin/nginx\n# \u041f\u0440\u0438\u0432\u044f\u0437\u043a\u0430 \u043a NUMA node 0\nCPUAffinity=0-7\nNUMAPolicy=bind\nNUMAMask=0\n</code></pre> <p>5. \u0418\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c set_irq_affinity \u0441\u043a\u0440\u0438\u043f\u0442 \u043e\u0442 Intel/Mellanox:</p> Bash<pre><code># Intel ixgbe/i40e\n/usr/share/doc/ixgbe/set_irq_affinity.sh eth0\n\n# Mellanox\nmlnx_affinity eth0\n</code></pre>"},{"location":"linux/numa/index.html#_5","title":"\u0410\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0437\u0430\u0446\u0438\u044f","text":"<p>\u0421\u043a\u0440\u0438\u043f\u0442 \u0434\u043b\u044f \u043d\u0430\u0441\u0442\u0440\u043e\u0439\u043a\u0438 affinity:</p> Bash<pre><code>#!/bin/bash\nIFACE=$1\nNODE=$(cat /sys/class/net/$IFACE/device/numa_node)\n\nif [ \"$NODE\" == \"-1\" ]; then\n    echo \"NIC $IFACE has no NUMA affinity\"\n    exit 1\nfi\n\n# \u041f\u043e\u043b\u0443\u0447\u0438\u0442\u044c CPU mask \u0434\u043b\u044f \u044d\u0442\u043e\u0433\u043e node\nCPUMASK=$(cat /sys/devices/system/node/node$NODE/cpumap)\n\n# \u041f\u0440\u0438\u043c\u0435\u043d\u0438\u0442\u044c \u043a\u043e \u0432\u0441\u0435\u043c IRQ \u044d\u0442\u043e\u0433\u043e \u0438\u043d\u0442\u0435\u0440\u0444\u0435\u0439\u0441\u0430\nfor irq in $(grep $IFACE /proc/interrupts | awk '{print $1}' | tr -d ':'); do\n    echo $CPUMASK &gt; /proc/irq/$irq/smp_affinity\n    echo \"IRQ $irq -&gt; NUMA node $NODE (mask $CPUMASK)\"\ndone\n</code></pre>"},{"location":"linux/numa/index.html#_6","title":"\u041a\u043e\u043c\u0430\u043d\u0434\u044b","text":"Bash<pre><code>numactl --hardware\n</code></pre> \u041f\u043e\u043a\u0430\u0437\u0430\u0442\u044c NUMA \u0442\u043e\u043f\u043e\u043b\u043e\u0433\u0438\u044e: nodes, CPUs, \u043f\u0430\u043c\u044f\u0442\u044c, distances. Bash<pre><code>numactl --cpunodebind=0 --membind=0 ./app\n</code></pre> \u0417\u0430\u043f\u0443\u0441\u0442\u0438\u0442\u044c \u043f\u0440\u0438\u043b\u043e\u0436\u0435\u043d\u0438\u0435 \u0441 \u043f\u0440\u0438\u0432\u044f\u0437\u043a\u043e\u0439 \u043a NUMA node 0. Bash<pre><code>numastat\n</code></pre> \u0421\u0442\u0430\u0442\u0438\u0441\u0442\u0438\u043a\u0430 \u0430\u043b\u043b\u043e\u043a\u0430\u0446\u0438\u0439 \u043f\u0430\u043c\u044f\u0442\u0438 \u043f\u043e NUMA nodes. Bash<pre><code>numastat -p &lt;PID&gt;\n</code></pre> \u0421\u0442\u0430\u0442\u0438\u0441\u0442\u0438\u043a\u0430 \u043f\u0430\u043c\u044f\u0442\u0438 \u043a\u043e\u043d\u043a\u0440\u0435\u0442\u043d\u043e\u0433\u043e \u043f\u0440\u043e\u0446\u0435\u0441\u0441\u0430 \u043f\u043e nodes. Bash<pre><code>cat /sys/class/net/eth0/device/numa_node\n</code></pre> NUMA node \u0441\u0435\u0442\u0435\u0432\u043e\u0439 \u043a\u0430\u0440\u0442\u044b. Bash<pre><code>lstopo\n</code></pre> \u0412\u0438\u0437\u0443\u0430\u043b\u044c\u043d\u0430\u044f \u0442\u043e\u043f\u043e\u043b\u043e\u0433\u0438\u044f \u0441\u0438\u0441\u0442\u0435\u043c\u044b (CPU, cache, PCIe, NUMA). Bash<pre><code>cat /proc/irq/&lt;N&gt;/smp_affinity_list\n</code></pre> \u041d\u0430 \u043a\u0430\u043a\u0438\u0445 CPU \u043e\u0431\u0440\u0430\u0431\u0430\u0442\u044b\u0432\u0430\u0435\u0442\u0441\u044f IRQ. Bash<pre><code>echo 0-7 &gt; /proc/irq/&lt;N&gt;/smp_affinity_list\n</code></pre> \u041f\u0440\u0438\u0432\u044f\u0437\u0430\u0442\u044c IRQ \u043a CPU 0-7."},{"location":"linux/numa/index.html#_7","title":"\u041f\u0440\u043e\u0432\u0435\u0440\u043a\u0430","text":"<p>\u0423\u0431\u0435\u0434\u0438\u0442\u044c\u0441\u044f \u0447\u0442\u043e \u0432\u0441\u0435 \u043f\u0440\u0430\u0432\u0438\u043b\u044c\u043d\u043e:</p> Bash<pre><code># 1. NIC \u043d\u0430 \u043a\u0430\u043a\u043e\u043c node?\ncat /sys/class/net/eth0/device/numa_node\n# \u0414\u043e\u043f\u0443\u0441\u0442\u0438\u043c: 0\n\n# 2. IRQ \u043e\u0431\u0440\u0430\u0431\u0430\u0442\u044b\u0432\u0430\u044e\u0442\u0441\u044f \u043d\u0430 \u044d\u0442\u043e\u043c node?\nfor irq in $(grep eth0 /proc/interrupts | awk '{print $1}' | tr -d ':'); do\n    echo -n \"IRQ $irq: \"\n    cat /proc/irq/$irq/smp_affinity_list\ndone\n# \u0414\u043e\u043b\u0436\u043d\u044b \u0431\u044b\u0442\u044c CPU \u0438\u0437 node 0\n\n# 3. \u041f\u0440\u0438\u043b\u043e\u0436\u0435\u043d\u0438\u0435 \u0440\u0430\u0431\u043e\u0442\u0430\u0435\u0442 \u043d\u0430 \u044d\u0442\u043e\u043c node?\ntaskset -cp $(pgrep nginx | head -1)\n# \u0414\u043e\u043b\u0436\u043d\u044b \u0431\u044b\u0442\u044c CPU \u0438\u0437 node 0\n\n# 4. \u041f\u0430\u043c\u044f\u0442\u044c \u0430\u043b\u043b\u043e\u0446\u0438\u0440\u043e\u0432\u0430\u043d\u0430 \u043b\u043e\u043a\u0430\u043b\u044c\u043d\u043e?\nnumastat -p $(pgrep nginx | head -1)\n# \u0411\u043e\u043b\u044c\u0448\u0438\u043d\u0441\u0442\u0432\u043e \u0432 Node 0\n</code></pre>"},{"location":"linux/numa/index.html#_8","title":"\u041f\u0440\u0438\u043c\u0435\u0440\u044b","text":"<p>\u0422\u0438\u043f\u0438\u0447\u043d\u0430\u044f \u043f\u0440\u043e\u0431\u043b\u0435\u043c\u0430:</p> Bash<pre><code># NIC \u043d\u0430 node 0\ncat /sys/class/net/eth0/device/numa_node\n0\n\n# \u041d\u043e IRQ \u0440\u0430\u0441\u043a\u0438\u0434\u0430\u043d\u044b \u043f\u043e \u0432\u0441\u0435\u043c CPU (irqbalance)\ngrep eth0 /proc/interrupts\n 45: 1000  2000  500  800  ...  eth0-TxRx-0\n 46:  900  1500  600  700  ...  eth0-TxRx-1\n# \u0427\u0438\u0441\u043b\u0430 \u043f\u0440\u0438\u043c\u0435\u0440\u043d\u043e \u0440\u0430\u0432\u043d\u044b = IRQ \u043f\u0440\u044b\u0433\u0430\u044e\u0442 \u043c\u0435\u0436\u0434\u0443 CPU\n</code></pre> <p>\u041f\u043e\u0441\u043b\u0435 \u043d\u0430\u0441\u0442\u0440\u043e\u0439\u043a\u0438:</p> Bash<pre><code># IRQ \u0442\u043e\u043b\u044c\u043a\u043e \u043d\u0430 CPU node 0\ngrep eth0 /proc/interrupts\n 45: 50000  0  0  0  0  0  0  0  ...  eth0-TxRx-0\n 46: 0  48000  0  0  0  0  0  0  ...  eth0-TxRx-1\n# \u0412\u0441\u0435 \u043f\u0440\u0435\u0440\u044b\u0432\u0430\u043d\u0438\u044f \u043d\u0430 CPU 0 \u0438 1\n</code></pre> <p>\u0411\u0435\u043d\u0447\u043c\u0430\u0440\u043a \u0434\u043e/\u043f\u043e\u0441\u043b\u0435 (iperf3, 100G):</p> Text Only<pre><code>\u0414\u043e (irqbalance, \u0441\u043b\u0443\u0447\u0430\u0439\u043d\u044b\u0435 CPU):\n  Bandwidth: 62 Gbps\n  CPU: 45% \u043d\u0430 node0, 35% \u043d\u0430 node1\n\n\u041f\u043e\u0441\u043b\u0435 (IRQ + app \u043d\u0430 node0):\n  Bandwidth: 94 Gbps\n  CPU: 70% \u043d\u0430 node0, 5% \u043d\u0430 node1\n</code></pre>"},{"location":"linux/ripe-atlas/index.html","title":"RIPE Atlas Software Probe","text":""},{"location":"linux/ripe-atlas/index.html#ripe-atlas-software-probe","title":"RIPE Atlas Software Probe","text":""},{"location":"linux/ripe-atlas/index.html#_1","title":"\u041a\u043e\u0440\u043e\u0442\u043a\u043e","text":"<p>\u041f\u0440\u043e\u0433\u0440\u0430\u043c\u043c\u043d\u0430\u044f probe \u0434\u043b\u044f \u0441\u0435\u0442\u0438 \u0438\u0437\u043c\u0435\u0440\u0435\u043d\u0438\u0439 RIPE NCC. \u0412\u044b\u043f\u043e\u043b\u043d\u044f\u0435\u0442 ping, traceroute, DNS, SSL/TLS, NTP, HTTP \u0438\u0437\u043c\u0435\u0440\u0435\u043d\u0438\u044f \u043f\u043e \u0437\u0430\u0434\u0430\u043d\u0438\u044f\u043c \u0438\u0437 \u043e\u0431\u043b\u0430\u043a\u0430.</p>"},{"location":"linux/ripe-atlas/index.html#_2","title":"\u0423\u0441\u0442\u0430\u043d\u043e\u0432\u043a\u0430","text":""},{"location":"linux/ripe-atlas/index.html#debianubuntu","title":"Debian/Ubuntu","text":"Bash<pre><code>ARCH=$(dpkg --print-architecture)\nCODENAME=$(. /etc/os-release &amp;&amp; echo \"$VERSION_CODENAME\")\n\nwget https://ftp.ripe.net/ripe/atlas/software-probe/debian/dists/\"$CODENAME\"/main/binary-\"$ARCH\"/ripe-atlas-repo_1.5-5_all.deb\nsudo dpkg -i ripe-atlas-repo_1.5-5_all.deb\nsudo apt update &amp;&amp; sudo apt install ripe-atlas-probe -y\n</code></pre>"},{"location":"linux/ripe-atlas/index.html#rhelcentos","title":"RHEL/CentOS","text":"Bash<pre><code>EL_VER=$(. /etc/os-release &amp;&amp; echo $PLATFORM_ID | cut -d':' -f2)\n\ncurl -fO https://ftp.ripe.net/ripe/atlas/software-probe/\"$EL_VER\"/noarch/ripe-atlas-repo-1.5-5.\"$EL_VER\".noarch.rpm\nsudo rpm -Uvh ripe-atlas-repo-1.5-5.\"$EL_VER\".noarch.rpm\nsudo dnf install ripe-atlas-probe -y\n</code></pre>"},{"location":"linux/ripe-atlas/index.html#_3","title":"\u0417\u0430\u043f\u0443\u0441\u043a","text":"Bash<pre><code>sudo systemctl enable --now ripe-atlas\n</code></pre>"},{"location":"linux/ripe-atlas/index.html#_4","title":"\u0420\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u044f","text":"Bash<pre><code>cat /etc/ripe-atlas/probe_key.pub\n</code></pre> <p>\u0421\u043a\u043e\u043f\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u043a\u043b\u044e\u0447 -&gt; https://atlas.ripe.net/apply/swprobe/ -&gt; \u0432\u0441\u0442\u0430\u0432\u0438\u0442\u044c -&gt; \u043e\u0442\u043f\u0440\u0430\u0432\u0438\u0442\u044c.</p>"},{"location":"linux/ripe-atlas/index.html#_5","title":"\u041f\u0440\u043e\u0432\u0435\u0440\u043a\u0430","text":"Bash<pre><code>sudo journalctl -u ripe-atlas | grep SESSION_ID\n</code></pre> <p>\u0415\u0441\u0442\u044c SESSION_ID - probe \u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0438\u043b\u0441\u044f.</p>"},{"location":"linux/ripe-atlas/index.html#_6","title":"\u0421\u0441\u044b\u043b\u043a\u0438","text":"<ul> <li>https://github.com/RIPE-NCC/ripe-atlas-software-probe</li> <li>https://atlas.ripe.net/apply/swprobe/</li> </ul>"},{"location":"networking/bgp/index.html","title":"\u041e\u0431\u0437\u043e\u0440","text":""},{"location":"networking/bgp/index.html#_1","title":"\u041e\u0431\u0437\u043e\u0440","text":""},{"location":"networking/bgp/index.html#_2","title":"\u041a\u043e\u0440\u043e\u0442\u043a\u043e","text":"<p>Border Gateway Protocol - \u043f\u0440\u043e\u0442\u043e\u043a\u043e\u043b \u043c\u0430\u0440\u0448\u0440\u0443\u0442\u0438\u0437\u0430\u0446\u0438\u0438 \u043c\u0435\u0436\u0434\u0443 \u0430\u0432\u0442\u043e\u043d\u043e\u043c\u043d\u044b\u043c\u0438 \u0441\u0438\u0441\u0442\u0435\u043c\u0430\u043c\u0438 (AS). \u0420\u0430\u0431\u043e\u0442\u0430\u0435\u0442 \u043f\u043e\u0432\u0435\u0440\u0445 TCP:179. Path-vector \u043f\u0440\u043e\u0442\u043e\u043a\u043e\u043b - \u0432\u044b\u0431\u0438\u0440\u0430\u0435\u0442 \u043c\u0430\u0440\u0448\u0440\u0443\u0442 \u043d\u0430 \u043e\u0441\u043d\u043e\u0432\u0435 \u0430\u0442\u0440\u0438\u0431\u0443\u0442\u043e\u0432, \u0430 \u043d\u0435 \u043c\u0435\u0442\u0440\u0438\u043a\u0438.</p> <p>\u041a\u043e\u0433\u0434\u0430 \u043d\u0443\u0436\u0435\u043d: - \u041f\u043e\u0434\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u0435 \u043a \u043d\u0435\u0441\u043a\u043e\u043b\u044c\u043a\u0438\u043c \u043f\u0440\u043e\u0432\u0430\u0439\u0434\u0435\u0440\u0430\u043c (multihoming) - \u0423\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u0438\u0435 \u0432\u0445\u043e\u0434\u044f\u0449\u0438\u043c/\u0438\u0441\u0445\u043e\u0434\u044f\u0449\u0438\u043c \u0442\u0440\u0430\u0444\u0438\u043a\u043e\u043c - \u041e\u0431\u043c\u0435\u043d \u043c\u0430\u0440\u0448\u0440\u0443\u0442\u0430\u043c\u0438 \u043c\u0435\u0436\u0434\u0443 AS</p>"},{"location":"networking/bgp/index.html#mp-bgp","title":"MP-BGP","text":"<p>Multiprotocol BGP (RFC 4760) - \u0440\u0430\u0441\u0448\u0438\u0440\u0435\u043d\u0438\u0435 \u0434\u043b\u044f \u043f\u043e\u0434\u0434\u0435\u0440\u0436\u043a\u0438 \u0440\u0430\u0437\u043d\u044b\u0445 \u043f\u0440\u043e\u0442\u043e\u043a\u043e\u043b\u043e\u0432 \u0438 \u0442\u0438\u043f\u043e\u0432 \u043c\u0430\u0440\u0448\u0440\u0443\u0442\u043e\u0432. \u041a\u043b\u0430\u0441\u0441\u0438\u0447\u0435\u0441\u043a\u0438\u0439 BGP \u0443\u043c\u0435\u043b \u0442\u043e\u043b\u044c\u043a\u043e IPv4 unicast. MP-BGP \u0434\u043e\u0431\u0430\u0432\u043b\u044f\u0435\u0442 address families.</p>"},{"location":"networking/bgp/index.html#afisafi","title":"AFI/SAFI","text":"<p>AFI (Address Family Identifier) - \u0442\u0438\u043f \u0430\u0434\u0440\u0435\u0441\u0430\u0446\u0438\u0438:</p> <ul> <li>1 - IPv4</li> <li>2 - IPv6</li> </ul> <p>SAFI (Subsequent AFI) - \u0442\u0438\u043f \u043c\u0430\u0440\u0448\u0440\u0443\u0442\u0438\u0437\u0430\u0446\u0438\u0438:</p> <ul> <li>1 - Unicast</li> <li>2 - Multicast</li> <li>128 - MPLS VPN</li> </ul> <p>\u041a\u043e\u043c\u0431\u0438\u043d\u0430\u0446\u0438\u0438:</p> <ul> <li>AFI 1, SAFI 1 - IPv4 Unicast (\u043a\u043b\u0430\u0441\u0441\u0438\u0447\u0435\u0441\u043a\u0438\u0439 BGP)</li> <li>AFI 1, SAFI 128 - VPNv4 (L3VPN)</li> <li>AFI 2, SAFI 1 - IPv6 Unicast</li> <li>AFI 2, SAFI 128 - VPNv6</li> </ul>"},{"location":"networking/bgp/index.html#ebgp-vs-ibgp","title":"eBGP vs iBGP","text":"<p>eBGP (external):</p> <ul> <li>\u0421\u043e\u0441\u0435\u0434\u0438 \u0438\u0437 \u0440\u0430\u0437\u043d\u044b\u0445 AS</li> <li>TTL = 1 \u043f\u043e \u0443\u043c\u043e\u043b\u0447\u0430\u043d\u0438\u044e</li> <li>\u041c\u0435\u043d\u044f\u0435\u0442 NEXT_HOP \u043d\u0430 \u0441\u0435\u0431\u044f</li> <li>\u0414\u043e\u0431\u0430\u0432\u043b\u044f\u0435\u0442 \u0441\u0432\u043e\u044e AS \u0432 AS_PATH</li> </ul> <p>iBGP (internal):</p> <ul> <li>\u0421\u043e\u0441\u0435\u0434\u0438 \u0432\u043d\u0443\u0442\u0440\u0438 \u043e\u0434\u043d\u043e\u0439 AS</li> <li>TTL = 255</li> <li>\u041d\u0435 \u043c\u0435\u043d\u044f\u0435\u0442 NEXT_HOP</li> <li>\u041d\u0435 \u0434\u043e\u0431\u0430\u0432\u043b\u044f\u0435\u0442 AS \u0432 AS_PATH</li> <li>\u0422\u0440\u0435\u0431\u0443\u0435\u0442 full-mesh \u0438\u043b\u0438 RR/confederation</li> </ul>"},{"location":"networking/bgp/index.html#_3","title":"\u0412\u044b\u0431\u043e\u0440 \u043b\u0443\u0447\u0448\u0435\u0433\u043e \u043c\u0430\u0440\u0448\u0440\u0443\u0442\u0430","text":"<p>\u041f\u043e\u0440\u044f\u0434\u043e\u043a \u0441\u0440\u0430\u0432\u043d\u0435\u043d\u0438\u044f (\u0441\u0432\u0435\u0440\u0445\u0443 \u0432\u043d\u0438\u0437, \u0434\u043e \u043f\u0435\u0440\u0432\u043e\u0433\u043e \u043e\u0442\u043b\u0438\u0447\u0438\u044f):</p> <ol> <li>Weight (\u0432\u044b\u0448\u0435 \u043b\u0443\u0447\u0448\u0435, Cisco-specific)</li> <li>LOCAL_PREF (\u0432\u044b\u0448\u0435 \u043b\u0443\u0447\u0448\u0435)</li> <li>Locally originated</li> <li>AS_PATH (\u043a\u043e\u0440\u043e\u0447\u0435 \u043b\u0443\u0447\u0448\u0435)</li> <li>ORIGIN (IGP &gt; EGP &gt; Incomplete)</li> <li>MED (\u043d\u0438\u0436\u0435 \u043b\u0443\u0447\u0448\u0435)</li> <li>eBGP &gt; iBGP</li> <li>IGP metric \u0434\u043e NEXT_HOP (\u043d\u0438\u0436\u0435 \u043b\u0443\u0447\u0448\u0435)</li> <li>Oldest route</li> <li>Lowest Router ID</li> <li>Lowest neighbor IP</li> </ol>"},{"location":"networking/bgp/advanced.html","title":"\u0414\u043e\u043f\u043e\u043b\u043d\u0438\u0442\u0435\u043b\u044c\u043d\u043e","text":""},{"location":"networking/bgp/advanced.html#_1","title":"\u0414\u043e\u043f\u043e\u043b\u043d\u0438\u0442\u0435\u043b\u044c\u043d\u043e","text":""},{"location":"networking/bgp/advanced.html#_2","title":"\u041a\u043e\u0440\u043e\u0442\u043a\u043e","text":"<p>Multipath, communities, add-path, BFD, route refresh \u0438 \u0434\u0440\u0443\u0433\u0438\u0435 \u0444\u0438\u0447\u0438 \u0434\u043b\u044f production.</p>"},{"location":"networking/bgp/advanced.html#multipath","title":"Multipath","text":"<p>\u0423\u0441\u0442\u0430\u043d\u043e\u0432\u043a\u0430 \u043d\u0435\u0441\u043a\u043e\u043b\u044c\u043a\u0438\u0445 \u043f\u0443\u0442\u0435\u0439 \u0432 RIB \u0434\u043b\u044f \u0431\u0430\u043b\u0430\u043d\u0441\u0438\u0440\u043e\u0432\u043a\u0438. \u041f\u043e \u0443\u043c\u043e\u043b\u0447\u0430\u043d\u0438\u044e BGP \u0441\u0442\u0430\u0432\u0438\u0442 \u0442\u043e\u043b\u044c\u043a\u043e \u043b\u0443\u0447\u0448\u0438\u0439 \u043c\u0430\u0440\u0448\u0440\u0443\u0442.</p> <p>eBGP multipath - \u043d\u0435\u0441\u043a\u043e\u043b\u044c\u043a\u043e \u043f\u0443\u0442\u0435\u0439 \u0447\u0435\u0440\u0435\u0437 \u0440\u0430\u0437\u043d\u044b\u0435 AS:</p> Juniper Text Only<pre><code>set routing-options autonomous-system 65000\nset protocols bgp group UPSTREAM multipath\n</code></pre> Huawei Text Only<pre><code>bgp 65000\n#\nipv4-family unicast\n  maximum load-balancing ebgp 4\n</code></pre> <p>iBGP multipath - \u043d\u0435\u0441\u043a\u043e\u043b\u044c\u043a\u043e \u043f\u0443\u0442\u0435\u0439 \u0432\u043d\u0443\u0442\u0440\u0438 AS:</p> Juniper Text Only<pre><code>set protocols bgp group INTERNAL multipath\n</code></pre> Huawei Text Only<pre><code>bgp 65000\n#\nipv4-family unicast\n  maximum load-balancing ibgp 4\n</code></pre> <p>eiBGP multipath - \u0441\u043c\u0435\u0448\u0430\u043d\u043d\u044b\u0439 (eBGP + iBGP):</p> Huawei Text Only<pre><code>bgp 65000\n#\nipv4-family unicast\n  maximum load-balancing 4\n</code></pre>"},{"location":"networking/bgp/advanced.html#communities","title":"Communities","text":"<p>\u041c\u0435\u0442\u043a\u0438 \u0434\u043b\u044f \u0433\u0440\u0443\u043f\u043f\u0438\u0440\u043e\u0432\u043a\u0438 \u043c\u0430\u0440\u0448\u0440\u0443\u0442\u043e\u0432 \u0438 \u043f\u0440\u0438\u043c\u0435\u043d\u0435\u043d\u0438\u044f \u043f\u043e\u043b\u0438\u0442\u0438\u043a.</p> <p>\u0424\u043e\u0440\u043c\u0430\u0442\u044b:</p> <ul> <li>Standard: <code>AS:VALUE</code> (16 bit \u043a\u0430\u0436\u0434\u043e\u0435) - RFC 1997</li> <li>Extended: 6 \u0431\u0430\u0439\u0442 - \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442\u0441\u044f \u0432 VPN</li> <li>Large: <code>AS:VALUE1:VALUE2</code> (32 bit AS) - RFC 8092</li> </ul> <p>Well-known communities:</p> <ul> <li><code>no-export</code> - \u043d\u0435 \u0430\u043d\u043e\u043d\u0441\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0437\u0430 \u043f\u0440\u0435\u0434\u0435\u043b\u044b AS</li> <li><code>no-advertise</code> - \u043d\u0435 \u0430\u043d\u043e\u043d\u0441\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u043d\u0438\u043a\u043e\u043c\u0443</li> <li><code>no-export-subconfed</code> - \u043d\u0435 \u0430\u043d\u043e\u043d\u0441\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0437\u0430 \u043f\u0440\u0435\u0434\u0435\u043b\u044b sub-AS</li> </ul> Juniper Text Only<pre><code># \u0423\u0441\u0442\u0430\u043d\u043e\u0432\u043a\u0430 community\nset policy-options community MY-COMM members 65000:100\n\nset policy-options policy-statement SET-COMM term 1 then community add MY-COMM\n\n# \u0424\u0438\u043b\u044c\u0442\u0440\u0430\u0446\u0438\u044f \u043f\u043e community\nset policy-options policy-statement MATCH-COMM term 1 from community MY-COMM\nset policy-options policy-statement MATCH-COMM term 1 then accept\n</code></pre> Huawei Text Only<pre><code># \u0423\u0441\u0442\u0430\u043d\u043e\u0432\u043a\u0430 community\nroute-policy SET-COMM permit node 10\n  apply community 65000:100\n\n# \u0424\u0438\u043b\u044c\u0442\u0440\u0430\u0446\u0438\u044f \u043f\u043e community\nip community-filter basic MY-COMM permit 65000:100\nroute-policy MATCH-COMM permit node 10\n  if-match community-filter MY-COMM\n</code></pre> <p>no-export \u043f\u0440\u0438\u043c\u0435\u0440:</p> Juniper Text Only<pre><code>set policy-options policy-statement NO-EXPORT then community add no-export\n</code></pre> Huawei Text Only<pre><code>route-policy NO-EXPORT permit node 10\n  apply community no-export\n</code></pre>"},{"location":"networking/bgp/advanced.html#add-path","title":"Add-Path","text":"<p>\u0410\u043d\u043e\u043d\u0441 \u043d\u0435\u0441\u043a\u043e\u043b\u044c\u043a\u0438\u0445 \u043f\u0443\u0442\u0435\u0439 \u043a \u043e\u0434\u043d\u043e\u043c\u0443 \u043f\u0440\u0435\u0444\u0438\u043a\u0441\u0443. \u041f\u043e\u043b\u0435\u0437\u043d\u043e \u0434\u043b\u044f RR - \u043a\u043b\u0438\u0435\u043d\u0442\u044b \u043f\u043e\u043b\u0443\u0447\u0430\u044e\u0442 \u0430\u043b\u044c\u0442\u0435\u0440\u043d\u0430\u0442\u0438\u0432\u044b.</p> Juniper Text Only<pre><code>set protocols bgp group RR-CLIENTS family inet unicast add-path send path-count 2\nset protocols bgp group RR-CLIENTS family inet unicast add-path receive\n</code></pre> Huawei Text Only<pre><code>bgp 65000\n#\nipv4-family unicast\n  peer RR-CLIENTS advertise-ext-community\n  peer RR-CLIENTS advertise-community\n  peer RR-CLIENTS additional-paths send\n  peer RR-CLIENTS additional-paths receive\n</code></pre>"},{"location":"networking/bgp/advanced.html#bfd-bidirectional-forwarding-detection","title":"BFD (Bidirectional Forwarding Detection)","text":"<p>\u0411\u044b\u0441\u0442\u0440\u043e\u0435 \u043e\u0431\u043d\u0430\u0440\u0443\u0436\u0435\u043d\u0438\u0435 \u043f\u0430\u0434\u0435\u043d\u0438\u044f \u0441\u043e\u0441\u0435\u0434\u0430 (\u043c\u0438\u043b\u043b\u0438\u0441\u0435\u043a\u0443\u043d\u0434\u044b \u0432\u043c\u0435\u0441\u0442\u043e Hold Timer).</p> Juniper Text Only<pre><code>set protocols bgp group UPSTREAM bfd-liveness-detection minimum-interval 300\nset protocols bgp group UPSTREAM bfd-liveness-detection multiplier 3\n</code></pre> Huawei Text Only<pre><code>bgp 65000\n  peer 10.0.0.1 bfd enable\n  peer 10.0.0.1 bfd min-tx-interval 300 min-rx-interval 300 detect-multiplier 3\n</code></pre>"},{"location":"networking/bgp/advanced.html#route-refresh","title":"Route Refresh","text":"<p>\u0417\u0430\u043f\u0440\u043e\u0441 \u043f\u043e\u0432\u0442\u043e\u0440\u043d\u043e\u0439 \u043e\u0442\u043f\u0440\u0430\u0432\u043a\u0438 \u043c\u0430\u0440\u0448\u0440\u0443\u0442\u043e\u0432 \u043e\u0442 \u0441\u043e\u0441\u0435\u0434\u0430 \u0431\u0435\u0437 \u0441\u0431\u0440\u043e\u0441\u0430 \u0441\u0435\u0441\u0441\u0438\u0438.</p> Juniper Text Only<pre><code># \u0412 CLI\nclear bgp neighbor 10.0.0.1 soft-inbound\n</code></pre> Huawei Text Only<pre><code># \u0412 CLI\nrefresh bgp 10.0.0.1 ipv4 unicast import\n</code></pre>"},{"location":"networking/bgp/advanced.html#graceful-restart","title":"Graceful Restart","text":"<p>\u0421\u043e\u0445\u0440\u0430\u043d\u0435\u043d\u0438\u0435 forwarding \u043f\u0440\u0438 \u043f\u0435\u0440\u0435\u0437\u0430\u043f\u0443\u0441\u043a\u0435 BGP-\u043f\u0440\u043e\u0446\u0435\u0441\u0441\u0430. \u0421\u043e\u0441\u0435\u0434 \u043d\u0435 \u0443\u0434\u0430\u043b\u044f\u0435\u0442 \u043c\u0430\u0440\u0448\u0440\u0443\u0442\u044b.</p> Juniper Text Only<pre><code>set routing-options graceful-restart\n</code></pre> Huawei Text Only<pre><code>bgp 65000\n  graceful-restart\n  graceful-restart timer restart 120\n</code></pre>"},{"location":"networking/bgp/advanced.html#next-hop-tracking","title":"Next-hop tracking","text":"<p>\u041e\u0442\u0441\u043b\u0435\u0436\u0438\u0432\u0430\u043d\u0438\u0435 \u0434\u043e\u0441\u0442\u0443\u043f\u043d\u043e\u0441\u0442\u0438 NEXT_HOP \u0447\u0435\u0440\u0435\u0437 IGP. \u041f\u0440\u0438 \u043d\u0435\u0434\u043e\u0441\u0442\u0443\u043f\u043d\u043e\u0441\u0442\u0438 - \u043c\u0430\u0440\u0448\u0440\u0443\u0442 \u0443\u0434\u0430\u043b\u044f\u0435\u0442\u0441\u044f.</p> Juniper Text Only<pre><code># \u0412\u043a\u043b\u044e\u0447\u0435\u043d\u043e \u043f\u043e \u0443\u043c\u043e\u043b\u0447\u0430\u043d\u0438\u044e\nset protocols bgp group INTERNAL family inet unicast nexthop-resolution\n</code></pre> Huawei Text Only<pre><code>bgp 65000\n#\nipv4-family unicast\n  nexthop recursive-lookup route-policy CHECK-NH\n</code></pre>"},{"location":"networking/bgp/advanced.html#selective-route-download","title":"Selective route download","text":"<p>\u0423\u0441\u0442\u0430\u043d\u043e\u0432\u043a\u0430 \u0432 RIB \u0442\u043e\u043b\u044c\u043a\u043e \u043d\u0443\u0436\u043d\u044b\u0445 \u043c\u0430\u0440\u0448\u0440\u0443\u0442\u043e\u0432 (\u044d\u043a\u043e\u043d\u043e\u043c\u0438\u044f \u043f\u0430\u043c\u044f\u0442\u0438).</p> Juniper Text Only<pre><code>set protocols bgp group UPSTREAM family inet unicast rib-group SELECTIVE\n</code></pre> Huawei Text Only<pre><code>bgp 65000\n#\nipv4-family unicast\n  peer 10.0.0.1 route-policy ACCEPT-ONLY-DEFAULT import\n</code></pre>"},{"location":"networking/bgp/attributes.html","title":"\u0410\u0442\u0440\u0438\u0431\u0443\u0442\u044b","text":""},{"location":"networking/bgp/attributes.html#_1","title":"\u0410\u0442\u0440\u0438\u0431\u0443\u0442\u044b","text":""},{"location":"networking/bgp/attributes.html#_2","title":"\u041a\u043e\u0440\u043e\u0442\u043a\u043e","text":"<p>\u0410\u0442\u0440\u0438\u0431\u0443\u0442\u044b \u043e\u043f\u0440\u0435\u0434\u0435\u043b\u044f\u044e\u0442 \u0445\u0430\u0440\u0430\u043a\u0442\u0435\u0440\u0438\u0441\u0442\u0438\u043a\u0438 \u043c\u0430\u0440\u0448\u0440\u0443\u0442\u0430 \u0438 \u0432\u043b\u0438\u044f\u044e\u0442 \u043d\u0430 \u0432\u044b\u0431\u043e\u0440 \u043b\u0443\u0447\u0448\u0435\u0433\u043e \u043f\u0443\u0442\u0438. Well-known (\u043e\u0431\u044f\u0437\u0430\u0442\u0435\u043b\u044c\u043d\u044b\u0435) vs Optional. Transitive (\u043f\u0435\u0440\u0435\u0434\u0430\u044e\u0442\u0441\u044f \u0434\u0430\u043b\u044c\u0448\u0435) vs Non-transitive.</p>"},{"location":"networking/bgp/attributes.html#_3","title":"\u041a\u043b\u0430\u0441\u0441\u0438\u0444\u0438\u043a\u0430\u0446\u0438\u044f","text":"<p>Well-known Mandatory - \u043e\u0431\u044f\u0437\u0430\u0442\u0435\u043b\u044c\u043d\u044b, \u0432\u0441\u0435\u0433\u0434\u0430 \u043f\u0440\u0438\u0441\u0443\u0442\u0441\u0442\u0432\u0443\u044e\u0442:</p> <ul> <li>ORIGIN</li> <li>AS_PATH</li> <li>NEXT_HOP</li> </ul> <p>Well-known Discretionary - \u0438\u0437\u0432\u0435\u0441\u0442\u043d\u044b \u0432\u0441\u0435\u043c, \u043d\u043e \u043e\u043f\u0446\u0438\u043e\u043d\u0430\u043b\u044c\u043d\u044b:</p> <ul> <li>LOCAL_PREF</li> <li>ATOMIC_AGGREGATE</li> </ul> <p>Optional Transitive - \u043e\u043f\u0446\u0438\u043e\u043d\u0430\u043b\u044c\u043d\u044b, \u043f\u0435\u0440\u0435\u0434\u0430\u044e\u0442\u0441\u044f \u0434\u0430\u043b\u044c\u0448\u0435:</p> <ul> <li>AGGREGATOR</li> <li>COMMUNITY</li> </ul> <p>Optional Non-transitive - \u043e\u043f\u0446\u0438\u043e\u043d\u0430\u043b\u044c\u043d\u044b, \u043d\u0435 \u043f\u0435\u0440\u0435\u0434\u0430\u044e\u0442\u0441\u044f:</p> <ul> <li>MED</li> <li>ORIGINATOR_ID</li> <li>CLUSTER_LIST</li> </ul>"},{"location":"networking/bgp/attributes.html#as_path","title":"AS_PATH","text":"<p>\u0421\u043f\u0438\u0441\u043e\u043a AS, \u0447\u0435\u0440\u0435\u0437 \u043a\u043e\u0442\u043e\u0440\u044b\u0435 \u043f\u0440\u043e\u0448\u0435\u043b \u043c\u0430\u0440\u0448\u0440\u0443\u0442. \u0417\u0430\u0449\u0438\u0442\u0430 \u043e\u0442 \u043f\u0435\u0442\u0435\u043b\u044c.</p> <ul> <li>\u041f\u0440\u0438 eBGP: \u0434\u043e\u0431\u0430\u0432\u043b\u044f\u0435\u0442\u0441\u044f \u0441\u0432\u043e\u044f AS \u0441\u043b\u0435\u0432\u0430</li> <li>\u041f\u0440\u0438 iBGP: \u043d\u0435 \u043c\u0435\u043d\u044f\u0435\u0442\u0441\u044f</li> <li>\u0415\u0441\u043b\u0438 \u0441\u0432\u043e\u044f AS \u0432 \u043f\u0443\u0442\u0438 - \u043c\u0430\u0440\u0448\u0440\u0443\u0442 \u043e\u0442\u0431\u0440\u0430\u0441\u044b\u0432\u0430\u0435\u0442\u0441\u044f</li> </ul> <p>AS_PATH prepend - \u0434\u043e\u0431\u0430\u0432\u043b\u0435\u043d\u0438\u0435 \u0441\u0432\u043e\u0435\u0439 AS \u043d\u0435\u0441\u043a\u043e\u043b\u044c\u043a\u043e \u0440\u0430\u0437 \u0434\u043b\u044f \u0443\u0434\u043b\u0438\u043d\u0435\u043d\u0438\u044f \u043f\u0443\u0442\u0438:</p> Juniper Text Only<pre><code>set policy-options policy-statement PREPEND term 1 then as-path-prepend \"65000 65000 65000\"\n</code></pre> Huawei Text Only<pre><code>route-policy PREPEND permit node 10\n  apply as-path 65000 65000 65000 additive\n</code></pre>"},{"location":"networking/bgp/attributes.html#next_hop","title":"NEXT_HOP","text":"<p>IP \u0441\u043b\u0435\u0434\u0443\u044e\u0449\u0435\u0433\u043e \u0445\u043e\u043f\u0430. \u0414\u043e\u043b\u0436\u0435\u043d \u0431\u044b\u0442\u044c \u0434\u043e\u0441\u0442\u0438\u0436\u0438\u043c \u0447\u0435\u0440\u0435\u0437 IGP.</p> <ul> <li>eBGP: \u043c\u0435\u043d\u044f\u0435\u0442\u0441\u044f \u043d\u0430 IP \u043e\u0442\u043f\u0440\u0430\u0432\u0438\u0442\u0435\u043b\u044f</li> <li>iBGP: \u043d\u0435 \u043c\u0435\u043d\u044f\u0435\u0442\u0441\u044f (\u043f\u0440\u043e\u0431\u043b\u0435\u043c\u0430 - \u043d\u0443\u0436\u0435\u043d IGP \u0434\u043e eBGP-\u0441\u043e\u0441\u0435\u0434\u0430)</li> </ul> <p>next-hop-self - \u043f\u0440\u0438\u043d\u0443\u0434\u0438\u0442\u0435\u043b\u044c\u043d\u043e \u0441\u0442\u0430\u0432\u0438\u0442\u044c \u0441\u0432\u043e\u0439 IP:</p> Juniper Text Only<pre><code>set protocols bgp group INTERNAL export NHS\nset policy-options policy-statement NHS then next-hop self\n</code></pre> Huawei Text Only<pre><code>bgp 65000\n#\nipv4-family unicast\n  peer IBGP-GROUP next-hop-local\n</code></pre>"},{"location":"networking/bgp/attributes.html#local_pref","title":"LOCAL_PREF","text":"<p>\u041f\u0440\u0438\u043e\u0440\u0438\u0442\u0435\u0442 \u043f\u0443\u0442\u0438 \u0432\u043d\u0443\u0442\u0440\u0438 AS. \u0412\u044b\u0448\u0435 - \u043b\u0443\u0447\u0448\u0435. \u041f\u043e \u0443\u043c\u043e\u043b\u0447\u0430\u043d\u0438\u044e 100. \u0420\u0430\u0441\u043f\u0440\u043e\u0441\u0442\u0440\u0430\u043d\u044f\u0435\u0442\u0441\u044f \u0442\u043e\u043b\u044c\u043a\u043e \u0432\u043d\u0443\u0442\u0440\u0438 AS (iBGP).</p> <p>\u0423\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u0438\u0435 \u0438\u0441\u0445\u043e\u0434\u044f\u0449\u0438\u043c \u0442\u0440\u0430\u0444\u0438\u043a\u043e\u043c - \u043a\u0430\u043a\u043e\u0439 \u0432\u044b\u0445\u043e\u0434 \u0438\u0437 AS \u043f\u0440\u0435\u0434\u043f\u043e\u0447\u0442\u0438\u0442\u0435\u043b\u044c\u043d\u0435\u0435.</p> Juniper Text Only<pre><code>set policy-options policy-statement SET-LP term 1 from neighbor 10.0.0.1\nset policy-options policy-statement SET-LP term 1 then local-preference 200\n</code></pre> Huawei Text Only<pre><code>route-policy PREFER-ISP1 permit node 10\n  apply local-preference 200\n#\nbgp 65000\n  peer 10.0.0.1 route-policy PREFER-ISP1 import\n</code></pre>"},{"location":"networking/bgp/attributes.html#med-multi-exit-discriminator","title":"MED (Multi-Exit Discriminator)","text":"<p>\u041f\u043e\u0434\u0441\u043a\u0430\u0437\u043a\u0430 \u0441\u043e\u0441\u0435\u0434\u043d\u0435\u0439 AS \u043a\u0430\u043a\u043e\u0439 \u0432\u0445\u043e\u0434 \u043f\u0440\u0435\u0434\u043f\u043e\u0447\u0442\u0438\u0442\u0435\u043b\u044c\u043d\u0435\u0435. \u041d\u0438\u0436\u0435 - \u043b\u0443\u0447\u0448\u0435. Non-transitive - \u043d\u0435 \u043f\u0435\u0440\u0435\u0434\u0430\u0435\u0442\u0441\u044f \u0434\u0430\u043b\u044c\u0448\u0435 \u043f\u0435\u0440\u0432\u043e\u0439 AS.</p> <p>\u0423\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u0438\u0435 \u0432\u0445\u043e\u0434\u044f\u0449\u0438\u043c \u0442\u0440\u0430\u0444\u0438\u043a\u043e\u043c.</p> Juniper Text Only<pre><code>set policy-options policy-statement SET-MED then metric 50\nset protocols bgp group UPSTREAM export SET-MED\n</code></pre> Huawei Text Only<pre><code>route-policy SET-MED permit node 10\n  apply cost 50\n#\nbgp 65000\n  peer 10.0.0.1 route-policy SET-MED export\n</code></pre>"},{"location":"networking/bgp/attributes.html#origin","title":"ORIGIN","text":"<p>\u041a\u0430\u043a \u043c\u0430\u0440\u0448\u0440\u0443\u0442 \u043f\u043e\u043f\u0430\u043b \u0432 BGP:</p> <ul> <li>IGP (i) - \u043a\u043e\u043c\u0430\u043d\u0434\u0430 network</li> <li>EGP (e) - \u0443\u0441\u0442\u0430\u0440\u0435\u0432\u0448\u0438\u0439 EGP \u043f\u0440\u043e\u0442\u043e\u043a\u043e\u043b</li> <li>Incomplete (?) - redistribute</li> </ul> <p>\u041f\u0440\u0435\u0434\u043f\u043e\u0447\u0442\u0435\u043d\u0438\u0435: IGP &gt; EGP &gt; Incomplete.</p>"},{"location":"networking/bgp/attributes.html#weight-cisco-specific","title":"Weight (Cisco-specific)","text":"<p>\u041b\u043e\u043a\u0430\u043b\u044c\u043d\u044b\u0439 \u0430\u0442\u0440\u0438\u0431\u0443\u0442, \u043d\u0435 \u043f\u0435\u0440\u0435\u0434\u0430\u0435\u0442\u0441\u044f. \u0412\u044b\u0448\u0435 - \u043b\u0443\u0447\u0448\u0435. \u041d\u0430 Juniper/Huawei \u0430\u043d\u0430\u043b\u043e\u0433\u0430 \u043d\u0435\u0442 - \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0439 LOCAL_PREF.</p>"},{"location":"networking/bgp/attributes.html#_4","title":"\u0421\u0443\u043c\u043c\u0430\u0440\u0438\u0437\u0430\u0446\u0438\u044f","text":"<p>aggregate - \u0441\u043e\u0437\u0434\u0430\u043d\u0438\u0435 \u0441\u0443\u043c\u043c\u0430\u0440\u043d\u043e\u0433\u043e \u043c\u0430\u0440\u0448\u0440\u0443\u0442\u0430.</p> Juniper Text Only<pre><code>set routing-options aggregate route 10.0.0.0/16\n\nset policy-options policy-statement AGGREGATE term 1 from protocol aggregate\nset policy-options policy-statement AGGREGATE term 1 then accept\n</code></pre> Huawei Text Only<pre><code>bgp 65000\n#\nipv4-family unicast\n  aggregate 10.0.0.0 255.255.0.0\n</code></pre> <p>as-set - \u0441\u043e\u0445\u0440\u0430\u043d\u0435\u043d\u0438\u0435 AS_PATH \u043a\u043e\u043c\u043f\u043e\u043d\u0435\u043d\u0442\u043e\u0432 \u0432 \u0441\u0443\u043c\u043c\u0430\u0440\u043d\u043e\u043c \u043c\u0430\u0440\u0448\u0440\u0443\u0442\u0435:</p> Juniper Text Only<pre><code>set routing-options aggregate route 10.0.0.0/16 as-path origin IGP\nset routing-options aggregate route 10.0.0.0/16 as-path path \"65001 65002\"\n</code></pre> Huawei Text Only<pre><code>bgp 65000\n#\nipv4-family unicast\n  aggregate 10.0.0.0 255.255.0.0 as-set\n</code></pre> <p>suppress-map / detail-suppressed - \u043f\u043e\u0434\u0430\u0432\u043b\u0435\u043d\u0438\u0435 \u0431\u043e\u043b\u0435\u0435 \u0441\u043f\u0435\u0446\u0438\u0444\u0438\u0447\u043d\u044b\u0445 \u043c\u0430\u0440\u0448\u0440\u0443\u0442\u043e\u0432:</p> Huawei Text Only<pre><code>bgp 65000\n#\nipv4-family unicast\n  aggregate 10.0.0.0 255.255.0.0 detail-suppressed\n</code></pre>"},{"location":"networking/bgp/filtering.html","title":"\u0424\u0438\u043b\u044c\u0442\u0440\u0430\u0446\u0438\u044f","text":""},{"location":"networking/bgp/filtering.html#_1","title":"\u0424\u0438\u043b\u044c\u0442\u0440\u0430\u0446\u0438\u044f","text":""},{"location":"networking/bgp/filtering.html#_2","title":"\u041a\u043e\u0440\u043e\u0442\u043a\u043e","text":"<p>\u0424\u0438\u043b\u044c\u0442\u0440\u0430\u0446\u0438\u044f \u043a\u043e\u043d\u0442\u0440\u043e\u043b\u0438\u0440\u0443\u0435\u0442 \u043a\u0430\u043a\u0438\u0435 \u043c\u0430\u0440\u0448\u0440\u0443\u0442\u044b \u043f\u0440\u0438\u043d\u0438\u043c\u0430\u0442\u044c (import) \u0438 \u043e\u0442\u0434\u0430\u0432\u0430\u0442\u044c (export). \u0418\u043d\u0441\u0442\u0440\u0443\u043c\u0435\u043d\u0442\u044b: prefix-list, as-path filter, route-map/policy.</p>"},{"location":"networking/bgp/filtering.html#prefix-list","title":"Prefix-list","text":"<p>\u0424\u0438\u043b\u044c\u0442\u0440\u0430\u0446\u0438\u044f \u043f\u043e \u043f\u0440\u0435\u0444\u0438\u043a\u0441\u0430\u043c \u0438 \u043c\u0430\u0441\u043a\u0430\u043c.</p> Juniper Text Only<pre><code>set policy-options prefix-list ALLOWED 10.0.0.0/8\nset policy-options prefix-list ALLOWED 172.16.0.0/12\n\nset policy-options policy-statement IMPORT-FILTER term 1 from prefix-list ALLOWED\nset policy-options policy-statement IMPORT-FILTER term 1 then accept\nset policy-options policy-statement IMPORT-FILTER then reject\n\nset protocols bgp group UPSTREAM import IMPORT-FILTER\n</code></pre> Huawei Text Only<pre><code>ip ip-prefix ALLOWED index 10 permit 10.0.0.0 8\nip ip-prefix ALLOWED index 20 permit 172.16.0.0 12\n#\nroute-policy IMPORT-FILTER permit node 10\n  if-match ip-prefix ALLOWED\nroute-policy IMPORT-FILTER deny node 100\n#\nbgp 65000\n  peer 10.0.0.1 route-policy IMPORT-FILTER import\n</code></pre>"},{"location":"networking/bgp/filtering.html#route-filter-juniper-prefix","title":"route-filter (Juniper) / prefix \u0441 \u043c\u0430\u0441\u043a\u0430\u043c\u0438","text":"<p>\u0413\u0438\u0431\u043a\u0430\u044f \u0444\u0438\u043b\u044c\u0442\u0440\u0430\u0446\u0438\u044f \u0441 \u0443\u043a\u0430\u0437\u0430\u043d\u0438\u0435\u043c \u0434\u043b\u0438\u043d\u044b \u043f\u0440\u0435\u0444\u0438\u043a\u0441\u0430.</p> Juniper Text Only<pre><code># exact - \u0442\u043e\u0447\u043d\u043e\u0435 \u0441\u043e\u0432\u043f\u0430\u0434\u0435\u043d\u0438\u0435\nset policy-options policy-statement FILTER term 1 from route-filter 10.0.0.0/8 exact\n\n# orlonger - /8 \u0438 \u0431\u043e\u043b\u0435\u0435 \u0441\u043f\u0435\u0446\u0438\u0444\u0438\u0447\u043d\u044b\u0435 (/9, /10, ...)\nset policy-options policy-statement FILTER term 2 from route-filter 10.0.0.0/8 orlonger\n\n# prefix-length-range - \u0434\u0438\u0430\u043f\u0430\u0437\u043e\u043d \u0434\u043b\u0438\u043d\nset policy-options policy-statement FILTER term 3 from route-filter 10.0.0.0/8 prefix-length-range /16-/24\n\n# upto - \u0434\u043e \u0443\u043a\u0430\u0437\u0430\u043d\u043d\u043e\u0439 \u0434\u043b\u0438\u043d\u044b\nset policy-options policy-statement FILTER term 4 from route-filter 10.0.0.0/8 upto /16\n</code></pre> Huawei Text Only<pre><code># exact (equal)\nip ip-prefix EXACT index 10 permit 10.0.0.0 8\n\n# orlonger (le 32)\nip ip-prefix ORLONGER index 10 permit 10.0.0.0 8 less-equal 32\n\n# prefix-length-range\nip ip-prefix RANGE index 10 permit 10.0.0.0 8 greater-equal 16 less-equal 24\n</code></pre>"},{"location":"networking/bgp/filtering.html#as-path-filter","title":"AS-PATH filter","text":"<p>\u0424\u0438\u043b\u044c\u0442\u0440\u0430\u0446\u0438\u044f \u043f\u043e \u0441\u043e\u0434\u0435\u0440\u0436\u0438\u043c\u043e\u043c\u0443 AS_PATH (regexp).</p> Juniper Text Only<pre><code># \u041c\u0430\u0440\u0448\u0440\u0443\u0442\u044b \u043e\u0442 \u043f\u0440\u044f\u043c\u043e\u0433\u043e \u0441\u043e\u0441\u0435\u0434\u0430 (\u043e\u0434\u043d\u0430 AS \u0432 \u043f\u0443\u0442\u0438)\nset policy-options as-path DIRECT \"^[0-9]+$\"\n\n# \u041c\u0430\u0440\u0448\u0440\u0443\u0442\u044b \u0447\u0435\u0440\u0435\u0437 AS 65001\nset policy-options as-path VIA-65001 \".*65001.*\"\n\n# \u041c\u0430\u0440\u0448\u0440\u0443\u0442\u044b originated AS 65002\nset policy-options as-path FROM-65002 \"65002$\"\n\nset policy-options policy-statement AS-FILTER term 1 from as-path DIRECT\nset policy-options policy-statement AS-FILTER term 1 then accept\n</code></pre> Huawei Text Only<pre><code>ip as-path-filter DIRECT index 10 permit ^[0-9]+$\nip as-path-filter VIA-65001 index 10 permit _65001_\nip as-path-filter FROM-65002 index 10 permit _65002$\n#\nroute-policy AS-FILTER permit node 10\n  if-match as-path-filter DIRECT\n</code></pre> <p>Regex \u0448\u0430\u0431\u043b\u043e\u043d\u044b:</p> <ul> <li><code>^</code> - \u043d\u0430\u0447\u0430\u043b\u043e \u0441\u0442\u0440\u043e\u043a\u0438</li> <li><code>$</code> - \u043a\u043e\u043d\u0435\u0446 \u0441\u0442\u0440\u043e\u043a\u0438</li> <li><code>.</code> - \u043b\u044e\u0431\u043e\u0439 \u0441\u0438\u043c\u0432\u043e\u043b</li> <li><code>*</code> - 0 \u0438\u043b\u0438 \u0431\u043e\u043b\u0435\u0435 \u043f\u043e\u0432\u0442\u043e\u0440\u0435\u043d\u0438\u0439</li> <li><code>+</code> - 1 \u0438\u043b\u0438 \u0431\u043e\u043b\u0435\u0435 \u043f\u043e\u0432\u0442\u043e\u0440\u0435\u043d\u0438\u0439</li> <li><code>[0-9]</code> - \u0446\u0438\u0444\u0440\u0430</li> <li><code>_</code> (Huawei) - \u0440\u0430\u0437\u0434\u0435\u043b\u0438\u0442\u0435\u043b\u044c AS</li> </ul>"},{"location":"networking/bgp/filtering.html#_3","title":"\u041e\u0433\u0440\u0430\u043d\u0438\u0447\u0435\u043d\u0438\u0435 \u043a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u0430 \u043f\u0440\u0435\u0444\u0438\u043a\u0441\u043e\u0432","text":"<p>\u0417\u0430\u0449\u0438\u0442\u0430 \u043e\u0442 \u043f\u0435\u0440\u0435\u043f\u043e\u043b\u043d\u0435\u043d\u0438\u044f \u0442\u0430\u0431\u043b\u0438\u0446\u044b.</p> Juniper Text Only<pre><code>set protocols bgp group CUSTOMER prefix-limit maximum 1000\nset protocols bgp group CUSTOMER prefix-limit teardown 80\nset protocols bgp group CUSTOMER prefix-limit teardown idle-timeout 30\n</code></pre> Huawei Text Only<pre><code>bgp 65000\n  peer 10.0.0.1 route-limit 1000 80\n</code></pre> <p>\u041f\u0440\u0438 80% \u043b\u0438\u043c\u0438\u0442\u0430 - \u043f\u0440\u0435\u0434\u0443\u043f\u0440\u0435\u0436\u0434\u0435\u043d\u0438\u0435. \u041f\u0440\u0438 100% - \u0441\u0435\u0441\u0441\u0438\u044f \u0440\u0432\u0435\u0442\u0441\u044f.</p>"},{"location":"networking/bgp/filtering.html#as_path","title":"\u0424\u0438\u043b\u044c\u0442\u0440\u0430\u0446\u0438\u044f \u043f\u043e \u0434\u043b\u0438\u043d\u0435 AS_PATH","text":"<p>\u041e\u0442\u0431\u0440\u0430\u0441\u044b\u0432\u0430\u0442\u044c \u043c\u0430\u0440\u0448\u0440\u0443\u0442\u044b \u0441 \u0441\u043b\u0438\u0448\u043a\u043e\u043c \u0434\u043b\u0438\u043d\u043d\u044b\u043c \u043f\u0443\u0442\u0435\u043c.</p> Juniper Text Only<pre><code>set policy-options policy-statement LIMIT-ASPATH term 1 from as-path-length 10 orlonger\nset policy-options policy-statement LIMIT-ASPATH term 1 then reject\n</code></pre> Huawei Text Only<pre><code>route-policy LIMIT-ASPATH deny node 10\n  if-match as-path-length 10 or-greater\nroute-policy LIMIT-ASPATH permit node 100\n</code></pre>"},{"location":"networking/bgp/filtering.html#_4","title":"\u041d\u0430\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u0438\u044f \u0444\u0438\u043b\u044c\u0442\u0440\u0430\u0446\u0438\u0438","text":"<p>import (in) - \u0444\u0438\u043b\u044c\u0442\u0440\u0430\u0446\u0438\u044f \u0432\u0445\u043e\u0434\u044f\u0449\u0438\u0445 \u043c\u0430\u0440\u0448\u0440\u0443\u0442\u043e\u0432 \u043e\u0442 \u0441\u043e\u0441\u0435\u0434\u0430.</p> <p>export (out) - \u0444\u0438\u043b\u044c\u0442\u0440\u0430\u0446\u0438\u044f \u0438\u0441\u0445\u043e\u0434\u044f\u0449\u0438\u0445 \u043c\u0430\u0440\u0448\u0440\u0443\u0442\u043e\u0432 \u043a \u0441\u043e\u0441\u0435\u0434\u0443.</p> Juniper Text Only<pre><code>set protocols bgp group UPSTREAM import IMPORT-POLICY\nset protocols bgp group UPSTREAM export EXPORT-POLICY\n</code></pre> Huawei Text Only<pre><code>bgp 65000\n  peer 10.0.0.1 route-policy IMPORT-POLICY import\n  peer 10.0.0.1 route-policy EXPORT-POLICY export\n</code></pre>"},{"location":"networking/bgp/neighbors.html","title":"\u0421\u043e\u0441\u0435\u0434\u0441\u0442\u0432\u043e","text":""},{"location":"networking/bgp/neighbors.html#_1","title":"\u0421\u043e\u0441\u0435\u0434\u0441\u0442\u0432\u043e","text":""},{"location":"networking/bgp/neighbors.html#_2","title":"\u041a\u043e\u0440\u043e\u0442\u043a\u043e","text":"<p>BGP-\u0441\u0435\u0441\u0441\u0438\u044f \u0443\u0441\u0442\u0430\u043d\u0430\u0432\u043b\u0438\u0432\u0430\u0435\u0442\u0441\u044f \u043f\u043e\u0432\u0435\u0440\u0445 TCP:179. \u0421\u043e\u0441\u0435\u0434\u0438 \u043e\u0431\u043c\u0435\u043d\u0438\u0432\u0430\u044e\u0442\u0441\u044f OPEN, \u0441\u043e\u0433\u043b\u0430\u0441\u043e\u0432\u044b\u0432\u0430\u044e\u0442 \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u044b, \u0437\u0430\u0442\u0435\u043c UPDATE \u0441 \u043c\u0430\u0440\u0448\u0440\u0443\u0442\u0430\u043c\u0438.</p>"},{"location":"networking/bgp/neighbors.html#_3","title":"\u0422\u0438\u043f\u044b \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0439","text":"<p>OPEN - \u043f\u0435\u0440\u0432\u043e\u0435 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435 \u043f\u043e\u0441\u043b\u0435 TCP handshake:</p> <ul> <li>BGP version (4)</li> <li>Local AS number</li> <li>Hold Time (\u043f\u043e \u0443\u043c\u043e\u043b\u0447\u0430\u043d\u0438\u044e 180 \u0441\u0435\u043a)</li> <li>BGP Identifier (Router ID)</li> <li>Capabilities (MP-BGP, route refresh \u0438 \u0434\u0440.)</li> </ul> <p>UPDATE - \u043e\u0431\u043c\u0435\u043d \u043c\u0430\u0440\u0448\u0440\u0443\u0442\u043d\u043e\u0439 \u0438\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u0435\u0439:</p> <ul> <li>Withdrawn Routes - \u043e\u0442\u0437\u044b\u0432 \u043c\u0430\u0440\u0448\u0440\u0443\u0442\u043e\u0432</li> <li>Path Attributes - \u0430\u0442\u0440\u0438\u0431\u0443\u0442\u044b \u043f\u0443\u0442\u0438</li> <li>NLRI - \u0430\u043d\u043e\u043d\u0441\u0438\u0440\u0443\u0435\u043c\u044b\u0435 \u043f\u0440\u0435\u0444\u0438\u043a\u0441\u044b</li> </ul> <p>KEEPALIVE - \u043f\u043e\u0434\u0434\u0435\u0440\u0436\u0430\u043d\u0438\u0435 \u0441\u0435\u0441\u0441\u0438\u0438:</p> <ul> <li>\u041e\u0442\u043f\u0440\u0430\u0432\u043b\u044f\u0435\u0442\u0441\u044f \u043a\u0430\u0436\u0434\u044b\u0435 \u2153 \u043e\u0442 Hold Time (\u043f\u043e \u0443\u043c\u043e\u043b\u0447\u0430\u043d\u0438\u044e 60 \u0441\u0435\u043a)</li> <li>\u0415\u0441\u043b\u0438 3 KEEPALIVE \u043f\u0440\u043e\u043f\u0443\u0449\u0435\u043d\u044b - \u0441\u0435\u0441\u0441\u0438\u044f \u043f\u0430\u0434\u0430\u0435\u0442</li> </ul> <p>NOTIFICATION - \u043e\u0448\u0438\u0431\u043a\u0430, \u0441\u0435\u0441\u0441\u0438\u044f \u0437\u0430\u043a\u0440\u044b\u0432\u0430\u0435\u0442\u0441\u044f:</p> <ul> <li>Hold Timer Expired</li> <li>Cease (\u0430\u0434\u043c\u0438\u043d\u0438\u0441\u0442\u0440\u0430\u0442\u0438\u0432\u043d\u044b\u0439 \u0441\u0431\u0440\u043e\u0441)</li> <li>Bad AS, Bad Router ID \u0438 \u0434\u0440.</li> </ul>"},{"location":"networking/bgp/neighbors.html#fsm-finite-state-machine","title":"FSM (Finite State Machine)","text":"<ol> <li>Idle - \u043d\u0430\u0447\u0430\u043b\u044c\u043d\u043e\u0435 \u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u0435, \u043d\u0438\u0447\u0435\u0433\u043e \u043d\u0435 \u0434\u0435\u043b\u0430\u0435\u0442</li> <li>Connect - \u0436\u0434\u0435\u0442 TCP-\u0441\u043e\u0435\u0434\u0438\u043d\u0435\u043d\u0438\u0435</li> <li>Active - \u043f\u044b\u0442\u0430\u0435\u0442\u0441\u044f \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c TCP</li> <li>OpenSent - \u043e\u0442\u043f\u0440\u0430\u0432\u0438\u043b OPEN, \u0436\u0434\u0435\u0442 \u043e\u0442\u0432\u0435\u0442</li> <li>OpenConfirm - \u043f\u043e\u043b\u0443\u0447\u0438\u043b OPEN, \u0436\u0434\u0435\u0442 KEEPALIVE</li> <li>Established - \u0441\u0435\u0441\u0441\u0438\u044f \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d\u0430, \u043e\u0431\u043c\u0435\u043d \u043c\u0430\u0440\u0448\u0440\u0443\u0442\u0430\u043c\u0438</li> </ol> <p>\u041a\u043e\u043b\u043b\u0438\u0437\u0438\u044f: \u0435\u0441\u043b\u0438 \u043e\u0431\u0430 \u0438\u043d\u0438\u0446\u0438\u0438\u0440\u0443\u044e\u0442 TCP - \u043e\u0441\u0442\u0430\u0435\u0442\u0441\u044f \u0441\u043e\u0435\u0434\u0438\u043d\u0435\u043d\u0438\u0435 \u043e\u0442 \u0440\u043e\u0443\u0442\u0435\u0440\u0430 \u0441 \u0431\u043e\u043b\u044c\u0448\u0438\u043c Router ID.</p>"},{"location":"networking/bgp/neighbors.html#_4","title":"\u0410\u0443\u0442\u0435\u043d\u0442\u0438\u0444\u0438\u043a\u0430\u0446\u0438\u044f","text":"<p>MD5 - \u043f\u043e\u0434\u043f\u0438\u0441\u044c TCP-\u0441\u0435\u0433\u043c\u0435\u043d\u0442\u043e\u0432 \u043e\u0431\u0449\u0438\u043c \u043a\u043b\u044e\u0447\u043e\u043c. \u0417\u0430\u0449\u0438\u0442\u0430 \u043e\u0442 \u0441\u043f\u0443\u0444\u0438\u043d\u0433\u0430.</p> Juniper Text Only<pre><code>set protocols bgp group PEERS authentication-key \"secret123\"\n</code></pre> Huawei Text Only<pre><code>bgp 65000\n  peer 10.0.0.1 password cipher secret123\n</code></pre>"},{"location":"networking/bgp/neighbors.html#_5","title":"\u041f\u0440\u0438\u043c\u0435\u0440\u044b \u043a\u043e\u043d\u0444\u0438\u0433\u0443\u0440\u0430\u0446\u0438\u0438","text":""},{"location":"networking/bgp/neighbors.html#ebgp","title":"eBGP","text":"Juniper Text Only<pre><code>set protocols bgp group UPSTREAM type external\nset protocols bgp group UPSTREAM peer-as 65001\nset protocols bgp group UPSTREAM neighbor 192.168.1.1\n</code></pre> Huawei Text Only<pre><code>bgp 65000\n  peer 192.168.1.1 as-number 65001\n#\nipv4-family unicast\n  peer 192.168.1.1 enable\n</code></pre>"},{"location":"networking/bgp/neighbors.html#ibgp-loopback","title":"iBGP (\u0447\u0435\u0440\u0435\u0437 loopback)","text":"Juniper Text Only<pre><code>set protocols bgp group INTERNAL type internal\nset protocols bgp group INTERNAL local-address 10.255.0.1\nset protocols bgp group INTERNAL neighbor 10.255.0.2\n</code></pre> Huawei Text Only<pre><code>bgp 65000\n  peer 10.255.0.2 as-number 65000\n  peer 10.255.0.2 connect-interface LoopBack0\n#\nipv4-family unicast\n  peer 10.255.0.2 enable\n</code></pre>"},{"location":"networking/bgp/neighbors.html#ebgp-multihop","title":"eBGP multihop","text":"<p>\u0414\u043b\u044f \u0441\u043e\u0441\u0435\u0434\u0441\u0442\u0432\u0430 \u0447\u0435\u0440\u0435\u0437 loopback \u043c\u0435\u0436\u0434\u0443 AS (TTL &gt; 1).</p> Juniper Text Only<pre><code>set protocols bgp group EBGP-MULTIHOP multihop ttl 2\nset protocols bgp group EBGP-MULTIHOP local-address 10.255.0.1\n</code></pre> Huawei Text Only<pre><code>bgp 65000\n  peer 10.255.1.1 ebgp-max-hop 2\n  peer 10.255.1.1 connect-interface LoopBack0\n</code></pre>"},{"location":"networking/bgp/nlri.html","title":"\u0410\u043d\u043e\u043d\u0441\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435","text":""},{"location":"networking/bgp/nlri.html#_1","title":"\u0410\u043d\u043e\u043d\u0441\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435","text":""},{"location":"networking/bgp/nlri.html#_2","title":"\u041a\u043e\u0440\u043e\u0442\u043a\u043e","text":"<p>NLRI (Network Layer Reachability Information) - \u043f\u0440\u0435\u0444\u0438\u043a\u0441\u044b, \u043a\u043e\u0442\u043e\u0440\u044b\u0435 BGP \u0430\u043d\u043e\u043d\u0441\u0438\u0440\u0443\u0435\u0442 \u0441\u043e\u0441\u0435\u0434\u044f\u043c. \u0414\u0432\u0430 \u0441\u043f\u043e\u0441\u043e\u0431\u0430: \u044f\u0432\u043d\u043e\u0435 \u043e\u0431\u044a\u044f\u0432\u043b\u0435\u043d\u0438\u0435 (network) \u0438 \u0440\u0435\u0434\u0438\u0441\u0442\u0440\u0438\u0431\u0443\u0446\u0438\u044f \u0438\u0437 \u0434\u0440\u0443\u0433\u0438\u0445 \u043f\u0440\u043e\u0442\u043e\u043a\u043e\u043b\u043e\u0432.</p>"},{"location":"networking/bgp/nlri.html#network","title":"network","text":"<p>\u042f\u0432\u043d\u043e\u0435 \u0434\u043e\u0431\u0430\u0432\u043b\u0435\u043d\u0438\u0435 \u043f\u0440\u0435\u0444\u0438\u043a\u0441\u0430 \u0432 BGP. \u041f\u0440\u0435\u0444\u0438\u043a\u0441 \u0434\u043e\u043b\u0436\u0435\u043d \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u043e\u0432\u0430\u0442\u044c \u0432 RIB (\u0442\u0430\u0431\u043b\u0438\u0446\u0435 \u043c\u0430\u0440\u0448\u0440\u0443\u0442\u0438\u0437\u0430\u0446\u0438\u0438).</p> Juniper Text Only<pre><code>set policy-options policy-statement EXPORT-DIRECT term 1 from protocol direct\nset policy-options policy-statement EXPORT-DIRECT term 1 from route-filter 10.0.0.0/24 exact\nset policy-options policy-statement EXPORT-DIRECT term 1 then accept\n\nset protocols bgp group PEERS export EXPORT-DIRECT\n</code></pre> Huawei Text Only<pre><code>bgp 65000\n#\nipv4-family unicast\n  network 10.0.0.0 255.255.255.0\n</code></pre> <p>\u0412\u0430\u0436\u043d\u043e: \u0432 Juniper \u043d\u0435\u0442 \u043a\u043e\u043c\u0430\u043d\u0434\u044b network - \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442\u0441\u044f export policy.</p>"},{"location":"networking/bgp/nlri.html#redistribute-import-igp","title":"redistribute (import \u0438\u0437 IGP)","text":"<p>\u0418\u043c\u043f\u043e\u0440\u0442 \u043c\u0430\u0440\u0448\u0440\u0443\u0442\u043e\u0432 \u0438\u0437 \u0434\u0440\u0443\u0433\u0438\u0445 \u043f\u0440\u043e\u0442\u043e\u043a\u043e\u043b\u043e\u0432 (OSPF, IS-IS, static, connected).</p> Juniper Text Only<pre><code>set policy-options policy-statement REDIST-OSPF term 1 from protocol ospf\nset policy-options policy-statement REDIST-OSPF term 1 then accept\n\nset protocols bgp group PEERS export REDIST-OSPF\n</code></pre> Huawei Text Only<pre><code>bgp 65000\n#\nipv4-family unicast\n  import-route ospf 1\n  import-route direct\n  import-route static\n</code></pre>"},{"location":"networking/bgp/nlri.html#_3","title":"\u041c\u043e\u0434\u0438\u0444\u0438\u043a\u0430\u0446\u0438\u044f \u0430\u0442\u0440\u0438\u0431\u0443\u0442\u043e\u0432 \u043f\u0440\u0438 \u0430\u043d\u043e\u043d\u0441\u0435","text":"<p>\u041c\u043e\u0436\u043d\u043e \u043c\u0435\u043d\u044f\u0442\u044c \u0430\u0442\u0440\u0438\u0431\u0443\u0442\u044b (MED, community, as-path) \u043f\u0440\u0438 \u044d\u043a\u0441\u043f\u043e\u0440\u0442\u0435.</p> Juniper Text Only<pre><code>set policy-options policy-statement SET-MED term 1 from route-filter 10.0.0.0/24 exact\nset policy-options policy-statement SET-MED term 1 then metric 100\nset policy-options policy-statement SET-MED term 1 then accept\n</code></pre> Huawei Text Only<pre><code>route-policy SET-MED permit node 10\n  if-match ip-prefix MY-PREFIX\n  apply cost 100\n#\nbgp 65000\n  peer 10.0.0.1 route-policy SET-MED export\n</code></pre>"},{"location":"networking/bgp/nlri.html#default-originate","title":"default-originate","text":"<p>\u0410\u043d\u043e\u043d\u0441 default route (0.0.0.0/0) \u0441\u043e\u0441\u0435\u0434\u0443.</p> Juniper Text Only<pre><code>set policy-options policy-statement SEND-DEFAULT term 1 from route-filter 0.0.0.0/0 exact\nset policy-options policy-statement SEND-DEFAULT term 1 then accept\n\nset routing-options generate route 0.0.0.0/0 discard\nset protocols bgp group DOWNSTREAM export SEND-DEFAULT\n</code></pre> Huawei Text Only<pre><code>bgp 65000\n#\nipv4-family unicast\n  peer 10.0.0.1 default-route-advertise\n</code></pre>"},{"location":"networking/bgp/scaling.html","title":"\u041c\u0430\u0441\u0448\u0442\u0430\u0431\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435","text":""},{"location":"networking/bgp/scaling.html#_1","title":"\u041c\u0430\u0441\u0448\u0442\u0430\u0431\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435","text":""},{"location":"networking/bgp/scaling.html#_2","title":"\u041a\u043e\u0440\u043e\u0442\u043a\u043e","text":"<p>\u041f\u0440\u043e\u0431\u043b\u0435\u043c\u0430 iBGP: \u0442\u0440\u0435\u0431\u0443\u0435\u0442\u0441\u044f full-mesh (n*(n-1)/2 \u0441\u0435\u0441\u0441\u0438\u0439). \u0420\u0435\u0448\u0435\u043d\u0438\u044f: Route Reflector, Confederation, peer-group/templates.</p>"},{"location":"networking/bgp/scaling.html#route-reflector","title":"Route Reflector","text":"<p>RR \u043f\u043e\u043b\u0443\u0447\u0430\u0435\u0442 \u043c\u0430\u0440\u0448\u0440\u0443\u0442\u044b \u043e\u0442 \u043a\u043b\u0438\u0435\u043d\u0442\u043e\u0432 \u0438 \u043e\u0442\u0440\u0430\u0436\u0430\u0435\u0442 \u0438\u0445 \u0434\u0440\u0443\u0433\u0438\u043c \u043a\u043b\u0438\u0435\u043d\u0442\u0430\u043c. \u041a\u043b\u0438\u0435\u043d\u0442\u044b \u043d\u0435 \u043d\u0443\u0436\u043d\u044b full-mesh \u043c\u0435\u0436\u0434\u0443 \u0441\u043e\u0431\u043e\u0439 - \u0442\u043e\u043b\u044c\u043a\u043e \u0441\u0435\u0441\u0441\u0438\u044f \u0441 RR.</p> <p>\u0420\u043e\u043b\u0438:</p> <ul> <li>RR (Route Reflector) - \u043e\u0442\u0440\u0430\u0436\u0430\u0435\u0442 \u043c\u0430\u0440\u0448\u0440\u0443\u0442\u044b</li> <li>RR Client - \u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0435\u043d \u043a RR</li> <li>Non-client - \u043e\u0431\u044b\u0447\u043d\u044b\u0439 iBGP-\u0441\u043e\u0441\u0435\u0434</li> </ul> <p>\u0410\u0442\u0440\u0438\u0431\u0443\u0442\u044b:</p> <ul> <li>ORIGINATOR_ID - router-id \u0438\u0441\u0442\u043e\u0447\u043d\u0438\u043a\u0430 \u043c\u0430\u0440\u0448\u0440\u0443\u0442\u0430</li> <li>CLUSTER_LIST - \u0441\u043f\u0438\u0441\u043e\u043a cluster-id \u043f\u0440\u043e\u0439\u0434\u0435\u043d\u043d\u044b\u0445 RR</li> </ul> <p>\u0417\u0430\u0449\u0438\u0442\u0430 \u043e\u0442 \u043f\u0435\u0442\u0435\u043b\u044c: \u0435\u0441\u043b\u0438 \u0441\u0432\u043e\u0439 router-id \u0432 ORIGINATOR_ID \u0438\u043b\u0438 cluster-id \u0432 CLUSTER_LIST - \u043c\u0430\u0440\u0448\u0440\u0443\u0442 \u043e\u0442\u0431\u0440\u0430\u0441\u044b\u0432\u0430\u0435\u0442\u0441\u044f.</p> Juniper Text Only<pre><code># \u041d\u0430 RR\nset protocols bgp group RR-CLIENTS type internal\nset protocols bgp group RR-CLIENTS cluster 1.1.1.1\nset protocols bgp group RR-CLIENTS neighbor 10.0.0.2\nset protocols bgp group RR-CLIENTS neighbor 10.0.0.3\n</code></pre> Huawei Text Only<pre><code># \u041d\u0430 RR\nbgp 65000\n  reflector cluster-id 1.1.1.1\n  peer 10.0.0.2 as-number 65000\n  peer 10.0.0.3 as-number 65000\n#\nipv4-family unicast\n  peer 10.0.0.2 reflect-client\n  peer 10.0.0.3 reflect-client\n</code></pre> <p>\u0418\u0435\u0440\u0430\u0440\u0445\u0438\u044f RR:</p> <p>\u041c\u043e\u0436\u043d\u043e \u0441\u0442\u0440\u043e\u0438\u0442\u044c \u043d\u0435\u0441\u043a\u043e\u043b\u044c\u043a\u043e \u0443\u0440\u043e\u0432\u043d\u0435\u0439 RR \u0434\u043b\u044f \u0431\u043e\u043b\u044c\u0448\u0438\u0445 \u0441\u0435\u0442\u0435\u0439. RR \u0432\u0435\u0440\u0445\u043d\u0435\u0433\u043e \u0443\u0440\u043e\u0432\u043d\u044f \u044f\u0432\u043b\u044f\u044e\u0442\u0441\u044f non-client \u0434\u0440\u0443\u0433 \u0434\u043b\u044f \u0434\u0440\u0443\u0433\u0430.</p>"},{"location":"networking/bgp/scaling.html#confederation","title":"Confederation","text":"<p>AS \u0440\u0430\u0437\u0431\u0438\u0432\u0430\u0435\u0442\u0441\u044f \u043d\u0430 sub-AS. \u041c\u0435\u0436\u0434\u0443 sub-AS - eBGP-\u043f\u043e\u0434\u043e\u0431\u043d\u043e\u0435 \u043f\u043e\u0432\u0435\u0434\u0435\u043d\u0438\u0435, \u043d\u043e AS_PATH \u043d\u0435 \u0443\u0434\u043b\u0438\u043d\u044f\u0435\u0442\u0441\u044f \u0441\u043d\u0430\u0440\u0443\u0436\u0438.</p> Juniper Text Only<pre><code>set routing-options autonomous-system 65000\nset routing-options confederation 65000 members 65001\nset routing-options confederation 65000 members 65002\n\nset protocols bgp group CONFED type external\nset protocols bgp group CONFED peer-as 65002\nset protocols bgp group CONFED neighbor 10.0.0.2\n</code></pre> Huawei Text Only<pre><code>bgp 65001\n  confederation id 65000\n  confederation peer-as 65002\n  peer 10.0.0.2 as-number 65002\n</code></pre> <p>\u041a\u043e\u0433\u0434\u0430 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c:</p> <ul> <li>RR \u043f\u0440\u043e\u0449\u0435, \u043f\u043e\u0434\u0445\u043e\u0434\u0438\u0442 \u0434\u043b\u044f \u0431\u043e\u043b\u044c\u0448\u0438\u043d\u0441\u0442\u0432\u0430 \u0441\u043b\u0443\u0447\u0430\u0435\u0432</li> <li>Confederation \u043b\u0443\u0447\u0448\u0435 \u0434\u043b\u044f \u043e\u0447\u0435\u043d\u044c \u0431\u043e\u043b\u044c\u0448\u0438\u0445 AS \u0441 \u043d\u0435\u0437\u0430\u0432\u0438\u0441\u0438\u043c\u044b\u043c\u0438 \u0440\u0435\u0433\u0438\u043e\u043d\u0430\u043c\u0438</li> </ul>"},{"location":"networking/bgp/scaling.html#peer-group","title":"Peer-group","text":"<p>\u0413\u0440\u0443\u043f\u043f\u0438\u0440\u043e\u0432\u043a\u0430 \u0441\u043e\u0441\u0435\u0434\u0435\u0439 \u0441 \u043e\u0434\u0438\u043d\u0430\u043a\u043e\u0432\u044b\u043c\u0438 \u043f\u043e\u043b\u0438\u0442\u0438\u043a\u0430\u043c\u0438. \u0423\u043f\u0440\u043e\u0449\u0430\u0435\u0442 \u043a\u043e\u043d\u0444\u0438\u0433 \u0438 \u0441\u043d\u0438\u0436\u0430\u0435\u0442 \u043d\u0430\u0433\u0440\u0443\u0437\u043a\u0443 \u043d\u0430 CPU.</p> Juniper Text Only<pre><code>set protocols bgp group UPSTREAM type external\nset protocols bgp group UPSTREAM import IMPORT-POLICY\nset protocols bgp group UPSTREAM export EXPORT-POLICY\nset protocols bgp group UPSTREAM neighbor 10.0.0.1 peer-as 65001\nset protocols bgp group UPSTREAM neighbor 10.0.0.2 peer-as 65002\n</code></pre> Huawei Text Only<pre><code>bgp 65000\n  group UPSTREAM external\n  peer UPSTREAM as-number 65001\n  peer 10.0.0.1 group UPSTREAM\n  peer 10.0.0.2 group UPSTREAM\n#\nipv4-family unicast\n  peer UPSTREAM enable\n  peer UPSTREAM route-policy IMPORT-POLICY import\n</code></pre>"},{"location":"networking/bgp/scaling.html#dynamic-neighbors","title":"Dynamic neighbors","text":"<p>\u0410\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u043e\u0435 \u043f\u0440\u0438\u043d\u044f\u0442\u0438\u0435 BGP-\u0441\u0435\u0441\u0441\u0438\u0439 \u0438\u0437 \u0434\u0438\u0430\u043f\u0430\u0437\u043e\u043d\u0430 IP.</p> Juniper Text Only<pre><code>set protocols bgp group DYNAMIC-PEERS type external\nset protocols bgp group DYNAMIC-PEERS peer-as 65001\nset protocols bgp group DYNAMIC-PEERS allow 10.0.0.0/24\n</code></pre> Huawei Text Only<pre><code>bgp 65000\n  peer 10.0.0.0 255.255.255.0 as-number 65001\n</code></pre>"},{"location":"networking/bgp/scaling.html#peer-templates-huawei","title":"Peer templates (Huawei)","text":"<p>\u0428\u0430\u0431\u043b\u043e\u043d\u044b \u0434\u043b\u044f \u043f\u0435\u0440\u0435\u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u043d\u0438\u044f \u043a\u043e\u043d\u0444\u0438\u0433\u0443\u0440\u0430\u0446\u0438\u0438.</p> Huawei Text Only<pre><code>bgp 65000\n  peer UPSTREAM-TEMPLATE as-number 65001\n  peer UPSTREAM-TEMPLATE ebgp-max-hop 2\n  peer UPSTREAM-TEMPLATE route-policy IMPORT import\n\n  peer 10.0.0.1 inherit peer UPSTREAM-TEMPLATE\n  peer 10.0.0.2 inherit peer UPSTREAM-TEMPLATE\n</code></pre>"},{"location":"networking/ipv6/index.html","title":"IPv6","text":""},{"location":"networking/ipv6/index.html#ipv6","title":"IPv6","text":""},{"location":"networking/ipv6/index.html#_1","title":"\u041a\u043e\u0440\u043e\u0442\u043a\u043e","text":"<p>128-\u0431\u0438\u0442\u043d\u044b\u0435 \u0430\u0434\u0440\u0435\u0441\u0430 (2^128). \u0417\u0430\u0433\u043e\u043b\u043e\u0432\u043e\u043a \u0443\u043f\u0440\u043e\u0449\u0435\u043d: 8 \u043f\u043e\u043b\u0435\u0439 \u0432\u043c\u0435\u0441\u0442\u043e 13 \u0432 IPv4, \u0444\u0438\u043a\u0441\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u044b\u0439 \u0440\u0430\u0437\u043c\u0435\u0440 40 \u0431\u0430\u0439\u0442. \u041d\u0435\u0442 broadcast - \u0432\u043c\u0435\u0441\u0442\u043e \u043d\u0435\u0433\u043e multicast. \u041d\u0435\u0442 ARP - \u0432\u043c\u0435\u0441\u0442\u043e \u043d\u0435\u0433\u043e NDP (Neighbor Discovery Protocol) \u043d\u0430 \u0431\u0430\u0437\u0435 ICMPv6.</p>"},{"location":"networking/ipv6/index.html#_2","title":"\u0424\u043e\u0440\u043c\u0430\u0442 \u0430\u0434\u0440\u0435\u0441\u0430","text":"<p>8 \u0433\u0440\u0443\u043f\u043f \u043f\u043e 4 hex-\u0441\u0438\u043c\u0432\u043e\u043b\u0430, \u0440\u0430\u0437\u0434\u0435\u043b\u0435\u043d\u043d\u044b\u0445 \u0434\u0432\u043e\u0435\u0442\u043e\u0447\u0438\u0435\u043c:</p> Text Only<pre><code>2001:0db8:0000:0000:0000:ff00:0042:8329\n</code></pre> <p>\u041f\u0440\u0430\u0432\u0438\u043b\u0430 \u0441\u043e\u043a\u0440\u0430\u0449\u0435\u043d\u0438\u044f:</p> <ul> <li>\u0412\u0435\u0434\u0443\u0449\u0438\u0435 \u043d\u0443\u043b\u0438 \u0432 \u0433\u0440\u0443\u043f\u043f\u0435 \u043c\u043e\u0436\u043d\u043e \u0443\u0431\u0438\u0440\u0430\u0442\u044c: <code>0db8</code> -&gt; <code>db8</code></li> <li>\u041f\u043e\u0441\u043b\u0435\u0434\u043e\u0432\u0430\u0442\u0435\u043b\u044c\u043d\u044b\u0435 \u0433\u0440\u0443\u043f\u043f\u044b \u043d\u0443\u043b\u0435\u0439 \u0437\u0430\u043c\u0435\u043d\u044f\u044e\u0442\u0441\u044f \u043d\u0430 <code>::</code> (\u043e\u0434\u0438\u043d \u0440\u0430\u0437): <code>0000:0000:0000</code> -&gt; <code>::</code></li> </ul> <p>\u0420\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442: <code>2001:db8::ff00:42:8329</code></p>"},{"location":"networking/ipv6/index.html#_3","title":"\u0422\u0438\u043f\u044b \u0430\u0434\u0440\u0435\u0441\u043e\u0432","text":"<p>Unicast - \u043e\u0434\u0438\u043d-\u043a-\u043e\u0434\u043d\u043e\u043c\u0443:</p> <ul> <li>Global Unicast (2000::/3) - \u043f\u0443\u0431\u043b\u0438\u0447\u043d\u044b\u0435 \u0430\u0434\u0440\u0435\u0441\u0430</li> <li>Link-Local (FE80::/10) - \u0442\u043e\u043b\u044c\u043a\u043e \u0432 \u043f\u0440\u0435\u0434\u0435\u043b\u0430\u0445 \u0441\u0435\u0433\u043c\u0435\u043d\u0442\u0430, \u043d\u0435 \u043c\u0430\u0440\u0448\u0440\u0443\u0442\u0438\u0437\u0438\u0440\u0443\u044e\u0442\u0441\u044f</li> <li>Unique Local (FD00::/8) - \u0430\u043d\u0430\u043b\u043e\u0433 RFC1918 (10.x, 172.16.x, 192.168.x)</li> </ul> <p>Multicast (FF00::/8) - \u043e\u0434\u0438\u043d-\u043a\u043e-\u043c\u043d\u043e\u0433\u0438\u043c. Scope \u0437\u0430\u0434\u0430\u0435\u0442\u0441\u044f 4-\u043c \u043e\u043a\u0442\u0435\u0442\u043e\u043c:</p> <ul> <li>FF02::1 - \u0432\u0441\u0435 \u0443\u0437\u043b\u044b \u0432 \u0441\u0435\u0433\u043c\u0435\u043d\u0442\u0435</li> <li>FF02::2 - \u0432\u0441\u0435 \u0440\u043e\u0443\u0442\u0435\u0440\u044b \u0432 \u0441\u0435\u0433\u043c\u0435\u043d\u0442\u0435</li> </ul> <p>Anycast - \u043e\u0434\u0438\u043d-\u043a-\u0431\u043b\u0438\u0436\u0430\u0439\u0448\u0435\u043c\u0443. \u0412\u044b\u0434\u0435\u043b\u044f\u044e\u0442\u0441\u044f \u0438\u0437 unicast-\u043f\u0440\u043e\u0441\u0442\u0440\u0430\u043d\u0441\u0442\u0432\u0430. \u041f\u0430\u043a\u0435\u0442 \u0434\u043e\u0441\u0442\u0430\u0432\u043b\u044f\u0435\u0442\u0441\u044f \u0431\u043b\u0438\u0436\u0430\u0439\u0448\u0435\u043c\u0443 \u0443\u0437\u043b\u0443 \u0441 \u0442\u0430\u043a\u0438\u043c \u0430\u0434\u0440\u0435\u0441\u043e\u043c.</p> <p>\u0421\u043f\u0435\u0446\u0438\u0430\u043b\u044c\u043d\u044b\u0435:</p> <ul> <li><code>::1</code> - loopback</li> <li><code>::</code> - unspecified (0.0.0.0 \u0432 IPv4)</li> </ul>"},{"location":"networking/ipv6/index.html#_4","title":"\u0417\u0430\u0433\u043e\u043b\u043e\u0432\u043e\u043a","text":"\u041f\u043e\u043b\u0435 \u0411\u0438\u0442 \u041e\u043f\u0438\u0441\u0430\u043d\u0438\u0435 Version 4 \u0412\u0441\u0435\u0433\u0434\u0430 6 Traffic Class 8 \u0410\u043d\u0430\u043b\u043e\u0433 ToS/DSCP Flow Label 20 \u0418\u0434\u0435\u043d\u0442\u0438\u0444\u0438\u043a\u0430\u0442\u043e\u0440 \u043f\u043e\u0442\u043e\u043a\u0430 \u0434\u043b\u044f QoS Payload Length 16 \u0414\u043b\u0438\u043d\u0430 \u0434\u0430\u043d\u043d\u044b\u0445 \u0431\u0435\u0437 \u0437\u0430\u0433\u043e\u043b\u043e\u0432\u043a\u0430 Next Header 8 \u0422\u0438\u043f \u0441\u043b\u0435\u0434\u0443\u044e\u0449\u0435\u0433\u043e \u0437\u0430\u0433\u043e\u043b\u043e\u0432\u043a\u0430 (TCP=6, UDP=17, ICMPv6=58) Hop Limit 8 \u0410\u043d\u0430\u043b\u043e\u0433 TTL Source 128 \u0410\u0434\u0440\u0435\u0441 \u0438\u0441\u0442\u043e\u0447\u043d\u0438\u043a\u0430 Destination 128 \u0410\u0434\u0440\u0435\u0441 \u043d\u0430\u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044f <p>\u0423\u0431\u0440\u0430\u043d\u043e \u043f\u043e \u0441\u0440\u0430\u0432\u043d\u0435\u043d\u0438\u044e \u0441 IPv4: Header Checksum, Fragmentation fields, Options. \u0424\u0440\u0430\u0433\u043c\u0435\u043d\u0442\u0430\u0446\u0438\u044f \u0432\u044b\u043d\u0435\u0441\u0435\u043d\u0430 \u0432 Extension Header - \u0440\u043e\u0443\u0442\u0435\u0440\u044b \u043d\u0435 \u0444\u0440\u0430\u0433\u043c\u0435\u043d\u0442\u0438\u0440\u0443\u044e\u0442.</p>"},{"location":"networking/ipv6/index.html#ndp-neighbor-discovery-protocol","title":"NDP (Neighbor Discovery Protocol)","text":"<p>\u0420\u0430\u0431\u043e\u0442\u0430\u0435\u0442 \u043f\u043e\u0432\u0435\u0440\u0445 ICMPv6. \u0417\u0430\u043c\u0435\u043d\u044f\u0435\u0442 ARP, ICMP Router Discovery, ICMP Redirect.</p> <p>5 \u0442\u0438\u043f\u043e\u0432 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0439:</p> \u0422\u0438\u043f ICMPv6 \u041d\u0430\u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 Router Solicitation (RS) 133 \u0425\u043e\u0441\u0442 \u0438\u0449\u0435\u0442 \u0440\u043e\u0443\u0442\u0435\u0440\u044b (dst: FF02::2) Router Advertisement (RA) 134 \u0420\u043e\u0443\u0442\u0435\u0440 \u043e\u0431\u044a\u044f\u0432\u043b\u044f\u0435\u0442 \u0441\u0435\u0431\u044f (dst: FF02::1) Neighbor Solicitation (NS) 135 \u0420\u0430\u0437\u0440\u0435\u0448\u0435\u043d\u0438\u0435 \u0430\u0434\u0440\u0435\u0441\u0430 (\u0430\u043d\u0430\u043b\u043e\u0433 ARP request) Neighbor Advertisement (NA) 136 \u041e\u0442\u0432\u0435\u0442 \u0441 MAC-\u0430\u0434\u0440\u0435\u0441\u043e\u043c (\u0430\u043d\u0430\u043b\u043e\u0433 ARP reply) Redirect 137 \u0423\u043a\u0430\u0437\u0430\u043d\u0438\u0435 \u043b\u0443\u0447\u0448\u0435\u0433\u043e next-hop <p>\u0424\u0443\u043d\u043a\u0446\u0438\u0438 NDP:</p> <ul> <li>Address resolution (\u0437\u0430\u043c\u0435\u043d\u0430 ARP)</li> <li>Router discovery</li> <li>Duplicate Address Detection (DAD)</li> <li>Neighbor Unreachability Detection (NUD)</li> </ul>"},{"location":"networking/ipv6/index.html#slaac","title":"SLAAC","text":"<p>Stateless Address Autoconfiguration (RFC 4862). \u0425\u043e\u0441\u0442 \u0441\u0430\u043c \u0433\u0435\u043d\u0435\u0440\u0438\u0440\u0443\u0435\u0442 \u0430\u0434\u0440\u0435\u0441 \u0431\u0435\u0437 DHCP.</p> <p>\u041f\u0440\u043e\u0446\u0435\u0441\u0441:</p> <ol> <li>\u0425\u043e\u0441\u0442 \u0441\u043e\u0437\u0434\u0430\u0435\u0442 link-local \u0430\u0434\u0440\u0435\u0441 (FE80:: + Interface ID)</li> <li>\u0412\u044b\u043f\u043e\u043b\u043d\u044f\u0435\u0442 DAD - \u043f\u0440\u043e\u0432\u0435\u0440\u044f\u0435\u0442 \u0443\u043d\u0438\u043a\u0430\u043b\u044c\u043d\u043e\u0441\u0442\u044c \u0447\u0435\u0440\u0435\u0437 NS</li> <li>\u041e\u0442\u043f\u0440\u0430\u0432\u043b\u044f\u0435\u0442 RS \u043d\u0430 FF02::2</li> <li>\u041f\u043e\u043b\u0443\u0447\u0430\u0435\u0442 RA \u0441 \u043f\u0440\u0435\u0444\u0438\u043a\u0441\u043e\u043c \u0441\u0435\u0442\u0438</li> <li>\u0424\u043e\u0440\u043c\u0438\u0440\u0443\u0435\u0442 global unicast: \u043f\u0440\u0435\u0444\u0438\u043a\u0441 \u0438\u0437 RA + Interface ID</li> </ol> <p>EUI-64 - \u043c\u0435\u0442\u043e\u0434 \u0433\u0435\u043d\u0435\u0440\u0430\u0446\u0438\u0438 Interface ID \u0438\u0437 MAC:</p> <ol> <li>MAC \u0440\u0430\u0437\u0431\u0438\u0432\u0430\u0435\u0442\u0441\u044f \u043f\u043e\u043f\u043e\u043b\u0430\u043c: <code>00:1A:2B</code> \u0438 <code>3C:4D:5E</code></li> <li>\u0412\u0441\u0442\u0430\u0432\u043b\u044f\u0435\u0442\u0441\u044f <code>FF:FE</code>: <code>00:1A:2B:FF:FE:3C:4D:5E</code></li> <li>\u0418\u043d\u0432\u0435\u0440\u0442\u0438\u0440\u0443\u0435\u0442\u0441\u044f 7-\u0439 \u0431\u0438\u0442: <code>02:1A:2B:FF:FE:3C:4D:5E</code></li> </ol> <p>Privacy Extensions (RFC 4941) - \u0441\u043b\u0443\u0447\u0430\u0439\u043d\u044b\u0439 Interface ID \u0432\u043c\u0435\u0441\u0442\u043e EUI-64 \u0434\u043b\u044f \u043f\u0440\u0438\u0432\u0430\u0442\u043d\u043e\u0441\u0442\u0438. \u0412\u043a\u043b\u044e\u0447\u0435\u043d \u043f\u043e \u0443\u043c\u043e\u043b\u0447\u0430\u043d\u0438\u044e \u0432 Windows, macOS, \u0441\u043e\u0432\u0440\u0435\u043c\u0435\u043d\u043d\u044b\u0445 Linux.</p>"},{"location":"networking/ipv6/index.html#_5","title":"\u041f\u043e\u0434\u0441\u0435\u0442\u0438","text":"<p>\u0421\u0442\u0430\u043d\u0434\u0430\u0440\u0442\u043d\u0430\u044f \u0434\u043b\u0438\u043d\u0430 \u043f\u0440\u0435\u0444\u0438\u043a\u0441\u0430 \u0434\u043b\u044f LAN - /64 (\u0442\u0440\u0435\u0431\u043e\u0432\u0430\u043d\u0438\u0435 SLAAC \u0438 NDP).</p> <p>Nibble boundary - \u0434\u0435\u043b\u0435\u043d\u0438\u0435 \u043f\u043e 4-\u0431\u0438\u0442\u043d\u044b\u043c \u0433\u0440\u0430\u043d\u0438\u0446\u0430\u043c \u0434\u043b\u044f \u0447\u0438\u0442\u0430\u0435\u043c\u043e\u0441\u0442\u0438:</p> <ul> <li>/48 - \u0442\u0438\u043f\u0438\u0447\u043d\u044b\u0439 \u0431\u043b\u043e\u043a \u0434\u043b\u044f \u043e\u0440\u0433\u0430\u043d\u0438\u0437\u0430\u0446\u0438\u0438</li> <li>/56 - \u0431\u043b\u043e\u043a \u0434\u043b\u044f \u0441\u0430\u0439\u0442\u0430/\u043e\u0444\u0438\u0441\u0430</li> <li>/64 - \u043e\u0434\u043d\u0430 \u043f\u043e\u0434\u0441\u0435\u0442\u044c</li> </ul> <p>\u041f\u0440\u0438\u043c\u0435\u0440: \u0438\u0437 /48 \u043c\u043e\u0436\u043d\u043e \u0441\u0434\u0435\u043b\u0430\u0442\u044c 65536 \u043f\u043e\u0434\u0441\u0435\u0442\u0435\u0439 /64.</p>"},{"location":"networking/ipv6/index.html#dhcpv6","title":"DHCPv6","text":"<p>\u0414\u0432\u0430 \u0440\u0435\u0436\u0438\u043c\u0430:</p> <p>Stateful - \u0441\u0435\u0440\u0432\u0435\u0440 \u0432\u044b\u0434\u0430\u0435\u0442 \u0430\u0434\u0440\u0435\u0441\u0430 \u0438 \u0445\u0440\u0430\u043d\u0438\u0442 lease (\u043a\u0430\u043a DHCPv4).</p> <p>Stateless - \u0430\u0434\u0440\u0435\u0441 \u0447\u0435\u0440\u0435\u0437 SLAAC, DHCPv6 \u0442\u043e\u043b\u044c\u043a\u043e \u0434\u043b\u044f \u043e\u043f\u0446\u0438\u0439 (DNS, NTP \u0438 \u0434\u0440.). RA \u0441\u043e\u0434\u0435\u0440\u0436\u0438\u0442 \u0444\u043b\u0430\u0433 O (Other config).</p> <p>\u0424\u043b\u0430\u0433\u0438 \u0432 RA:</p> <ul> <li>M (Managed) = 1 - \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0439 DHCPv6 \u0434\u043b\u044f \u0430\u0434\u0440\u0435\u0441\u0430</li> <li>O (Other) = 1 - \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0439 DHCPv6 \u0434\u043b\u044f \u043e\u043f\u0446\u0438\u0439</li> </ul>"},{"location":"networking/ipv6/index.html#_6","title":"\u041f\u0440\u0438\u043c\u0435\u0440\u044b","text":"<p>\u041f\u0440\u043e\u0441\u043c\u043e\u0442\u0440 IPv6 \u0430\u0434\u0440\u0435\u0441\u043e\u0432:</p> Bash<pre><code>ip -6 addr show\n</code></pre> <p>\u0422\u0430\u0431\u043b\u0438\u0446\u0430 \u0441\u043e\u0441\u0435\u0434\u0435\u0439 (\u0430\u043d\u0430\u043b\u043e\u0433 arp -a):</p> Bash<pre><code>ip -6 neigh show\n</code></pre> <p>Ping:</p> Bash<pre><code>ping6 2001:db8::1\nping6 fe80::1%eth0  # link-local \u0442\u0440\u0435\u0431\u0443\u0435\u0442 \u0443\u043a\u0430\u0437\u0430\u043d\u0438\u044f \u0438\u043d\u0442\u0435\u0440\u0444\u0435\u0439\u0441\u0430\n</code></pre> <p>Traceroute:</p> Bash<pre><code>traceroute6 2001:db8::1\n</code></pre>"},{"location":"networking/ipv6/transition.html","title":"Transition","text":""},{"location":"networking/ipv6/transition.html#transition","title":"Transition","text":""},{"location":"networking/ipv6/transition.html#_1","title":"\u041a\u043e\u0440\u043e\u0442\u043a\u043e","text":"<p>IPv6 \u0438 IPv4 \u043d\u0435\u0441\u043e\u0432\u043c\u0435\u0441\u0442\u0438\u043c\u044b \u043d\u0430\u043f\u0440\u044f\u043c\u0443\u044e - \u043d\u0443\u0436\u043d\u044b \u043c\u0435\u0445\u0430\u043d\u0438\u0437\u043c\u044b \u043f\u0435\u0440\u0435\u0445\u043e\u0434\u0430. \u0414\u0432\u0430 \u043f\u043e\u0434\u0445\u043e\u0434\u0430:</p> <ul> <li>CGN-based - NAT \u0446\u0435\u043d\u0442\u0440\u0430\u043b\u0438\u0437\u043e\u0432\u0430\u043d\u043d\u043e (DS-Lite, NAT64). \u0426\u0435\u043d\u0442\u0440\u0430\u043b\u044c\u043d\u044b\u0439 \u0443\u0437\u0435\u043b \u0445\u0440\u0430\u043d\u0438\u0442 \u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u0435 \u0441\u0435\u0441\u0441\u0438\u0439.</li> <li>A+P-based - NAT \u043d\u0430 CPE (MAP-E, MAP-T). \u0426\u0435\u043d\u0442\u0440\u0430\u043b\u044c\u043d\u044b\u0439 \u0443\u0437\u0435\u043b stateless, \u043b\u0443\u0447\u0448\u0435 \u043c\u0430\u0441\u0448\u0442\u0430\u0431\u0438\u0440\u0443\u0435\u0442\u0441\u044f.</li> </ul> <p>\u041b\u044e\u0431\u043e\u0439 \u043c\u0435\u0445\u0430\u043d\u0438\u0437\u043c \u0434\u043e\u0431\u0430\u0432\u043b\u044f\u0435\u0442 \u0441\u043b\u043e\u0436\u043d\u043e\u0441\u0442\u044c. \u041f\u0440\u0435\u0434\u043f\u043e\u0447\u0442\u0438\u0442\u0435\u043b\u0435\u043d native dual-stack \u0438\u043b\u0438 native IPv6.</p>"},{"location":"networking/ipv6/transition.html#nat64-dns64","title":"NAT64 / DNS64","text":"<p>\u041f\u043e\u0437\u0432\u043e\u043b\u044f\u0435\u0442 IPv6-only \u043a\u043b\u0438\u0435\u043d\u0442\u0430\u043c \u043e\u0431\u0440\u0430\u0449\u0430\u0442\u044c\u0441\u044f \u043a IPv4 \u0441\u0435\u0440\u0432\u0435\u0440\u0430\u043c. RFC 6146 (NAT64), RFC 6147 (DNS64).</p> <p>\u041a\u043e\u043c\u043f\u043e\u043d\u0435\u043d\u0442\u044b:</p> <ul> <li>DNS64 - \u0441\u0438\u043d\u0442\u0435\u0437\u0438\u0440\u0443\u0435\u0442 AAAA-\u0437\u0430\u043f\u0438\u0441\u0438 \u0438\u0437 A-\u0437\u0430\u043f\u0438\u0441\u0435\u0439, \u0434\u043e\u0431\u0430\u0432\u043b\u044f\u044f NAT64-\u043f\u0440\u0435\u0444\u0438\u043a\u0441</li> <li>NAT64 - \u0442\u0440\u0430\u043d\u0441\u043b\u0438\u0440\u0443\u0435\u0442 IPv6 &lt;-&gt; IPv4, \u0445\u0440\u0430\u043d\u0438\u0442 state</li> </ul> <p>\u041f\u0440\u0435\u0444\u0438\u043a\u0441 NAT64:</p> <ul> <li>Well-Known: <code>64:ff9b::/96</code></li> <li>Network-Specific: \u043b\u044e\u0431\u043e\u0439 /32, /40, /48, /56, /64, /96 \u043f\u0440\u043e\u0432\u0430\u0439\u0434\u0435\u0440\u0430</li> </ul> <p>\u041f\u0440\u043e\u0446\u0435\u0441\u0441:</p> <ol> <li>\u041a\u043b\u0438\u0435\u043d\u0442 \u0437\u0430\u043f\u0440\u0430\u0448\u0438\u0432\u0430\u0435\u0442 AAAA \u0434\u043b\u044f example.com</li> <li>DNS64 \u043d\u0435 \u043d\u0430\u0445\u043e\u0434\u0438\u0442 AAAA, \u043f\u043e\u043b\u0443\u0447\u0430\u0435\u0442 A: 93.184.216.34</li> <li>DNS64 \u0441\u0438\u043d\u0442\u0435\u0437\u0438\u0440\u0443\u0435\u0442: <code>64:ff9b::5db8:d822</code> (5db8:d822 = 93.184.216.34 \u0432 hex)</li> <li>\u041a\u043b\u0438\u0435\u043d\u0442 \u0448\u043b\u0435\u0442 \u043f\u0430\u043a\u0435\u0442 \u043d\u0430 64:ff9b::5db8:d822</li> <li>NAT64 \u0442\u0440\u0430\u043d\u0441\u043b\u0438\u0440\u0443\u0435\u0442 \u0438 \u0444\u043e\u0440\u0432\u0430\u0440\u0434\u0438\u0442 \u043d\u0430 93.184.216.34</li> </ol> <p>\u041e\u0433\u0440\u0430\u043d\u0438\u0447\u0435\u043d\u0438\u044f:</p> <ul> <li>\u041d\u0435 \u0440\u0430\u0431\u043e\u0442\u0430\u0435\u0442 \u0441 IPv4-\u043b\u0438\u0442\u0435\u0440\u0430\u043b\u0430\u043c\u0438 \u0432 \u043f\u0440\u0438\u043b\u043e\u0436\u0435\u043d\u0438\u044f\u0445 (http://192.0.2.1)</li> <li>\u0422\u043e\u043b\u044c\u043a\u043e \u0438\u0441\u0445\u043e\u0434\u044f\u0449\u0438\u0435 \u0441\u043e\u0435\u0434\u0438\u043d\u0435\u043d\u0438\u044f (IPv6 -&gt; IPv4)</li> <li>\u041d\u0435 \u043f\u043e\u0434\u0434\u0435\u0440\u0436\u0438\u0432\u0430\u0435\u0442 \u043f\u0440\u043e\u0442\u043e\u043a\u043e\u043b\u044b \u0441 IP \u0432 payload (SIP, FTP active)</li> </ul> <p>\u041f\u0440\u0438\u043c\u0435\u043d\u0435\u043d\u0438\u0435: \u043c\u043e\u0431\u0438\u043b\u044c\u043d\u044b\u0435 \u043e\u043f\u0435\u0440\u0430\u0442\u043e\u0440\u044b (T-Mobile US, Telstra, Orange).</p>"},{"location":"networking/ipv6/transition.html#464xlat","title":"464XLAT","text":"<p>\u0420\u0435\u0448\u0430\u0435\u0442 \u043f\u0440\u043e\u0431\u043b\u0435\u043c\u0443 IPv4-\u043b\u0438\u0442\u0435\u0440\u0430\u043b\u043e\u0432 \u0432 \u043f\u0440\u0438\u043b\u043e\u0436\u0435\u043d\u0438\u044f\u0445. RFC 6877.</p> <p>\u041a\u043e\u043c\u043f\u043e\u043d\u0435\u043d\u0442\u044b:</p> <ul> <li>CLAT - \u043d\u0430 \u0443\u0441\u0442\u0440\u043e\u0439\u0441\u0442\u0432\u0435 \u043a\u043b\u0438\u0435\u043d\u0442\u0430, \u0442\u0440\u0430\u043d\u0441\u043b\u0438\u0440\u0443\u0435\u0442 IPv4 -&gt; IPv6</li> <li>PLAT - NAT64 \u043f\u0440\u043e\u0432\u0430\u0439\u0434\u0435\u0440\u0430</li> </ul> <p>\u041f\u0440\u043e\u0446\u0435\u0441\u0441:</p> <ol> <li>\u041f\u0440\u0438\u043b\u043e\u0436\u0435\u043d\u0438\u0435 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442 IPv4-\u043b\u0438\u0442\u0435\u0440\u0430\u043b (192.0.2.1)</li> <li>CLAT \u043f\u0435\u0440\u0435\u0445\u0432\u0430\u0442\u044b\u0432\u0430\u0435\u0442, \u0442\u0440\u0430\u043d\u0441\u043b\u0438\u0440\u0443\u0435\u0442 \u0432 IPv6 \u0441 NAT64-\u043f\u0440\u0435\u0444\u0438\u043a\u0441\u043e\u043c</li> <li>\u041f\u0430\u043a\u0435\u0442 \u0438\u0434\u0435\u0442 \u043f\u043e IPv6-\u0441\u0435\u0442\u0438 \u0434\u043e PLAT</li> <li>PLAT \u0442\u0440\u0430\u043d\u0441\u043b\u0438\u0440\u0443\u0435\u0442 \u043e\u0431\u0440\u0430\u0442\u043d\u043e \u0432 IPv4</li> </ol> <p>\u041f\u0440\u0438\u043c\u0435\u043d\u0435\u043d\u0438\u0435: Android \u0441 4.3, iOS, Windows 10+.</p>"},{"location":"networking/ipv6/transition.html#6to4","title":"6to4","text":"<p>Deprecated. RFC 3056 (2001), deprecated RFC 7526 (2015).</p> <p>\u0418\u0434\u0435\u044f: \u0438\u043d\u043a\u0430\u043f\u0441\u0443\u043b\u044f\u0446\u0438\u044f IPv6 \u0432 IPv4 \u0447\u0435\u0440\u0435\u0437 anycast-\u0440\u0435\u043b\u0435\u0438. \u041f\u0440\u0435\u0444\u0438\u043a\u0441 2002::/16, \u0433\u0434\u0435 \u0441\u043b\u0435\u0434\u0443\u044e\u0449\u0438\u0435 32 \u0431\u0438\u0442\u0430 - IPv4 \u0430\u0434\u0440\u0435\u0441.</p> <p>\u041f\u0440\u043e\u0431\u043b\u0435\u043c\u044b:</p> <ul> <li>\u0410\u0441\u0438\u043c\u043c\u0435\u0442\u0440\u0438\u0447\u043d\u0430\u044f \u043c\u0430\u0440\u0448\u0440\u0443\u0442\u0438\u0437\u0430\u0446\u0438\u044f</li> <li>\u041d\u0435\u043d\u0430\u0434\u0435\u0436\u043d\u044b\u0435 \u043f\u0443\u0431\u043b\u0438\u0447\u043d\u044b\u0435 relay-\u0440\u043e\u0443\u0442\u0435\u0440\u044b</li> <li>\u041d\u0435 \u0440\u0430\u0431\u043e\u0442\u0430\u0435\u0442 \u0437\u0430 NAT</li> <li>\u0412\u044b\u0441\u043e\u043a\u0438\u0435 \u0437\u0430\u0434\u0435\u0440\u0436\u043a\u0438</li> </ul> <p>\u041d\u0435 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c \u0432 \u043d\u043e\u0432\u044b\u0445 \u0440\u0430\u0437\u0432\u0435\u0440\u0442\u044b\u0432\u0430\u043d\u0438\u044f\u0445.</p>"},{"location":"networking/ipv6/transition.html#6rd-ipv6-rapid-deployment","title":"6RD (IPv6 Rapid Deployment)","text":"<p>\u0423\u043b\u0443\u0447\u0448\u0435\u043d\u043d\u044b\u0439 6to4 \u043f\u043e\u0434 \u043a\u043e\u043d\u0442\u0440\u043e\u043b\u0435\u043c \u043f\u0440\u043e\u0432\u0430\u0439\u0434\u0435\u0440\u0430. RFC 5969 (2010).</p> <p>\u041e\u0442\u043b\u0438\u0447\u0438\u044f \u043e\u0442 6to4:</p> <ul> <li>\u041f\u0440\u0435\u0444\u0438\u043a\u0441 \u043f\u0440\u043e\u0432\u0430\u0439\u0434\u0435\u0440\u0430 \u0432\u043c\u0435\u0441\u0442\u043e 2002::/16</li> <li>Relay-\u0440\u043e\u0443\u0442\u0435\u0440\u044b (BR) \u0432 \u0441\u0435\u0442\u0438 \u043f\u0440\u043e\u0432\u0430\u0439\u0434\u0435\u0440\u0430</li> <li>\u0422\u0440\u0430\u0444\u0438\u043a \u0441\u0438\u043c\u043c\u0435\u0442\u0440\u0438\u0447\u043d\u044b\u0439 \u0438 \u043a\u043e\u043d\u0442\u0440\u043e\u043b\u0438\u0440\u0443\u0435\u043c\u044b\u0439</li> </ul> <p>\u041a\u043e\u043c\u043f\u043e\u043d\u0435\u043d\u0442\u044b:</p> <ul> <li>6RD CE - Customer Edge, \u0438\u043d\u043a\u0430\u043f\u0441\u0443\u043b\u0438\u0440\u0443\u0435\u0442 IPv6 \u0432 IPv4</li> <li>6RD BR - Border Relay, \u0442\u0435\u0440\u043c\u0438\u043d\u0438\u0440\u0443\u0435\u0442 \u0442\u0443\u043d\u043d\u0435\u043b\u0438</li> </ul> <p>\u041f\u0440\u043e\u0446\u0435\u0441\u0441:</p> <ol> <li>CE \u043f\u043e\u043b\u0443\u0447\u0430\u0435\u0442 6RD-\u043f\u0440\u0435\u0444\u0438\u043a\u0441 \u0438 \u0430\u0434\u0440\u0435\u0441 BR \u0447\u0435\u0440\u0435\u0437 DHCP option 212</li> <li>CE \u0444\u043e\u0440\u043c\u0438\u0440\u0443\u0435\u0442 /64 \u0438\u0437 6RD-\u043f\u0440\u0435\u0444\u0438\u043a\u0441\u0430 + \u0441\u0432\u043e\u0435\u0433\u043e IPv4</li> <li>CE \u0438\u043d\u043a\u0430\u043f\u0441\u0443\u043b\u0438\u0440\u0443\u0435\u0442 IPv6 \u0432 IPv4, \u0448\u043b\u0435\u0442 \u043d\u0430 BR</li> <li>BR \u0434\u0435\u043a\u0430\u043f\u0441\u0443\u043b\u0438\u0440\u0443\u0435\u0442 \u0438 \u043c\u0430\u0440\u0448\u0440\u0443\u0442\u0438\u0437\u0438\u0440\u0443\u0435\u0442 \u0432 IPv6-\u0438\u043d\u0442\u0435\u0440\u043d\u0435\u0442</li> </ol> <p>\u041f\u0440\u0438\u043c\u0435\u043d\u0435\u043d\u0438\u0435: Free (\u0424\u0440\u0430\u043d\u0446\u0438\u044f) \u0440\u0430\u0437\u0432\u0435\u0440\u043d\u0443\u043b \u0434\u043b\u044f \u043c\u0438\u043b\u043b\u0438\u043e\u043d\u043e\u0432 \u043a\u043b\u0438\u0435\u043d\u0442\u043e\u0432 \u0437\u0430 5 \u043d\u0435\u0434\u0435\u043b\u044c.</p>"},{"location":"networking/ipv6/transition.html#ds-lite-dual-stack-lite","title":"DS-Lite (Dual-Stack Lite)","text":"<p>IPv4 \u0447\u0435\u0440\u0435\u0437 IPv6-\u0441\u0435\u0442\u044c \u043f\u0440\u043e\u0432\u0430\u0439\u0434\u0435\u0440\u0430. RFC 6333 (2011).</p> <p>CPE \u043d\u0435 \u043f\u043e\u043b\u0443\u0447\u0430\u0435\u0442 \u043f\u0443\u0431\u043b\u0438\u0447\u043d\u044b\u0439 IPv4. NAT \u0432\u044b\u043f\u043e\u043b\u043d\u044f\u0435\u0442\u0441\u044f \u0446\u0435\u043d\u0442\u0440\u0430\u043b\u0438\u0437\u043e\u0432\u0430\u043d\u043d\u043e.</p> <p>\u041a\u043e\u043c\u043f\u043e\u043d\u0435\u043d\u0442\u044b:</p> <ul> <li>B4 - Basic Bridging BroadBand, \u043d\u0430 CPE. \u0418\u043d\u043a\u0430\u043f\u0441\u0443\u043b\u0438\u0440\u0443\u0435\u0442 IPv4 \u0432 IPv6.</li> <li>AFTR - Address Family Transition Router. \u0422\u0435\u0440\u043c\u0438\u043d\u0438\u0440\u0443\u0435\u0442 \u0442\u0443\u043d\u043d\u0435\u043b\u044c, \u0432\u044b\u043f\u043e\u043b\u043d\u044f\u0435\u0442 CGNAT.</li> </ul> <p>\u0410\u0434\u0440\u0435\u0441\u0430:</p> <ul> <li>AFTR: 192.0.0.1 (well-known)</li> <li>B4: \u0438\u0437 192.0.0.0/29</li> </ul> <p>\u041f\u0440\u043e\u0446\u0435\u0441\u0441:</p> <ol> <li>B4 \u043f\u043e\u043b\u0443\u0447\u0430\u0435\u0442 \u0430\u0434\u0440\u0435\u0441 AFTR \u0447\u0435\u0440\u0435\u0437 DHCPv6 option 64</li> <li>\u0425\u043e\u0441\u0442 \u0432 LAN \u043f\u043e\u043b\u0443\u0447\u0430\u0435\u0442 \u043f\u0440\u0438\u0432\u0430\u0442\u043d\u044b\u0439 IPv4 (RFC1918)</li> <li>B4 \u0438\u043d\u043a\u0430\u043f\u0441\u0443\u043b\u0438\u0440\u0443\u0435\u0442 IPv4 \u0432 IPv6, \u0448\u043b\u0435\u0442 \u043d\u0430 AFTR</li> <li>AFTR \u0434\u0435\u043a\u0430\u043f\u0441\u0443\u043b\u0438\u0440\u0443\u0435\u0442, \u0432\u044b\u043f\u043e\u043b\u043d\u044f\u0435\u0442 NAT44, \u043c\u0430\u0440\u0448\u0440\u0443\u0442\u0438\u0437\u0438\u0440\u0443\u0435\u0442 \u0432 IPv4</li> </ol> <p>NAT \u043d\u0430 CPE \u043d\u0435 \u043d\u0443\u0436\u0435\u043d - B4 \u043f\u0435\u0440\u0435\u0434\u0430\u0435\u0442 \u043f\u0430\u043a\u0435\u0442\u044b \u0431\u0435\u0437 \u0442\u0440\u0430\u043d\u0441\u043b\u044f\u0446\u0438\u0438.</p> <p>\u041e\u0441\u043e\u0431\u0435\u043d\u043d\u043e\u0441\u0442\u0438:</p> <ul> <li>\u0426\u0435\u043d\u0442\u0440\u0430\u043b\u0438\u0437\u043e\u0432\u0430\u043d\u043d\u043e\u0435 \u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u0435 NAT \u043d\u0430 AFTR</li> <li>AFTR - \u0442\u043e\u0447\u043a\u0430 \u043e\u0442\u043a\u0430\u0437\u0430 \u0438 \u0443\u0437\u043a\u043e\u0435 \u043c\u0435\u0441\u0442\u043e</li> <li>ALG \u0434\u043b\u044f \u043f\u0440\u043e\u0431\u043b\u0435\u043c\u043d\u044b\u0445 \u043f\u0440\u043e\u0442\u043e\u043a\u043e\u043b\u043e\u0432 \u043d\u0430 AFTR</li> </ul>"},{"location":"networking/ipv6/transition.html#map-e","title":"MAP-E","text":"<p>Mapping of Address and Port with Encapsulation. RFC 7597 (2015).</p> <p>NAT \u043d\u0430 CPE, \u0446\u0435\u043d\u0442\u0440\u0430\u043b\u044c\u043d\u044b\u0439 \u0443\u0437\u0435\u043b stateless.</p> <p>\u041a\u043e\u043c\u043f\u043e\u043d\u0435\u043d\u0442\u044b:</p> <ul> <li>MAP CE - \u0432\u044b\u043f\u043e\u043b\u043d\u044f\u0435\u0442 NAPT44 + \u0438\u043d\u043a\u0430\u043f\u0441\u0443\u043b\u044f\u0446\u0438\u044e IPv4 \u0432 IPv6</li> <li>MAP BR - Border Relay, \u0434\u0435\u043a\u0430\u043f\u0441\u0443\u043b\u0438\u0440\u0443\u0435\u0442, \u0431\u0435\u0437 NAT-\u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u044f</li> </ul> <p>\u041f\u0440\u0438\u043d\u0446\u0438\u043f:</p> <ul> <li>CE \u043f\u043e\u043b\u0443\u0447\u0430\u0435\u0442 \u0447\u0430\u0441\u0442\u044c \u043f\u043e\u0440\u0442\u043e\u0432 \u043f\u0443\u0431\u043b\u0438\u0447\u043d\u043e\u0433\u043e IPv4 (port set)</li> <li>Mapping rules \u043e\u043f\u0440\u0435\u0434\u0435\u043b\u044f\u044e\u0442 \u0441\u043e\u043e\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u0438\u0435 IPv4+port &lt;-&gt; IPv6</li> </ul> <p>\u041f\u0440\u043e\u0446\u0435\u0441\u0441:</p> <ol> <li>CE \u043f\u043e\u043b\u0443\u0447\u0430\u0435\u0442 MAP rules \u0447\u0435\u0440\u0435\u0437 DHCPv6</li> <li>CE \u0432\u044b\u043f\u043e\u043b\u043d\u044f\u0435\u0442 NAT44 \u0441 \u0432\u044b\u0434\u0435\u043b\u0435\u043d\u043d\u044b\u043c IPv4 \u0438 port set</li> <li>CE \u0438\u043d\u043a\u0430\u043f\u0441\u0443\u043b\u0438\u0440\u0443\u0435\u0442 \u0432 IPv6, \u0448\u043b\u0435\u0442 \u043d\u0430 BR</li> <li>BR \u0434\u0435\u043a\u0430\u043f\u0441\u0443\u043b\u0438\u0440\u0443\u0435\u0442, \u0444\u043e\u0440\u0432\u0430\u0440\u0434\u0438\u0442 \u043f\u043e IPv4 \u0431\u0435\u0437 NAT</li> </ol> <p>\u041e\u0432\u0435\u0440\u0445\u0435\u0434: 40 \u0431\u0430\u0439\u0442 \u043d\u0430 \u043f\u0430\u043a\u0435\u0442 (IPv6 \u0437\u0430\u0433\u043e\u043b\u043e\u0432\u043e\u043a). MTU \u043d\u0443\u0436\u043d\u043e \u0443\u0447\u0438\u0442\u044b\u0432\u0430\u0442\u044c.</p>"},{"location":"networking/ipv6/transition.html#map-t","title":"MAP-T","text":"<p>Mapping of Address and Port using Translation. RFC 7599 (2015).</p> <p>\u041a\u0430\u043a MAP-E, \u043d\u043e \u0442\u0440\u0430\u043d\u0441\u043b\u044f\u0446\u0438\u044f \u0432\u043c\u0435\u0441\u0442\u043e \u0438\u043d\u043a\u0430\u043f\u0441\u0443\u043b\u044f\u0446\u0438\u0438.</p> <p>\u041e\u0442\u043b\u0438\u0447\u0438\u044f \u043e\u0442 MAP-E:</p> <ul> <li>CE: NAT44 + NAT46 (stateless)</li> <li>BR: NAT64 (stateless)</li> <li>\u041d\u0435\u0442 \u043e\u0432\u0435\u0440\u0445\u0435\u0434\u0430 \u0438\u043d\u043a\u0430\u043f\u0441\u0443\u043b\u044f\u0446\u0438\u0438</li> <li>IPv4 destination \u043a\u043e\u0434\u0438\u0440\u0443\u0435\u0442\u0441\u044f \u0432 IPv6 destination</li> </ul> <p>\u041f\u0440\u0438\u043c\u0435\u043d\u0435\u043d\u0438\u0435: \u043a\u043e\u0433\u0434\u0430 \u043e\u0432\u0435\u0440\u0445\u0435\u0434 MAP-E \u043a\u0440\u0438\u0442\u0438\u0447\u0435\u043d \u0438\u043b\u0438 \u043d\u0443\u0436\u043d\u0430 \u043a\u043b\u0430\u0441\u0441\u0438\u0444\u0438\u043a\u0430\u0446\u0438\u044f \u043f\u043e IPv6-\u0437\u0430\u0433\u043e\u043b\u043e\u0432\u043a\u0430\u043c.</p>"},{"location":"networking/ipv6/transition.html#routing-protocols","title":"\u0422\u0443\u043d\u043d\u0435\u043b\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435 routing protocols","text":"<p>IPv6 routing protocols (OSPFv3, BGP, RIPng) \u043c\u043e\u0436\u043d\u043e \u0437\u0430\u043f\u0443\u0441\u0442\u0438\u0442\u044c \u0447\u0435\u0440\u0435\u0437 IPv4 backbone \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u044f \u0442\u0443\u043d\u043d\u0435\u043b\u0438.</p> <p>\u0422\u0438\u043f\u044b \u0442\u0443\u043d\u043d\u0435\u043b\u0435\u0439:</p> <ul> <li>Manual IPv6-in-IPv4 (RFC 4213) - protocol 41</li> <li>GRE - \u0431\u043e\u043b\u0435\u0435 \u0443\u043d\u0438\u0432\u0435\u0440\u0441\u0430\u043b\u044c\u043d\u044b\u0439, \u043f\u043e\u0434\u0434\u0435\u0440\u0436\u0438\u0432\u0430\u0435\u0442 multicast</li> </ul> <p>GRE \u043f\u0440\u0435\u0434\u043f\u043e\u0447\u0442\u0438\u0442\u0435\u043b\u0435\u043d \u0434\u043b\u044f IGP (OSPFv3, EIGRP) - \u043f\u043e\u0434\u0434\u0435\u0440\u0436\u0438\u0432\u0430\u0435\u0442 multicast \u0434\u043b\u044f \u043e\u0431\u043c\u0435\u043d\u0430 hello/LSA.</p> <p>\u041d\u0430\u0441\u0442\u0440\u043e\u0439\u043a\u0430:</p> <ol> <li>Tunnel source/destination - IPv4 \u0430\u0434\u0440\u0435\u0441\u0430</li> <li>Tunnel mode: ipv6ip \u0438\u043b\u0438 gre ip</li> <li>\u041d\u0430 tunnel interface \u043d\u0430\u0437\u043d\u0430\u0447\u0430\u0435\u0442\u0441\u044f IPv6 (\u0434\u043e\u0441\u0442\u0430\u0442\u043e\u0447\u043d\u043e <code>ipv6 enable</code> \u0434\u043b\u044f link-local)</li> <li>\u0412\u043a\u043b\u044e\u0447\u0430\u0435\u0442\u0441\u044f routing protocol \u043d\u0430 tunnel interface</li> </ol> <p>\u041e\u0441\u043e\u0431\u0435\u043d\u043d\u043e\u0441\u0442\u0438:</p> <ul> <li>OSPFv3 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442 link-local \u043a\u0430\u043a next-hop</li> <li>\u041c\u043e\u0436\u043d\u043e \u043a\u043e\u043c\u0431\u0438\u043d\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0441 IPSec \u0434\u043b\u044f \u0448\u0438\u0444\u0440\u043e\u0432\u0430\u043d\u0438\u044f</li> <li>MTU \u0443\u0447\u0438\u0442\u044b\u0432\u0430\u0442\u044c: GRE \u0434\u043e\u0431\u0430\u0432\u043b\u044f\u0435\u0442 24+ \u0431\u0430\u0439\u0442 \u043e\u0432\u0435\u0440\u0445\u0435\u0434\u0430</li> </ul>"},{"location":"networking/ipv6/transition.html#_2","title":"\u0421\u0440\u0430\u0432\u043d\u0435\u043d\u0438\u0435","text":"\u041c\u0435\u0445\u0430\u043d\u0438\u0437\u043c NAT \u043d\u0430 State \u043d\u0430 \u041e\u0432\u0435\u0440\u0445\u0435\u0434 \u0421\u0442\u0430\u0442\u0443\u0441 NAT64 NAT64 NAT64 - \u0410\u043a\u0442\u0438\u0432\u043d\u043e \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442\u0441\u044f 6to4 - - 20B Deprecated 6RD - - 20B \u0418\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442\u0441\u044f DS-Lite AFTR AFTR 40B \u0418\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442\u0441\u044f MAP-E CE - 40B \u0418\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442\u0441\u044f MAP-T CE - - \u0418\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442\u0441\u044f"},{"location":"networking/nfv/index.html","title":"NFV (Network Function Virtualization)","text":""},{"location":"networking/nfv/index.html#nfv-network-function-virtualization","title":"NFV (Network Function Virtualization)","text":""},{"location":"networking/nfv/index.html#_1","title":"\u041a\u043e\u0440\u043e\u0442\u043a\u043e","text":"<p>NFV - \u043f\u0435\u0440\u0435\u043d\u043e\u0441 \u0441\u0435\u0442\u0435\u0432\u044b\u0445 \u0444\u0443\u043d\u043a\u0446\u0438\u0439 (firewall, load balancer, router, NAT, VPN) \u0441 \u0436\u0435\u043b\u0435\u0437\u043d\u044b\u0445 appliances \u043d\u0430 \u0432\u0438\u0440\u0442\u0443\u0430\u043b\u044c\u043d\u044b\u0435 \u043c\u0430\u0448\u0438\u043d\u044b \u0438\u043b\u0438 \u043a\u043e\u043d\u0442\u0435\u0439\u043d\u0435\u0440\u044b \u043f\u043e\u0432\u0435\u0440\u0445 \u0441\u0442\u0430\u043d\u0434\u0430\u0440\u0442\u043d\u044b\u0445 x86 \u0441\u0435\u0440\u0432\u0435\u0440\u043e\u0432.</p> <p>\u0426\u0435\u043b\u044c: \u0443\u0439\u0442\u0438 \u043e\u0442 vendor lock-in, \u0441\u043d\u0438\u0437\u0438\u0442\u044c CAPEX/OPEX, \u0443\u0441\u043a\u043e\u0440\u0438\u0442\u044c \u0434\u0435\u043f\u043b\u043e\u0439 \u043d\u043e\u0432\u044b\u0445 \u0441\u0435\u0440\u0432\u0438\u0441\u043e\u0432.</p> <p>SDN \u0438 NFV - \u0434\u043e\u043f\u043e\u043b\u043d\u044f\u044e\u0449\u0438\u0435 \u0442\u0435\u0445\u043d\u043e\u043b\u043e\u0433\u0438\u0438: SDN \u043e\u0442\u0434\u0435\u043b\u044f\u0435\u0442 control plane \u043e\u0442 data plane \u0438 \u0443\u043f\u0440\u0430\u0432\u043b\u044f\u0435\u0442 \u0441\u0435\u0442\u044c\u044e \u043f\u0440\u043e\u0433\u0440\u0430\u043c\u043c\u043d\u043e, NFV \u0432\u0438\u0440\u0442\u0443\u0430\u043b\u0438\u0437\u0438\u0440\u0443\u0435\u0442 \u0441\u0430\u043c\u0438 \u0441\u0435\u0442\u0435\u0432\u044b\u0435 \u0444\u0443\u043d\u043a\u0446\u0438\u0438. SDN \u0447\u0430\u0441\u0442\u043e \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442\u0441\u044f \u0434\u043b\u044f \u0441\u0432\u044f\u0437\u0438 VNF \u043c\u0435\u0436\u0434\u0443 \u0441\u043e\u0431\u043e\u0439 (service chaining).</p>"},{"location":"networking/nfv/index.html#etsi-nfv","title":"\u0410\u0440\u0445\u0438\u0442\u0435\u043a\u0442\u0443\u0440\u0430 ETSI NFV","text":"<p>\u0421\u0442\u0430\u043d\u0434\u0430\u0440\u0442 ETSI \u043e\u043f\u0440\u0435\u0434\u0435\u043b\u044f\u0435\u0442 \u0442\u0440\u0438 \u043e\u0441\u043d\u043e\u0432\u043d\u044b\u0445 \u043a\u043e\u043c\u043f\u043e\u043d\u0435\u043d\u0442\u0430:</p> <p>NFVI (NFV Infrastructure) - \u0438\u043d\u0444\u0440\u0430\u0441\u0442\u0440\u0443\u043a\u0442\u0443\u0440\u043d\u044b\u0439 \u0441\u043b\u043e\u0439:</p> <ul> <li>compute/storage/network \u0440\u0435\u0441\u0443\u0440\u0441\u044b (\u043e\u0431\u044b\u0447\u043d\u044b\u0435 \u0441\u0435\u0440\u0432\u0435\u0440\u044b)</li> <li>\u0433\u0438\u043f\u0435\u0440\u0432\u0438\u0437\u043e\u0440 \u0438\u043b\u0438 container runtime</li> <li>\u0432\u0438\u0440\u0442\u0443\u0430\u043b\u044c\u043d\u044b\u0435 \u0440\u0435\u0441\u0443\u0440\u0441\u044b \u0434\u043b\u044f VNF</li> </ul> <p>VNF (Virtual Network Function) - \u0432\u0438\u0440\u0442\u0443\u0430\u043b\u0438\u0437\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u0430\u044f \u0441\u0435\u0442\u0435\u0432\u0430\u044f \u0444\u0443\u043d\u043a\u0446\u0438\u044f:</p> <ul> <li>vRouter, vFirewall, vLB, vNAT, vVPN</li> <li>\u0440\u0430\u0431\u043e\u0442\u0430\u0435\u0442 \u043d\u0430 VM \u0438\u043b\u0438 \u0432 \u043a\u043e\u043d\u0442\u0435\u0439\u043d\u0435\u0440\u0435</li> <li>\u0437\u0430\u043c\u0435\u043d\u044f\u0435\u0442 \u0444\u0438\u0437\u0438\u0447\u0435\u0441\u043a\u0438\u0439 appliance</li> </ul> <p>MANO (Management and Orchestration) - \u0443\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u0438\u0435:</p> <ul> <li>NFVO (NFV Orchestrator) - \u043e\u0440\u043a\u0435\u0441\u0442\u0440\u0430\u0446\u0438\u044f \u0441\u0435\u0440\u0432\u0438\u0441\u043e\u0432, lifecycle NS</li> <li>VNFM (VNF Manager) - lifecycle VNF</li> <li>VIM (Virtualized Infrastructure Manager) - \u0443\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u0438\u0435 \u0438\u043d\u0444\u0440\u0430\u0441\u0442\u0440\u0443\u043a\u0442\u0443\u0440\u043e\u0439 (OpenStack, VMware)</li> </ul> Text Only<pre><code>+------------------------------------------+\n|              MANO                        |\n|  +--------+  +--------+  +--------+      |\n|  |  NFVO  |  |  VNFM  |  |  VIM   |      |\n|  +--------+  +--------+  +--------+      |\n+------------------------------------------+\n                    |\n+------------------------------------------+\n|              VNF Layer                   |\n|  [vRouter] [vFirewall] [vLB] [vNAT]      |\n+------------------------------------------+\n                    |\n+------------------------------------------+\n|              NFVI                        |\n|  Hypervisor / Container Runtime          |\n|  Compute | Storage | Network             |\n+------------------------------------------+\n</code></pre>"},{"location":"networking/nfv/index.html#vnf-vs-cnf","title":"VNF vs CNF","text":"<p>VNF (Virtual Network Function) - \u0441\u0435\u0442\u0435\u0432\u0430\u044f \u0444\u0443\u043d\u043a\u0446\u0438\u044f \u0432 VM:</p> <ul> <li>\u0442\u044f\u0436\u0435\u043b\u044b\u0439: \u0433\u043e\u0441\u0442\u0435\u0432\u0430\u044f \u041e\u0421 + \u0433\u0438\u043f\u0435\u0440\u0432\u0438\u0437\u043e\u0440</li> <li>\u043e\u0440\u043a\u0435\u0441\u0442\u0440\u0430\u0446\u0438\u044f \u0447\u0435\u0440\u0435\u0437 NFV-MANO (OpenStack/VMware)</li> <li>\u043c\u0435\u0434\u043b\u0435\u043d\u043d\u044b\u0439 \u0441\u0442\u0430\u0440\u0442 (\u043c\u0438\u043d\u0443\u0442\u044b)</li> </ul> <p>CNF (Cloud Native Network Function) - \u0441\u0435\u0442\u0435\u0432\u0430\u044f \u0444\u0443\u043d\u043a\u0446\u0438\u044f \u0432 \u043a\u043e\u043d\u0442\u0435\u0439\u043d\u0435\u0440\u0435:</p> <ul> <li>\u043b\u0435\u0433\u043a\u0438\u0439: \u0442\u043e\u043b\u044c\u043a\u043e \u043a\u043e\u043d\u0442\u0435\u0439\u043d\u0435\u0440, \u0431\u0435\u0437 guest OS</li> <li>\u043e\u0440\u043a\u0435\u0441\u0442\u0440\u0430\u0446\u0438\u044f \u0447\u0435\u0440\u0435\u0437 Kubernetes</li> <li>\u0431\u044b\u0441\u0442\u0440\u044b\u0439 \u0441\u0442\u0430\u0440\u0442 (\u0441\u0435\u043a\u0443\u043d\u0434\u044b)</li> <li>\u043c\u0438\u043a\u0440\u043e\u0441\u0435\u0440\u0432\u0438\u0441\u043d\u0430\u044f \u0430\u0440\u0445\u0438\u0442\u0435\u043a\u0442\u0443\u0440\u0430</li> <li>\u0438\u043d\u0442\u0435\u0433\u0440\u0430\u0446\u0438\u044f \u0441 CI/CD</li> </ul> <p>CNF - \u044d\u0432\u043e\u043b\u044e\u0446\u0438\u044f VNF \u0434\u043b\u044f cloud-native \u0438\u043d\u0444\u0440\u0430\u0441\u0442\u0440\u0443\u043a\u0442\u0443\u0440\u044b. \u0421\u043e\u0432\u0440\u0435\u043c\u0435\u043d\u043d\u044b\u0435 \u043f\u0440\u043e\u0435\u043a\u0442\u044b \u043f\u0440\u0435\u0434\u043f\u043e\u0447\u0438\u0442\u0430\u044e\u0442 CNF.</p>"},{"location":"networking/nfv/index.html#use-cases-dccloud","title":"Use Cases \u0432 DC/Cloud","text":"<p>Service Chaining - \u0446\u0435\u043f\u043e\u0447\u043a\u0430 VNF \u0434\u043b\u044f \u043e\u0431\u0440\u0430\u0431\u043e\u0442\u043a\u0438 \u0442\u0440\u0430\u0444\u0438\u043a\u0430:</p> Text Only<pre><code>Traffic -&gt; vFirewall -&gt; vLB -&gt; vWAF -&gt; App\n</code></pre> <p>SDN \u043a\u043e\u043d\u0442\u0440\u043e\u043b\u043b\u0435\u0440 \u0443\u043f\u0440\u0430\u0432\u043b\u044f\u0435\u0442 \u043c\u0430\u0440\u0448\u0440\u0443\u0442\u0438\u0437\u0430\u0446\u0438\u0435\u0439 \u043c\u0435\u0436\u0434\u0443 VNF.</p> <p>vCPE (virtual Customer Premise Equipment) - \u0432\u0438\u0440\u0442\u0443\u0430\u043b\u044c\u043d\u044b\u0439 \u0440\u043e\u0443\u0442\u0435\u0440/firewall \u0434\u043b\u044f \u043a\u043b\u0438\u0435\u043d\u0442\u0430 \u0432\u043c\u0435\u0441\u0442\u043e \u0436\u0435\u043b\u0435\u0437\u043a\u0438 \u043d\u0430 \u043f\u043b\u043e\u0449\u0430\u0434\u043a\u0435.</p> <p>Network Segmentation - vFirewall \u043c\u0435\u0436\u0434\u0443 \u0441\u0435\u0433\u043c\u0435\u043d\u0442\u0430\u043c\u0438 \u0432 DC \u0431\u0435\u0437 \u0444\u0438\u0437\u0438\u0447\u0435\u0441\u043a\u0438\u0445 appliances.</p> <p>Elastic Scaling - \u0430\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0438\u0439 scale out/in VNF \u043f\u043e\u0434 \u043d\u0430\u0433\u0440\u0443\u0437\u043a\u0443 (\u0447\u0435\u0440\u0435\u0437 MANO \u0438\u043b\u0438 Kubernetes \u0434\u043b\u044f CNF).</p>"},{"location":"networking/nfv/index.html#_2","title":"\u041f\u0440\u0438\u043c\u0435\u0440\u044b \u0440\u0435\u0430\u043b\u0438\u0437\u0430\u0446\u0438\u0439","text":"<p>VIM:</p> <ul> <li>OpenStack (\u043e\u0441\u043d\u043e\u0432\u043d\u043e\u0439 \u0432\u044b\u0431\u043e\u0440 \u0434\u043b\u044f NFV)</li> <li>VMware vCloud NFV</li> </ul> <p>VNF/CNF:</p> <ul> <li>Open vSwitch (vSwitch)</li> <li>VPP (Vector Packet Processing) - \u0432\u044b\u0441\u043e\u043a\u043e\u043f\u0440\u043e\u0438\u0437\u0432\u043e\u0434\u0438\u0442\u0435\u043b\u044c\u043d\u044b\u0439 data plane</li> <li>Cilium, Calico - CNI \u0434\u043b\u044f Kubernetes \u0441 network policy</li> </ul> <p>MANO:</p> <ul> <li>ONAP (Open Network Automation Platform)</li> <li>OSM (Open Source MANO \u043e\u0442 ETSI)</li> </ul>"},{"location":"networking/nfv/index.html#_3","title":"\u0421\u0441\u044b\u043b\u043a\u0438","text":"<ul> <li>ETSI NFV</li> <li>ETSI GS NFV-MAN 001</li> </ul>"},{"location":"networking/ovs/index.html","title":"Open vSwitch","text":""},{"location":"networking/ovs/index.html#open-vswitch","title":"Open vSwitch","text":""},{"location":"networking/ovs/index.html#_1","title":"\u041a\u043e\u0440\u043e\u0442\u043a\u043e","text":"<p>\u041f\u0440\u043e\u0433\u0440\u0430\u043c\u043c\u043d\u044b\u0439 \u043a\u043e\u043c\u043c\u0443\u0442\u0430\u0442\u043e\u0440 \u0443\u0440\u043e\u0432\u043d\u044f L2-L4. \u041f\u043e\u0434\u0434\u0435\u0440\u0436\u0438\u0432\u0430\u0435\u0442 OpenFlow, VLAN, bonding, QoS. \u0418\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442\u0441\u044f \u0432 \u0432\u0438\u0440\u0442\u0443\u0430\u043b\u0438\u0437\u0430\u0446\u0438\u0438 (OpenStack, KVM) \u0438 SDN.</p>"},{"location":"networking/ovs/index.html#_2","title":"\u0410\u0440\u0445\u0438\u0442\u0435\u043a\u0442\u0443\u0440\u0430","text":"<p>\u0422\u0440\u0438 \u043e\u0441\u043d\u043e\u0432\u043d\u044b\u0445 \u043a\u043e\u043c\u043f\u043e\u043d\u0435\u043d\u0442\u0430:</p> <p>ovsdb-server - \u0431\u0430\u0437\u0430 \u0434\u0430\u043d\u043d\u044b\u0445 \u043a\u043e\u043d\u0444\u0438\u0433\u0443\u0440\u0430\u0446\u0438\u0438. \u0425\u0440\u0430\u043d\u0438\u0442 \u043d\u0430\u0441\u0442\u0440\u043e\u0439\u043a\u0438 bridges, ports, interfaces. \u041a\u043e\u043d\u0444\u0438\u0433\u0443\u0440\u0430\u0446\u0438\u044f \u043f\u0435\u0440\u0435\u0436\u0438\u0432\u0430\u0435\u0442 \u043f\u0435\u0440\u0435\u0437\u0430\u0433\u0440\u0443\u0437\u043a\u0443.</p> <p>ovs-vswitchd - \u0434\u0435\u043c\u043e\u043d \u043a\u043e\u043c\u043c\u0443\u0442\u0430\u0442\u043e\u0440\u0430. \u0427\u0438\u0442\u0430\u0435\u0442 \u043a\u043e\u043d\u0444\u0438\u0433 \u0438\u0437 ovsdb, \u0443\u043f\u0440\u0430\u0432\u043b\u044f\u0435\u0442 datapath, \u043e\u0431\u0440\u0430\u0431\u0430\u0442\u044b\u0432\u0430\u0435\u0442 OpenFlow.</p> <p>datapath - \u043c\u043e\u0434\u0443\u043b\u044c \u044f\u0434\u0440\u0430 (\u0438\u043b\u0438 userspace/DPDK). \u0412\u044b\u043f\u043e\u043b\u043d\u044f\u0435\u0442 \u0431\u044b\u0441\u0442\u0440\u0443\u044e \u043f\u0435\u0440\u0435\u0441\u044b\u043b\u043a\u0443 \u043f\u0430\u043a\u0435\u0442\u043e\u0432 \u043f\u043e \u0437\u0430\u043a\u044d\u0448\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u044b\u043c flow. \u0415\u0441\u043b\u0438 flow \u043d\u0435\u0442 - \u043e\u0442\u043f\u0440\u0430\u0432\u043b\u044f\u0435\u0442 \u043f\u0430\u043a\u0435\u0442 \u0432 ovs-vswitchd.</p> <p>\u041f\u0443\u0442\u044c \u043f\u0430\u043a\u0435\u0442\u0430:</p> <ol> <li>\u041f\u0430\u043a\u0435\u0442 \u043f\u0440\u0438\u0445\u043e\u0434\u0438\u0442 \u043d\u0430 \u043f\u043e\u0440\u0442</li> <li>Datapath \u0438\u0449\u0435\u0442 matching flow</li> <li>\u0415\u0441\u0442\u044c flow -&gt; \u0432\u044b\u043f\u043e\u043b\u043d\u044f\u0435\u0442 actions \u0432 \u044f\u0434\u0440\u0435 (\u0431\u044b\u0441\u0442\u0440\u043e)</li> <li>\u041d\u0435\u0442 flow -&gt; upcall \u0432 ovs-vswitchd -&gt; \u0440\u0435\u0448\u0435\u043d\u0438\u0435 -&gt; \u043d\u043e\u0432\u044b\u0439 flow \u0432 datapath</li> </ol>"},{"location":"networking/ovs/index.html#_3","title":"\u041a\u043e\u043c\u0430\u043d\u0434\u044b","text":""},{"location":"networking/ovs/index.html#ovs-vsctl","title":"ovs-vsctl","text":"Bash<pre><code>ovs-vsctl show\n</code></pre> <p>\u041e\u0431\u0449\u0430\u044f \u0438\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u044f \u043e bridges \u0438 \u043f\u043e\u0440\u0442\u0430\u0445.</p> Bash<pre><code>ovs-vsctl list-br\n</code></pre> <p>\u0421\u043f\u0438\u0441\u043e\u043a bridges.</p> Bash<pre><code>ovs-vsctl list-ports br0\n</code></pre> <p>\u0421\u043f\u0438\u0441\u043e\u043a \u043f\u043e\u0440\u0442\u043e\u0432 \u043d\u0430 bridge.</p> Bash<pre><code>ovs-vsctl list interface\n</code></pre> <p>\u0421\u043f\u0438\u0441\u043e\u043a \u0432\u0441\u0435\u0445 \u0438\u043d\u0442\u0435\u0440\u0444\u0435\u0439\u0441\u043e\u0432.</p> Bash<pre><code>ovs-vsctl get port eth0 tag\n</code></pre> <p>\u041f\u043e\u043b\u0443\u0447\u0438\u0442\u044c VLAN tag \u043f\u043e\u0440\u0442\u0430.</p>"},{"location":"networking/ovs/index.html#ovs-ofctl","title":"ovs-ofctl","text":"Bash<pre><code>ovs-ofctl show br0\n</code></pre> <p>\u0418\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u044f \u043e bridge \u0438 \u043f\u043e\u0440\u0442\u0430\u0445 (OpenFlow port numbers).</p> Bash<pre><code>ovs-ofctl dump-flows br0\n</code></pre> <p>\u0412\u0441\u0435 flow rules.</p> Bash<pre><code>ovs-ofctl dump-flows br0 table=0\n</code></pre> <p>Flows \u0438\u0437 \u043a\u043e\u043d\u043a\u0440\u0435\u0442\u043d\u043e\u0439 \u0442\u0430\u0431\u043b\u0438\u0446\u044b.</p> Bash<pre><code>ovs-ofctl dump-ports br0\n</code></pre> <p>\u0421\u0442\u0430\u0442\u0438\u0441\u0442\u0438\u043a\u0430 \u043f\u043e\u0440\u0442\u043e\u0432 (\u043f\u0430\u043a\u0435\u0442\u044b, \u0431\u0430\u0439\u0442\u044b).</p> Bash<pre><code>ovs-ofctl dump-ports-desc br0\n</code></pre> <p>\u041e\u043f\u0438\u0441\u0430\u043d\u0438\u0435 \u043f\u043e\u0440\u0442\u043e\u0432 (state, speed).</p>"},{"location":"networking/ovs/index.html#ovs-appctl","title":"ovs-appctl","text":"Bash<pre><code>ovs-appctl ofproto/trace br0 in_port=1\n</code></pre> <p>\u0422\u0440\u0430\u0441\u0441\u0438\u0440\u043e\u0432\u043a\u0430 \u043f\u0430\u043a\u0435\u0442\u0430 \u0447\u0435\u0440\u0435\u0437 flow tables.</p> Bash<pre><code>ovs-appctl fdb/show br0\n</code></pre> <p>MAC-\u0442\u0430\u0431\u043b\u0438\u0446\u0430 (FDB).</p> Bash<pre><code>ovs-appctl dpctl/show -s\n</code></pre> <p>\u0421\u0442\u0430\u0442\u0438\u0441\u0442\u0438\u043a\u0430 datapath.</p> Bash<pre><code>ovs-appctl bridge/dump-flows br0\n</code></pre> <p>Flows \u0432\u043a\u043b\u044e\u0447\u0430\u044f \u0441\u043a\u0440\u044b\u0442\u044b\u0435.</p>"},{"location":"networking/segment-routing/index.html","title":"Segment Routing","text":""},{"location":"networking/segment-routing/index.html#segment-routing","title":"Segment Routing","text":""},{"location":"networking/segment-routing/index.html#_1","title":"\u041a\u043e\u0440\u043e\u0442\u043a\u043e","text":"<p>Segment Routing (SR) - \u0430\u0440\u0445\u0438\u0442\u0435\u043a\u0442\u0443\u0440\u0430 \u043c\u0430\u0440\u0448\u0440\u0443\u0442\u0438\u0437\u0430\u0446\u0438\u0438 \u043e\u0442 \u0438\u0441\u0442\u043e\u0447\u043d\u0438\u043a\u0430. \u0413\u043e\u043b\u043e\u0432\u043d\u043e\u0439 \u0443\u0437\u0435\u043b \u0432\u044b\u0431\u0438\u0440\u0430\u0435\u0442 \u043f\u0443\u0442\u044c \u0438 \u043a\u043e\u0434\u0438\u0440\u0443\u0435\u0442 \u0435\u0433\u043e \u043a\u0430\u043a \u0443\u043f\u043e\u0440\u044f\u0434\u043e\u0447\u0435\u043d\u043d\u044b\u0439 \u0441\u043f\u0438\u0441\u043e\u043a \u0441\u0435\u0433\u043c\u0435\u043d\u0442\u043e\u0432 (SID). \u041a\u0430\u0436\u0434\u044b\u0439 \u0442\u0440\u0430\u043d\u0437\u0438\u0442\u043d\u044b\u0439 \u0443\u0437\u0435\u043b \u0432\u044b\u043f\u043e\u043b\u043d\u044f\u0435\u0442 \u0438\u043d\u0441\u0442\u0440\u0443\u043a\u0446\u0438\u044e \u0438\u0437 \u0432\u0435\u0440\u0445\u043d\u0435\u0433\u043e \u0441\u0435\u0433\u043c\u0435\u043d\u0442\u0430 \u0438 \u0443\u0434\u0430\u043b\u044f\u0435\u0442 \u0435\u0433\u043e.</p> <p>\u0414\u0432\u0430 data plane:</p> <ul> <li>SR-MPLS - \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442 MPLS \u043c\u0435\u0442\u043a\u0438 (20 \u0431\u0438\u0442), \u0441\u043e\u0432\u043c\u0435\u0441\u0442\u0438\u043c \u0441 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u044e\u0449\u0438\u043c \u043e\u0431\u043e\u0440\u0443\u0434\u043e\u0432\u0430\u043d\u0438\u0435\u043c</li> <li>SRv6 - \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442 IPv6 \u0437\u0430\u0433\u043e\u043b\u043e\u0432\u043a\u0438 (128 \u0431\u0438\u0442 SID)</li> </ul> <p>\u0417\u0430\u0447\u0435\u043c:</p> <ul> <li>\u0423\u0431\u0438\u0440\u0430\u0435\u0442 LDP \u0438 RSVP-TE \u0438\u0437 control plane</li> <li>IGP (OSPF/IS-IS) \u0441\u0430\u043c \u0440\u0430\u0441\u043f\u0440\u043e\u0441\u0442\u0440\u0430\u043d\u044f\u0435\u0442 SID</li> <li>\u041d\u0435\u0442 per-flow \u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u044f \u043d\u0430 \u0442\u0440\u0430\u043d\u0437\u0438\u0442\u043d\u044b\u0445 \u0443\u0437\u043b\u0430\u0445</li> <li>Fast reroute &lt; 50ms</li> </ul>"},{"location":"networking/segment-routing/index.html#_2","title":"\u0422\u0438\u043f\u044b \u0441\u0435\u0433\u043c\u0435\u043d\u0442\u043e\u0432","text":"<p>Prefix SID (\u0433\u043b\u043e\u0431\u0430\u043b\u044c\u043d\u044b\u0439):</p> <ul> <li>\u041f\u0440\u0438\u0432\u044f\u0437\u0430\u043d \u043a IP-\u043f\u0440\u0435\u0444\u0438\u043a\u0441\u0443</li> <li>\u041a\u043e\u0434\u0438\u0440\u0443\u0435\u0442\u0441\u044f \u043a\u0430\u043a \u0438\u043d\u0434\u0435\u043a\u0441 (\u0441\u043c\u0435\u0449\u0435\u043d\u0438\u0435 \u043e\u0442 SRGB)</li> <li>IGP \u0441\u0442\u0440\u043e\u0438\u0442 \u043a\u0440\u0430\u0442\u0447\u0430\u0439\u0448\u0438\u0439 \u043f\u0443\u0442\u044c \u0434\u043e \u043f\u0440\u0435\u0444\u0438\u043a\u0441\u0430</li> <li>\u041f\u043e\u0434\u0434\u0435\u0440\u0436\u0438\u0432\u0430\u0435\u0442 ECMP</li> </ul> <p>Node SID (\u0447\u0430\u0441\u0442\u043d\u044b\u0439 \u0441\u043b\u0443\u0447\u0430\u0439 Prefix SID):</p> <ul> <li>\u041f\u0440\u0438\u0432\u044f\u0437\u0430\u043d \u043a loopback-\u0430\u0434\u0440\u0435\u0441\u0443 \u0443\u0437\u043b\u0430</li> <li>\u0424\u043b\u0430\u0433 N-Flag = 1</li> </ul> <p>Adjacency SID (\u043b\u043e\u043a\u0430\u043b\u044c\u043d\u044b\u0439):</p> <ul> <li>\u041f\u0440\u0438\u0432\u044f\u0437\u0430\u043d \u043a \u043a\u043e\u043d\u043a\u0440\u0435\u0442\u043d\u043e\u043c\u0443 \u043b\u0438\u043d\u043a\u0443</li> <li>\u0410\u0431\u0441\u043e\u043b\u044e\u0442\u043d\u043e\u0435 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u043c\u0435\u0442\u043a\u0438 (\u043d\u0435 \u0438\u043d\u0434\u0435\u043a\u0441)</li> <li>\u0412\u044b\u0434\u0435\u043b\u044f\u0435\u0442\u0441\u044f \u0434\u0438\u043d\u0430\u043c\u0438\u0447\u0435\u0441\u043a\u0438 \u0438\u0437 SRLB</li> <li>\u041d\u0435\u0442 ECMP - \u0444\u043e\u0440\u0441\u0438\u0440\u0443\u0435\u0442 \u0442\u0440\u0430\u0444\u0438\u043a \u0447\u0435\u0440\u0435\u0437 \u043a\u043e\u043d\u043a\u0440\u0435\u0442\u043d\u044b\u0439 \u0438\u043d\u0442\u0435\u0440\u0444\u0435\u0439\u0441</li> </ul> <p>Anycast SID:</p> <ul> <li>\u041e\u0434\u0438\u043d \u0438 \u0442\u043e\u0442 \u0436\u0435 SID \u0430\u043d\u043e\u043d\u0441\u0438\u0440\u0443\u0435\u0442\u0441\u044f \u043d\u0435\u0441\u043a\u043e\u043b\u044c\u043a\u0438\u043c\u0438 \u0443\u0437\u043b\u0430\u043c\u0438</li> <li>\u0422\u0440\u0430\u0444\u0438\u043a \u0438\u0434\u0435\u0442 \u043a \u0431\u043b\u0438\u0436\u0430\u0439\u0448\u0435\u043c\u0443 \u0443\u0437\u043b\u0443 \u043f\u043e IGP</li> </ul> <p>Binding SID:</p> <ul> <li>\u041b\u043e\u043a\u0430\u043b\u044c\u043d\u044b\u0439 \u0441\u0435\u0433\u043c\u0435\u043d\u0442, \u043f\u0440\u0435\u0434\u0441\u0442\u0430\u0432\u043b\u044f\u0435\u0442 SR-TE policy</li> <li>\u0410\u0431\u0441\u0442\u0440\u0430\u0433\u0438\u0440\u0443\u0435\u0442 \u0441\u043f\u0438\u0441\u043e\u043a \u0441\u0435\u0433\u043c\u0435\u043d\u0442\u043e\u0432 \u0437\u0430 \u043e\u0434\u043d\u043e\u0439 \u043c\u0435\u0442\u043a\u043e\u0439</li> </ul> <p>BGP Prefix SID:</p> <ul> <li>\u0413\u043b\u043e\u0431\u0430\u043b\u044c\u043d\u044b\u0439 \u0441\u0435\u0433\u043c\u0435\u043d\u0442 \u0434\u043b\u044f BGP-\u043f\u0440\u0435\u0444\u0438\u043a\u0441\u0430</li> <li>\u0418\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442\u0441\u044f \u0432 inter-domain \u0441\u0446\u0435\u043d\u0430\u0440\u0438\u044f\u0445 (Unified MPLS)</li> </ul> <p>BGP Peering SID:</p> <ul> <li>\u041b\u043e\u043a\u0430\u043b\u044c\u043d\u044b\u0439 \u0441\u0435\u0433\u043c\u0435\u043d\u0442 \u0434\u043b\u044f BGP-\u0441\u043e\u0441\u0435\u0434\u0430</li> <li>\u0424\u043e\u0440\u0441\u0438\u0440\u0443\u0435\u0442 \u0442\u0440\u0430\u0444\u0438\u043a \u0447\u0435\u0440\u0435\u0437 \u043a\u043e\u043d\u043a\u0440\u0435\u0442\u043d\u043e\u0433\u043e BGP peer</li> </ul>"},{"location":"networking/segment-routing/index.html#label-blocks","title":"Label Blocks","text":"<p>SRGB (Segment Routing Global Block):</p> <ul> <li>\u0414\u0438\u0430\u043f\u0430\u0437\u043e\u043d \u043c\u0435\u0442\u043e\u043a \u0434\u043b\u044f \u0433\u043b\u043e\u0431\u0430\u043b\u044c\u043d\u044b\u0445 \u0441\u0435\u0433\u043c\u0435\u043d\u0442\u043e\u0432 (Prefix/Node SID)</li> <li>\u041f\u043e \u0443\u043c\u043e\u043b\u0447\u0430\u043d\u0438\u044e: 16000-23999</li> <li>Prefix SID = SRGB base + index</li> </ul> <p>SRLB (Segment Routing Local Block):</p> <ul> <li>\u0414\u0438\u0430\u043f\u0430\u0437\u043e\u043d \u043c\u0435\u0442\u043e\u043a \u0434\u043b\u044f \u043b\u043e\u043a\u0430\u043b\u044c\u043d\u044b\u0445 \u0441\u0435\u0433\u043c\u0435\u043d\u0442\u043e\u0432 (Adjacency SID)</li> <li>\u0412\u044b\u0434\u0435\u043b\u044f\u0435\u0442\u0441\u044f \u043e\u0442\u0434\u0435\u043b\u044c\u043d\u043e \u043e\u0442 SRGB</li> </ul>"},{"location":"networking/segment-routing/index.html#sr-te-traffic-engineering","title":"SR-TE (Traffic Engineering)","text":"<p>Segment Routing Traffic Engineering - \u0443\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u0438\u0435 \u043f\u0443\u0442\u0435\u043c \u0447\u0435\u0440\u0435\u0437 \u0441\u0435\u0442\u044c.</p> <p>SR-TE Policy \u0438\u0434\u0435\u043d\u0442\u0438\u0444\u0438\u0446\u0438\u0440\u0443\u0435\u0442\u0441\u044f \u0442\u0440\u043e\u0439\u043a\u043e\u0439: (head-end, color, end-point).</p> <ul> <li>head-end: \u0443\u0437\u0435\u043b, \u0433\u0434\u0435 \u0441\u043e\u0437\u0434\u0430\u0435\u0442\u0441\u044f policy</li> <li>color: \u0447\u0438\u0441\u043b\u043e\u0432\u043e\u0439 \u0438\u0434\u0435\u043d\u0442\u0438\u0444\u0438\u043a\u0430\u0442\u043e\u0440 (1-4294967295)</li> <li>end-point: \u043a\u043e\u043d\u0435\u0447\u043d\u0430\u044f \u0442\u043e\u0447\u043a\u0430</li> </ul> <p>SID-list \u0432\u0441\u0442\u0430\u0432\u043b\u044f\u0435\u0442\u0441\u044f \u0432 \u043f\u0430\u043a\u0435\u0442 \u043d\u0430 head-end. \u0422\u0440\u0430\u043d\u0437\u0438\u0442\u043d\u044b\u0435 \u0443\u0437\u043b\u044b \u0432\u044b\u043f\u043e\u043b\u043d\u044f\u044e\u0442 \u0438\u043d\u0441\u0442\u0440\u0443\u043a\u0446\u0438\u0438.</p> <p>Prefix SID \u0432 TE:</p> <ul> <li>ECMP, \u0443\u0441\u0442\u043e\u0439\u0447\u0438\u0432\u043e\u0441\u0442\u044c \u043a \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u044f\u043c \u0442\u043e\u043f\u043e\u043b\u043e\u0433\u0438\u0438</li> <li>\u041c\u043e\u0436\u0435\u0442 \u0443\u0434\u043b\u0438\u043d\u0438\u0442\u044c \u043f\u0443\u0442\u044c</li> </ul> <p>Adjacency SID \u0432 TE:</p> <ul> <li>\u0414\u0435\u0442\u0435\u0440\u043c\u0438\u043d\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u044b\u0439 \u043f\u0443\u0442\u044c</li> <li>\u041d\u0435\u0442 ECMP, \u0443\u044f\u0437\u0432\u0438\u043c \u043a \u043e\u0442\u043a\u0430\u0437\u0430\u043c</li> </ul>"},{"location":"networking/segment-routing/index.html#on-demand-next-hop-odn","title":"On-Demand Next Hop (ODN)","text":"<p>\u0410\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u043e\u0435 \u0441\u043e\u0437\u0434\u0430\u043d\u0438\u0435 SR-TE policy \u043f\u0440\u0438 \u043f\u043e\u044f\u0432\u043b\u0435\u043d\u0438\u0438 BGP-\u043c\u0430\u0440\u0448\u0440\u0443\u0442\u0430 \u0441 color extended community. Head-end \u043f\u0440\u0438\u043c\u0435\u043d\u044f\u0435\u0442 \u0448\u0430\u0431\u043b\u043e\u043d \u0434\u043b\u044f \u0441\u043e\u043e\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u0443\u044e\u0449\u0435\u0433\u043e color.</p> <p>\u0412\u0430\u0440\u0438\u0430\u043d\u0442\u044b \u0432\u044b\u0447\u0438\u0441\u043b\u0435\u043d\u0438\u044f \u043f\u0443\u0442\u0438:</p> <ul> <li>\u041b\u043e\u043a\u0430\u043b\u044c\u043d\u043e (head-end \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442 \u0441\u0432\u043e\u044e TE topology database)</li> <li>\u0426\u0435\u043d\u0442\u0440\u0430\u043b\u0438\u0437\u043e\u0432\u0430\u043d\u043d\u043e (SR-PCE)</li> </ul>"},{"location":"networking/segment-routing/index.html#flexible-algorithm-flex-algo","title":"Flexible Algorithm (Flex-Algo)","text":"<p>IGP \u0432\u044b\u0447\u0438\u0441\u043b\u044f\u0435\u0442 \u0434\u043e\u043f\u043e\u043b\u043d\u0438\u0442\u0435\u043b\u044c\u043d\u044b\u0435 \u043f\u0443\u0442\u0438 \u043d\u0430 \u043e\u0441\u043d\u043e\u0432\u0435 \u043e\u0433\u0440\u0430\u043d\u0438\u0447\u0435\u043d\u0438\u0439. \u041f\u0440\u043e\u0441\u0442\u043e\u0439 TE \u0431\u0435\u0437 \u043a\u043e\u043d\u0442\u0440\u043e\u043b\u043b\u0435\u0440\u0430.</p> <p>Flex-Algo ID: 128-255 (\u0434\u043e 128 \u0430\u043b\u0433\u043e\u0440\u0438\u0442\u043c\u043e\u0432).</p> <p>\u041f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u044b:</p> <ul> <li>Calculation type: SPF \u0438\u043b\u0438 Strict SPF</li> <li>Metric type: IGP / delay / TE metric</li> <li>Constraints: affinity (include/exclude links), min bandwidth, max delay</li> </ul> <p>\u0412\u0441\u0435 \u0443\u0437\u043b\u044b \u0434\u043e\u043b\u0436\u043d\u044b \u0441\u043e\u0433\u043b\u0430\u0441\u043e\u0432\u0430\u0442\u044c \u043e\u043f\u0440\u0435\u0434\u0435\u043b\u0435\u043d\u0438\u0435 Flex-Algo (FAD). \u041e\u0434\u0438\u043d \u0443\u0437\u0435\u043b \u0430\u043d\u043e\u043d\u0441\u0438\u0440\u0443\u0435\u0442 FAD \u0441 \u043f\u0440\u0438\u043e\u0440\u0438\u0442\u0435\u0442\u043e\u043c.</p> <p>Prefix SID \u0434\u043b\u044f Flex-Algo \u043e\u0442\u043b\u0438\u0447\u0430\u0435\u0442\u0441\u044f \u043e\u0442 \u043e\u0431\u044b\u0447\u043d\u043e\u0433\u043e - \u0442\u0440\u0430\u0444\u0438\u043a \u0438\u0434\u0435\u0442 \u043f\u043e \u043f\u0443\u0442\u0438, \u0432\u044b\u0447\u0438\u0441\u043b\u0435\u043d\u043d\u043e\u043c\u0443 \u0441 \u043e\u0433\u0440\u0430\u043d\u0438\u0447\u0435\u043d\u0438\u044f\u043c\u0438.</p> <p>\u041f\u0440\u0438\u043c\u0435\u043d\u0435\u043d\u0438\u0435:</p> <ul> <li>Low-latency routing (metric type = delay)</li> <li>\u0418\u0441\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u0435 \u043e\u043f\u0440\u0435\u0434\u0435\u043b\u0435\u043d\u043d\u044b\u0445 \u043b\u0438\u043d\u043a\u043e\u0432 (affinity)</li> <li>\u0420\u0430\u0437\u0434\u0435\u043b\u0435\u043d\u0438\u0435 \u0442\u0440\u0430\u0444\u0438\u043a\u0430 \u043f\u043e \u0442\u0438\u043f\u0430\u043c \u0441\u0435\u0440\u0432\u0438\u0441\u043e\u0432</li> </ul>"},{"location":"networking/segment-routing/index.html#ti-lfa-fast-reroute","title":"TI-LFA (Fast Reroute)","text":"<p>Topology Independent Loop-Free Alternate - \u0437\u0430\u0449\u0438\u0442\u0430 \u043e\u0442 \u043e\u0442\u043a\u0430\u0437\u043e\u0432 &lt; 50ms.</p> <p>\u041f\u0440\u0435\u0438\u043c\u0443\u0449\u0435\u0441\u0442\u0432\u0430 \u043d\u0430\u0434 \u043a\u043b\u0430\u0441\u0441\u0438\u0447\u0435\u0441\u043a\u0438\u043c LFA/RLFA:</p> <ul> <li>100% \u043f\u043e\u043a\u0440\u044b\u0442\u0438\u0435 \u0432 \u043b\u044e\u0431\u043e\u0439 \u0442\u043e\u043f\u043e\u043b\u043e\u0433\u0438\u0438 (\u043d\u0435 \u0437\u0430\u0432\u0438\u0441\u0438\u0442 \u043e\u0442 \u0433\u0435\u043e\u043c\u0435\u0442\u0440\u0438\u0438 \u0441\u0435\u0442\u0438)</li> <li>\u041d\u0435 \u0442\u0440\u0435\u0431\u0443\u0435\u0442 LDP \u0434\u043b\u044f RLFA \u0442\u0443\u043d\u043d\u0435\u043b\u0435\u0439</li> <li>\u0412\u0441\u0435 SID \u0443\u0436\u0435 \u0432 LSDB \u043e\u0442 IGP</li> </ul> <p>\u041a\u0430\u043a \u0440\u0430\u0431\u043e\u0442\u0430\u0435\u0442:</p> <ul> <li>PLR (Point of Local Repair) \u0437\u0430\u0440\u0430\u043d\u0435\u0435 \u0432\u044b\u0447\u0438\u0441\u043b\u044f\u0435\u0442 backup path</li> <li>\u041f\u0440\u0438 \u043e\u0442\u043a\u0430\u0437\u0435 \u043b\u0438\u043d\u043a\u0430/\u0443\u0437\u043b\u0430 - \u043c\u0433\u043d\u043e\u0432\u0435\u043d\u043d\u043e\u0435 \u043f\u0435\u0440\u0435\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u0435 \u043d\u0430 backup</li> <li>Backup path \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442 SID-list \u0434\u043b\u044f \u043e\u0431\u0445\u043e\u0434\u0430 \u043e\u0442\u043a\u0430\u0437\u0430\u0432\u0448\u0435\u0433\u043e \u044d\u043b\u0435\u043c\u0435\u043d\u0442\u0430</li> </ul> <p>\u0417\u0430\u0449\u0438\u0442\u0430:</p> <ul> <li>Link protection</li> <li>Node protection</li> <li>SRLG protection (Shared Risk Link Group)</li> </ul>"},{"location":"networking/segment-routing/index.html#microloop-avoidance","title":"Microloop Avoidance","text":"<p>\u041f\u0440\u0435\u0434\u043e\u0442\u0432\u0440\u0430\u0449\u0435\u043d\u0438\u0435 \u043a\u0440\u0430\u0442\u043a\u043e\u0432\u0440\u0435\u043c\u0435\u043d\u043d\u044b\u0445 \u043f\u0435\u0442\u0435\u043b\u044c \u043f\u0440\u0438 \u043a\u043e\u043d\u0432\u0435\u0440\u0433\u0435\u043d\u0446\u0438\u0438 \u0441\u0435\u0442\u0438.</p> <p>Microloop \u0432\u043e\u0437\u043d\u0438\u043a\u0430\u0435\u0442 \u0438\u0437-\u0437\u0430 \u043d\u0435\u043e\u0434\u043d\u043e\u0432\u0440\u0435\u043c\u0435\u043d\u043d\u043e\u0439 \u043a\u043e\u043d\u0432\u0435\u0440\u0433\u0435\u043d\u0446\u0438\u0438 \u0440\u0430\u0437\u043d\u044b\u0445 \u0443\u0437\u043b\u043e\u0432 \u043f\u043e\u0441\u043b\u0435 \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u044f \u0442\u043e\u043f\u043e\u043b\u043e\u0433\u0438\u0438.</p> <p>\u041a\u0430\u043a \u0440\u0430\u0431\u043e\u0442\u0430\u0435\u0442:</p> <ul> <li>\u041f\u043e\u0441\u043b\u0435 \u0441\u043e\u0431\u044b\u0442\u0438\u044f (link down/up, metric change) \u0443\u0437\u0435\u043b \u0432\u044b\u0447\u0438\u0441\u043b\u044f\u0435\u0442 post-convergence path</li> <li>\u0415\u0441\u043b\u0438 \u0432\u043e\u0437\u043c\u043e\u0436\u0435\u043d microloop - \u0443\u0441\u0442\u0430\u043d\u0430\u0432\u043b\u0438\u0432\u0430\u0435\u0442 SID-list \u0434\u043b\u044f \u043e\u0431\u0445\u043e\u0434\u0430</li> <li>\u041f\u043e\u0441\u043b\u0435 \u0442\u0430\u0439\u043c\u0435\u0440\u0430 (\u043a\u043e\u0433\u0434\u0430 \u0432\u0441\u0435 \u0443\u0437\u043b\u044b \u0441\u043a\u043e\u043d\u0432\u0435\u0440\u0433\u0438\u0440\u043e\u0432\u0430\u043b\u0438\u0441\u044c) - \u043f\u0435\u0440\u0435\u043a\u043b\u044e\u0447\u0430\u0435\u0442\u0441\u044f \u043d\u0430 \u043e\u0431\u044b\u0447\u043d\u044b\u0439 \u043f\u0443\u0442\u044c</li> </ul> <p>\u0420\u0430\u0431\u043e\u0442\u0430\u0435\u0442 \u043b\u043e\u043a\u0430\u043b\u044c\u043d\u043e - \u043d\u0435 \u0442\u0440\u0435\u0431\u0443\u0435\u0442 \u043f\u043e\u0434\u0434\u0435\u0440\u0436\u043a\u0438 \u043d\u0430 \u0432\u0441\u0435\u0445 \u0443\u0437\u043b\u0430\u0445.</p>"},{"location":"networking/segment-routing/index.html#path-computation-element-pce","title":"Path Computation Element (PCE)","text":"<p>\u0426\u0435\u043d\u0442\u0440\u0430\u043b\u0438\u0437\u043e\u0432\u0430\u043d\u043d\u044b\u0439 \u043a\u043e\u043d\u0442\u0440\u043e\u043b\u043b\u0435\u0440 \u0434\u043b\u044f \u0432\u044b\u0447\u0438\u0441\u043b\u0435\u043d\u0438\u044f \u043f\u0443\u0442\u0435\u0439. \u0423\u0437\u043d\u0430\u0435\u0442 \u0442\u043e\u043f\u043e\u043b\u043e\u0433\u0438\u044e \u0447\u0435\u0440\u0435\u0437 IGP \u0438\u043b\u0438 BGP-LS.</p> <p>PCEP (Path Computation Element Protocol):</p> <ul> <li>TCP-based \u043f\u0440\u043e\u0442\u043e\u043a\u043e\u043b \u043c\u0435\u0436\u0434\u0443 PCC \u0438 PCE</li> <li>PCC (Path Computation Client) - \u043c\u0430\u0440\u0448\u0440\u0443\u0442\u0438\u0437\u0430\u0442\u043e\u0440, \u0437\u0430\u043f\u0440\u0430\u0448\u0438\u0432\u0430\u044e\u0449\u0438\u0439 \u043f\u0443\u0442\u044c</li> <li>PCE \u0432\u044b\u0447\u0438\u0441\u043b\u044f\u0435\u0442 \u0438 \u0438\u043d\u0438\u0446\u0438\u0438\u0440\u0443\u0435\u0442 SR-TE policy</li> </ul> <p>\u0421\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u044f PCEP:</p> <ul> <li>PCInitiate - PCE \u0438\u043d\u0438\u0446\u0438\u0438\u0440\u0443\u0435\u0442 policy \u043d\u0430 PCC</li> <li>PCRpt - PCC \u043e\u0442\u0447\u0438\u0442\u044b\u0432\u0430\u0435\u0442\u0441\u044f \u043e \u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u0438</li> <li>PCUpd - PCE \u043e\u0431\u043d\u043e\u0432\u043b\u044f\u0435\u0442 policy</li> <li>PCErr - \u043e\u0448\u0438\u0431\u043a\u0430</li> </ul> <p>SR-PCE \u043f\u043e\u0434\u0434\u0435\u0440\u0436\u0438\u0432\u0430\u0435\u0442 stateful \u0440\u0435\u0436\u0438\u043c: PCE \u0445\u0440\u0430\u043d\u0438\u0442 \u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u0435 \u0432\u0441\u0435\u0445 LSP \u0438 \u043c\u043e\u0436\u0435\u0442 \u0438\u0445 \u043c\u043e\u0434\u0438\u0444\u0438\u0446\u0438\u0440\u043e\u0432\u0430\u0442\u044c.</p>"},{"location":"networking/segment-routing/index.html#performance-measurement-pm","title":"Performance Measurement (PM)","text":"<p>\u0418\u0437\u043c\u0435\u0440\u0435\u043d\u0438\u0435 \u0445\u0430\u0440\u0430\u043a\u0442\u0435\u0440\u0438\u0441\u0442\u0438\u043a \u0441\u0435\u0442\u0438: delay, packet loss, jitter.</p> <p>\u041f\u0440\u043e\u0442\u043e\u043a\u043e\u043b\u044b:</p> <ul> <li>TWAMP-Light (RFC 5357) - IP/UDP encap, \u043f\u043e \u0443\u043c\u043e\u043b\u0447\u0430\u043d\u0438\u044e</li> <li>PM-MPLS (RFC 6374) - MPLS encap</li> </ul> <p>\u0420\u0435\u0436\u0438\u043c\u044b:</p> <ul> <li>Two-way delay (\u043f\u043e \u0443\u043c\u043e\u043b\u0447\u0430\u043d\u0438\u044e)</li> <li>One-way delay (\u0442\u0440\u0435\u0431\u0443\u0435\u0442 \u0441\u0438\u043d\u0445\u0440\u043e\u043d\u0438\u0437\u0430\u0446\u0438\u0438 PTP)</li> </ul> <p>\u041f\u0440\u0438\u043c\u0435\u043d\u0435\u043d\u0438\u0435:</p> <ul> <li>\u041c\u043e\u043d\u0438\u0442\u043e\u0440\u0438\u043d\u0433 SLA</li> <li>\u0412\u0445\u043e\u0434 \u0434\u043b\u044f Flex-Algo (metric type = delay)</li> <li>Troubleshooting \u0441\u0435\u0442\u0438</li> </ul> <p>\u0417\u0430\u043c\u0435\u043d\u044f\u0435\u0442 \u043e\u0442\u0434\u0435\u043b\u044c\u043d\u044b\u0435 \u043f\u0440\u043e\u0442\u043e\u043a\u043e\u043b\u044b \u043c\u043e\u043d\u0438\u0442\u043e\u0440\u0438\u043d\u0433\u0430 (BFD \u0434\u043b\u044f liveness + \u043e\u0442\u0434\u0435\u043b\u044c\u043d\u044b\u0439 PM).</p>"},{"location":"networking/segment-routing/index.html#srv6","title":"SRv6","text":"<p>Segment Routing \u043f\u043e\u0432\u0435\u0440\u0445 IPv6 data plane. SID = 128 \u0431\u0438\u0442 (IPv6 \u0430\u0434\u0440\u0435\u0441).</p> <p>\u0421\u0442\u0440\u0443\u043a\u0442\u0443\u0440\u0430 SID:</p> <ul> <li>Locator (\u043f\u0440\u0435\u0444\u0438\u043a\u0441, \u043c\u0430\u0440\u0448\u0440\u0443\u0442\u0438\u0437\u0438\u0440\u0443\u0435\u043c\u044b\u0439 \u043f\u043e IGP)</li> <li>Function (\u0438\u043d\u0441\u0442\u0440\u0443\u043a\u0446\u0438\u044f: End, End.X, End.DT4, \u0438 \u0442.\u0434.)</li> <li>Arguments (\u043e\u043f\u0446\u0438\u043e\u043d\u0430\u043b\u044c\u043d\u043e)</li> </ul> <p>\u041f\u0440\u0435\u0438\u043c\u0443\u0449\u0435\u0441\u0442\u0432\u0430:</p> <ul> <li>\u041d\u0430\u0442\u0438\u0432\u043d\u0430\u044f \u043f\u043e\u0434\u0434\u0435\u0440\u0436\u043a\u0430 \u0432 IPv6 \u0441\u0435\u0442\u044f\u0445</li> <li>Network Programming - \u0431\u043e\u0433\u0430\u0442\u044b\u0439 \u043d\u0430\u0431\u043e\u0440 \u0438\u043d\u0441\u0442\u0440\u0443\u043a\u0446\u0438\u0439</li> <li>\u041d\u0435 \u0442\u0440\u0435\u0431\u0443\u0435\u0442 MPLS</li> </ul> <p>Micro-SID (uSID):</p> <ul> <li>\u041a\u043e\u043c\u043f\u0430\u043a\u0442\u043d\u043e\u0435 \u043a\u043e\u0434\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435: \u0434\u043e 6 uSID \u0432 \u043e\u0434\u043d\u043e\u043c 128-\u0431\u0438\u0442 carrier</li> <li>uSID = 16 \u0431\u0438\u0442 (\u0432\u043c\u0435\u0441\u0442\u043e 128)</li> <li>\u041f\u0443\u0442\u044c \u0438\u0437 5 \u0445\u043e\u043f\u043e\u0432: 16 \u0431\u0430\u0439\u0442 \u0432\u043c\u0435\u0441\u0442\u043e 80 \u0431\u0430\u0439\u0442</li> <li>\u0415\u0441\u043b\u0438 &gt; 6 uSID - \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442\u0441\u044f SRH (Segment Routing Header)</li> </ul> <p>uSID Block - IPv6 \u043f\u0440\u0435\u0444\u0438\u043a\u0441 \u0434\u043b\u044f \u0431\u043b\u043e\u043a\u0430 micro-SID. uN - \u0431\u0430\u0437\u043e\u0432\u0430\u044f micro-\u0438\u043d\u0441\u0442\u0440\u0443\u043a\u0446\u0438\u044f: shortest path + \u0430\u043a\u0442\u0438\u0432\u0430\u0446\u0438\u044f \u0441\u043b\u0435\u0434\u0443\u044e\u0449\u0435\u0433\u043e uSID.</p>"},{"location":"networking/segment-routing/index.html#vpn-services-sr","title":"VPN Services \u043f\u043e\u0432\u0435\u0440\u0445 SR","text":"<p>L3VPN (VPNv4/VPNv6):</p> <p>\u041a\u043e\u043d\u0444\u0438\u0433\u0443\u0440\u0430\u0446\u0438\u044f \u043d\u0435 \u043e\u0442\u043b\u0438\u0447\u0430\u0435\u0442\u0441\u044f \u043e\u0442 \u043a\u043b\u0430\u0441\u0441\u0438\u0447\u0435\u0441\u043a\u043e\u0433\u043e MPLS:</p> <ul> <li>VRF \u043d\u0430 PE</li> <li>MP-BGP \u0434\u043b\u044f VPNv4 \u043c\u0435\u0436\u0434\u0443 PE (\u043d\u0430\u043f\u0440\u044f\u043c\u0443\u044e \u0438\u043b\u0438 \u0447\u0435\u0440\u0435\u0437 RR)</li> <li>\u0422\u0440\u0430\u043d\u0441\u043f\u043e\u0440\u0442\u043d\u044b\u0435 \u043c\u0435\u0442\u043a\u0438 - SR \u0432\u043c\u0435\u0441\u0442\u043e LDP</li> </ul> <p>L2VPN:</p> <ul> <li>VPWS (point-to-point pseudowire)</li> <li>VPLS (multipoint, flooding/learning)</li> <li>EVPN (control plane learning \u0447\u0435\u0440\u0435\u0437 BGP)</li> </ul> <p>L2VPN \u0441\u0435\u0440\u0432\u0438\u0441\u044b \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u044e\u0442 SR-TE policy \u0447\u0435\u0440\u0435\u0437 preferred-path.</p> <p>EVPN \u043d\u0430\u0434 SR-MPLS/SRv6 - \u0441\u043e\u0432\u0440\u0435\u043c\u0435\u043d\u043d\u044b\u0439 \u043f\u043e\u0434\u0445\u043e\u0434 \u0434\u043b\u044f DC \u0438 SP \u0441\u0435\u0442\u0435\u0439.</p>"},{"location":"networking/segment-routing/index.html#inter-domain-sr","title":"Inter-Domain SR","text":"<p>\u0421\u0446\u0435\u043d\u0430\u0440\u0438\u0438 \u0434\u043b\u044f multi-area/multi-AS:</p> <p>Option A - back-to-back VRF \u043d\u0430 ASBR</p> <p>Option B - \u043e\u0431\u043c\u0435\u043d labeled VPN routes \u043c\u0435\u0436\u0434\u0443 ASBR</p> <p>Option C - \u043e\u0431\u043c\u0435\u043d loopback \u0447\u0435\u0440\u0435\u0437 BGP-LU + VPNv4 \u0447\u0435\u0440\u0435\u0437 RR - BGP Prefix SID \u043e\u0431\u0435\u0441\u043f\u0435\u0447\u0438\u0432\u0430\u0435\u0442 \u0441\u043a\u0432\u043e\u0437\u043d\u043e\u0439 LSP - \u041a\u0430\u0436\u0434\u044b\u0439 \u0434\u043e\u043c\u0435\u043d \u0438\u043c\u0435\u0435\u0442 \u0441\u0432\u043e\u0439 SRGB</p> <p>Unified MPLS / Seamless MPLS - end-to-end SR \u0447\u0435\u0440\u0435\u0437 \u043d\u0435\u0441\u043a\u043e\u043b\u044c\u043a\u043e IGP \u0434\u043e\u043c\u0435\u043d\u043e\u0432.</p>"},{"location":"networking/segment-routing/index.html#ldp","title":"\u041c\u0438\u0433\u0440\u0430\u0446\u0438\u044f \u0441 LDP","text":"<p>SR \u0441\u043e\u0432\u043c\u0435\u0441\u0442\u0438\u043c \u0441 LDP. \u0412\u0430\u0440\u0438\u0430\u043d\u0442\u044b \u043c\u0438\u0433\u0440\u0430\u0446\u0438\u0438:</p> <p>SR Prefer:</p> <ul> <li>\u0415\u0441\u043b\u0438 \u0435\u0441\u0442\u044c \u0438 SR label \u0438 LDP label \u0434\u043b\u044f \u043f\u0440\u0435\u0444\u0438\u043a\u0441\u0430 - \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442\u0441\u044f SR</li> <li>\u041f\u043e\u0437\u0432\u043e\u043b\u044f\u0435\u0442 \u043f\u043e\u0441\u0442\u0435\u043f\u0435\u043d\u043d\u0443\u044e \u043c\u0438\u0433\u0440\u0430\u0446\u0438\u044e</li> </ul> <p>Mapping Server:</p> <ul> <li>\u0410\u043d\u043e\u043d\u0441\u0438\u0440\u0443\u0435\u0442 SID \u0434\u043b\u044f \u043f\u0440\u0435\u0444\u0438\u043a\u0441\u043e\u0432 \u043e\u0442 LDP-only \u0443\u0437\u043b\u043e\u0432</li> <li>\u041f\u043e\u0437\u0432\u043e\u043b\u044f\u0435\u0442 SR \u0443\u0437\u043b\u0430\u043c \u0434\u043e\u0441\u0442\u0438\u0433\u0430\u0442\u044c LDP \u0443\u0437\u043b\u043e\u0432</li> </ul>"},{"location":"networking/segment-routing/index.html#_3","title":"\u0421\u0442\u0430\u043d\u0434\u0430\u0440\u0442\u044b","text":"<ul> <li>RFC 8402 - Segment Routing Architecture</li> <li>RFC 8660 - Segment Routing with MPLS Data Plane</li> <li>RFC 8667 - IS-IS Extensions for Segment Routing</li> <li>RFC 8665 - OSPF Extensions for Segment Routing</li> <li>RFC 8664 - PCEP Extensions for Segment Routing</li> <li>RFC 9256 - Segment Routing Policy Architecture</li> <li>RFC 9862 - PCEP Extensions for SR Policy Candidate Paths</li> <li>RFC 9855 - TI-LFA using Segment Routing</li> <li>RFC 8986 - SRv6 Network Programming</li> </ul>"},{"location":"networking/segment-routing/srv6.html","title":"SRv6","text":""},{"location":"networking/segment-routing/srv6.html#srv6","title":"SRv6","text":""},{"location":"networking/segment-routing/srv6.html#_1","title":"\u041a\u043e\u0440\u043e\u0442\u043a\u043e","text":"<p>SRv6 - \u0440\u0435\u0430\u043b\u0438\u0437\u0430\u0446\u0438\u044f Segment Routing \u043d\u0430 IPv6. SID - \u044d\u0442\u043e 128-\u0431\u0438\u0442\u043d\u044b\u0439 IPv6 \u0430\u0434\u0440\u0435\u0441, \u043a\u043e\u0442\u043e\u0440\u044b\u0439 \u043e\u0434\u043d\u043e\u0432\u0440\u0435\u043c\u0435\u043d\u043d\u043e \u0438 \u0430\u0434\u0440\u0435\u0441 \u0443\u0437\u043b\u0430, \u0438 \u0438\u043d\u0441\u0442\u0440\u0443\u043a\u0446\u0438\u044f. Underlay - \u0447\u0438\u0441\u0442\u044b\u0439 IPv6 \u0441 IGP (IS-IS). Overlay - VPN \u0441\u0435\u0440\u0432\u0438\u0441\u044b \u0447\u0435\u0440\u0435\u0437 BGP.</p> <p>\u041d\u0435\u0442 MPLS. \u041d\u0435\u0442 LDP. \u041e\u0434\u0438\u043d \u043f\u0440\u043e\u0442\u043e\u043a\u043e\u043b \u0434\u043b\u044f transport \u0438 services.</p>"},{"location":"networking/segment-routing/srv6.html#sid","title":"\u0421\u0442\u0440\u0443\u043a\u0442\u0443\u0440\u0430 SID","text":"Text Only<pre><code>|&lt;-- Locator (L) --&gt;|&lt;-- Function (F) --&gt;|&lt;-- Args (A) --&gt;|\n</code></pre> <p>Locator - \u043c\u0430\u0440\u0448\u0440\u0443\u0442\u0438\u0437\u0438\u0440\u0443\u0435\u043c\u044b\u0439 IPv6 \u043f\u0440\u0435\u0444\u0438\u043a\u0441 (/48 \u0438\u043b\u0438 /64). IGP \u0437\u043d\u0430\u0435\u0442 \u043a\u0430\u043a \u0434\u043e\u0439\u0442\u0438 \u0434\u043e locator.</p> <p>Function - \u0447\u0442\u043e \u0434\u0435\u043b\u0430\u0442\u044c \u043a\u043e\u0433\u0434\u0430 \u0434\u043e\u0448\u043b\u0438. 16-32 \u0431\u0438\u0442\u0430. End.DT4, End.DX2 \u0438 \u0442.\u0434.</p> <p>Args - \u0434\u043e\u043f\u043e\u043b\u043d\u0438\u0442\u0435\u043b\u044c\u043d\u044b\u0435 \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u044b. \u041e\u0431\u044b\u0447\u043d\u043e \u043d\u0435 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442\u0441\u044f.</p> <p>Locator \u0441\u043e\u0441\u0442\u043e\u0438\u0442 \u0438\u0437 Block (\u0430\u0434\u0440\u0435\u0441\u043d\u043e\u0435 \u043f\u0440\u043e\u0441\u0442\u0440\u0430\u043d\u0441\u0442\u0432\u043e \u0434\u043e\u043c\u0435\u043d\u0430) \u0438 Node ID.</p>"},{"location":"networking/segment-routing/srv6.html#_2","title":"\u0410\u0434\u0440\u0435\u0441\u043d\u044b\u0439 \u043f\u043b\u0430\u043d","text":"<p>\u0422\u0438\u043f\u0438\u0447\u043d\u044b\u0439 \u0444\u043e\u0440\u043c\u0430\u0442 (F3216):</p> Text Only<pre><code>BBBB:BBBF:SSNN::/48\n\nB - block \u043e\u0440\u0433\u0430\u043d\u0438\u0437\u0430\u0446\u0438\u0438 (28 \u0431\u0438\u0442)\nF - Flex-Algo (4 \u0431\u0438\u0442\u0430, \u0435\u0441\u043b\u0438 \u043d\u0443\u0436\u0435\u043d)\nS - Set/POD (8 \u0431\u0438\u0442)\nN - Node (8 \u0431\u0438\u0442)\n</code></pre> <p>\u0413\u043b\u0430\u0432\u043d\u043e\u0435 - \u043f\u043b\u0430\u043d\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0441\u0443\u043c\u043c\u0430\u0440\u0438\u0437\u0430\u0446\u0438\u044e. \u041d\u0430 \u0433\u0440\u0430\u043d\u0438\u0446\u0435 POD \u0430\u043d\u043e\u043d\u0441\u0438\u0440\u0443\u0435\u0442\u0441\u044f \u043e\u0434\u0438\u043d /48 \u0432\u043c\u0435\u0441\u0442\u043e \u0441\u043e\u0442\u0435\u043d /64 \u043e\u0442 \u043a\u0430\u0436\u0434\u043e\u0433\u043e \u0443\u0437\u043b\u0430.</p>"},{"location":"networking/segment-routing/srv6.html#srh","title":"SRH","text":"<p>Segment Routing Header - extension header \u0434\u043b\u044f \u0441\u043f\u0438\u0441\u043a\u0430 \u0441\u0435\u0433\u043c\u0435\u043d\u0442\u043e\u0432.</p> <p>Segments Left (SL) - \u0441\u043a\u043e\u043b\u044c\u043a\u043e \u0441\u0435\u0433\u043c\u0435\u043d\u0442\u043e\u0432 \u043e\u0441\u0442\u0430\u043b\u043e\u0441\u044c. Segment List - \u043c\u0430\u0441\u0441\u0438\u0432 SID.</p> <p>\u0410\u043a\u0442\u0438\u0432\u043d\u044b\u0439 \u0441\u0435\u0433\u043c\u0435\u043d\u0442 \u043b\u0435\u0436\u0438\u0442 \u0432 DA \u043f\u0430\u043a\u0435\u0442\u0430. \u0423\u0437\u0435\u043b \u043e\u0431\u0440\u0430\u0431\u0430\u0442\u044b\u0432\u0430\u0435\u0442, \u0443\u043c\u0435\u043d\u044c\u0448\u0430\u0435\u0442 SL, \u043a\u043e\u043f\u0438\u0440\u0443\u0435\u0442 \u0441\u043b\u0435\u0434\u0443\u044e\u0449\u0438\u0439 SID \u0432 DA.</p> <p>\u0415\u0441\u043b\u0438 \u043f\u0443\u0442\u044c \u0438\u0437 \u043e\u0434\u043d\u043e\u0433\u043e \u0441\u0435\u0433\u043c\u0435\u043d\u0442\u0430 - SRH \u0432\u043e\u043e\u0431\u0449\u0435 \u043d\u0435 \u043d\u0443\u0436\u0435\u043d, \u0445\u0432\u0430\u0442\u0430\u0435\u0442 DA.</p>"},{"location":"networking/segment-routing/srv6.html#behaviors","title":"Behaviors","text":""},{"location":"networking/segment-routing/srv6.html#headend","title":"\u041d\u0430 \u0432\u0445\u043e\u0434\u0435 (Headend)","text":"<p>H.Encaps - \u0434\u043e\u0431\u0430\u0432\u043b\u044f\u0435\u0442 \u0432\u043d\u0435\u0448\u043d\u0438\u0439 IPv6 header \u0438 SRH. \u041e\u0440\u0438\u0433\u0438\u043d\u0430\u043b\u044c\u043d\u044b\u0439 \u043f\u0430\u043a\u0435\u0442 \u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u0441\u044f payload.</p> <p>H.Encaps.Red - \u0442\u043e \u0436\u0435 \u0441\u0430\u043c\u043e\u0435, \u043d\u043e \u043f\u0435\u0440\u0432\u044b\u0439 SID \u043d\u0435 \u0434\u0443\u0431\u043b\u0438\u0440\u0443\u0435\u0442\u0441\u044f \u0432 SRH (\u0442\u043e\u043b\u044c\u043a\u043e \u0432 DA). \u042d\u043a\u043e\u043d\u043e\u043c\u0438\u0442 16 \u0431\u0430\u0439\u0442.</p> <p>H.Encaps.L2 - \u0434\u043b\u044f L2 \u0444\u0440\u0435\u0439\u043c\u043e\u0432.</p>"},{"location":"networking/segment-routing/srv6.html#_3","title":"\u0422\u0440\u0430\u043d\u0437\u0438\u0442","text":"<p>End - \u0431\u0430\u0437\u043e\u0432\u044b\u0439. \u041e\u0431\u043d\u043e\u0432\u043b\u044f\u0435\u0442 SL \u0438 DA, forwarding \u0434\u0430\u043b\u044c\u0448\u0435.</p> <p>End.X - \u0442\u043e \u0436\u0435 + \u0444\u043e\u0440\u0441\u0438\u0440\u0443\u0435\u0442 \u043a\u043e\u043d\u043a\u0440\u0435\u0442\u043d\u044b\u0439 nexthop (\u043a\u0430\u043a Adjacency SID).</p>"},{"location":"networking/segment-routing/srv6.html#l3vpn","title":"L3VPN","text":"<p>End.DT4 - \u0441\u043d\u0438\u043c\u0430\u0435\u0442 \u0432\u043d\u0435\u0448\u043d\u0438\u0439 IPv6, \u0434\u0435\u043b\u0430\u0435\u0442 lookup \u0432 IPv4 VRF. \u0410\u043d\u0430\u043b\u043e\u0433 per-VRF label.</p> <p>End.DT6 - \u0442\u043e \u0436\u0435 \u0434\u043b\u044f IPv6 VRF.</p> <p>End.DT46 - \u043e\u0434\u0438\u043d SID \u0434\u043b\u044f dual-stack VRF. \u0421\u043c\u043e\u0442\u0440\u0438\u0442 inner protocol.</p>"},{"location":"networking/segment-routing/srv6.html#l2vpn","title":"L2VPN","text":"<p>End.DX2 - \u0441\u043d\u0438\u043c\u0430\u0435\u0442 IPv6, \u0432\u044b\u0434\u0430\u0435\u0442 L2 frame \u043d\u0430 \u043a\u043e\u043d\u043a\u0440\u0435\u0442\u043d\u044b\u0439 AC. \u0414\u043b\u044f VPWS.</p> <p>End.DT2U - \u0441\u043d\u0438\u043c\u0430\u0435\u0442 IPv6, MAC lookup \u0432 bridge table. \u0414\u043b\u044f ELAN unicast.</p> <p>End.DT2M - \u0434\u043b\u044f BUM \u0442\u0440\u0430\u0444\u0438\u043a\u0430.</p>"},{"location":"networking/segment-routing/srv6.html#micro-sid","title":"Micro-SID","text":"<p>\u041f\u0440\u043e\u0431\u043b\u0435\u043c\u0430 \u043f\u043e\u043b\u043d\u044b\u0445 SID - overhead. 5 \u0445\u043e\u043f\u043e\u0432 = 80 \u0431\u0430\u0439\u0442 SID-\u043b\u0438\u0441\u0442\u0430.</p> <p>uSID - \u043a\u043e\u043c\u043f\u0440\u0435\u0441\u0441\u0438\u044f. \u0412 \u043e\u0434\u0438\u043d 128-\u0431\u0438\u0442\u043d\u044b\u0439 carrier \u0432\u043b\u0435\u0437\u0430\u0435\u0442 \u0434\u043e 6 \u043c\u0438\u043a\u0440\u043e-SID \u043f\u043e 16 \u0431\u0438\u0442.</p> Text Only<pre><code>|&lt;-- Block 32 --&gt;|&lt;-- uSID1 16 --&gt;|&lt;-- uSID2 16 --&gt;|...|\n</code></pre> <p>\u0422\u0435 \u0436\u0435 5 \u0445\u043e\u043f\u043e\u0432 = 16 \u0431\u0430\u0439\u0442.</p> <p>uN behavior - \u0441\u0434\u0432\u0438\u0433\u0430\u0435\u0442 uSID \u0432\u043b\u0435\u0432\u043e \u0438 \u0434\u0435\u043b\u0430\u0435\u0442 lookup \u043f\u043e \u043d\u043e\u0432\u043e\u043c\u0443 DA.</p> <p>\u0415\u0441\u043b\u0438 \u0431\u043e\u043b\u044c\u0448\u0435 6 uSID - \u0434\u043e\u0431\u0430\u0432\u043b\u044f\u0435\u0442\u0441\u044f SRH \u0441 \u0434\u043e\u043f\u043e\u043b\u043d\u0438\u0442\u0435\u043b\u044c\u043d\u044b\u043c\u0438 carriers.</p>"},{"location":"networking/segment-routing/srv6.html#l3vpn_1","title":"L3VPN","text":"<p>Underlay: IS-IS \u0430\u043d\u043e\u043d\u0441\u0438\u0440\u0443\u0435\u0442 locators.</p> <p>Overlay: MP-BGP VPNv4/VPNv6 \u043c\u0435\u0436\u0434\u0443 PE.</p> <p>\u041d\u0430 PE \u0441\u043e\u0437\u0434\u0430\u0435\u0442\u0441\u044f VRF, \u043d\u0430\u0437\u043d\u0430\u0447\u0430\u0435\u0442\u0441\u044f locator, \u0430\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0438 \u0430\u043b\u043b\u043e\u0446\u0438\u0440\u0443\u0435\u0442\u0441\u044f End.DT4/DT6 SID.</p> <p>\u041f\u0443\u0442\u044c \u043f\u0430\u043a\u0435\u0442\u0430:</p> Text Only<pre><code>CE -&gt; Ingress PE: VRF lookup, \u043d\u0430\u0445\u043e\u0434\u0438\u0442 remote PE\nIngress PE: H.Encaps, DA = End.DT4 SID \u0443\u0434\u0430\u043b\u0435\u043d\u043d\u043e\u0433\u043e PE\nTransit P: \u043e\u0431\u044b\u0447\u043d\u044b\u0439 IPv6 forwarding \u043f\u043e DA (\u044d\u0442\u043e \u0436\u0435 locator prefix)\nEgress PE: \u0432\u0438\u0434\u0438\u0442 \u0441\u0432\u043e\u0439 End.DT4, decap, lookup \u0432 VRF\nEgress PE -&gt; CE\n</code></pre>"},{"location":"networking/segment-routing/srv6.html#evpn","title":"EVPN","text":"<p>VPWS (E-Line) - point-to-point. EVPN Type 1 route \u043d\u0435\u0441\u0435\u0442 End.DX2 SID.</p> <p>ELAN (E-LAN) - multipoint. EVPN Type 2 (MAC/IP) \u043d\u0435\u0441\u0435\u0442 End.DT2U SID. MAC learning \u0447\u0435\u0440\u0435\u0437 BGP, \u043d\u0435 flooding.</p> <p>IRB - L2 \u0438 L3 \u0432\u043c\u0435\u0441\u0442\u0435. End.DT2U \u0434\u043b\u044f bridging \u0432\u043d\u0443\u0442\u0440\u0438 VLAN, End.DT46 \u0434\u043b\u044f routing \u043c\u0435\u0436\u0434\u0443 VLAN. Anycast gateway \u043d\u0430 \u0432\u0441\u0435\u0445 leaf.</p>"},{"location":"networking/segment-routing/srv6.html#dc-fabric","title":"DC Fabric","text":"<p>Spine-Leaf \u0430\u0440\u0445\u0438\u0442\u0435\u043a\u0442\u0443\u0440\u0430.</p> <p>Spine - \u0447\u0438\u0441\u0442\u044b\u0439 P router. IPv6 forwarding, IS-IS \u0441 SRv6, \u043d\u0438\u043a\u0430\u043a\u0438\u0445 VRF.</p> <p>Leaf - PE router. VRF \u0434\u043b\u044f \u0442\u0435\u043d\u0430\u043d\u0442\u043e\u0432, locator, BGP EVPN \u0441 \u0434\u0440\u0443\u0433\u0438\u043c\u0438 leaf.</p> <p>Locators:</p> Text Only<pre><code>Leaf-1: 2001:db8:0:1::/64\nLeaf-2: 2001:db8:0:2::/64\nLeaf-3: 2001:db8:0:3::/64\n</code></pre> <p>Spine \u0432\u0438\u0434\u0438\u0442 summary 2001:db8::/48 \u0438 locator \u043a\u0430\u0436\u0434\u043e\u0433\u043e leaf.</p> <p>\u041a\u0430\u0436\u0434\u044b\u0439 VRF \u043d\u0430 leaf \u043f\u043e\u043b\u0443\u0447\u0430\u0435\u0442 \u0441\u0432\u043e\u0439 function:</p> Text Only<pre><code>Leaf-1, Tenant-A: 2001:db8:0:1::100 (End.DT46)\nLeaf-1, Tenant-B: 2001:db8:0:1::200 (End.DT46)\n</code></pre>"},{"location":"networking/segment-routing/srv6.html#dci","title":"DCI","text":"<p>\u0412\u0430\u0440\u0438\u0430\u043d\u0442 1 - SRv6 core \u043c\u0435\u0436\u0434\u0443 DC:</p> Text Only<pre><code>DC-1 Fabric &lt;-&gt; SRv6 WAN &lt;-&gt; DC-2 Fabric\n</code></pre> <p>Border leaf \u0430\u043d\u043e\u043d\u0441\u0438\u0440\u0443\u0435\u0442 EVPN routes \u0432 core. End-to-end SRv6, \u043d\u0438\u043a\u0430\u043a\u0438\u0445 gateway.</p> <p>\u0412\u0430\u0440\u0438\u0430\u043d\u0442 2 - DC \u043d\u0430 VXLAN, core \u043d\u0430 SRv6:</p> Text Only<pre><code>VXLAN Fabric &lt;-&gt; BorderPE &lt;-&gt; SRv6 Core\n</code></pre> <p>BorderPE \u0442\u0435\u0440\u043c\u0438\u043d\u0438\u0440\u0443\u0435\u0442 VXLAN, \u0438\u043c\u043f\u043e\u0440\u0442\u0438\u0440\u0443\u0435\u0442 routes \u0432 VRF, \u0440\u0435\u0430\u043d\u043e\u043d\u0441\u0438\u0440\u0443\u0435\u0442 \u0432 L3VPN SRv6.</p>"},{"location":"networking/segment-routing/srv6.html#best-practices","title":"Best Practices","text":""},{"location":"networking/segment-routing/srv6.html#_4","title":"\u0410\u0434\u0440\u0435\u0441\u0430\u0446\u0438\u044f","text":"<ul> <li>\u0412\u044b\u0434\u0435\u043b\u0438\u0442\u044c \u043c\u0438\u043d\u0438\u043c\u0443\u043c /32 block \u043f\u043e\u0434 SRv6 (\u043b\u0443\u0447\u0448\u0435 /28 \u0441 \u0437\u0430\u043f\u0430\u0441\u043e\u043c)</li> <li>\u0417\u0430\u0440\u0435\u0437\u0435\u0440\u0432\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u043e\u0434\u0438\u043d nibble (4 \u0431\u0438\u0442\u0430) \u043f\u043e\u0434 Flex-Algo ID</li> <li>Flex-Algo \u043a\u043e\u0434\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0432 \u0441\u0442\u0430\u0440\u0448\u0438\u0445 \u0431\u0438\u0442\u0430\u0445 - \u0442\u0430\u043a \u043f\u0440\u043e\u0449\u0435 \u0441\u0443\u043c\u043c\u0430\u0440\u0438\u0437\u0430\u0446\u0438\u044f</li> <li>\u041f\u043b\u0430\u043d\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0438\u0435\u0440\u0430\u0440\u0445\u0438\u044e: Block -&gt; Region -&gt; POD -&gt; Node</li> <li>\u041d\u0430 \u0433\u0440\u0430\u043d\u0438\u0446\u0435 POD \u0441\u0443\u043c\u043c\u0430\u0440\u0438\u0437\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0434\u043e /48</li> </ul> <p>\u041f\u0440\u0438\u043c\u0435\u0440 \u0438\u0435\u0440\u0430\u0440\u0445\u0438\u0438:</p> Text Only<pre><code>2001:db8::/32        - \u0432\u0435\u0441\u044c SRv6 \u0434\u043e\u043c\u0435\u043d\n2001:db8:0::/40      - Flex-Algo 0 (default)\n2001:db8:1::/40      - Flex-Algo 1 (low-latency)\n2001:db8:0:10::/48   - POD-1\n2001:db8:0:10:1::/64 - Leaf-1 \u0432 POD-1\n</code></pre>"},{"location":"networking/segment-routing/srv6.html#locators","title":"Locators","text":"<ul> <li>/48 \u0434\u043b\u044f uSID, /64 \u0434\u043b\u044f full-length SID</li> <li>\u041e\u0434\u0438\u043d\u0430\u043a\u043e\u0432\u0430\u044f \u0434\u043b\u0438\u043d\u0430 locator \u0432\u043e \u0432\u0441\u0435\u043c \u0434\u043e\u043c\u0435\u043d\u0435</li> <li>\u041e\u0434\u0438\u043d locator \u043d\u0430 Flex-Algo (\u0440\u0430\u0437\u043d\u044b\u0435 \u043f\u0443\u0442\u0438 - \u0440\u0430\u0437\u043d\u044b\u0435 locators)</li> <li>\u041d\u0435 \u043c\u0435\u043d\u044f\u0442\u044c locator \u043f\u043e\u0441\u043b\u0435 \u0434\u0435\u043f\u043b\u043e\u044f (\u043b\u043e\u043c\u0430\u0435\u0442 \u0432\u0441\u0435 SID)</li> </ul>"},{"location":"networking/segment-routing/srv6.html#function-allocation","title":"Function Allocation","text":"<ul> <li>\u0420\u0430\u0437\u0434\u0435\u043b\u0438\u0442\u044c function space \u043d\u0430 static \u0438 dynamic ranges</li> <li>Static (\u043d\u0430\u043f\u0440\u0438\u043c\u0435\u0440 0x0001-0x00FF) - \u0434\u043b\u044f manually assigned SID</li> <li>Dynamic (0x0100-0xFFFF) - \u0434\u043b\u044f auto-allocated (VRF, EVPN)</li> <li>\u0414\u043e\u043a\u0443\u043c\u0435\u043d\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c static assignments</li> </ul>"},{"location":"networking/segment-routing/srv6.html#underlay","title":"Underlay","text":"<ul> <li>IS-IS \u043f\u0440\u0435\u0434\u043f\u043e\u0447\u0442\u0438\u0442\u0435\u043b\u044c\u043d\u0435\u0435 OSPF (\u043b\u0443\u0447\u0448\u0435 SRv6 extensions, TLV flexibility)</li> <li>\u041e\u0442\u0434\u0435\u043b\u044c\u043d\u044b\u0439 IS-IS process/instance \u0434\u043b\u044f SRv6 (\u043d\u0435 \u043c\u0435\u0448\u0430\u0442\u044c \u0441 legacy)</li> <li>TI-LFA \u043d\u0430 \u0432\u0441\u0435\u0445 \u0438\u043d\u0442\u0435\u0440\u0444\u0435\u0439\u0441\u0430\u0445</li> <li>BFD \u0441 aggressive timers (50ms x 3)</li> <li>Micro-loop avoidance \u0435\u0441\u043b\u0438 \u0431\u043e\u043b\u044c\u0448\u043e\u0439 \u0434\u043e\u043c\u0435\u043d</li> </ul>"},{"location":"networking/segment-routing/srv6.html#overlay","title":"Overlay","text":"<ul> <li>BGP EVPN \u0434\u043b\u044f L2/L3 services</li> <li>\u041c\u0438\u043d\u0438\u043c\u0443\u043c 2 Route Reflector (redundancy)</li> <li>RR \u0432 \u043e\u0442\u0434\u0435\u043b\u044c\u043d\u043e\u0439 plane \u043e\u0442 data traffic</li> <li>RT-based filtering - import \u0442\u043e\u043b\u044c\u043a\u043e \u043d\u0443\u0436\u043d\u044b\u0435 VRF</li> <li>\u041d\u0435 \u0430\u043d\u043e\u043d\u0441\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0432\u0441\u0435 \u0432\u043e \u0432\u0441\u0435 (full mesh RT = \u043f\u0440\u043e\u0431\u043b\u0435\u043c\u044b)</li> </ul>"},{"location":"networking/segment-routing/srv6.html#mtu","title":"MTU","text":"<ul> <li>\u0411\u0430\u0437\u043e\u0432\u044b\u0439 overhead: IPv6 header 40 \u0431\u0430\u0439\u0442</li> <li>SRH: 8 \u0431\u0430\u0439\u0442 header + 16 \u0431\u0430\u0439\u0442 \u043d\u0430 \u043a\u0430\u0436\u0434\u044b\u0439 SID</li> <li>\u0421 uSID: 8 \u0431\u0430\u0439\u0442 header + 16 \u0431\u0430\u0439\u0442 carrier (\u0434\u043e 6 uSID)</li> <li>\u041f\u043b\u0430\u043d\u0438\u0440\u043e\u0432\u0430\u0442\u044c MTU 9216 \u043d\u0430 fabric, 9000 \u043a \u0441\u0435\u0440\u0432\u0435\u0440\u0430\u043c</li> <li>\u041f\u0440\u043e\u0432\u0435\u0440\u044f\u0442\u044c path MTU \u0434\u043e \u0432\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u044f \u0441\u0435\u0440\u0432\u0438\u0441\u043e\u0432</li> </ul>"},{"location":"networking/segment-routing/srv6.html#_5","title":"\u041c\u043e\u043d\u0438\u0442\u043e\u0440\u0438\u043d\u0433","text":"<ul> <li>Performance Measurement \u0434\u043b\u044f delay/loss \u043d\u0430 SRv6 paths</li> <li>Delay metrics \u043a\u0430\u043a input \u0434\u043b\u044f Flex-Algo</li> <li>TWAMP-Light \u043c\u0435\u0436\u0434\u0443 PE \u0434\u043b\u044f SLA \u043c\u043e\u043d\u0438\u0442\u043e\u0440\u0438\u043d\u0433\u0430</li> <li>\u041e\u0442\u0441\u043b\u0435\u0436\u0438\u0432\u0430\u0442\u044c SID allocation (\u043d\u0435 \u0437\u0430\u043a\u043e\u043d\u0447\u0438\u043b\u0441\u044f \u043b\u0438 function range)</li> </ul>"},{"location":"networking/segment-routing/srv6.html#rfc","title":"RFC","text":"<ul> <li>RFC 8986 - SRv6 Network Programming</li> <li>RFC 8754 - Segment Routing Header</li> <li>RFC 9252 - BGP Overlay Services over SRv6</li> <li>RFC 9602 - SRv6 SID Addressing</li> </ul>"},{"location":"networking/tcp/index.html","title":"TCP","text":""},{"location":"networking/tcp/index.html#tcp","title":"TCP","text":""},{"location":"networking/tcp/index.html#_1","title":"\u041a\u043e\u0440\u043e\u0442\u043a\u043e","text":"<p>Transmission Control Protocol - \u043d\u0430\u0434\u0435\u0436\u043d\u044b\u0439 \u0442\u0440\u0430\u043d\u0441\u043f\u043e\u0440\u0442\u043d\u044b\u0439 \u043f\u0440\u043e\u0442\u043e\u043a\u043e\u043b \u0441 \u0433\u0430\u0440\u0430\u043d\u0442\u0438\u0435\u0439 \u0434\u043e\u0441\u0442\u0430\u0432\u043a\u0438 \u0438 \u043f\u043e\u0440\u044f\u0434\u043a\u0430. \u0418\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442 \u0441\u043e\u0435\u0434\u0438\u043d\u0435\u043d\u0438\u044f (connection-oriented), \u043f\u043e\u0434\u0442\u0432\u0435\u0440\u0436\u0434\u0435\u043d\u0438\u044f (ACK), \u043a\u043e\u043d\u0442\u0440\u043e\u043b\u044c \u043f\u043e\u0442\u043e\u043a\u0430 (flow control) \u0438 \u043a\u043e\u043d\u0442\u0440\u043e\u043b\u044c \u043f\u0435\u0440\u0435\u0433\u0440\u0443\u0437\u043e\u043a (congestion control). \u041e\u043f\u0440\u0435\u0434\u0435\u043b\u0435\u043d \u0432 RFC 793 (1981), \u0430\u043a\u0442\u0443\u0430\u043b\u044c\u043d\u0430\u044f \u0432\u0435\u0440\u0441\u0438\u044f - RFC 9293.</p>"},{"location":"networking/tcp/index.html#tcp_1","title":"\u0417\u0430\u0433\u043e\u043b\u043e\u0432\u043e\u043a TCP","text":"Text Only<pre><code> 0                   1                   2                   3\n 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1\n+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n|          Source Port          |       Destination Port        |\n+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n|                        Sequence Number                        |\n+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n|                    Acknowledgment Number                      |\n+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n|  Data |           |U|A|P|R|S|F|                               |\n| Offset| Reserved  |R|C|S|S|Y|I|            Window             |\n|       |           |G|K|H|T|N|N|                               |\n+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n|           Checksum            |         Urgent Pointer        |\n+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n|                    Options                    |    Padding    |\n+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n</code></pre> <p>\u0424\u043b\u0430\u0433\u0438 (6 \u0431\u0438\u0442):</p> <ul> <li>SYN - \u0441\u0438\u043d\u0445\u0440\u043e\u043d\u0438\u0437\u0430\u0446\u0438\u044f sequence numbers, \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u043a\u0430 \u0441\u043e\u0435\u0434\u0438\u043d\u0435\u043d\u0438\u044f</li> <li>ACK - \u043f\u043e\u043b\u0435 Acknowledgment Number \u0432\u0430\u043b\u0438\u0434\u043d\u043e</li> <li>FIN - \u043e\u0442\u043f\u0440\u0430\u0432\u0438\u0442\u0435\u043b\u044c \u0437\u0430\u0432\u0435\u0440\u0448\u0430\u0435\u0442 \u043f\u0435\u0440\u0435\u0434\u0430\u0447\u0443</li> <li>RST - \u0441\u0431\u0440\u043e\u0441 \u0441\u043e\u0435\u0434\u0438\u043d\u0435\u043d\u0438\u044f</li> <li>PSH - \u043f\u0435\u0440\u0435\u0434\u0430\u0442\u044c \u0434\u0430\u043d\u043d\u044b\u0435 \u043f\u0440\u0438\u043b\u043e\u0436\u0435\u043d\u0438\u044e \u043d\u0435\u043c\u0435\u0434\u043b\u0435\u043d\u043d\u043e</li> <li>URG - \u043f\u043e\u043b\u0435 Urgent Pointer \u0432\u0430\u043b\u0438\u0434\u043d\u043e</li> </ul>"},{"location":"networking/tcp/index.html#3-way-handshake","title":"\u0423\u0441\u0442\u0430\u043d\u043e\u0432\u043a\u0430 \u0441\u043e\u0435\u0434\u0438\u043d\u0435\u043d\u0438\u044f (3-way handshake)","text":"Text Only<pre><code>Client                    Server\n   |                         |\n   |-------- SYN -----------&gt;|   seq=x\n   |                         |\n   |&lt;----- SYN+ACK ----------|   seq=y, ack=x+1\n   |                         |\n   |-------- ACK -----------&gt;|   seq=x+1, ack=y+1\n   |                         |\n</code></pre> <p>\u0426\u0435\u043b\u044c: \u043e\u0431\u043c\u0435\u043d \u043d\u0430\u0447\u0430\u043b\u044c\u043d\u044b\u043c\u0438 sequence numbers, \u043f\u0440\u0435\u0434\u043e\u0442\u0432\u0440\u0430\u0449\u0435\u043d\u0438\u0435 \u0434\u0443\u0431\u043b\u0438\u043a\u0430\u0442\u043e\u0432 \u0441\u0442\u0430\u0440\u044b\u0445 \u0441\u043e\u0435\u0434\u0438\u043d\u0435\u043d\u0438\u0439.</p>"},{"location":"networking/tcp/index.html#4-way-handshake","title":"\u0417\u0430\u043a\u0440\u044b\u0442\u0438\u0435 \u0441\u043e\u0435\u0434\u0438\u043d\u0435\u043d\u0438\u044f (4-way handshake)","text":"Text Only<pre><code>Client                    Server\n   |                         |\n   |-------- FIN -----------&gt;|   active close\n   |                         |\n   |&lt;------- ACK ------------|\n   |                         |\n   |&lt;------- FIN ------------|   passive close\n   |                         |\n   |-------- ACK -----------&gt;|\n   |                         |\n   | (TIME_WAIT 2*MSL)       |\n</code></pre>"},{"location":"networking/tcp/index.html#tcp_2","title":"\u0421\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u044f TCP","text":"<p>LISTEN - \u043e\u0436\u0438\u0434\u0430\u043d\u0438\u0435 \u0432\u0445\u043e\u0434\u044f\u0449\u0438\u0445 \u0441\u043e\u0435\u0434\u0438\u043d\u0435\u043d\u0438\u0439 (passive open) SYN_SENT - \u043e\u0442\u043f\u0440\u0430\u0432\u043b\u0435\u043d SYN, \u0436\u0434\u0435\u043c SYN+ACK SYN_RECEIVED - \u043f\u043e\u043b\u0443\u0447\u0435\u043d SYN, \u043e\u0442\u043f\u0440\u0430\u0432\u043b\u0435\u043d SYN+ACK ESTABLISHED - \u0441\u043e\u0435\u0434\u0438\u043d\u0435\u043d\u0438\u0435 \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d\u043e, \u043f\u0435\u0440\u0435\u0434\u0430\u0447\u0430 \u0434\u0430\u043d\u043d\u044b\u0445 FIN_WAIT_1 - \u043e\u0442\u043f\u0440\u0430\u0432\u043b\u0435\u043d FIN, \u0436\u0434\u0435\u043c ACK FIN_WAIT_2 - \u043f\u043e\u043b\u0443\u0447\u0435\u043d ACK \u043d\u0430 FIN, \u0436\u0434\u0435\u043c FIN \u043e\u0442 \u0434\u0440\u0443\u0433\u043e\u0439 \u0441\u0442\u043e\u0440\u043e\u043d\u044b CLOSE_WAIT - \u043f\u043e\u043b\u0443\u0447\u0435\u043d FIN, \u0436\u0434\u0435\u043c close() \u043e\u0442 \u043f\u0440\u0438\u043b\u043e\u0436\u0435\u043d\u0438\u044f CLOSING - \u043e\u0431\u0435 \u0441\u0442\u043e\u0440\u043e\u043d\u044b \u043e\u0442\u043f\u0440\u0430\u0432\u0438\u043b\u0438 FIN \u043e\u0434\u043d\u043e\u0432\u0440\u0435\u043c\u0435\u043d\u043d\u043e LAST_ACK - \u043f\u043e\u0441\u043b\u0435 \u043e\u0442\u043f\u0440\u0430\u0432\u043a\u0438 FIN \u0432 \u043e\u0442\u0432\u0435\u0442 \u043d\u0430 \u043f\u043e\u043b\u0443\u0447\u0435\u043d\u043d\u044b\u0439 FIN TIME_WAIT - \u0436\u0434\u0435\u043c 2*MSL (\u043e\u0431\u044b\u0447\u043d\u043e 2 \u043c\u0438\u043d\u0443\u0442\u044b) \u043f\u0435\u0440\u0435\u0434 \u043f\u043e\u043b\u043d\u044b\u043c \u0437\u0430\u043a\u0440\u044b\u0442\u0438\u0435\u043c</p>"},{"location":"networking/tcp/index.html#flow-control","title":"\u041a\u043e\u043d\u0442\u0440\u043e\u043b\u044c \u043f\u043e\u0442\u043e\u043a\u0430 (Flow Control)","text":"<p>Sliding Window - \u043f\u043e\u043b\u0443\u0447\u0430\u0442\u0435\u043b\u044c \u0441\u043e\u043e\u0431\u0449\u0430\u0435\u0442 \u0432 \u043f\u043e\u043b\u0435 Window \u0441\u043a\u043e\u043b\u044c\u043a\u043e \u0431\u0430\u0439\u0442 \u0433\u043e\u0442\u043e\u0432 \u043f\u0440\u0438\u043d\u044f\u0442\u044c. \u041e\u0442\u043f\u0440\u0430\u0432\u0438\u0442\u0435\u043b\u044c \u043d\u0435 \u043c\u043e\u0436\u0435\u0442 \u043e\u0442\u043f\u0440\u0430\u0432\u0438\u0442\u044c \u0431\u043e\u043b\u044c\u0448\u0435, \u0447\u0435\u043c \u0440\u0430\u0437\u0440\u0435\u0448\u0435\u043d\u043e \u043e\u043a\u043d\u043e\u043c.</p> <p>Window = 0: \u043e\u0442\u043f\u0440\u0430\u0432\u0438\u0442\u0435\u043b\u044c \u043e\u0441\u0442\u0430\u043d\u0430\u0432\u043b\u0438\u0432\u0430\u0435\u0442\u0441\u044f \u0438 \u0448\u043b\u0435\u0442 probe-\u043f\u0430\u043a\u0435\u0442\u044b (persist timer).</p> <p>Window Scaling (RFC 1323): \u043e\u043f\u0446\u0438\u044f \u043f\u0440\u0438 handshake, \u043c\u0430\u0441\u0448\u0442\u0430\u0431\u0438\u0440\u0443\u0435\u0442 16-\u0431\u0438\u0442\u043d\u043e\u0435 \u043f\u043e\u043b\u0435 Window \u0434\u043e 1 GB.</p>"},{"location":"networking/tcp/index.html#congestion-control","title":"\u041a\u043e\u043d\u0442\u0440\u043e\u043b\u044c \u043f\u0435\u0440\u0435\u0433\u0440\u0443\u0437\u043e\u043a (Congestion Control)","text":"<p>RFC 5681 \u043e\u043f\u0440\u0435\u0434\u0435\u043b\u044f\u0435\u0442 4 \u0430\u043b\u0433\u043e\u0440\u0438\u0442\u043c\u0430:</p> <p>Slow Start - cwnd (congestion window) \u043d\u0430\u0447\u0438\u043d\u0430\u0435\u0442\u0441\u044f \u0441 \u043c\u0430\u043b\u043e\u0433\u043e \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044f - cwnd \u0443\u0432\u0435\u043b\u0438\u0447\u0438\u0432\u0430\u0435\u0442\u0441\u044f \u043d\u0430 1 MSS \u0437\u0430 \u043a\u0430\u0436\u0434\u044b\u0439 ACK - \u042d\u043a\u0441\u043f\u043e\u043d\u0435\u043d\u0446\u0438\u0430\u043b\u044c\u043d\u044b\u0439 \u0440\u043e\u0441\u0442 \u0434\u043e ssthresh</p> <p>Congestion Avoidance - \u041a\u043e\u0433\u0434\u0430 cwnd &gt;= ssthresh - cwnd \u0443\u0432\u0435\u043b\u0438\u0447\u0438\u0432\u0430\u0435\u0442\u0441\u044f \u043d\u0430 ~1 MSS \u0437\u0430 RTT (\u043b\u0438\u043d\u0435\u0439\u043d\u044b\u0439 \u0440\u043e\u0441\u0442) - AIMD: Additive Increase, Multiplicative Decrease</p> <p>Fast Retransmit - 3 duplicate ACK -&gt; \u043d\u0435\u043c\u0435\u0434\u043b\u0435\u043d\u043d\u0430\u044f \u0440\u0435\u0442\u0440\u0430\u043d\u0441\u043c\u0438\u0441\u0441\u0438\u044f \u0431\u0435\u0437 \u043e\u0436\u0438\u0434\u0430\u043d\u0438\u044f \u0442\u0430\u0439\u043c\u0435\u0440\u0430</p> <p>Fast Recovery - \u041f\u043e\u0441\u043b\u0435 fast retransmit: ssthresh = cwnd/2, cwnd = ssthresh + 3*MSS</p>"},{"location":"networking/tcp/index.html#_2","title":"\u041a\u043e\u043c\u0430\u043d\u0434\u044b","text":"Bash<pre><code>ss -t\n</code></pre> \u041f\u043e\u043a\u0430\u0437\u0430\u0442\u044c TCP-\u0441\u043e\u0435\u0434\u0438\u043d\u0435\u043d\u0438\u044f. Bash<pre><code>ss -tlnp\n</code></pre> \u041f\u043e\u043a\u0430\u0437\u0430\u0442\u044c \u0441\u043b\u0443\u0448\u0430\u044e\u0449\u0438\u0435 TCP-\u043f\u043e\u0440\u0442\u044b \u0441 \u043f\u0440\u043e\u0446\u0435\u0441\u0441\u0430\u043c\u0438. Bash<pre><code>ss -s\n</code></pre> \u0421\u0432\u043e\u0434\u043a\u0430 \u043f\u043e \u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u044f\u043c TCP (estab, timewait, \u0438 \u0442.\u0434.). Bash<pre><code>netstat -nat | awk '{print $6}' | sort | uniq -c | sort -rn\n</code></pre> \u041f\u043e\u0434\u0441\u0447\u0435\u0442 \u0441\u043e\u0435\u0434\u0438\u043d\u0435\u043d\u0438\u0439 \u043f\u043e \u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u044f\u043c. Bash<pre><code>tcpdump -i eth0 tcp port 80 -n\n</code></pre> \u0417\u0430\u0445\u0432\u0430\u0442 TCP-\u0442\u0440\u0430\u0444\u0438\u043a\u0430 \u043d\u0430 \u043f\u043e\u0440\u0442\u0443 80. Bash<pre><code>tcpdump -i eth0 'tcp[tcpflags] &amp; tcp-syn != 0' -n\n</code></pre> \u0417\u0430\u0445\u0432\u0430\u0442 \u0442\u043e\u043b\u044c\u043a\u043e SYN-\u043f\u0430\u043a\u0435\u0442\u043e\u0432. Bash<pre><code>tcpdump -i any -w capture.pcap host 10.0.0.1\n</code></pre> \u0417\u0430\u043f\u0438\u0441\u044c \u0432 \u0444\u0430\u0439\u043b \u0434\u043b\u044f \u0430\u043d\u0430\u043b\u0438\u0437\u0430 \u0432 Wireshark."},{"location":"networking/tcp/index.html#_3","title":"\u041f\u0440\u0438\u043c\u0435\u0440\u044b","text":"<p>\u041f\u0440\u043e\u0432\u0435\u0440\u043a\u0430 \u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u044f \u0441\u043e\u0435\u0434\u0438\u043d\u0435\u043d\u0438\u0439 \u043d\u0430 \u0441\u0435\u0440\u0432\u0435\u0440\u0435:</p> Bash<pre><code>ss -tan state established\nss -tan state time-wait\nss -tan state close-wait\n</code></pre> <p>\u041c\u043d\u043e\u0433\u043e CLOSE_WAIT - \u043f\u0440\u0438\u043b\u043e\u0436\u0435\u043d\u0438\u0435 \u043d\u0435 \u0437\u0430\u043a\u0440\u044b\u0432\u0430\u0435\u0442 \u0441\u043e\u043a\u0435\u0442\u044b (\u0431\u0430\u0433). \u041c\u043d\u043e\u0433\u043e TIME_WAIT - \u043c\u043d\u043e\u0433\u043e \u043a\u043e\u0440\u043e\u0442\u043a\u0438\u0445 \u0441\u043e\u0435\u0434\u0438\u043d\u0435\u043d\u0438\u0439 (\u043d\u043e\u0440\u043c\u0430 \u0434\u043b\u044f HTTP).</p> <p>\u041f\u0440\u043e\u0441\u043c\u043e\u0442\u0440 TCP-\u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u043e\u0432 \u044f\u0434\u0440\u0430:</p> Bash<pre><code>sysctl net.ipv4.tcp_fin_timeout\nsysctl net.ipv4.tcp_keepalive_time\nsysctl net.ipv4.tcp_keepalive_intvl\nsysctl net.ipv4.tcp_keepalive_probes\n</code></pre> <p>\u0418\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u0435 \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u043e\u0432:</p> Bash<pre><code># \u0423\u043c\u0435\u043d\u044c\u0448\u0438\u0442\u044c FIN_WAIT_2 timeout (\u043f\u043e \u0443\u043c\u043e\u043b\u0447\u0430\u043d\u0438\u044e 60)\nsysctl -w net.ipv4.tcp_fin_timeout=15\n\n# Keepalive: \u043f\u0440\u043e\u0432\u0435\u0440\u044f\u0442\u044c \u0447\u0435\u0440\u0435\u0437 5 \u043c\u0438\u043d\u0443\u0442 \u0432\u043c\u0435\u0441\u0442\u043e 2 \u0447\u0430\u0441\u043e\u0432\nsysctl -w net.ipv4.tcp_keepalive_time=300\n</code></pre> <p>\u0414\u043b\u044f \u043f\u043e\u0441\u0442\u043e\u044f\u043d\u043d\u044b\u0445 \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u0439 - \u0434\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0432 /etc/sysctl.conf:</p> Text Only<pre><code>net.ipv4.tcp_fin_timeout = 15\nnet.ipv4.tcp_keepalive_time = 300\nnet.ipv4.tcp_keepalive_intvl = 15\nnet.ipv4.tcp_keepalive_probes = 5\n</code></pre> <p>\u041f\u0440\u0438\u043c\u0435\u043d\u0438\u0442\u044c: <code>sysctl -p</code></p>"},{"location":"networking/tls/index.html","title":"TLS","text":""},{"location":"networking/tls/index.html#tls","title":"TLS","text":""},{"location":"networking/tls/index.html#_1","title":"\u041a\u043e\u0440\u043e\u0442\u043a\u043e","text":"<p>Transport Layer Security - \u0448\u0438\u0444\u0440\u043e\u0432\u0430\u043d\u0438\u0435 \u0441\u043e\u0435\u0434\u0438\u043d\u0435\u043d\u0438\u044f \u043c\u0435\u0436\u0434\u0443 \u043a\u043b\u0438\u0435\u043d\u0442\u043e\u043c \u0438 \u0441\u0435\u0440\u0432\u0435\u0440\u043e\u043c. \u0420\u0430\u0431\u043e\u0442\u0430\u0435\u0442 \u043d\u0430\u0434 TCP (Application Layer). \u0414\u043b\u044f UDP - DTLS. \u041d\u0430\u0431\u043b\u044e\u0434\u0430\u0442\u0435\u043b\u044c \u0432\u0438\u0434\u0438\u0442 \u0442\u043e\u043b\u044c\u043a\u043e IP, \u043f\u043e\u0440\u0442\u044b, \u0442\u0438\u043f \u0448\u0438\u0444\u0440\u043e\u0432\u0430\u043d\u0438\u044f. \u0414\u0430\u043d\u043d\u044b\u0435 \u043d\u0435\u0434\u043e\u0441\u0442\u0443\u043f\u043d\u044b.</p>"},{"location":"networking/tls/index.html#handshake","title":"Handshake","text":"<p>\u0423\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u0435 \u0437\u0430\u0449\u0438\u0449\u0435\u043d\u043d\u043e\u0433\u043e \u0441\u043e\u0435\u0434\u0438\u043d\u0435\u043d\u0438\u044f:</p> <ol> <li>ClientHello - \u043a\u043b\u0438\u0435\u043d\u0442 \u043e\u0442\u043f\u0440\u0430\u0432\u043b\u044f\u0435\u0442 \u0432\u0435\u0440\u0441\u0438\u044e TLS, \u043f\u043e\u0434\u0434\u0435\u0440\u0436\u0438\u0432\u0430\u0435\u043c\u044b\u0435 \u0448\u0438\u0444\u0440\u044b, \u0441\u043b\u0443\u0447\u0430\u0439\u043d\u044b\u0435 \u0434\u0430\u043d\u043d\u044b\u0435</li> <li>ServerHello - \u0441\u0435\u0440\u0432\u0435\u0440 \u0432\u044b\u0431\u0438\u0440\u0430\u0435\u0442 \u0448\u0438\u0444\u0440, \u043e\u0442\u043f\u0440\u0430\u0432\u043b\u044f\u0435\u0442 \u0441\u0435\u0440\u0442\u0438\u0444\u0438\u043a\u0430\u0442</li> <li>Key Exchange - \u043e\u0431\u043c\u0435\u043d \u043a\u043b\u044e\u0447\u0430\u043c\u0438 (\u043e\u0431\u044b\u0447\u043d\u043e ECDHE)</li> <li>Finished - \u043e\u0431\u0435 \u0441\u0442\u043e\u0440\u043e\u043d\u044b \u043f\u043e\u0434\u0442\u0432\u0435\u0440\u0436\u0434\u0430\u044e\u0442, \u043d\u0430\u0447\u0438\u043d\u0430\u0435\u0442\u0441\u044f \u0448\u0438\u0444\u0440\u043e\u0432\u0430\u043d\u043d\u044b\u0439 \u043e\u0431\u043c\u0435\u043d</li> </ol> <p>TLS 1.3: 1-RTT (\u043e\u0434\u0438\u043d round-trip). TLS 1.2: 2-RTT.</p>"},{"location":"networking/tls/index.html#session-ticket","title":"Session Ticket","text":"<p>\u041e\u043f\u0442\u0438\u043c\u0438\u0437\u0430\u0446\u0438\u044f \u0434\u043b\u044f \u043f\u043e\u0432\u0442\u043e\u0440\u043d\u044b\u0445 \u0441\u043e\u0435\u0434\u0438\u043d\u0435\u043d\u0438\u0439.</p> <ul> <li>\u0421\u0435\u0440\u0432\u0435\u0440 \u0448\u0438\u0444\u0440\u0443\u0435\u0442 \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u044b \u0441\u0435\u0441\u0441\u0438\u0438 \u0441\u0432\u043e\u0438\u043c \u043a\u043b\u044e\u0447\u043e\u043c \u0438 \u043e\u0442\u043f\u0440\u0430\u0432\u043b\u044f\u0435\u0442 \u043a\u043b\u0438\u0435\u043d\u0442\u0443</li> <li>\u041a\u043b\u0438\u0435\u043d\u0442 \u043f\u0440\u0438 reconnect \u043e\u0442\u043f\u0440\u0430\u0432\u043b\u044f\u0435\u0442 ticket \u0432 ClientHello</li> <li>\u0421\u0435\u0440\u0432\u0435\u0440 \u0440\u0430\u0441\u0448\u0438\u0444\u0440\u043e\u0432\u044b\u0432\u0430\u0435\u0442 - \u0441\u0435\u0441\u0441\u0438\u044f \u0432\u043e\u0441\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d\u0430 \u0431\u0435\u0437 \u043f\u043e\u043b\u043d\u043e\u0433\u043e handshake</li> <li>\u0421\u0435\u0440\u0432\u0435\u0440 \u043d\u0435 \u0445\u0440\u0430\u043d\u0438\u0442 \u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u0435 \u0441\u0435\u0441\u0441\u0438\u0439</li> </ul>"},{"location":"networking/tls/index.html#false-start","title":"False Start","text":"<p>\u041e\u043f\u0442\u0438\u043c\u0438\u0437\u0430\u0446\u0438\u044f: \u043a\u043b\u0438\u0435\u043d\u0442 \u043d\u0430\u0447\u0438\u043d\u0430\u0435\u0442 \u043e\u0442\u043f\u0440\u0430\u0432\u043b\u044f\u0442\u044c \u0434\u0430\u043d\u043d\u044b\u0435 \u0434\u043e \u0437\u0430\u0432\u0435\u0440\u0448\u0435\u043d\u0438\u044f handshake. \u0420\u0430\u0431\u043e\u0442\u0430\u0435\u0442 \u0442\u043e\u043b\u044c\u043a\u043e \u0435\u0441\u043b\u0438 \u0432\u044b\u0431\u0440\u0430\u043d \u0448\u0438\u0444\u0440 \u0441 forward secrecy.</p>"},{"location":"networking/tls/index.html#tls-13-vs-12","title":"TLS 1.3 vs 1.2","text":"<ul> <li>1.3: \u0443\u0431\u0440\u0430\u043d\u044b \u0443\u0441\u0442\u0430\u0440\u0435\u0432\u0448\u0438\u0435 \u0448\u0438\u0444\u0440\u044b (RSA key exchange, CBC, SHA-1)</li> <li>1.3: \u043e\u0431\u044f\u0437\u0430\u0442\u0435\u043b\u044c\u043d\u044b\u0439 forward secrecy (ECDHE)</li> <li>1.3: 0-RTT resumption (\u0441 \u0440\u0438\u0441\u043a\u0430\u043c\u0438 replay)</li> <li>1.3: \u0437\u0430\u0448\u0438\u0444\u0440\u043e\u0432\u0430\u043d handshake \u043f\u043e\u0441\u043b\u0435 ServerHello</li> </ul>"},{"location":"storage/ceph/index.html","title":"Ceph","text":""},{"location":"storage/ceph/index.html#ceph","title":"Ceph","text":""},{"location":"storage/ceph/index.html#tldr","title":"TL;DR","text":"<p>\u041f\u0440\u043e\u0433\u0440\u0430\u043c\u043c\u043d\u043e-\u043e\u043f\u0440\u0435\u0434\u0435\u043b\u044f\u0435\u043c\u043e\u0435 \u0440\u0430\u0441\u043f\u0440\u0435\u0434\u0435\u043b\u0451\u043d\u043d\u043e\u0435 \u0445\u0440\u0430\u043d\u0438\u043b\u0438\u0449\u0435. \u0414\u0430\u0451\u0442 block (RBD), object (S3/Swift) \u0438 file (CephFS) storage \u0438\u0437 \u043e\u0434\u043d\u043e\u0433\u043e \u043a\u043b\u0430\u0441\u0442\u0435\u0440\u0430.</p> <ul> <li>OSD (Object Storage Daemon) \u2014 \u0445\u0440\u0430\u043d\u0438\u0442 \u0434\u0430\u043d\u043d\u044b\u0435 \u043d\u0430 \u0434\u0438\u0441\u043a\u0430\u0445</li> <li>MON (Monitor) \u2014 \u0441\u043b\u0435\u0434\u0438\u0442 \u0437\u0430 \u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u0435\u043c \u043a\u043b\u0430\u0441\u0442\u0435\u0440\u0430, \u0445\u0440\u0430\u043d\u0438\u0442 \u043a\u0430\u0440\u0442\u0443</li> <li>MGR (Manager) \u2014 \u043c\u0435\u0442\u0440\u0438\u043a\u0438, \u0434\u0430\u0448\u0431\u043e\u0440\u0434, \u0431\u0430\u043b\u0430\u043d\u0441\u0438\u0440\u043e\u0432\u043a\u0430</li> <li>MDS (Metadata Server) \u2014 \u0442\u043e\u043b\u044c\u043a\u043e \u0434\u043b\u044f CephFS</li> </ul>"},{"location":"storage/ceph/index.html#_1","title":"\u041f\u0430\u043a\u0435\u0442\u044b \u0438 \u043f\u0443\u0442\u0438","text":"<ul> <li>\u041f\u0430\u043a\u0435\u0442\u044b: <code>ceph</code>, <code>ceph-radosgw</code></li> <li>\u0421\u0435\u0440\u0432\u0438\u0441: <code>ceph.service</code></li> <li>\u041a\u043e\u043d\u0444\u0438\u0433: <code>/etc/ceph/ceph.conf</code></li> <li>\u041b\u043e\u0433\u0438: <code>/var/log/ceph/*</code></li> <li>Keyring: <code>/etc/ceph/ceph.client.admin.keyring</code></li> </ul>"},{"location":"storage/ceph/index.html#_2","title":"\u041a\u043e\u043c\u0430\u043d\u0434\u044b","text":""},{"location":"storage/ceph/index.html#_3","title":"\u0421\u0442\u0430\u0442\u0443\u0441 \u043a\u043b\u0430\u0441\u0442\u0435\u0440\u0430","text":"Bash<pre><code>ceph status\nceph health detail\n</code></pre> \u041e\u0431\u0449\u0435\u0435 \u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u0435. HEALTH_OK / HEALTH_WARN / HEALTH_ERR. Bash<pre><code>ceph osd tree\n</code></pre> \u0414\u0435\u0440\u0435\u0432\u043e OSD \u2014 \u043a\u0430\u043a\u0438\u0435 \u0434\u0438\u0441\u043a\u0438 \u043d\u0430 \u043a\u0430\u043a\u0438\u0445 \u0445\u043e\u0441\u0442\u0430\u0445, \u0441\u0442\u0430\u0442\u0443\u0441 up/down. Bash<pre><code>ceph df\n</code></pre> \u0418\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u043d\u0438\u0435 \u043c\u0435\u0441\u0442\u0430 \u0432 \u043a\u043b\u0430\u0441\u0442\u0435\u0440\u0435 \u0438 \u043f\u043e \u043f\u0443\u043b\u0430\u043c."},{"location":"storage/ceph/index.html#_4","title":"\u041f\u0443\u043b\u044b","text":"Bash<pre><code>ceph osd pool ls\n</code></pre> \u0421\u043f\u0438\u0441\u043e\u043a \u043f\u0443\u043b\u043e\u0432. Bash<pre><code>ceph osd pool create mypool 128\n</code></pre> \u0421\u043e\u0437\u0434\u0430\u0442\u044c \u043f\u0443\u043b \u0441 128 PG (placement groups). Bash<pre><code>ceph osd pool set mypool size 3\n</code></pre> \u0423\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c \u0440\u0435\u043f\u043b\u0438\u043a\u0430\u0446\u0438\u044e x3."},{"location":"storage/ceph/index.html#rbd-block-storage","title":"RBD (block storage)","text":"Bash<pre><code>rbd create mypool/myimage --size 10G\n</code></pre> \u0421\u043e\u0437\u0434\u0430\u0442\u044c \u0431\u043b\u043e\u0447\u043d\u044b\u0439 \u043e\u0431\u0440\u0430\u0437 10 \u0413\u0411. Bash<pre><code>rbd map mypool/myimage\n</code></pre> \u041f\u043e\u0434\u043a\u043b\u044e\u0447\u0438\u0442\u044c \u043a\u0430\u043a /dev/rbdX. Bash<pre><code>rbd ls mypool\nrbd info mypool/myimage\n</code></pre> \u0421\u043f\u0438\u0441\u043e\u043a \u043e\u0431\u0440\u0430\u0437\u043e\u0432 / \u0438\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u044f."},{"location":"storage/ceph/index.html#_5","title":"\u0421\u0435\u0440\u0432\u0438\u0441\u044b","text":"Bash<pre><code>ceph orch ls\nceph orch ps\n</code></pre> \u0421\u043f\u0438\u0441\u043e\u043a \u0441\u0435\u0440\u0432\u0438\u0441\u043e\u0432 \u0438 \u043f\u0440\u043e\u0446\u0435\u0441\u0441\u043e\u0432 (cephadm). Bash<pre><code>ceph orch daemon restart osd.0\n</code></pre> \u041f\u0435\u0440\u0435\u0437\u0430\u043f\u0443\u0441\u0442\u0438\u0442\u044c \u043a\u043e\u043d\u043a\u0440\u0435\u0442\u043d\u044b\u0439 \u0434\u0435\u043c\u043e\u043d."},{"location":"storage/ceph/index.html#_6","title":"\u041f\u0440\u043e\u0432\u0435\u0440\u043a\u0430","text":"Bash<pre><code>ceph health\n</code></pre> \u0411\u044b\u0441\u0442\u0440\u0430\u044f \u043f\u0440\u043e\u0432\u0435\u0440\u043a\u0430 \u2014 HEALTH_OK \u0437\u043d\u0430\u0447\u0438\u0442 \u0432\u0441\u0451 \u043e\u043a. Bash<pre><code>ceph osd stat\n</code></pre> \u0421\u043a\u043e\u043b\u044c\u043a\u043e OSD \u0432\u0441\u0435\u0433\u043e / up / in. Bash<pre><code>ceph pg stat\n</code></pre> \u0421\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u0435 placement groups."},{"location":"storage/ceph/index.html#_7","title":"\u041f\u043e\u0434\u0432\u043e\u0434\u043d\u044b\u0435 \u043a\u0430\u043c\u043d\u0438","text":"<ul> <li>\u041c\u0438\u043d\u0438\u043c\u0443\u043c 3 MON \u0434\u043b\u044f \u043a\u0432\u043e\u0440\u0443\u043c\u0430</li> <li>PG count \u0432\u043b\u0438\u044f\u0435\u0442 \u043d\u0430 \u043f\u0440\u043e\u0438\u0437\u0432\u043e\u0434\u0438\u0442\u0435\u043b\u044c\u043d\u043e\u0441\u0442\u044c \u2014 \u0441\u043b\u0438\u0448\u043a\u043e\u043c \u043c\u0430\u043b\u043e \u0438\u043b\u0438 \u043c\u043d\u043e\u0433\u043e = \u043f\u0440\u043e\u0431\u043b\u0435\u043c\u044b</li> <li>\u041f\u0440\u0438 \u043f\u0430\u0434\u0435\u043d\u0438\u0438 OSD \u0434\u0430\u043d\u043d\u044b\u0435 \u0440\u0435\u0431\u0430\u043b\u0430\u043d\u0441\u0438\u0440\u0443\u044e\u0442\u0441\u044f \u2014 \u043d\u0430\u0433\u0440\u0443\u0437\u043a\u0430 \u043d\u0430 \u0441\u0435\u0442\u044c</li> <li><code>ceph osd pool delete</code> \u0442\u0440\u0435\u0431\u0443\u0435\u0442 \u043f\u043e\u0434\u0442\u0432\u0435\u0440\u0436\u0434\u0435\u043d\u0438\u044f \u0434\u0432\u0430\u0436\u0434\u044b (\u0437\u0430\u0449\u0438\u0442\u0430 \u043e\u0442 \u0441\u043b\u0443\u0447\u0430\u0439\u043d\u043e\u0433\u043e \u0443\u0434\u0430\u043b\u0435\u043d\u0438\u044f)</li> </ul>"},{"location":"storage/lvm/index.html","title":"LVM","text":""},{"location":"storage/lvm/index.html#lvm","title":"LVM","text":""},{"location":"storage/lvm/index.html#tldr","title":"TL;DR","text":"<ul> <li>PV (Physical Volume) \u2014 \u0444\u0438\u0437\u0438\u0447\u0435\u0441\u043a\u0438\u0439 \u0434\u0438\u0441\u043a/\u0440\u0430\u0437\u0434\u0435\u043b</li> <li>VG (Volume Group) \u2014 \u043e\u0431\u044a\u0435\u0434\u0438\u043d\u0435\u043d\u0438\u0435 PV \u0432 \u043f\u0443\u043b</li> <li>LV (Logical Volume) \u2014 \u0432\u0438\u0440\u0442\u0443\u0430\u043b\u044c\u043d\u044b\u0439 \u0440\u0430\u0437\u0434\u0435\u043b \u0438\u0437 VG</li> <li>\u041c\u043e\u0436\u043d\u043e \u043c\u0435\u043d\u044f\u0442\u044c \u0440\u0430\u0437\u043c\u0435\u0440 LV \u043d\u0430 \u043b\u0435\u0442\u0443, \u0434\u0435\u043b\u0430\u0442\u044c \u0441\u043d\u0430\u043f\u0448\u043e\u0442\u044b</li> </ul>"},{"location":"storage/lvm/index.html#_1","title":"\u0411\u044b\u0441\u0442\u0440\u044b\u0439 \u0441\u0442\u0430\u0440\u0442","text":"<p>\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u043d\u043e\u0432\u044b\u0439 \u0434\u0438\u0441\u043a \u0438 \u0441\u043e\u0437\u0434\u0430\u0442\u044c \u0442\u043e\u043c:</p> Bash<pre><code>pvcreate /dev/sdb\nvgcreate data_vg /dev/sdb\nlvcreate -L 50G -n app_lv data_vg\nmkfs.ext4 /dev/data_vg/app_lv\nmount /dev/data_vg/app_lv /mnt/app\n</code></pre>"},{"location":"storage/lvm/index.html#_2","title":"\u041a\u043e\u043c\u0430\u043d\u0434\u044b","text":""},{"location":"storage/lvm/index.html#_3","title":"\u0421\u043e\u0437\u0434\u0430\u043d\u0438\u0435","text":"Bash<pre><code>pvcreate /dev/sdX\n</code></pre> \u0418\u043d\u0438\u0446\u0438\u0430\u043b\u0438\u0437\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0434\u0438\u0441\u043a \u043a\u0430\u043a PV. Bash<pre><code>vgcreate my_vg /dev/sdb /dev/sdc\n</code></pre> \u0421\u043e\u0437\u0434\u0430\u0442\u044c VG \u0438\u0437 \u043d\u0435\u0441\u043a\u043e\u043b\u044c\u043a\u0438\u0445 PV. Bash<pre><code>lvcreate -L 10G -n my_lv my_vg\n</code></pre> \u0421\u043e\u0437\u0434\u0430\u0442\u044c LV \u043d\u0430 10 \u0413\u0411."},{"location":"storage/lvm/index.html#_4","title":"\u0420\u0430\u0441\u0448\u0438\u0440\u0435\u043d\u0438\u0435","text":"Bash<pre><code>lvextend -L +5G /dev/my_vg/my_lv\nresize2fs /dev/my_vg/my_lv\n</code></pre> \u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c 5 \u0413\u0411 \u043a LV \u0438 \u0440\u0430\u0441\u0448\u0438\u0440\u0438\u0442\u044c \u0424\u0421 (ext4)."},{"location":"storage/lvm/index.html#_5","title":"\u0421\u043e\u043a\u0440\u0430\u0449\u0435\u043d\u0438\u0435","text":"Bash<pre><code>umount /dev/my_vg/my_lv\ne2fsck -f /dev/my_vg/my_lv\nresize2fs /dev/my_vg/my_lv 15G\nlvreduce -L 15G /dev/my_vg/my_lv\nmount /dev/my_vg/my_lv /mnt\n</code></pre> \u0421\u043d\u0430\u0447\u0430\u043b\u0430 \u0443\u043c\u0435\u043d\u044c\u0448\u0438\u0442\u044c \u0424\u0421, \u043f\u043e\u0442\u043e\u043c LV. \u0418\u043d\u0430\u0447\u0435 \u043f\u043e\u0442\u0435\u0440\u044f \u0434\u0430\u043d\u043d\u044b\u0445."},{"location":"storage/lvm/index.html#_6","title":"\u0421\u043d\u0430\u043f\u0448\u043e\u0442\u044b","text":"Bash<pre><code>lvcreate -L 5G -s -n my_lv_snap /dev/my_vg/my_lv\n</code></pre> \u0421\u043d\u0430\u043f\u0448\u043e\u0442 \u0434\u043b\u044f \u0431\u044d\u043a\u0430\u043f\u0430. \u0420\u0430\u0437\u043c\u0435\u0440 \u2014 \u043f\u043e\u0434 \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u044f \u043d\u0430 \u0432\u0440\u0435\u043c\u044f \u0436\u0438\u0437\u043d\u0438 \u0441\u043d\u0430\u043f\u0448\u043e\u0442\u0430."},{"location":"storage/lvm/index.html#_7","title":"\u041f\u0440\u043e\u0441\u043c\u043e\u0442\u0440","text":"Bash<pre><code>pvs / pvdisplay\nvgs / vgdisplay\nlvs / lvdisplay\n</code></pre> \u041a\u043e\u0440\u043e\u0442\u043a\u0438\u0439 / \u043f\u043e\u0434\u0440\u043e\u0431\u043d\u044b\u0439 \u0432\u044b\u0432\u043e\u0434."},{"location":"storage/lvm/index.html#_8","title":"\u0423\u0434\u0430\u043b\u0435\u043d\u0438\u0435","text":"Bash<pre><code>lvremove /dev/my_vg/my_lv\n</code></pre>"},{"location":"storage/lvm/index.html#_9","title":"\u041f\u043e\u0434\u0432\u043e\u0434\u043d\u044b\u0435 \u043a\u0430\u043c\u043d\u0438","text":"<ul> <li><code>lvreduce</code> \u0431\u0435\u0437 \u043f\u0440\u0435\u0434\u0432\u0430\u0440\u0438\u0442\u0435\u043b\u044c\u043d\u043e\u0433\u043e <code>resize2fs</code> = \u043f\u043e\u0442\u0435\u0440\u044f \u0434\u0430\u043d\u043d\u044b\u0445</li> <li>\u0421\u043d\u0430\u043f\u0448\u043e\u0442 \u043f\u0435\u0440\u0435\u043f\u043e\u043b\u043d\u0438\u0442\u0441\u044f \u0435\u0441\u043b\u0438 \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u0439 \u0431\u043e\u043b\u044c\u0448\u0435 \u0447\u0435\u043c \u0435\u0433\u043e \u0440\u0430\u0437\u043c\u0435\u0440 \u2014 \u0441\u0442\u0430\u043d\u0435\u0442 \u043d\u0435\u0432\u0430\u043b\u0438\u0434\u043d\u044b\u043c</li> <li>\u0414\u043b\u044f XFS \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0439 <code>xfs_growfs</code> \u0432\u043c\u0435\u0441\u0442\u043e <code>resize2fs</code></li> </ul>"}]}