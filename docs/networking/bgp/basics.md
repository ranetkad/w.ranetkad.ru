# BGP - основы

## Коротко

Протокол маршрутизации между автономными системами (AS). Работает поверх TCP:179.
eBGP - между разными AS, iBGP - внутри одной AS.

## Установление соседства

TCP:179. При коллизии (оба пытаются установить сессию) - остается соединение от соседа с большим router-id.

Состояния FSM:

- **Idle** - начальное, входящие запросы отбрасываются
- **Connect** - слушает TCP:179
- **Active** - пытается установить исходящее соединение
- **OpenSent** - ожидает OPEN от соседа
- **OpenConfirm** - получен корректный OPEN, ждет KEEPALIVE
- **Established** - сессия установлена, обмен маршрутами

## Типы соседства

**eBGP** (external):

- Сосед из другой AS
- TTL = 1 (по умолчанию)
- Атрибуты модифицируются при отправке

**iBGP** (internal):

- Сосед из своей AS
- TTL = 255
- Атрибуты не модифицируются
- Обычно устанавливается с Loopback-интерфейсов

## Peer-group

Группировка соседей с одинаковыми настройками. Упрощает конфигурацию - параметры применяются ко всем членам группы.

## Шаблоны

Аналог peer-group. Определяют общие параметры (политики, фильтры), которые применяются к нескольким соседям.
